<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CrystalFieldHeatCapacity</title>
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '6.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="CrystalFieldMagnetisation" href="CrystalFieldMagnetisation.html" />
    <link rel="prev" title="CrystalFieldFunction" href="CrystalFieldFunction.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.3</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="crystalfieldheatcapacity">
<span id="func-crystalfieldheatcapacity"></span><h1>CrystalFieldHeatCapacity<a class="headerlink" href="#crystalfieldheatcapacity" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<span id="index-0"></span><h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This function calculates the magnetic contribution to the heat capacity of a material from the splitting of its electronic energy
levels by the crystal field. It is a part of crystal field computation in Mantid and under active development.
More documentation will follow as the development progresses.</p>
</div>
<div class="section" id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p>The heat capacity at constant volume is given by</p>
<div class="math">
\[\begin{split}C_v = \left. \frac{\partial U}{\partial T} \right|_V = \frac{1}{k_B T^2}
\frac{\partial}{\partial \beta} \left[ \frac{1}{Z}\frac{\partial Z}{\partial \beta} \right]
\qquad \qquad \qquad \qquad \qquad \qquad \qquad \\
= \frac{1}{k_B T^2} \left( \frac{1}{Z}\sum_n E_n^2 \exp(-\beta E_n)
  - \left[ \frac{1}{Z}\sum_n E_n \exp(-\beta E_n) \right]^2 \right)\end{split}\]</div>
<p>where <span class="math">\(k_B\)</span> is Boltzmann’s constant, <span class="math">\(Z\)</span> is the partition sum, and <span class="math">\(E_n\)</span> is the n-th energy level split by the
crystal field. This is obtained by diagonalising the crystal field Hamiltonian.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Here is an example of how to fit function’s parameters to a spectrum. All parameters disallowed by symmetry are fixed automatically.
The “data” here is generated from the function itself. For real data, you should subtract the phonon contribution manually using either
measurements from a phonon blank or a theoretical calculation (e.g. Debye model, or from lattice dynamical calculations) before
using it with this function.</p>
<p>The <cite>x</cite>-axis is given in Kelvin, and the heat capacity (<cite>y</cite>-axis) is in Joules per mole-Kelvin (Jmol<sup>-1</sup>K<sup>-1</sup>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Build a reference data set</span>
<span class="n">fun</span> <span class="o">=</span> <span class="s1">&#39;name=CrystalFieldHeatCapacity,Ion=Ce,B20=0.37737,B22=0.039770,B40=-0.031787,B42=-0.11611,B44=-0.12544&#39;</span>

<span class="c1"># This creates a (empty) workspace to use with EvaluateFunction</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">0</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

<span class="c1"># The calculated data will be in &#39;data&#39;, WorkspaceIndex=1</span>
<span class="n">EvaluateFunction</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

 <span class="c1"># Change parameters slightly and fit to the reference data</span>
<span class="n">fun</span> <span class="o">=</span> <span class="s1">&#39;name=CrystalFieldHeatCapacity,Ion=Ce,Symmetry=C2v,B20=0.4,B22=0.04,B40=-0.03,B42=-0.1,B44=-0.1,&#39;</span>
<span class="n">fun</span> <span class="o">+=</span> <span class="s1">&#39;ties=(B60=0,B62=0,B64=0,B66=0,BmolX=0,BmolY=0,BmolZ=0,BextX=0,BextY=0,BextZ=0)&#39;</span>

<span class="c1"># (set MaxIterations=0 to see the starting point)</span>
<span class="n">Fit</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Output</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span><span class="n">MaxIterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">CostFunction</span><span class="o">=</span><span class="s1">&#39;Unweighted least squares&#39;</span><span class="p">)</span>
<span class="c1"># Using Unweighted least squares fit because the data has no errors.</span>

<span class="c1"># Extract fitted parameters</span>
<span class="n">parws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fit_Parameters&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">parws</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">parws</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%7s</span><span class="s2"> = </span><span class="si">% 7.5g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output (the numbers you see on your machine may vary):</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span>    <span class="n">B20</span> <span class="o">=</span>  <span class="mf">0.40709</span>
    <span class="n">B22</span> <span class="o">=</span>  <span class="mf">0.020272</span>
    <span class="n">B40</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.031454</span>
    <span class="n">B42</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.10724</span>
    <span class="n">B44</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1314</span>
<span class="n">Cost</span> <span class="n">function</span> <span class="n">value</span> <span class="o">=</span>  <span class="mf">4.4642e-15</span>
</pre></div>
</div>
</div>
<div class="section" id="attributes-non-fitting-parameters">
<h2>Attributes (non-fitting parameters)<a class="headerlink" href="#attributes-non-fitting-parameters" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="2%" />
<col width="3%" />
<col width="91%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Ion</td>
<td>String</td>
<td>Mandatory</td>
<td>An element name for a rare earth ion. Possible values are: Ce, Pr, Nd, Pm, Sm, Eu, Gd, Tb, Dy, Ho, Er, Tm, Yb.</td>
</tr>
<tr class="row-odd"><td>Symmetry</td>
<td>String</td>
<td>C1</td>
<td>A symbol for a symmetry group. Setting <cite>Symmetry</cite> automatically zeros and fixes all forbidden parameters. Possible values are: C1, Ci, C2, Cs, C2h, C2v, D2, D2h, C4, S4, C4h, D4, C4v, D2d, D4h, C3, S6, D3, C3v, D3d, C6, C3h, C6h, D6, C6v, D3h, D6h, T, Td, Th, O, Oh</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="properties-fitting-parameters">
<h2>Properties (fitting parameters)<a class="headerlink" href="#properties-fitting-parameters" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="8%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>BmolX</td>
<td>0.0</td>
<td>The x-component of the molecular field.</td>
</tr>
<tr class="row-odd"><td>BmolY</td>
<td>0.0</td>
<td>The y-component of the molecular field.</td>
</tr>
<tr class="row-even"><td>BmolZ</td>
<td>0.0</td>
<td>The z-component of the molecular field.</td>
</tr>
<tr class="row-odd"><td>BextX</td>
<td>0.0</td>
<td>The x-component of the external field.</td>
</tr>
<tr class="row-even"><td>BextY</td>
<td>0.0</td>
<td>The y-component of the external field.</td>
</tr>
<tr class="row-odd"><td>BextZ</td>
<td>0.0</td>
<td>The z-component of the external field.</td>
</tr>
<tr class="row-even"><td>B20</td>
<td>0.0</td>
<td>Real part of the B20 field parameter.</td>
</tr>
<tr class="row-odd"><td>B21</td>
<td>0.0</td>
<td>Real part of the B21 field parameter.</td>
</tr>
<tr class="row-even"><td>B22</td>
<td>0.0</td>
<td>Real part of the B22 field parameter.</td>
</tr>
<tr class="row-odd"><td>B40</td>
<td>0.0</td>
<td>Real part of the B40 field parameter.</td>
</tr>
<tr class="row-even"><td>B41</td>
<td>0.0</td>
<td>Real part of the B41 field parameter.</td>
</tr>
<tr class="row-odd"><td>B42</td>
<td>0.0</td>
<td>Real part of the B42 field parameter.</td>
</tr>
<tr class="row-even"><td>B43</td>
<td>0.0</td>
<td>Real part of the B43 field parameter.</td>
</tr>
<tr class="row-odd"><td>B44</td>
<td>0.0</td>
<td>Real part of the B44 field parameter.</td>
</tr>
<tr class="row-even"><td>B60</td>
<td>0.0</td>
<td>Real part of the B60 field parameter.</td>
</tr>
<tr class="row-odd"><td>B61</td>
<td>0.0</td>
<td>Real part of the B61 field parameter.</td>
</tr>
<tr class="row-even"><td>B62</td>
<td>0.0</td>
<td>Real part of the B62 field parameter.</td>
</tr>
<tr class="row-odd"><td>B63</td>
<td>0.0</td>
<td>Real part of the B63 field parameter.</td>
</tr>
<tr class="row-even"><td>B64</td>
<td>0.0</td>
<td>Real part of the B64 field parameter.</td>
</tr>
<tr class="row-odd"><td>B65</td>
<td>0.0</td>
<td>Real part of the B65 field parameter.</td>
</tr>
<tr class="row-even"><td>B66</td>
<td>0.0</td>
<td>Real part of the B66 field parameter.</td>
</tr>
<tr class="row-odd"><td>IB21</td>
<td>0.0</td>
<td>Imaginary part of the B21 field parameter.</td>
</tr>
<tr class="row-even"><td>IB22</td>
<td>0.0</td>
<td>Imaginary part of the B22 field parameter.</td>
</tr>
<tr class="row-odd"><td>IB41</td>
<td>0.0</td>
<td>Imaginary part of the B41 field parameter.</td>
</tr>
<tr class="row-even"><td>IB42</td>
<td>0.0</td>
<td>Imaginary part of the B42 field parameter.</td>
</tr>
<tr class="row-odd"><td>IB43</td>
<td>0.0</td>
<td>Imaginary part of the B43 field parameter.</td>
</tr>
<tr class="row-even"><td>IB44</td>
<td>0.0</td>
<td>Imaginary part of the B44 field parameter.</td>
</tr>
<tr class="row-odd"><td>IB61</td>
<td>0.0</td>
<td>Imaginary part of the B61 field parameter.</td>
</tr>
<tr class="row-even"><td>IB62</td>
<td>0.0</td>
<td>Imaginary part of the B62 field parameter.</td>
</tr>
<tr class="row-odd"><td>IB63</td>
<td>0.0</td>
<td>Imaginary part of the B63 field parameter.</td>
</tr>
<tr class="row-even"><td>IB64</td>
<td>0.0</td>
<td>Imaginary part of the B64 field parameter.</td>
</tr>
<tr class="row-odd"><td>IB65</td>
<td>0.0</td>
<td>Imaginary part of the B65 field parameter.</td>
</tr>
<tr class="row-even"><td>IB66</td>
<td>0.0</td>
<td>Imaginary part of the B66 field parameter.</td>
</tr>
</tbody>
</table>
<p><strong>Categories</strong>: <a class="reference external" href="categories/FitFunctions.html">FitFunctions</a> | <a class="reference external" href="categories/General.html">General</a></p>
</div>
<div class="section" id="source">
<h2>Source<a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c7a0e2338713fd338893c4f24ed76cd968f52b11/Framework/CurveFitting/inc/MantidCurveFitting/Functions/CrystalFieldHeatCapacity.h">CrystalFieldHeatCapacity.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c7a0e2338713fd338893c4f24ed76cd968f52b11/Framework/CurveFitting/src/Functions/CrystalFieldHeatCapacity.cpp">CrystalFieldHeatCapacity.cpp</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CrystalFieldFunction.html" title="Previous Chapter: CrystalFieldFunction"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CrystalFieldFunction</span>
    </a>
  </li>
  <li>
    <a href="CrystalFieldMagnetisation.html" title="Next Chapter: CrystalFieldMagnetisation"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CrystalFieldM... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>