<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ModeratorTzero v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ModeratorTzeroLinear v1" href="ModeratorTzeroLinear-v1.html" />
    <link rel="prev" title="MinusMD v1" href="MinusMD-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.3</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="moderatortzero-v1">
<span id="algm-moderatortzero"></span><span id="algm-moderatortzero-v1"></span><h1>ModeratorTzero v1<a class="headerlink" href="#moderatortzero-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ModeratorTzero-v1_dlg.png"><img alt="../_images/ModeratorTzero-v1_dlg.png" class="screenshot" src="../_images/ModeratorTzero-v1_dlg.png" style="width: 361px;" /></a>
<p class="caption"><span class="caption-text"><strong>ModeratorTzero</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Corrects the time of flight of an indirect geometry instrument by a time offset that is dependent on the energy of the neutron after passing through the moderator.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="ModeratorTzeroLinear-v1.html#algm-moderatortzerolinear"><span class="std std-ref">ModeratorTzeroLinear</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="4%" />
<col width="23%" />
<col width="7%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>The name of the input workspace, containing events and/or histogram data, in units of time-of-flight</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>The name of the output workspace</td>
</tr>
<tr class="row-even"><td>EMode</td>
<td>Input</td>
<td>string</td>
<td>Indirect</td>
<td>The energy mode (default: Indirect). Allowed values: [‘Indirect’, ‘Direct’, ‘Elastic’]</td>
</tr>
<tr class="row-odd"><td>tolTOF</td>
<td>Input</td>
<td>number</td>
<td>0.1</td>
<td>Tolerance in the calculation of the emission time, in microseconds (default:1)</td>
</tr>
<tr class="row-even"><td>Niter</td>
<td>Input</td>
<td>m</td>
<td>1</td>
<td>Number of iterations (default:1)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Corrects the time of flight (TOF) by a time offset that is dependent
on the energy of the neutron after passing through the moderator. A
heuristic formula for the correction is stored in the instrument
definition file. Below is shown the entry in the instrument file for the
VISION beamline:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- formula for t0 calculation. See http://muparser.sourceforge.net/mup_features.html#idDef2 for available operators--&gt;</span>
<span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;t0_formula&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;(incidentEnergy &lt; 34.7332) ? 37.011296*incidentEnergy^(-0.052874) : (incidentEnergy &lt; 88.7556) ? 124.267307*incidentEnergy^(-0.394282) : (incidentEnergy &lt; 252.471) ? 963.775145*incidentEnergy^(-0.850919) : (incidentEnergy &lt; 420.145) ? 33.225834*incidentEnergy^(-0.242105) : (incidentEnergy &lt; 100000.0) ? 120.569231*incidentEnergy^(-0.455477) : 0.0&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>The recorded <span class="math">\(TOF = t_0 + t_i + t_f\)</span> with</p>
<ul class="simple">
<li><span class="math">\(t_0\)</span>: emission time from the moderator</li>
<li><span class="math">\(t_1\)</span>: time from moderator to sample or monitor</li>
<li><span class="math">\(t_2\)</span>: time from sample to detector</li>
</ul>
<p>This algorithm will replace <span class="math">\(TOF\)</span> with <span class="math">\(TOF^* = TOF-t_0 = t_i+t_f\)</span></p>
<p>For a direct geometry instrument, the incident energy <span class="math">\(E_1\)</span> is
the same for all neutrons. Hence, the moderator emission time is the
same for all neutrons. For an indirect geometry instrument, <span class="math">\(E_1\)</span>
is different for each neutron and is not known. However, the final
energy <span class="math">\(E_2\)</span> selected by the analyzers is known.</p>
<ul class="simple">
<li><span class="math">\(t_0 = func(E_1)\)</span> , a function of the incident energy</li>
<li><span class="math">\(t_1 = L_1/v_1\)</span> with <span class="math">\(L_1\)</span> the distance from moderator to
sample, and <span class="math">\(v_1\)</span> the initial unknown velocity (<span class="math">\(E_1=1/2*m*v_1^2\)</span>)</li>
<li><span class="math">\(t_2 = L_2/v_2\)</span> with <span class="math">\(L_2\)</span> the distance from sample to
detector, and <span class="math">\(v_2\)</span> is the final fixed velocity (<span class="math">\(E_2=1/2*m*v_2^2\)</span>)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We obtain <span class="math">\(TOF^*\)</span> as an iterative process,
taking into account the fact that the correction <span class="math">\(t_0\)</span> is much
smaller than <span class="math">\(t_i+t_f\)</span>. Thus
<span class="math">\(TOF-t_0^{(n)} = L_1/v_1^{(n)} + L_2/v_2\)</span> , <span class="math">\(n=0, 1, 2,..\)</span>
Set <span class="math">\(t_0^{(0)}=0\)</span> and obtain <span class="math">\(v_1^{(0)}\)</span> from the previous
formula. From <span class="math">\(v_1^{(0)}\)</span> we obtain <span class="math">\(E_1^{(0)}\)</span>
Set <span class="math">\(t_0^{(1)}=func( E_1^{(0)} )\)</span> and repeat the steps until
<span class="math">\(|t_0^{(n+1)} - t_0^{(n+1)}| &lt; tolTOF\)</span>. With
<span class="math">\(tolTOF=0.1 microsecond\)</span>, only one iteration is needed for convergence.</p>
</div>
<p>Here’s the result of applying ModeratorTzero to both the event list and
the histogrammed data of a run in the VISION beamline. The
transformation of either events or histograms shifts the curve to
smaller TOF’s. The transformed curves are not supposed to be identical,
but similar and differentiated from the original curve.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.1.jpeg"><img alt="Summed Histogram" src="../_images/ModeratorTzero_Fig.1.jpeg" style="width: 400px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.2.jpeg"><img alt="Elastic Line" src="../_images/ModeratorTzero_Fig.2.jpeg" style="width: 400px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.3.jpeg"><img alt="Inelastic Peaks" src="../_images/ModeratorTzero_Fig.3.jpeg" style="width: 400px;" /></a>
</div>
<p>For indirect instruments featuring an incoming neutron flux having a
sufficiently narrow distribution of energies, a linear relationship
between <span class="math">\(t_0\)</span> and the wavelength of the incoming neutron can be
established. This relation allows for coding of an algorithm with faster
execution times. For indirect instruments that comply with these
conditions, use of <a class="reference internal" href="ModeratorTzeroLinear-v1.html#algm-moderatortzerolinear"><span class="std std-ref">ModeratorTzeroLinear v1</span></a> is
preferred.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/InstrumentCorrections.html">CorrectionFunctions\InstrumentCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c7a0e2338713fd338893c4f24ed76cd968f52b11/Framework/Algorithms/inc/MantidAlgorithms/ModeratorTzero.h">ModeratorTzero.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c7a0e2338713fd338893c4f24ed76cd968f52b11/Framework/Algorithms/src/ModeratorTzero.cpp">ModeratorTzero.cpp</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="MinusMD-v1.html" title="Previous Chapter: MinusMD v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MinusMD v1</span>
    </a>
  </li>
  <li>
    <a href="ModeratorTzeroLinear-v1.html" title="Next Chapter: ModeratorTzeroLinear v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ModeratorTzer... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>