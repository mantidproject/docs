<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>TOSCABankCorrection v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.9.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="TestWorkspaceGroupProperty v1" href="TestWorkspaceGroupProperty-v1.html" />
    <link rel="prev" title="TOFTOFMergeRuns v1" href="TOFTOFMergeRuns-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="toscabankcorrection-v1">
<span id="algm-toscabankcorrection"></span><span id="algm-toscabankcorrection-v1"></span><h1>TOSCABankCorrection v1<a class="headerlink" href="#toscabankcorrection-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/TOSCABankCorrection-v1_dlg.png"><img alt="../_images/TOSCABankCorrection-v1_dlg.png" class="screenshot" src="../_images/TOSCABankCorrection-v1_dlg.png" style="width: 301px;" /></a>
<p class="caption"><strong>TOSCABankCorrection</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#workflow" id="id4">Workflow</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Corrects TOSCA reductions where the peaks across banks are not in alignment.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="5%" />
<col width="27%" />
<col width="8%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Input reduced workspace</td>
</tr>
<tr class="row-odd"><td>SearchRange</td>
<td>Input</td>
<td>dbl list</td>
<td>200,2000</td>
<td>Range over which to find peaks</td>
</tr>
<tr class="row-even"><td>PeakPosition</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Specify a particular peak to use</td>
</tr>
<tr class="row-odd"><td>ClosePeakTolerance</td>
<td>Input</td>
<td>number</td>
<td>20</td>
<td>Tolerance under which peaks are considered to be the same</td>
</tr>
<tr class="row-even"><td>PeakFunction</td>
<td>Input</td>
<td>string</td>
<td>Lorentzian</td>
<td>Type of peak to search for. Allowed values: [&#8216;Lorentzian&#8217;, &#8216;Gaussian&#8217;]</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Output corrected workspace</td>
</tr>
<tr class="row-even"><td>TargetPeakCentre</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>X position between the centres of the two selected peaks</td>
</tr>
<tr class="row-odd"><td>ScaleFactor1</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Scale factor for the first bank (histogram 0)</td>
</tr>
<tr class="row-even"><td>ScaleFactor2</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Scale factor for the second bank (histogram 1)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm attempts to automatically correct TOSCA data in which the
position of the sample has been moved and has affected the alignment of features
on the spectra from forward and backscattering detector banks.</p>
<p>The input workspace should be an energy transfer reduction, for the default
values of SearchRange and ClosePeakTolerance the X axis is assumed to be in
cm-1, however the X axis is not restricted to this unit.</p>
<p>The algorithm works by finding peaks of a given shape (using the <a class="reference internal" href="FindPeaks-v1.html#algm-findpeaks"><em>FindPeaks</em></a>) on both the forward and backscattering banks, either
selecting a peak in a given position or selecting the peak with the highest X
value and attempting to match them to what is believed to be the same feature on
the other bank.</p>
<p>A scale factor is then calculated for each bank that will align at least the
selected peak and in doing so will also align the majority of misaligned peaks
across the two banks.</p>
<p>The sacling factor is calculated as follows:</p>
<div class="math">
<p><img src="../_images/math/d7a27159f093601cdcf43590cc4c133657059cb3.png" alt="X_{centre} = \frac{X_{forward peak} + X_{back peak}}{2}

SF_{forward} = \frac{X_{centre}}{X_{forward peak}}

SF_{back} = \frac{X_{centre}}{X_{back peak}}"/></p>
</div><p>The corrected spectra are then rebinned to the input workspace (using
<a class="reference internal" href="RebinToWorkspace-v1.html#algm-rebintoworkspace"><em>RebinToWorkspace</em></a>) to preserve the X range and to
maintain bin alignment.</p>
<p>The sum spectra (containing both forward and back scattering detectors) is then
recalculated by averaging the intensities of the two corrected spectra, this
compensates for the broader peaks seen on the original sum spectra due to the
misalignment of the peaks.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This algorithm is only intended to provide an approximation of what the
measured spectra would look like if the sample was in the expected sample
position.</p>
</div>
</div>
<div class="section" id="workflow">
<h2><a class="toc-backref" href="#id4">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/TOSCABankCorrection-v1_wkflw.png" src="../_images/TOSCABankCorrection-v1_wkflw.png" />
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Automatic peak selection.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">original_reduction</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;TSC14007_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="n">corrected_reduction</span><span class="p">,</span> <span class="n">peak_position</span><span class="p">,</span> <span class="n">scale_factor_1</span><span class="p">,</span> <span class="n">scale_factor_2</span> <span class="o">=</span> \
  <span class="n">TOSCABankCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">original_reduction</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Target peak centre: %.f&#39;</span> <span class="o">%</span> <span class="n">peak_position</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Target peak centre: 1080
</pre></div>
</div>
<p><strong>Example - Manual peak selection.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">original_reduction</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;TSC14007_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="n">corrected_reduction</span><span class="p">,</span> <span class="n">peak_position</span><span class="p">,</span> <span class="n">scale_factor_1</span><span class="p">,</span> <span class="n">scale_factor_2</span> <span class="o">=</span> \
  <span class="n">TOSCABankCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">original_reduction</span><span class="p">,</span>
                      <span class="n">PeakPosition</span><span class="o">=</span><span class="s">&#39;715&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Target peak centre: %.f&#39;</span> <span class="o">%</span> <span class="n">peak_position</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Target peak centre: 714
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Inelastic/Corrections.html">Inelastic\Corrections</a> | <a class="reference external" href="categories/CorrectionFunctions/SpecialCorrections.html">CorrectionFunctions\SpecialCorrections</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="TOFTOFMergeRuns-v1.html" title="Previous Chapter: TOFTOFMergeRuns v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; TOFTOFMergeRuns ...</span>
    </a>
  </li>
  <li>
    <a href="TestWorkspaceGroupProperty-v1.html" title="Next Chapter: TestWorkspaceGroupProperty v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">TestWorkspaceGro... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>