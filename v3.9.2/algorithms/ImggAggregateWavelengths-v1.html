<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ImggAggregateWavelengths v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.9.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="ImggTomographicReconstruction v1" href="ImggTomographicReconstruction-v1.html" />
    <link rel="prev" title="IdentifyNoisyDetectors v1" href="IdentifyNoisyDetectors-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="imggaggregatewavelengths-v1">
<span id="algm-imggaggregatewavelengths"></span><span id="algm-imggaggregatewavelengths-v1"></span><h1>ImggAggregateWavelengths v1<a class="headerlink" href="#imggaggregatewavelengths-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/ImggAggregateWavelengths-v1_dlg.png"><img alt="../_images/ImggAggregateWavelengths-v1_dlg.png" class="screenshot" src="../_images/ImggAggregateWavelengths-v1_dlg.png" style="width: 217px;" /></a>
<p class="caption"><strong>ImggAggregateWavelengths</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Aggregates images from multiple energy bands or wavelengths</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="1%" />
<col width="1%" />
<col width="2%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputPath</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The path (directory) to the input image files. It must contain image files (radiography) or subdirectories containing image files (radiography, one directory per projection angle)</td>
</tr>
<tr class="row-odd"><td>OutputPath</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The path (directory) where to generate the output image(s).</td>
</tr>
<tr class="row-even"><td>UniformBands</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>The number of output bands. The input bands are divided into uniform non-overlapping blocks and each of the output bands correspond to one block. This is a convenience particular case of the property IndexRanges</td>
</tr>
<tr class="row-odd"><td>IndexRanges</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>A comma separated list of ranges of indices, where the indices refer to the input images, counting from 1. For example: 1-100, 101-200, 201-300. The number of ranges given will set the number of output bands. If you just need a certainnumber of bands split uniformly you can alternatively use the simple property UniformBands</td>
</tr>
<tr class="row-even"><td>ToFRanges</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>A comma separated list of time-of-flight ranges given as for example 5000-10000. These will be the boundaries in ToF that delimit the output bands. The units are as specified in the input images headers or metainformation (normally units of microseconds). The algorithm will produce as many output bands as ranges are given in this property. The ranges can overlap</td>
</tr>
<tr class="row-odd"><td>NumProjections</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>The number of projections (subdirectories with images) found in the input path and successfully processed</td>
</tr>
<tr class="row-even"><td>NumBands</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>The number of wavelength or energy bands found in the inputs and successfully processed (aggregated) into the output(s)</td>
</tr>
<tr class="row-odd"><td>OutputProjectionsPrefix</td>
<td>Input</td>
<td>string</td>
<td>sum_projection_</td>
<td>This prefix is added in the output file names to precede the projection sequence number (or angle, or simply the input directory index). The names of the output files then look like: sum_projection_bands_idx_1_1200, as in addition to this prefix, another prefix is added with the indices of the input images included (see option OutputBandPrefix</td>
</tr>
<tr class="row-even"><td>OutputBandPrefix</td>
<td>Input</td>
<td>string</td>
<td>bands_</td>
<td>This prefix is used for the output file names in addition to the prefix that specifies the projection or input directory sequence number, (OutputProjectionsPrefix). The output bands will be written into subdirectories with names where the prefix is prepended. In addition to this prefix, a second prefix that specifies whether the input bands were aggregated by indices or by time of flight is also appended. For example when running this algorithm using the property UniformBands or IndexRanges the output subdirectoy names will look like &#8216;sum_projection_bands_idx_1_1200&#8217; (where the 1 and 1200 derive from the division into uniform non-overlaping blocks of input bands, or the index ranges given. When running the algorithm using the property ToFRanges the output names will look like &#8216;bands_tof_10000_50000&#8217; (where the 10000 and 50000 are the time of flight boundaries of the output band, using the same units as in the image headers).</td>
</tr>
<tr class="row-odd"><td>OutputSubdirsPrefixUniformBands</td>
<td>Input</td>
<td>string</td>
<td>bands_uniform_</td>
<td>This prefix will be used for the name of the output subdirectories of every output band when producing uniform output bands (property UniformBands)</td>
</tr>
<tr class="row-even"><td>OutputSubdirsPrefixIndexBands</td>
<td>Input</td>
<td>string</td>
<td>bands_by_index_</td>
<td>This prefix will be used for the name of the output subdirectories of every output band when producing output bands using index ranges (property  IndexRanges)</td>
</tr>
<tr class="row-odd"><td>OutputSubdirsPrefixToFBands</td>
<td>Input</td>
<td>string</td>
<td>bands_by_tof_</td>
<td>This prefix will be used for the name of the output subdirectories of every output band when producing output bands using ToF ranges (property  ToFRanges)</td>
</tr>
<tr class="row-even"><td>InputImageFormat</td>
<td>Input</td>
<td>string</td>
<td>FITS</td>
<td>From the input directory(ies) use images in this format and ignore any other files. Allowed values: [&#8216;FITS&#8217;]</td>
</tr>
<tr class="row-odd"><td>OutputImageFormat</td>
<td>Input</td>
<td>string</td>
<td>FITS</td>
<td>Produce output images in this format. Allowed values: [&#8216;FITS&#8217;]</td>
</tr>
<tr class="row-even"><td>OutputBitDepth</td>
<td>Input</td>
<td>number</td>
<td>16</td>
<td>The bit depth or number of bits per pixel to use for the output image(s). Only 16 bits is supported at the moment. Allowed values: [&#8216;16&#8217;]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is experimental and it is at the moment being
developed for a specific instrument (IMAT at ISIS). It might be
changed significantly, renamed, or even removed without a
notification, should instrument scientists decide to do so.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The property <strong>ToFRanges</strong> requires specific headers in the input
(FITS) files and it is not enabled. At the moment, trying to use
this property will produce an error.</p>
</div>
<p>This algorithm aggregates images from multiple energy bands or
wavelengths into one or more output wavelength bands. The algorithm
applies to energy selective imaging data. It aggregates images by
summing up counts, and assumes that the image pixel values represent
neutron counts.</p>
<p>Given an input path (directory) and an output path (directory) the
algorithm will combine images from the input path and write the result
into the output path. Two different uses are considered: neutron
radiography (single projection angle) and tomography (multiple
projection angles). The image format supported is FITS (using the
algorithm <a class="reference internal" href="LoadFITS-v1.html#algm-loadfits"><em>LoadFITS v1</em></a>).</p>
<p>The algorithm produces its main outputs as files on disk. It also
outputs two values: the number of projections (or angles) processed
successfully (which will be always one for neutron radiography), and
the number of wavelength bands aggregated. One and only one of the
options <strong>UniformBands</strong>, <strong>IndexRanges</strong> or <strong>ToFRanges</strong> must be
specified. This defines the number of output bands and how the input
bands are aggregated or combined into the output bands.</p>
<p>For the sake of simplicity let us explain first the files that the
algorithm produces when a single output band is generated. This single
output band could correspond to the aggregation of all or a subset of
the input bands. This is the case when the property UniformBands is
set to 1, or the properties <strong>IndexRanges</strong> or <strong>ToFRanges</strong> are set
to a single range (and not multiple ranges separated by commas).</p>
<p>For neutron radiography data the input path points to a set of image
files where every file is assumed to correspond to a different
wavelength or energy band. The algorithm will produce an image in the
output path by combining the energy bands selected (as specified in
the algorithm options, and using all the input images as default).</p>
<p>For neutron tomography data the input path points to a set of
subdirectories, one per projection angle, and each of them containing
image files. It is assumed that each of the directories corresponds to
a projection angle.  The algorithm will produce as many images in the
output path as subdirectories are found in the input path a single
image in the output path by combining the energy bands selected,
separately for every input subdirectory, i.e., projection angle
(selecting the bands as specified in the algorithm options, and using
all the input bands as default). The images are written in a
subdirectory that is named depending on the type of aggregation
used. For the uniform bands (<strong>UniformBands</strong> property) the
subdirectory will be named <strong>bands_uniform_idx_&lt;start&gt;_to_&lt;end&gt;</strong>,
where <strong>&lt;start&gt;</strong> and <strong>&lt;end&gt;</strong> are the limits of the range(s). When
the index ranges option (<strong>IndexRanges</strong>) is used the names of the
output subdirectory will be named
<strong>bands_index_idx_&lt;start&gt;_to_&lt;end&gt;</strong>. And when the time of flight
range option (<strong>ToFRanges</strong>) is used the names will be
<strong>bands_tof_idx_&lt;start&gt;_to_&lt;end&gt;</strong>. The initial prefix
(bands_uniform, bands_index, bands_tof) can be mofified via the
input properties <strong>OutputSubdirsPrefixUniformBands</strong>,
<strong>OutputSubdirsPrefixIndexBands</strong>, <strong>OutputSubdirsPrefixToFBands</strong>,
respectively.</p>
<p>The output images are created as described above when there is a
single output band or stack of images. When multiple output ranges are
specified the outputs are produced similarly but every range will be
generated in a separate subdirectory created under the output path
given to the algorithm. For example the algorithm would produce
subdirectories named bands_by_index_idx_0_99,
bands_by_index_idx_50_149, and bands_by_index_idx_99_149, or
bands_uniform_idx_0_49, bands_uniform_idx_50_99.</p>
<p>A relevant consideration is how to use the range options to generate
multiple output stacks of images. This is very important for
performance reasons and concerns how to use the properties
<strong>IndexRanges</strong> and <strong>ToFRanges</strong>.  The comma separated list of ranges
enables the user to generate multiple output stacks of images in one
call to this algorithm. The same result can be obtained by calling the
algorithm repeatedly with the different individual ranges, one at a
time. This second alternative would be significantly slower though,
and it is discouraged to use that approach in scripts. That is because
the algorithm would need to read through the input images for every
individual call. This can make a big different in terms of run time,
given that this algorithm is meant to process large sets of images
which can take of the order of tens of minutes or hours to read and/or
write depending on the disk resources available.</p>
<p>As the algorithm tries to find images and subdirectories with images
from the input path, to decide whether to process the data as a single
projection (radiography) or multiple projections (tomography), there
can be ambiguities.  When an input path is given that contains both
image files and subdirectories with image files, the algorithm
processes the image files and does not try to process the
subdirectories. That is, it is assumed that the input path given
contains data for a single projection, and that the subdirectories do
not necessarily contain images for different projections (tomography
data).</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - ImggAggregateWavelengthsSingleProjection</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create an image combining all energy bands</span>
<span class="n">projections</span><span class="p">,</span> <span class="n">bands</span> <span class="o">=</span> <span class="n">ImggAggregateWavelengths</span><span class="p">(</span><span class="n">InputPath</span><span class="o">=</span><span class="s">&#39;D:\Data\RB000000\SampleA</span><span class="se">\&#39;</span><span class="s">,</span>
                                              <span class="n">OutputPath</span><span class="o">=</span><span class="s">&#39;D:\Data\RB000000\SampleA_all_wavelenghts&#39;</span>
                                              <span class="n">UniformBands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">projections</span><span class="p">:</span>
   <span class="k">print</span> <span class="s">&quot;An error happened. Expected to process one projection but processed: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
<span class="c"># Print some details</span>
<span class="k">print</span> <span class="s">&quot;Wrote a projection image combining {1} wavelength bands&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Wrote a projection image combining 2000 wavelength bands
</pre></div>
</div>
<p><strong>Example - ImggAggregateWavelengthsTomography</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a stack of images that can be used in tomographic reconstruction</span>
<span class="n">angles</span><span class="p">,</span> <span class="n">bands</span> <span class="o">=</span> <span class="n">ImggAggregateWavelengths</span><span class="p">(</span><span class="n">InputPath</span><span class="o">=</span><span class="s">&#39;D:\Data\RB000000\SampleA</span><span class="se">\&#39;</span><span class="s">,</span>
                                         <span class="n">OutputPath</span><span class="o">=</span><span class="s">&#39;D:\Data\RB000000\SampleA</span><span class="se">\a</span><span class="s">ll_wavelenghts&#39;</span><span class="p">,</span>
                                         <span class="n">UniformBands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Print some details</span>
<span class="k">print</span> <span class="s">&quot;Wrote {0} projection images, each combining {1} wavelength bands&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">bands</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Wrote 144 projection images, each combining 2000 wavelength bands
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/DataHandling/Imaging.html">DataHandling\Imaging</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/855d87d02cc81b30296c0eae91fc76b4b143c405/Framework/DataHandling/src/ImggAggregateWavelengths.cpp">ImggAggregateWavelengths.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/855d87d02cc81b30296c0eae91fc76b4b143c405/Framework/DataHandling/inc/MantidDataHandling/ImggAggregateWavelengths.h">ImggAggregateWavelengths.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IdentifyNoisyDetectors-v1.html" title="Previous Chapter: IdentifyNoisyDetectors v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; IdentifyNoisyDet...</span>
    </a>
  </li>
  <li>
    <a href="ImggTomographicReconstruction-v1.html" title="Next Chapter: ImggTomographicReconstruction v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ImggTomographicR... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>