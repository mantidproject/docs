<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DNSComputeDetEffCorrCoefs v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DNSFlippingRatioCorr v1" href="DNSFlippingRatioCorr-v1.html" />
    <link rel="prev" title="D7YIGPositionCalibration v1" href="D7YIGPositionCalibration-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.4</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">DNSComputeDetEffCorrCoefs v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="dnscomputedeteffcorrcoefs-v1">
<span id="algm-dnscomputedeteffcorrcoefs"></span><span id="algm-dnscomputedeteffcorrcoefs-v1"></span><h1>DNSComputeDetEffCorrCoefs v1<a class="headerlink" href="#dnscomputedeteffcorrcoefs-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/DNSComputeDetEffCorrCoefs-v1_dlg.png"><img alt="../_images/DNSComputeDetEffCorrCoefs-v1_dlg.png" class="screenshot" src="../_images/DNSComputeDetEffCorrCoefs-v1_dlg.png" style="width: 424px;" /></a>
<p class="caption"><span class="caption-text"><strong>DNSComputeDetEffCorrCoefs</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a><ul>
<li><a class="reference internal" href="#valid-input-workspaces" id="id6">Valid input workspaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Computes detector efficiency correction coefficients using the Vanadium data.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="DNSFlippingRatioCorr-v1.html#algm-dnsflippingratiocorr"><span class="std std-ref">DNSFlippingRatioCorr</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="5%" />
<col width="19%" />
<col width="8%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>VanadiumWorkspaces</td>
<td>Input</td>
<td>str list</td>
<td><em>Mandatory</em></td>
<td>Comma separated list of Vanadium workspaces or groups of workspaces.</td>
</tr>
<tr class="row-odd"><td>BackgroundWorkspaces</td>
<td>Input</td>
<td>str list</td>
<td><em>Mandatory</em></td>
<td>Comma separated list of Background workspaces or groups of workspaces.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Name of the workspace or group of workspaces that will contain computed coefficients.</td>
</tr>
<tr class="row-odd"><td>TwoThetaTolerance</td>
<td>Input</td>
<td>number</td>
<td>0.05</td>
<td>Tolerance for 2theta comparison (degrees). Number between 0 and 0.1.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It might get changed or even
removed without a notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm computes detector efficiency correction coefficients using a given Vanadium and background workspaces. As a result, output workspace or group of workspaces with coefficients will be created.</p>
<p>Detector efficiency correction is performed using the measurements of vanadium standard sample (hereafter Vanadium). Background for Vanadium must be also measured and provided to the algorithm as an input <strong>BkgWorkspace</strong>. Vanadium and its background can be measured at several detector bank positions.  This algorithm does the detector efficiency for a particular run in following steps:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Algorithm requires data normalized either to monitor counts or experiment duration. The normalization must be the same for all input workspaces.</p>
</div>
<ol class="arabic">
<li><p class="first">Subtract Background from Vanadium:</p>
<p><span class="math">\(V_i = (V_i)_{raw} - B_i\)</span></p>
<p>The <a class="reference internal" href="Minus-v1.html#algm-minus"><span class="std std-ref">Minus v1</span></a> algorithm is used for this step. In the case of negative result, the error message will be produced and the algorithm terminates.</p>
</li>
<li><p class="first">Calculate the correction coefficients:</p>
<p><span class="math">\(k_i = \frac{V_i^{SF} + V_i^{NSF}}{&lt;V&gt;}\)</span></p>
<p>where <em>SF</em> and <em>NSF</em> correspond to spin-slip and non-spin-flip signal, respectively. <span class="math">\(&lt;V&gt;\)</span> is calculated in a following way:</p>
<p><span class="math">\(&lt;V&gt; = \frac{1}{N}\sum &lt;V_i^{SF} + V_i^{NSF}&gt;\)</span></p>
<p>where <span class="math">\(&lt;V_i^{SF} + V_i^{NSF}&gt;\)</span> is the mean value of the total signal for <span class="math">\(i\)</span>-th detector calculated using the <a class="reference internal" href="Mean-v1.html#algm-mean"><span class="std std-ref">Mean v1</span></a> algorithm, <span class="math">\(N\)</span> is the number of not masked detectors. Sum is calculated using the <a class="reference internal" href="SumSpectra-v1.html#algm-sumspectra"><span class="std std-ref">SumSpectra v1</span></a> algorithm.</p>
<p>The <a class="reference internal" href="Divide-v1.html#algm-divide"><span class="std std-ref">Divide v1</span></a> algorithm is used for this step.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To apply detector efficiency corrrection to the data, one should divide neutron counts by the coefficients:</p>
<blockquote class="last">
<div><span class="math">\((I_i)_{corr} = \frac{I_i}{k_i}\)</span></div></blockquote>
</div>
<div class="section" id="valid-input-workspaces">
<h3><a class="toc-backref" href="#id6">Valid input workspaces</a><a class="headerlink" href="#valid-input-workspaces" title="Permalink to this headline">¶</a></h3>
<p>The input workspaces or groups of workspaces have to have the following in order to be valid inputs for this algorithm.</p>
<ul class="simple">
<li>The same number of dimensions</li>
<li>The same number of spectra</li>
<li>The same number of bins</li>
<li>The same kind of normalization in the <em>normalized</em> sample log.</li>
</ul>
<p>For the physically meaningful correction it is also important that these workspaces have the same slits size, polarisation, and the neutron wavelength. If some of these parameters are different, algorithm produces warning. If these properties are not specified in the workspace sample logs, no comparison is performed.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Calculate coefficients and apply correction to a single run:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Load Vanadium and background data</span>
<span class="n">curtable</span> <span class="o">=</span> <span class="s1">&#39;currents.txt&#39;</span>

<span class="n">vana_sf</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="s1">&#39;dn134011vana.d_dat&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">curtable</span><span class="p">)</span>
<span class="n">vana_nsf</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="s1">&#39;dn134012vana.d_dat&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">curtable</span><span class="p">)</span>
<span class="n">bkgr_sf</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="s1">&#39;dn134037leer.d_dat&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">curtable</span><span class="p">)</span>
<span class="n">bkgr_nsf</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="s1">&#39;dn134038leer.d_dat&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">curtable</span><span class="p">)</span>

<span class="c1"># Mask &#39;bad&#39; detectors</span>
<span class="n">MaskDetectors</span><span class="p">(</span><span class="n">vana_nsf</span><span class="p">,</span> <span class="n">DetectorList</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Calculate correction coefficients</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">DNSComputeDetEffCorrCoefs</span><span class="p">([</span><span class="n">vana_sf</span><span class="p">,</span> <span class="n">vana_nsf</span><span class="p">],</span> <span class="p">[</span><span class="n">bkgr_sf</span><span class="p">,</span> <span class="n">bkgr_nsf</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;First 3 correction coefficients: &quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
     <span class="k">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coefs</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Is first detector masked? {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coefs</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">isMasked</span><span class="p">()))</span>

<span class="c1"># load sample data</span>
<span class="n">rawdata</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="s1">&#39;oi196012pbi.d_dat&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">curtable</span><span class="p">)</span>

<span class="c1"># apply correction</span>
<span class="n">corrected_data</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">/</span><span class="n">coefs</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;First 3 corrected data points&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
     <span class="k">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">corrected_data</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>First 3 correction coefficients:

0.0

1.13

1.26

Is first detector masked? True

First 3 corrected data points

0.0

287.89

277.55
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/MLZ/DNS.html">Workflow\MLZ\DNS</a> | <a class="reference external" href="categories/CorrectionFunctions/SpecialCorrections.html">CorrectionFunctions\SpecialCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/7cec3a047fd2864c82ac0280d76fe566152576ec/Framework/PythonInterface/plugins/algorithms/DNSComputeDetEffCorrCoefs.py">DNSComputeDetEffCorrCoefs.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="D7YIGPositionCalibration-v1.html" title="Previous Chapter: D7YIGPositionCalibration v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; D7YIGPosition...</span>
    </a>
  </li>
  <li>
    <a href="DNSFlippingRatioCorr-v1.html" title="Next Chapter: DNSFlippingRatioCorr v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DNSFlippingRa... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>