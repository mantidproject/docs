<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ApplyInstrumentToPeaks v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ApplyMuonDetectorGroupPairing v1" href="ApplyMuonDetectorGroupPairing-v1.html" />
    <link rel="prev" title="ApplyFloodWorkspace v1" href="ApplyFloodWorkspace-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.4</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ApplyInstrumentToPeaks v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="applyinstrumenttopeaks-v1">
<span id="algm-applyinstrumenttopeaks"></span><span id="algm-applyinstrumenttopeaks-v1"></span><h1>ApplyInstrumentToPeaks v1<a class="headerlink" href="#applyinstrumenttopeaks-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ApplyInstrumentToPeaks-v1_dlg.png"><img alt="../_images/ApplyInstrumentToPeaks-v1_dlg.png" class="screenshot" src="../_images/ApplyInstrumentToPeaks-v1_dlg.png" style="width: 447px;" /></a>
<p class="caption"><span class="caption-text"><strong>ApplyInstrumentToPeaks</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Update the instrument attached to peaks within a PeaksWorkspace to match the one provided or the one attached to the input workspace while keeping detectorID and TOF unchanged</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="4%" />
<col width="15%" />
<col width="6%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>Input peaks workspace.</td>
</tr>
<tr class="row-odd"><td>InstrumentWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td>&#160;</td>
<td>Workspace from which the instrument will be copied from. If none is provided then the instrument on the input workspace is used.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>Output peaks workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>ApplyInstrumentToPeaks will update the instrument contained within
peaks of a <a class="reference internal" href="../concepts/PeaksWorkspace.html#peaksworkspace"><span class="std std-ref">PeaksWorkspace</span></a>. It will keep the
same detector ID and TOF but recalculate the detector positions and
therefore the Q-vectors.</p>
<p>The issue this is trying to address is that the instrument in the
PeaksWorkspace can be different to the instrument within the peaks and
when the instrument of the PeaksWorkspace is modified (by
<a class="reference internal" href="MoveInstrumentComponent-v1.html#algm-moveinstrumentcomponent"><span class="std std-ref">MoveInstrumentComponent</span></a>,
<a class="reference internal" href="RotateInstrumentComponent-v1.html#algm-rotateinstrumentcomponent"><span class="std std-ref">RotateInstrumentComponent</span></a>,
<a class="reference internal" href="LoadIsawDetCal-v1.html#algm-loadisawdetcal"><span class="std std-ref">LoadIsawDetCal</span></a>, <em>etc</em>) then instrument in
the peaks is not updated.</p>
<p>If a workspace is provided to the <code class="docutils literal"><span class="pre">InstrumentWorkspace</span></code> property
then the instrument from that workspace will be used, otherwise the
instrument in the <code class="docutils literal"><span class="pre">InputWorkspace</span></code> will be used.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example</strong></p>
<p>First create a peaks workspace with 3 peaks with <code class="docutils literal"><span class="pre">L1</span> <span class="pre">==</span> <span class="pre">L2</span> <span class="pre">==</span> <span class="pre">1</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">NumBanks</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;moderator&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Z</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;bank1&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># θ=90, ϕ=0</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;bank2&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># θ=90, ϕ=90</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;bank3&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># θ=45, ϕ=45</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">CreatePeaksWorkspace</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">NumberOfPeaks</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">AddPeak</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">TOF</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">DetectorID</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># θ=90, ϕ=0</span>
<span class="n">AddPeak</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">TOF</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">DetectorID</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># θ=90, ϕ=90</span>
<span class="n">AddPeak</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">TOF</span><span class="o">=</span><span class="mi">1234</span><span class="p">,</span> <span class="n">DetectorID</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># θ=45, ϕ=45</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DetID=</span><span class="si">{DetID}</span><span class="s2"> TOF=</span><span class="si">{TOF:.1f}</span><span class="s2">μs λ=</span><span class="si">{Wavelength:.4f}</span><span class="s2">Å Qsample=</span><span class="si">{QSample}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">peaks</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>DetID=1 TOF=10000.0μs λ=19.7802Å Qsample=[-0.317651,0,0.317651]
DetID=2 TOF=5000.0μs λ=9.8901Å Qsample=[0,-0.635301,0.635301]
DetID=3 TOF=1234.0μs λ=2.4409Å Qsample=[-1.28708,-1.28708,0.753953]
</pre></div>
</div>
<p>Now move source and detectors so <code class="docutils literal"><span class="pre">L1</span> <span class="pre">==</span> <span class="pre">L2</span> <span class="pre">==</span> <span class="pre">2</span></code>.  When you look at
the peaks nothing has been updated.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;moderator&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Z</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;bank1&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;bank2&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;bank3&#39;</span><span class="p">,</span> <span class="n">RelativePosition</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DetID=</span><span class="si">{DetID}</span><span class="s2"> TOF=</span><span class="si">{TOF:.1f}</span><span class="s2">μs λ=</span><span class="si">{Wavelength:.4f}</span><span class="s2">Å Qsample=</span><span class="si">{QSample}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">peaks</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>DetID=1 TOF=10000.0μs λ=19.7802Å Qsample=[-0.317651,0,0.317651]
DetID=2 TOF=5000.0μs λ=9.8901Å Qsample=[0,-0.635301,0.635301]
DetID=3 TOF=1234.0μs λ=2.4409Å Qsample=[-1.28708,-1.28708,0.753953]
</pre></div>
</div>
<p>So we apply this algorithm and the peaks are updated, the wavelength
is halved and the q-vector doubled as expected while keeping the same
detector ID and TOF.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">peaks</span> <span class="o">=</span> <span class="n">ApplyInstrumentToPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DetID=</span><span class="si">{DetID}</span><span class="s2"> TOF=</span><span class="si">{TOF:.1f}</span><span class="s2">μs λ=</span><span class="si">{Wavelength:.4f}</span><span class="s2">Å Qsample=</span><span class="si">{QSample}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">peaks</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">n</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>DetID=1 TOF=10000.0μs λ=9.8901Å Qsample=[-0.635301,0,0.635301]
DetID=2 TOF=5000.0μs λ=4.9450Å Qsample=[0,-1.2706,1.2706]
DetID=3 TOF=1234.0μs λ=1.2204Å Qsample=[-2.57415,-2.57415,1.50791]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/Peaks.html">Crystal\Peaks</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/7cec3a047fd2864c82ac0280d76fe566152576ec/Framework/Algorithms/inc/MantidAlgorithms/ApplyInstrumentToPeaks.h">ApplyInstrumentToPeaks.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/7cec3a047fd2864c82ac0280d76fe566152576ec/Framework/Algorithms/src/ApplyInstrumentToPeaks.cpp">ApplyInstrumentToPeaks.cpp</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ApplyFloodWorkspace-v1.html" title="Previous Chapter: ApplyFloodWorkspace v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ApplyFloodWor...</span>
    </a>
  </li>
  <li>
    <a href="ApplyMuonDetectorGroupPairing-v1.html" title="Next Chapter: ApplyMuonDetectorGroupPairing v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ApplyMuonDete... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>