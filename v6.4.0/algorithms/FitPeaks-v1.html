<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FitPeaks v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="FitPowderDiffPeaks v1" href="FitPowderDiffPeaks-v1.html" />
    <link rel="prev" title="FitPeak v1" href="FitPeak-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.4</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">FitPeaks v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="fitpeaks-v1">
<span id="algm-fitpeaks"></span><span id="algm-fitpeaks-v1"></span><h1>FitPeaks v1<a class="headerlink" href="#fitpeaks-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id3">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/FitPeaks-v1_dlg.png"><img alt="../_images/FitPeaks-v1_dlg.png" class="screenshot" src="../_images/FitPeaks-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>FitPeaks</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id4">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id5">Properties</a></li>
<li><a class="reference internal" href="#description" id="id6">Description</a><ul>
<li><a class="reference internal" href="#assumption" id="id7">Assumption</a></li>
<li><a class="reference internal" href="#required-pre-knowledge" id="id8">Required pre-knowledge</a><ul>
<li><a class="reference internal" href="#for-better-results" id="id9">For better results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#description-of-algorithm" id="id10">Description of algorithm</a></li>
<li><a class="reference internal" href="#background" id="id11">Background</a></li>
<li><a class="reference internal" href="#estimation-of-values-of-peak-profiles" id="id12">Estimation of values of peak profiles</a></li>
<li><a class="reference internal" href="#subalgorithms-used" id="id13">Subalgorithms used</a><ul>
<li><a class="reference internal" href="#inputs" id="id14">Inputs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#limitations-on-partial-spectra" id="id15">Limitations on Partial Spectra</a></li>
<li><a class="reference internal" href="#peak-positions" id="id16">Peak positions</a></li>
<li><a class="reference internal" href="#fit-window" id="id17">Fit Window</a></li>
<li><a class="reference internal" href="#tolerance-on-fitting-peaks-positions" id="id18">Tolerance on Fitting Peaks Positions</a></li>
<li><a class="reference internal" href="#algorithm-configurations" id="id19">Algorithm Configurations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calculation-of-starting-value-of-peak-profile-and-background-parameters" id="id20">Calculation of starting value of peak profile and background parameters</a><ul>
<li><a class="reference internal" href="#workflow" id="id21">Workflow</a></li>
<li><a class="reference internal" href="#estimate-background" id="id22">Estimate background</a></li>
<li><a class="reference internal" href="#estimate-peak-parameters" id="id23">Estimate peak parameters</a><ul>
<li><a class="reference internal" href="#estimate-peak-range" id="id24">Estimate peak range</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fit-peak-with-high-background" id="id25">Fit peak with high background</a><ul>
<li><a class="reference internal" href="#step-1" id="id26">Step 1</a></li>
<li><a class="reference internal" href="#step-2" id="id27">Step 2</a></li>
<li><a class="reference internal" href="#step-3" id="id28">Step 3</a></li>
<li><a class="reference internal" href="#id1" id="id29">Step 3</a></li>
<li><a class="reference internal" href="#step-4" id="id30">Step 4</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#outputs" id="id31">Outputs</a><ul>
<li><a class="reference internal" href="#outputworkspaces" id="id32">OutputWorkspaces</a><ul>
<li><a class="reference internal" href="#outputworkspace" id="id33">OutputWorkspace</a></li>
<li><a class="reference internal" href="#outputpeakparametersworkspace" id="id34">OutputPeakParametersWorkspace</a></li>
<li><a class="reference internal" href="#outputparameterfiterrorsworkspace" id="id35">OutputParameterFitErrorsWorkspace</a></li>
<li><a class="reference internal" href="#fittedpeaksworkspace" id="id36">FittedPeaksWorkspace</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fittingcostworkspace" id="id37">FittingCostWorkspace</a></li>
<li><a class="reference internal" href="#id2" id="id38">FittedPeaksWorkspace</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id39">Usage</a></li>
<li><a class="reference internal" href="#source" id="id40">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id4">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Fit one or multiple peaks in all spectra of a given workspace</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id5">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="1%" />
<col width="7%" />
<col width="4%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Name of the input workspace for peak fitting.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Name of the output workspace containing peak centers for fitting offset.The output workspace is point data.Each workspace index corresponds to a spectrum. Each X value ranges from 0 to N-1, where N is the number of peaks to fit. Each Y value is the peak position obtained by peak fitting. Negative value is used for error signals. -1 for data is zero;  -2 for maximum value is smaller than specified minimum value.and -3 for non-converged fitting.</td>
</tr>
<tr class="row-even"><td>StartWorkspaceIndex</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Starting workspace index for fit</td>
</tr>
<tr class="row-odd"><td>StopWorkspaceIndex</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Last workspace index to fit (which is included). If a value larger than the workspace index of last spectrum, then the workspace index of last spectrum is used.</td>
</tr>
<tr class="row-even"><td>PeakCenters</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>List of peak centers to fit against.</td>
</tr>
<tr class="row-odd"><td>PeakCentersWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>MatrixWorkspace containing peak centers</td>
</tr>
<tr class="row-even"><td>PeakFunction</td>
<td>Input</td>
<td>string</td>
<td>Gaussian</td>
<td>Use of a BackToBackExponential profile is only reccomended if the coeficients to calculate A and B are defined in the instrument Parameters.xml file. Allowed values: [‘AsymmetricPearsonVII’, ‘BackToBackExponential’, ‘Bk2BkExpConvPV’, ‘DeltaFunction’, ‘ElasticDiffRotDiscreteCircle’, ‘ElasticDiffSphere’, ‘ElasticIsoRotDiff’, ‘ExamplePeakFunction’, ‘Gaussian’, ‘IkedaCarpenterPV’, ‘Lorentzian’, ‘PseudoVoigt’, ‘Voigt’]</td>
</tr>
<tr class="row-odd"><td>BackgroundType</td>
<td>Input</td>
<td>string</td>
<td>Linear</td>
<td>Type of Background. Allowed values: [‘Flat’, ‘Linear’, ‘Quadratic’]</td>
</tr>
<tr class="row-even"><td>FitWindowBoundaryList</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>List of left boundaries of the peak fitting window corresponding to PeakCenters.</td>
</tr>
<tr class="row-odd"><td>FitPeakWindowWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>MatrixWorkspace for of peak windows</td>
</tr>
<tr class="row-even"><td>PeakWidthPercent</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>The estimated peak width as a percentage of the d-spacing of the center of the peak. Value must be less than 1.</td>
</tr>
<tr class="row-odd"><td>PeakParameterNames</td>
<td>Input</td>
<td>str list</td>
<td>&#160;</td>
<td>List of peak parameters’ names</td>
</tr>
<tr class="row-even"><td>PeakParameterValues</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>List of peak parameters’ value</td>
</tr>
<tr class="row-odd"><td>PeakParameterValueTable</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td>&#160;</td>
<td>Name of the an optional workspace, whose each column corresponds to given peak parameter names, and each row corresponds to a subset of spectra.</td>
</tr>
<tr class="row-even"><td>FitFromRight</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Flag for the order to fit peaks.  If true, peaks are fitted from rightmost;Otherwise peaks are fitted from leftmost.</td>
</tr>
<tr class="row-odd"><td>Minimizer</td>
<td>Input</td>
<td>string</td>
<td>Levenberg-Marquardt</td>
<td>Minimizer to use for fitting. Allowed values: [‘BFGS’, ‘Conjugate gradient (Fletcher-Reeves imp.)’, ‘Conjugate gradient (Polak-Ribiere imp.)’, ‘Damped GaussNewton’, ‘FABADA’, ‘Levenberg-Marquardt’, ‘Levenberg-MarquardtMD’, ‘Simplex’, ‘SteepestDescent’, ‘Trust Region’]</td>
</tr>
<tr class="row-even"><td>CostFunction</td>
<td>Input</td>
<td>string</td>
<td>Least squares</td>
<td>Cost functions. Allowed values: [‘Least squares’, ‘Rwp’]</td>
</tr>
<tr class="row-odd"><td>MaxFitIterations</td>
<td>Input</td>
<td>number</td>
<td>50</td>
<td>Maximum number of function fitting iterations.</td>
</tr>
<tr class="row-even"><td>FindBackgroundSigma</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>Multiplier of standard deviations of the variance for convergence of peak elimination.  Default is 1.0.</td>
</tr>
<tr class="row-odd"><td>HighBackground</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Flag whether the data has high background comparing to peaks’ intensities. For example, vanadium peaks usually have high background.</td>
</tr>
<tr class="row-even"><td>PositionTolerance</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>List of tolerance on fitted peak positions against given peak positions.If there is only one value given, then</td>
</tr>
<tr class="row-odd"><td>MinimumPeakHeight</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Minimum peak height such that all the fitted peaks with height under this value will be excluded.</td>
</tr>
<tr class="row-even"><td>ConstrainPeakPositions</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>If true peak position will be constrained by estimated positions (highest Y value position) and the peak width either estimted by observation or calculate.</td>
</tr>
<tr class="row-odd"><td>FittedPeaksWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>Name of the output matrix workspace with fitted peak. This output workspace have the same dimesion as the input workspace.The Y values belonged to peaks to fit are replaced by fitted value. Values of estimated background are used if peak fails to be fit.</td>
</tr>
<tr class="row-even"><td>OutputPeakParametersWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Name of table workspace containing all fitted peak parameters.</td>
</tr>
<tr class="row-odd"><td>OutputParameterFitErrorsWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td>&#160;</td>
<td>Name of workspace containing all fitted peak parameters’ fitting error.It must be used along with FittedPeaksWorkspace and RawPeakParameters (True)</td>
</tr>
<tr class="row-even"><td>RawPeakParameters</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>false generates table with effective centre/width/height parameters. true generates a table with peak function parameters</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id6">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm fits a set of specified peaks in a set of specified spectra in a <a class="reference internal" href="../api/python/mantid/api/MatrixWorkspace.html#mantid.api.MatrixWorkspace" title="mantid.api.MatrixWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a>,
returning a list of the successfully fitted peaks along with
optional output for fitting information.</p>
<p>The list of candidate peaks found is passed to a fitting routine and
those that are successfully fitted are kept and returned in the output
workspace (and logged at information level). The output
<a class="reference internal" href="../api/python/mantid/api/ITableWorkspace.html#mantid.api.ITableWorkspace" title="mantid.api.ITableWorkspace"><code class="xref py py-class docutils literal"><span class="pre">TableWorkspace</span></code></a>
contains the following columns,
which reflect the fact that the peak has been fitted to a Gaussian atop
a linear background: spectrum, centre, width, height,
backgroundintercept &amp; backgroundslope.</p>
<div class="section" id="assumption">
<h3><a class="toc-backref" href="#id7">Assumption</a><a class="headerlink" href="#assumption" title="Permalink to this headline">¶</a></h3>
<p>It is assumed that the profile parameters of a peak at a given d-spacing, such as the peak width, are correlated between adjacent spectra (in index).</p>
</div>
<div class="section" id="required-pre-knowledge">
<h3><a class="toc-backref" href="#id8">Required pre-knowledge</a><a class="headerlink" href="#required-pre-knowledge" title="Permalink to this headline">¶</a></h3>
<p>The following information are required.</p>
<ul class="simple">
<li>Assumed position of each peak</li>
<li>Peak profile function</li>
<li>Background type (flat or linear)</li>
<li>Starting values of peak parameters</li>
</ul>
<div class="section" id="for-better-results">
<h4><a class="toc-backref" href="#id9">For better results</a><a class="headerlink" href="#for-better-results" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Peak fit window: this is an option<ol class="loweralpha">
<li>specified by user</li>
<li>figured out by <a class="reference internal" href="FindPeakBackground-v1.html#algm-findpeakbackground"><span class="std std-ref">FindPeakBackground</span></a>, and peak FWHM estimated from the height and integrated intensity in the window assuming a Gaussian distribution (overwriting the peak profile parameters initialised from the reuslt of the previous spectrum).</li>
<li>if the workspace is in unit dSpacing and <span class="math">\(\Delta d/d\)</span></li>
</ol>
</li>
<li>Peak position tolerance: there could be three cases for how the peak position tolerance is specified.<ol class="loweralpha">
<li>specified by user</li>
<li>defined by peak windows</li>
<li>half distance to the neighboring peak (if not (a) and not (b))</li>
<li>whole range of X-axis (if there is one and only one peak in a spectrum)</li>
</ol>
</li>
</ul>
</div>
</div>
<div class="section" id="description-of-algorithm">
<h3><a class="toc-backref" href="#id10">Description of algorithm</a><a class="headerlink" href="#description-of-algorithm" title="Permalink to this headline">¶</a></h3>
<p>For each spectrum, it is assumed that there are N peaks to fit.
The fitting starts from either the peak at the smallest X value or the largest X values depending on the
user’s input.
The first peak will be fit with the starting value provided by the user.
except background and peak center, which will be determiend by <em>observation</em>.</p>
</div>
<div class="section" id="background">
<h3><a class="toc-backref" href="#id11">Background</a><a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p>Linear background is used for fitting peaks.  The background parameters
will be estimated via <em>observation</em>.</p>
</div>
<div class="section" id="estimation-of-values-of-peak-profiles">
<h3><a class="toc-backref" href="#id12">Estimation of values of peak profiles</a><a class="headerlink" href="#estimation-of-values-of-peak-profiles" title="Permalink to this headline">¶</a></h3>
<p>Peak height, center, and FWHM and peak center are estimated by
observing the maximum value within peak fit window and calculating the
first two moments.</p>
<p>When using peak profiles that do not have a one-to-one mapping between
effective and raw parameters, you may need to supply starting
information for more of the parameters. This can be done by specifying
<code class="docutils literal"><span class="pre">PeakParameterNames</span></code> and <code class="docutils literal"><span class="pre">PeakParameterValues</span></code> for some or all of
the parameters (e.g. <code class="docutils literal"><span class="pre">Mixing</span></code> for a <a class="reference internal" href="../fitting/fitfunctions/PseudoVoigt.html#func-pseudovoigt"><span class="std std-ref">PseudoVoigt</span></a>) which
will be used for the first peak fit in each spectrum. To supply <em>all</em>
parameters, <code class="docutils literal"><span class="pre">PeakParameterNames</span></code> and <code class="docutils literal"><span class="pre">PeakParameterValueTable</span></code> can
be used. <strong>WARNING</strong> Partially specifying peak parameters such as
height and position will be overwritten by observed values.</p>
</div>
<div class="section" id="subalgorithms-used">
<h3><a class="toc-backref" href="#id13">Subalgorithms used</a><a class="headerlink" href="#subalgorithms-used" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">FitPeaks</span></code> uses the <a class="reference internal" href="Fit-v1.html#algm-fit"><span class="std std-ref">Fit</span></a> algorithm to fit each single peak.
<code class="docutils literal"><span class="pre">FitPeaks</span></code> uses the <a class="reference internal" href="FindPeakBackground-v1.html#algm-findpeakbackground"><span class="std std-ref">FindPeakBackground</span></a> algorithm to estimate the background of each peak.</p>
<div class="section" id="inputs">
<h4><a class="toc-backref" href="#id14">Inputs</a><a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h4>
<p>The inputs tends to be general enough for various use cases.</p>
</div>
</div>
<div class="section" id="limitations-on-partial-spectra">
<h3><a class="toc-backref" href="#id15">Limitations on Partial Spectra</a><a class="headerlink" href="#limitations-on-partial-spectra" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>For partial spectra peak fitting, the spectra must be consecutive.</li>
</ul>
</div>
<div class="section" id="peak-positions">
<h3><a class="toc-backref" href="#id16">Peak positions</a><a class="headerlink" href="#peak-positions" title="Permalink to this headline">¶</a></h3>
<p>One of only one of the following will be taken.</p>
<ul class="simple">
<li>A <a class="reference internal" href="../api/python/mantid/api/MatrixWorkspace.html#mantid.api.MatrixWorkspace" title="mantid.api.MatrixWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a><ul>
<li>Number of spectra shall be the same as the number of spectra of the workspace containing peaks to fit for.  Or the number of spectra is the same as the number of spectra of the input workspace.</li>
<li>X value is the index of the peak.</li>
<li>Y value is the position of the peaks to fit.</li>
<li>Peak centers are stored in <code class="docutils literal"><span class="pre">m_peakCenterWorkspace</span></code>.</li>
<li>Spectra can be a subset of all spectra because <code class="docutils literal"><span class="pre">FitPeaks</span></code> can work on partial spectra.</li>
</ul>
</li>
<li>An array of double as the positions of the peaks to fit.<ul>
<li>Peak centers are stored in <code class="docutils literal"><span class="pre">m_peakCenters</span></code></li>
</ul>
</li>
</ul>
<p><strong>Peaks’ positions must be given in ascending order</strong></p>
<p>Parameter <code class="docutils literal"><span class="pre">FitFromRight</span></code> deontes start fits from right most peak rather than left most peak.</p>
</div>
<div class="section" id="fit-window">
<h3><a class="toc-backref" href="#id17">Fit Window</a><a class="headerlink" href="#fit-window" title="Permalink to this headline">¶</a></h3>
<p>There are two input parameters that are associated with fitting window.</p>
<ul class="simple">
<li>FitWindowBoundaryList</li>
<li>FitPeakWindowWorkspace</li>
</ul>
<p>If FitWindows is defined, then a peak’s range to fit (i.e., x-min and
x-max) is confined by this window.</p>
<p>If FitWindows is defined, starting peak centres are NOT user’s input,
but found by highest value within peak window. (Is this correct???)</p>
<p>Further down the road, here are the fitting setup that can be affected.</p>
<ul class="simple">
<li>Peak positions are uniform among all spectra<ul>
<li>Peak window information will be retrieved from <strong>m_peakWindowVector</strong></li>
</ul>
</li>
<li>Peak positions are different among spectra.<ul>
<li>Peak windown information will be retrieved from <strong>m_peakWindowWorkspace</strong></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="tolerance-on-fitting-peaks-positions">
<h3><a class="toc-backref" href="#id18">Tolerance on Fitting Peaks Positions</a><a class="headerlink" href="#tolerance-on-fitting-peaks-positions" title="Permalink to this headline">¶</a></h3>
<p>Tolerance will be always checked!</p>
<ul class="simple">
<li>Uniform tolerance</li>
<li>Non-uniform tolerance</li>
<li>Case 2, 3 and 4</li>
</ul>
</div>
<div class="section" id="algorithm-configurations">
<h3><a class="toc-backref" href="#id19">Algorithm Configurations</a><a class="headerlink" href="#algorithm-configurations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Peak profile starting value will be given as<ul>
<li>an array <code class="docutils literal"><span class="pre">PeakParameterValues</span></code> such that the starting values are uniform among all spectra.</li>
<li>a table (workspace) <code class="docutils literal"><span class="pre">PeakParameterValueTable</span></code> such that the starting values are not necessary same among all spectra.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="calculation-of-starting-value-of-peak-profile-and-background-parameters">
<h2><a class="toc-backref" href="#id20">Calculation of starting value of peak profile and background parameters</a><a class="headerlink" href="#calculation-of-starting-value-of-peak-profile-and-background-parameters" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">FitPeaks</span></code> supports estimating peak parameter names as starting values.</p>
<div class="section" id="workflow">
<h3><a class="toc-backref" href="#id21">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Call <a class="reference internal" href="FindPeakBackground-v1.html#algm-findpeakbackground"><span class="std std-ref">FindPeakBackground</span></a> to estimate the background of peak with a numerical approach.<ul>
<li>Some tests have made to show that most time <a class="reference internal" href="FindPeakBackground-v1.html#algm-findpeakbackground"><span class="std std-ref">FindPeakBackground</span></a> failed to do a valid estimation.  Therefore this feature is temporarily disabled.</li>
</ul>
</li>
<li>If <a class="reference internal" href="FindPeakBackground-v1.html#algm-findpeakbackground"><span class="std std-ref">FindPeakBackground</span></a> fails, <em>estimate-peak-background</em> will be used for simple approximation.</li>
<li>Estimate the peak parameter, <em>estimate-peak-parameter</em>, by using the estimated peak background obtained in either step 1 or step 2.</li>
<li>Estimate the peak range, which is used to constrain the peak position in fitting, by using the left <em>FWHM</em> and right <em>FWHM</em> from step 3.</li>
</ol>
</div>
<div class="section" id="estimate-background">
<h3><a class="toc-backref" href="#id22">Estimate background</a><a class="headerlink" href="#estimate-background" title="Permalink to this headline">¶</a></h3>
<p><em>Estimate-peak-background</em> takes <em>peak fit window</em> for pre-knowledge, and calculate <em>a</em> and <em>b</em> in the linear background function.</p>
<p>The algorithm is
1. Find the left and right <em>N</em> points respectively, average both <em>x</em> and <em>y</em> value
2. Use <span class="math">\((\bar{x}_1, \bar{y}_1)\)</span> and <span class="math">\((\bar{x}_2, \bar{y}_2)\)</span> to calculate <em>a</em> and <em>b</em> in <span class="math">\(y = a\cdot x + b\)</span></p>
</div>
<div class="section" id="estimate-peak-parameters">
<h3><a class="toc-backref" href="#id23">Estimate peak parameters</a><a class="headerlink" href="#estimate-peak-parameters" title="Permalink to this headline">¶</a></h3>
<p><em>Estimate-peak-parameters</em> requires background parameters being estimated.</p>
<p>Here is the approach to estimate the peak parameters</p>
<ol class="arabic simple">
<li>Remove background.</li>
<li>Find maximum Y value as the <em>observed</em> peak center and peak height <span class="math">\(H_{obs}\)</span>.</li>
<li>Check peak height with user-specified minimum height and peak center that must be at least more than 3 data points away from the boundary of fit window.</li>
<li>Find the left and right <em>FWHM</em> by searching <span class="math">\(x_i\)</span> and <span class="math">\(x_{i+1}\)</span> such that <span class="math">\(H_{obs}\)</span> is between <span class="math">\(y_i\)</span> and <span class="math">\(y_{i+1}\)</span>.</li>
</ol>
<div class="section" id="estimate-peak-range">
<h4><a class="toc-backref" href="#id24">Estimate peak range</a><a class="headerlink" href="#estimate-peak-range" title="Permalink to this headline">¶</a></h4>
<p><em>Estimate-peak-range</em> requires inputs including expected peak center, fit window and estimated right and left FWHM.
It will output the left and right boundary of the peak such that the background can be fit by excluding the peak.</p>
<ol class="arabic simple">
<li>Peak range is defined as <span class="math">\(x_0 \pm 6 \cdot w\)</span>, where <em>w</em> is half of FWHM for either left or right half of peak.</li>
<li>Check the number of background points out of peak range at the left and right side respectively.
It is required to have at least 3 background points at either side, i.e., <span class="math">\(min(3, \frac{i_{x0} - i_{min}}{6})\)</span> for left side.</li>
</ol>
</div>
</div>
<div class="section" id="fit-peak-with-high-background">
<h3><a class="toc-backref" href="#id25">Fit peak with high background</a><a class="headerlink" href="#fit-peak-with-high-background" title="Permalink to this headline">¶</a></h3>
<div class="section" id="step-1">
<h4><a class="toc-backref" href="#id26">Step 1</a><a class="headerlink" href="#step-1" title="Permalink to this headline">¶</a></h4>
<p>Reduce the background by finding a linear function <span class="math">\(B_i = a\cdot x_i + b\)</span>,
such that <span class="math">\(\sum_i (Y_i - B_i)\)</span> is minimum while any <span class="math">\(Y_i - B_i\)</span> is non-negative.</p>
<p>This approach is good for any background close to linear within the fit window.</p>
</div>
<div class="section" id="step-2">
<h4><a class="toc-backref" href="#id27">Step 2</a><a class="headerlink" href="#step-2" title="Permalink to this headline">¶</a></h4>
<p>With the background reduced in step 1, it will be more reliable to estimate the peak’s FWHM via <em>observation</em>.</p>
</div>
<div class="section" id="step-3">
<h4><a class="toc-backref" href="#id28">Step 3</a><a class="headerlink" href="#step-3" title="Permalink to this headline">¶</a></h4>
<p>Fit peak… ………..</p>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id29">Step 3</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Get the peak range (by <em>estimate-peak-range</em>) and fit the background with <em>FitMultiDomain</em> to fit background.</p>
</div>
<div class="section" id="step-4">
<h4><a class="toc-backref" href="#id30">Step 4</a><a class="headerlink" href="#step-4" title="Permalink to this headline">¶</a></h4>
<p>Remove the background and fit peak!</p>
</div>
</div>
</div>
<div class="section" id="outputs">
<h2><a class="toc-backref" href="#id31">Outputs</a><a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h2>
<p>Algorithm <code class="docutils literal"><span class="pre">FitPeaks</span></code> is designed for various purposes including but not limited to vanadium peak striping and fitting diamond peaks to calibrate detectors’ positions.
On the other hand, due to the complexity in peak fitting, users prefer to check the fitting results.
Therefore, <code class="docutils literal"><span class="pre">FitPeaks</span></code> supports various fexible and informative outputs.</p>
<div class="section" id="outputworkspaces">
<h3><a class="toc-backref" href="#id32">OutputWorkspaces</a><a class="headerlink" href="#outputworkspaces" title="Permalink to this headline">¶</a></h3>
<div class="section" id="outputworkspace">
<h4><a class="toc-backref" href="#id33">OutputWorkspace</a><a class="headerlink" href="#outputworkspace" title="Permalink to this headline">¶</a></h4>
<p>It is a <a class="reference internal" href="../api/python/mantid/api/MatrixWorkspace.html#mantid.api.MatrixWorkspace" title="mantid.api.MatrixWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a> containing the peak positions expected and fitted.</p>
<ul class="simple">
<li>The output workspace has <em>N</em> spectra corresponding to the spectra that are specified by user via <code class="docutils literal"><span class="pre">MinimumWorkspaceIndex</span></code> and <code class="docutils literal"><span class="pre">MaximumWorkspaceIndex</span></code>.</li>
<li>If there are <em>m</em> peaks that are required to fit for, then each spectrum in the output workspace has <em>m</em> data points.</li>
<li>In each spectrum, <em>x(i)</em> is the expected position of <em>i-th</em> peak; <em>y(i)</em> is the fitted position of <em>i-th</em> peak; and <em>e(i)</em> is the cost from fitting.</li>
<li>There are several cases that the fitting could fail.  A negative peak position <em>y(i)</em> combined with <em>e(i)</em> equal to <em>DBL_MAX</em> denote such failure.</li>
<li>Cause of fitting failure is denoted by different negative value of <em>y(i)</em>
- -1: empty spectrum
- -2: spectrum with too few counts
- -3: peak is low
- -4: TODO : find out the answer
- -5: TODO : find out the answer</li>
</ul>
</div>
<div class="section" id="outputpeakparametersworkspace">
<h4><a class="toc-backref" href="#id34">OutputPeakParametersWorkspace</a><a class="headerlink" href="#outputpeakparametersworkspace" title="Permalink to this headline">¶</a></h4>
<p>It is an output <a class="reference internal" href="../api/python/mantid/api/ITableWorkspace.html#mantid.api.ITableWorkspace" title="mantid.api.ITableWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a> containing function parameters’ fitted values
for all peaks that are specified to fit.
The order of the peaks will be exactly the sequence of peaks as the order of the given positions of peaks.</p>
<p>If user specifies a subset of spectra to fit, this TableWorksapce will only contain function
parameters’ value that corresponds to the spectra that are fitted.</p>
</div>
<div class="section" id="outputparameterfiterrorsworkspace">
<h4><a class="toc-backref" href="#id35">OutputParameterFitErrorsWorkspace</a><a class="headerlink" href="#outputparameterfiterrorsworkspace" title="Permalink to this headline">¶</a></h4>
<p>It is an optional output <a class="reference internal" href="../api/python/mantid/api/ITableWorkspace.html#mantid.api.ITableWorkspace" title="mantid.api.ITableWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a> containing function parameters’ fitting error,
i.e., uncertainties, for all peaks that are specified to fit.
The order of the peaks will be exactly the sequence of peaks as the order of the given positions of peaks.</p>
<p>If user specifies a subset of spectra to fit, this TableWorksapce will only contain function
parameters’ uncertainties that corresponds to the spectra that are fitted.</p>
<p>It has one less column than OutputPeakParametersWorkspace, which is chi2.</p>
</div>
<div class="section" id="fittedpeaksworkspace">
<h4><a class="toc-backref" href="#id36">FittedPeaksWorkspace</a><a class="headerlink" href="#fittedpeaksworkspace" title="Permalink to this headline">¶</a></h4>
<p>It is an optional output <a class="reference internal" href="../api/python/mantid/api/MatrixWorkspace.html#mantid.api.MatrixWorkspace" title="mantid.api.MatrixWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a> containing the peaks
calculated from fitting result.</p>
</div>
</div>
<div class="section" id="fittingcostworkspace">
<h3><a class="toc-backref" href="#id37">FittingCostWorkspace</a><a class="headerlink" href="#fittingcostworkspace" title="Permalink to this headline">¶</a></h3>
<p>It is a <a class="reference internal" href="../api/python/mantid/api/MatrixWorkspace.html#mantid.api.MatrixWorkspace" title="mantid.api.MatrixWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a> recording the cost of each peak that is fitted.
It is in the exactly same order as the given positions of peaks to fit.
Its X values store the fitted peak positions and Y values are for <span class="math">\(\chi^2\)</span>.</p>
<p>If a peak’s fitting is bad, then the peak position will be its proposed peak position,
while its <span class="math">\(\chi^2\)</span> shall be some special value.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id38">FittedPeaksWorkspace</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>It is an optional output <a class="reference internal" href="../api/python/mantid/api/MatrixWorkspace.html#mantid.api.MatrixWorkspace" title="mantid.api.MatrixWorkspace"><code class="xref py py-obj docutils literal"><span class="pre">MatrixWorkspace</span></code></a>.</p>
<p>For each spectrum, in each fit window, the Y values will be replaced by the calculated peak and background value.
If fitting is bad, then only background is calculated.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id39">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Find a single peak:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s2">&quot;User Defined&quot;</span><span class="p">,</span>
                           <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s2">&quot;name=LinearBackground, A0=0.3;name=Gaussian, PeakCentre=5, Height=10, Sigma=0.7&quot;</span><span class="p">,</span>
                           <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XMin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">XMax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">FitPeaks</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span> <span class="n">PeakCenters</span><span class="o">=</span><span class="s1">&#39;5.1&#39;</span><span class="p">,</span> <span class="n">FitWindowBoundaryList</span><span class="o">=</span><span class="s1">&#39;0,10&#39;</span><span class="p">,</span> <span class="n">OutputPeakParametersWorkspace</span><span class="o">=</span><span class="s1">&#39;fitted_params&#39;</span><span class="p">,</span>
         <span class="n">BackgroundType</span><span class="o">=</span><span class="s1">&#39;Linear&#39;</span><span class="p">,</span> <span class="n">FittedPeaksWorkspace</span><span class="o">=</span><span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;peakpositions&#39;</span><span class="p">)</span>

<span class="n">peakposws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;peakpositions&#39;</span><span class="p">]</span>
<span class="n">param_ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;fitted_params&#39;</span><span class="p">]</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">param_ws</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># output</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Fitted peak position: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peakposws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Peak 0  Centre: </span><span class="si">{0:.5f}</span><span class="s2">, width: </span><span class="si">{1:.5f}</span><span class="s2">, height: </span><span class="si">{2:.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;PeakCentre&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Sigma&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Height&quot;</span><span class="p">]))</span>

<span class="c1"># clean up workspaces</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;fitted&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;fitted_params&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;peakpositions&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Fitted peak position: 5.05000
Peak 0  Centre: 5.05000, width: 0.70000, height: 10.00000
</pre></div>
</div>
<p><strong>Example - Fit peaks on high background (vanadium):</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># load a 4 spectra workspace</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s2">&quot;PG3_733.nxs&quot;</span><span class="p">)</span>

<span class="n">van_peak_centers</span> <span class="o">=</span> <span class="s2">&quot;0.5044,0.5191,0.5350,0.5526,0.5936,0.6178,0.6453,0.6768,0.7134,0.7566,0.8089,0.8737,0.9571,1.0701,1.2356,1.5133,2.1401&quot;</span>
<span class="n">FitPeaks</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span> <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">StopWorkspaceIndex</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">PeakCenters</span><span class="o">=</span><span class="n">van_peak_centers</span><span class="p">,</span>
           <span class="n">FitFromRight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">HighBackground</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">BackgroundType</span><span class="o">=</span><span class="s1">&#39;Quadratic&#39;</span><span class="p">,</span>
           <span class="n">PeakWidthPercent</span><span class="o">=</span><span class="mf">0.008</span><span class="p">,</span>
           <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;PG3_733_peak_positions&#39;</span><span class="p">,</span><span class="n">OutputPeakParametersWorkspace</span><span class="o">=</span><span class="s1">&#39;PG3_733_peak_params&#39;</span><span class="p">,</span>
           <span class="n">FittedPeaksWorkspace</span><span class="o">=</span><span class="s1">&#39;PG3_733_fitted_peaks&#39;</span><span class="p">)</span>

<span class="n">PG3_733_peak_positions</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s2">&quot;PG3_733_peak_positions&quot;</span><span class="p">]</span>
<span class="n">ep0</span> <span class="o">=</span> <span class="n">PG3_733_peak_positions</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ep1</span> <span class="o">=</span> <span class="n">PG3_733_peak_positions</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">ep2</span> <span class="o">=</span> <span class="n">PG3_733_peak_positions</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">fp0</span> <span class="o">=</span> <span class="n">PG3_733_peak_positions</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fp1</span> <span class="o">=</span> <span class="n">PG3_733_peak_positions</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">fp2</span> <span class="o">=</span> <span class="n">PG3_733_peak_positions</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>

<span class="c1"># print data</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Spectrum 1: Expected right most 3 peaks at </span><span class="si">{0:.7f}</span><span class="s1">, </span><span class="si">{1:.7f}</span><span class="s1">, </span><span class="si">{2:.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ep0</span><span class="p">,</span> <span class="n">ep1</span><span class="p">,</span> <span class="n">ep2</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Spectrum 1: Found    right most 3 peaks at </span><span class="si">{0:.7f}</span><span class="s1">, </span><span class="si">{1:.7f}</span><span class="s1">, </span><span class="si">{2:.7f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fp0</span><span class="p">,</span> <span class="n">fp1</span><span class="p">,</span> <span class="n">fp2</span><span class="p">))</span>

<span class="c1"># delete workspaces</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;PG3_733_peak_positions&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;PG3_733_fitted_peaks&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;PG3_733_peak_params&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;ws&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Spectrum 1: Expected right most 3 peaks at 2.1401000, 1.5133000, 1.2356000
Spectrum 1: Found    right most 3 peaks at 2.1485553, 1.5190662, 1.2404027
</pre></div>
</div>
<p><strong>Example - Fit back-to-back exponential peaks (Vulcan diamond):</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># load data</span>
<span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s2">&quot;vulcan_diamond.nxs&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;diamond_3peaks&quot;</span><span class="p">)</span>

<span class="n">FitPeaks</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;diamond_3peaks&quot;</span><span class="p">,</span> <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">StopWorkspaceIndex</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
       <span class="n">PeakCenters</span><span class="o">=</span><span class="s2">&quot;0.6867, 0.728299, 0.89198, 1.0758&quot;</span><span class="p">,</span>
       <span class="n">PeakFunction</span><span class="o">=</span><span class="s2">&quot;BackToBackExponential&quot;</span><span class="p">,</span> <span class="n">BackgroundType</span><span class="o">=</span><span class="s2">&quot;Linear&quot;</span><span class="p">,</span>
       <span class="n">FitWindowBoundaryList</span><span class="o">=</span><span class="s2">&quot;0.67, 0.709, 0.71, 0.76, 0.87, 0.92, 1.05, 1.1&quot;</span><span class="p">,</span>
       <span class="n">PeakParameterNames</span><span class="o">=</span><span class="s2">&quot;I, A, B, X0, S&quot;</span><span class="p">,</span>
       <span class="n">PeakParameterValues</span><span class="o">=</span><span class="s2">&quot;2.5e+06, 5400, 1700, 1.07, 0.000355&quot;</span><span class="p">,</span>
       <span class="n">FitFromRight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
       <span class="n">HighBackground</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
       <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;diamond_peaks_centers&quot;</span><span class="p">,</span>
       <span class="n">OutputPeakParametersWorkspace</span><span class="o">=</span><span class="s2">&quot;PeakParametersWS2&quot;</span><span class="p">,</span>
       <span class="n">FittedPeaksWorkspace</span><span class="o">=</span><span class="s2">&quot;FittedPeaksWS2&quot;</span><span class="p">)</span>

<span class="n">fitted_peak_pos_ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;diamond_peaks_centers&#39;</span><span class="p">]</span>

<span class="c1"># print result</span>
<span class="k">for</span> <span class="n">ws_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Spectrum </span><span class="si">{0}</span><span class="s1">:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">peak_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">exp_pos</span> <span class="o">=</span> <span class="n">fitted_peak_pos_ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="n">ws_index</span><span class="p">)[</span><span class="n">peak_index</span><span class="p">]</span>
        <span class="n">fit_pos</span> <span class="o">=</span> <span class="n">fitted_peak_pos_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">ws_index</span><span class="p">)[</span><span class="n">peak_index</span><span class="p">]</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Expected @ </span><span class="si">{0:.3f}</span><span class="s1">  Fitted @ </span><span class="si">{1:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exp_pos</span><span class="p">,</span> <span class="n">fit_pos</span><span class="p">))</span>

<span class="c1"># clean</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;diamond_3peaks&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;diamond_peaks_centers&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;FittedPeaksWS2&#39;</span><span class="p">)</span>
<span class="n">DeleteWorkspace</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;PeakParametersWS2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Spectrum 1:
Expected @ 0.892  Fitted @ 0.892
Expected @ 1.076  Fitted @ 1.075
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Optimization.html">Optimization</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id40">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/7cec3a047fd2864c82ac0280d76fe566152576ec/Framework/Algorithms/inc/MantidAlgorithms/FitPeaks.h">FitPeaks.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/7cec3a047fd2864c82ac0280d76fe566152576ec/Framework/Algorithms/src/FitPeaks.cpp">FitPeaks.cpp</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FitPeak-v1.html" title="Previous Chapter: FitPeak v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FitPeak v1</span>
    </a>
  </li>
  <li>
    <a href="FitPowderDiffPeaks-v1.html" title="Next Chapter: FitPowderDiffPeaks v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FitPowderDiffPeaks v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>