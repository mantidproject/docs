<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PrimStretchedExpFT</title>
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '5.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ProductFunction" href="ProductFunction.html" />
    <link rel="prev" title="Porod" href="Porod.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>5.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="primstretchedexpft">
<span id="func-primstretchedexpft"></span><h1>PrimStretchedExpFT<a class="headerlink" href="#primstretchedexpft" title="Permalink to this headline">¶</a></h1>
<div class="section" id="properties-fitting-parameters">
<span id="index-0"></span><h2>Properties (fitting parameters)<a class="headerlink" href="#properties-fitting-parameters" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="16%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Height</td>
<td>0.1</td>
<td>Intensity at the origin</td>
</tr>
<tr class="row-odd"><td>Tau</td>
<td>100.0</td>
<td>Relaxation time</td>
</tr>
<tr class="row-even"><td>Beta</td>
<td>1.0</td>
<td>Stretching exponent</td>
</tr>
<tr class="row-odd"><td>Centre</td>
<td>0.0</td>
<td>Centre of the peak</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Provides the Fourier Transform of the Symmetrized Stretched Exponential Function integrated over
each energy bin.</p>
<div class="math">
<p><img src="../../_images/math/aea51b6e72bf82ebb7719b9e4af95937cb89d60c.png" alt="S(Q,E) = \int_{E-\delta E}^{E+\delta E} dE' StretchedExpFT(E', Centre, Tau, Beta)"/></p>
</div><p>with <img class="math" src="../../_images/math/bfeaf747532165aaa37e3190076ff1bf3d2bd7e1.png" alt="StretchedExpFT" style="vertical-align: -4px"/> is fit function <a class="reference internal" href="StretchedExpFT.html#func-stretchedexpft"><span class="std std-ref">StretchedExpFT</span></a>.
Quantity <img class="math" src="../../_images/math/c28bb5eb0ae1a9986571c933161f8fb3fad19d98.png" alt="\delta E" style="vertical-align: 0px"/> is evaluated at run time. If we request to evaluate this
function over a set of energy values <img class="math" src="../../_images/math/940198ff425cf4501237b38d1e16677098ecb015.png" alt="E_0,..,E_N" style="vertical-align: -4px"/>,
then <img class="math" src="../../_images/math/7f1af9553f0d8de421ca7e516ebcfea736754e70.png" alt="2\delta E = \frac{E_N-E_0}{N}" style="vertical-align: -6px"/></p>
<p>In the picture below we evaluated function StretcheExpFT at the center of bins of width
<img class="math" src="../../_images/math/9f96e2c2e751d7e3792fb9d88fc587c7ee646b0c.png" alt="0.4 \mu eV" style="vertical-align: -4px"/> (label &lt;i&gt;center_evaluated&lt;/i&gt;). However, one should compare the integral
of ​the model within each bin against experimental QENS data, because the data is a histogram.
Nevertheless, we usually compare the value that the model takes at the center of each bin instead
of the integral. This approximation is acceptable when the model does not change much
within each bin. This is specially true at high energies when StretcheExpFT is very smooth.
Sometimes this center-of-the-bin evaluation is wrong, like in the central bin [-0.2, 0.2]ueV.
The integral of <img class="math" src="../../_images/math/bfeaf747532165aaa37e3190076ff1bf3d2bd7e1.png" alt="StretchedExpFT" style="vertical-align: -4px"/> in this bin is the red dot, and the value of
<img class="math" src="../../_images/math/bfeaf747532165aaa37e3190076ff1bf3d2bd7e1.png" alt="StretchedExpFT" style="vertical-align: -4px"/> at the center of the bin is the black dot at the top. Very different!
This situation is likely to arise for samples with a relaxation rate <img class="math" src="../../_images/math/1237c334d66dbd0481d980316a0db941f88f5582.png" alt="h/Tau \ll \delta E" style="vertical-align: -5px"/>.
Finally, the blue line is the evaluation of <img class="math" src="../../_images/math/6effcf7f02de5054966f33eb8f5d2f6d187a054d.png" alt="PrimStretchedExpFT" style="vertical-align: -4px"/> at each bin center, which
by design amounts to the integral of <img class="math" src="../../_images/math/bfeaf747532165aaa37e3190076ff1bf3d2bd7e1.png" alt="StretchedExpFT" style="vertical-align: -4px"/> within each bin. This curve
coincides with the red dot for the central bin, as expected. Also, it agrees with the
center-of-bin evaluation of <img class="math" src="../../_images/math/bfeaf747532165aaa37e3190076ff1bf3d2bd7e1.png" alt="StretchedExpFT" style="vertical-align: -4px"/> at high energies, when the center-of-the-bin
approximation is acceptable.</p>
<div class="figure">
<img alt="Comparison of Pseudo-Voigt function with Gaussian and Lorentzian profiles." src="../../_images/PrimStretchedExpFT_fig1.png" />
</div>
</div>
<div class="section" id="usage">
<span id="primstretchedexpft-usage"></span><h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Fit to a QENS signal:</strong></p>
<p>The QENS signal is modeled by the convolution of a resolution function
with elastic and PrimStretchedExpFT components.
Noise is modeled by a linear background:</p>
<p><img class="math" src="../../_images/math/84497ae8d014a643c75eb487c713095cc96fe865.png" alt="S(Q,E) = R(Q,E) \otimes (\alpha \delta(E) + PrimStretchedExpFT(Q,E)) + (a+bE)" style="vertical-align: -4px"/></p>
<p>Obtaining an initial guess close to the optimal fit is critical. For this model,
it is recommended to follow these steps:
- In the Fit Function window of MantidPlot, construct the model.
- Tie parameter <img class="math" src="../../_images/math/af4cd31e950ec5b911cb88f6dbd162e83fa85cb3.png" alt="Height" style="vertical-align: -4px"/> of PrimStretchedExpFT to zero, then carry out the Fit. This will result in optimized elastic line and background.
- Untie parameter <img class="math" src="../../_images/math/af4cd31e950ec5b911cb88f6dbd162e83fa85cb3.png" alt="Height" style="vertical-align: -4px"/> of PrimStretchedExpFT and tie parameter <img class="math" src="../../_images/math/86c898cf0351c13d5ea603d9a5bf0a7406e76499.png" alt="Beta" style="vertical-align: 0px"/> to 1.0, then carry out the fit. This will result in optimized model using an exponential.
- Release the tie on Beta  and redo the fit.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Load resolution function and scattered signal</span>
<span class="n">resolution</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s2">&quot;resolution_14955.nxs&quot;</span><span class="p">)</span>
<span class="n">qens_data</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s2">&quot;qens_data_14955.nxs&quot;</span><span class="p">)</span>

<span class="c1"># This function_string is obtained by constructing the model</span>
<span class="c1"># with the Fit Function window of MantidPlot, then</span>
<span class="c1"># Setup--&gt; Manage Setup --&gt; Copy to Clipboard</span>
<span class="n">function_string</span>  <span class="o">=</span> <span class="s2">&quot;(composite=Convolution,FixResolution=true,NumDeriv=true;&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;name=TabulatedFunction,Workspace=resolution,WorkspaceIndex=0,Scaling=1,Shift=0,XScaling=1;&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;(name=DeltaFunction,Height=1,Centre=0;&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;name=PrimStretchedExpFT,Height=1.0,Tau=100,Beta=0.98,Centre=0));&quot;</span>
<span class="n">function_string</span> <span class="o">+=</span> <span class="s2">&quot;name=LinearBackground,A0=0,A1=0&quot;</span>

<span class="c1"># Carry out the fit. Produces workspaces  fit_results_Parameters,</span>
<span class="c1">#  fit_results_Workspace, and fit_results_NormalisedCovarianceMatrix.</span>
<span class="n">Fit</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="n">function_string</span><span class="p">,</span>
   <span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;qens_data&quot;</span><span class="p">,</span>
   <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
   <span class="n">StartX</span><span class="o">=-</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">EndX</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
   <span class="n">CreateOutput</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
   <span class="n">Output</span><span class="o">=</span><span class="s2">&quot;fit_results&quot;</span><span class="p">)</span>

<span class="c1"># Collect and print parameters for PrimStrechtedExpFT</span>
<span class="n">parameters_of_interest</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Tau&quot;</span><span class="p">,</span> <span class="s2">&quot;Beta&quot;</span><span class="p">)</span>
<span class="n">values_found</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s2">&quot;fit_results_Parameters&quot;</span><span class="p">]</span>  <span class="c1"># Workspace containing optimized parameters</span>
<span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
   <span class="n">full_parameter_name</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">row_index</span><span class="p">)[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
   <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameters_of_interest</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">full_parameter_name</span><span class="p">:</span>
         <span class="n">values_found</span><span class="p">[</span><span class="n">parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">row_index</span><span class="p">)[</span><span class="s2">&quot;Value&quot;</span><span class="p">]</span>
         <span class="k">break</span>
<span class="k">if</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Beta&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.63</span> <span class="ow">and</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Beta&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.71</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Beta found within [0.63, 0.71]&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Tau&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">54.0</span> <span class="ow">and</span> <span class="n">values_found</span><span class="p">[</span><span class="s2">&quot;Tau&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">60.0</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Tau found within [54.0, 60.0]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Beta found within [0.63, 0.71]
Tau found within [54.0, 60.0]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/FitFunctions.html">FitFunctions</a> | <a class="reference external" href="categories/QuasiElastic.html">QuasiElastic</a></p>
</div>
<div class="section" id="source">
<h2>Source<a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a412251b161c30a0be7a42eaf858d03199961661/Framework/PythonInterface/plugins/functions/PrimStretchedExpFT.py">PrimStretchedExpFT.py</a> <em>(last modified: 2019-11-13)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="Porod.html" title="Previous Chapter: Porod"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Porod</span>
    </a>
  </li>
  <li>
    <a href="ProductFunction.html" title="Next Chapter: ProductFunction"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ProductFunction &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2020-03-14.<br/>
    </p>
  </div>
</footer>
  </body>
</html>