<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>EnggFitPeaks v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EnggFitTOFFromPeaks v1" href="EnggFitTOFFromPeaks-v1.html" />
    <link rel="prev" title="EnggCalibrateFull v1" href="EnggCalibrateFull-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>5.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="enggfitpeaks-v1">
<span id="algm-enggfitpeaks"></span><span id="algm-enggfitpeaks-v1"></span><h1>EnggFitPeaks v1<a class="headerlink" href="#enggfitpeaks-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/EnggFitPeaks-v1_dlg.png"><img alt="../_images/EnggFitPeaks-v1_dlg.png" class="screenshot" src="../_images/EnggFitPeaks-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><span class="caption-text"><strong>EnggFitPeaks</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>The algorithm fits an expected diffraction pattern to a spectrum from a workspace by fitting one peak at a time (single peak fits).</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="EnggFitTOFFromPeaks-v1.html#algm-enggfittoffrompeaks"><span class="std std-ref">EnggFitTOFFromPeaks</span></a>, <a class="reference internal" href="GSASIIRefineFitPeaks-v1.html#algm-gsasiirefinefitpeaks"><span class="std std-ref">GSASIIRefineFitPeaks</span></a>, <a class="reference internal" href="Fit-v1.html#algm-fit"><span class="std std-ref">Fit</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="7%" />
<col width="39%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Workspace to fit peaks in. The X units must be time of flight (TOF).</td>
</tr>
<tr class="row-odd"><td>WorkspaceIndex</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Index of the spectra to fit peaks in</td>
</tr>
<tr class="row-even"><td>ExpectedPeaks</td>
<td>Input</td>
<td>dbl list</td>
<td>3.12428,2.7057,1.91322,1.6316,1.56214,1.35285,1.24146,1.21003,1.1046,1.04143,0.95661,0.914694,0.901901,0.855618,0.825232,0.8158,0.781069,0.757748,0.750427,0.72313,0.704505,0.676426,0.661108,0.656229,0.63774,0.624855,0.620731,0.605014</td>
<td>A list of peak centre values to be translated into TOF (if required) to find expected peaks.</td>
</tr>
<tr class="row-odd"><td>ExpectedPeaksFromFile</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Load from file a list of peak centre values to be translated into TOF (if required) to find expected peaks. This takes precedence over ‘ExpectedPeaks’ if both options are given. Allowed extensions: [‘.csv’]</td>
</tr>
<tr class="row-even"><td>OutFittedPeaksTable</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Name for a table workspace with the parameters of the peaks found and fitted. If not given, the table workspace is not created.</td>
</tr>
<tr class="row-odd"><td>FittedPeaks</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Information on fitted peaks. The table contains, for every peak fitted the expected peak value (in d-spacing), and the parameters fitted. The expected values are given in the column labelled ‘dSpacing’. When fitting back-to-back exponential functions, the ‘X0’ column has the fitted peak center.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It
might get changed or even removed without a notification, should
instrument scientists decide to do so.</p>
</div>
<p>Fits a series of single peaks to a spectrum with an expected
diffraction pattern.  The pattern is specified by providing a list of
peak centres where Bragg peaks are expected. These expected values
are used as initial peak positions when fitting the peaks. The
expected dSpacing values can be given as an input string or in a file
with values separated by commas. These values can be in units of either
TOF or dSpacing, but <strong>not</strong> a mixture of the two. At least one of the
peaks in the list must lie inside the x limits of the input workspace.</p>
<p>The peaks are fitted one at a time. The peak centres given in the
property ExpectedPeaks are initially assumed to be in units of TOF.
If none lie inside the x limits of the input workspace, EnggFitPeaks
tries converting them to dSpacing, and if they still don’t fit the data
then the algorithm fails.</p>
<p>After the conversion of units, the algorithm tries to fit (in
time-of-flight) a peak in the neighborhood of every expected peak
using a peak shape or function. The conversion is done as in the
Mantid algorithm <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><span class="std std-ref">AlignDetectors</span></a>
(following GSAS equations) if the workspace is focused (single
spectrum) and has a log entry named “difc”, where the GSAS DIFC
parameter is expected. Otherwise the conversion of units is done as in
the Mantid <a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><span class="std std-ref">ConvertUnits</span></a>.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="EnggFitTOFFromPeaks-v1.html#algm-enggfittoffrompeaks"><span class="std std-ref">EnggFitTOFFromPeaks</span></a>.</p>
</div>
<p>This algorithm currently fits (single) peaks of type
<a class="reference internal" href="../fitting/fitfunctions/BackToBackExponential.html#func-backtobackexponential"><span class="std std-ref">Back2BackExponential</span></a>. Other
alternatives might be added as optional in the future (for example the
simpler <a class="reference internal" href="../fitting/fitfunctions/Gaussian.html#func-gaussian"><span class="std std-ref">Gaussian</span></a> or the more complex
<em>Bk2BkExpConvPV</em> or <a class="reference internal" href="../fitting/fitfunctions/IkedaCarpenterPV.html#func-ikedacarpenterpv"><span class="std std-ref">IkedaCarpenterPV</span></a>). To
produce an initial guess for the peak
function parameters this algorithm uses the <a class="reference internal" href="FindPeaks-v1.html#algm-findpeaks"><span class="std std-ref">FindPeaks</span></a> algorithm
starting from the expected peaks list given in the inputs.</p>
<p>The algorithm produces an output table workspace with information
about the peaks fitted. The table has one row per peak and several
columns for the different fitted parameters (and the errors of these
parameters). If a name is given in the input OutFittedPeaksTable, the
table will be available in the “analysis data service” (workspaces
window) with that name.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Fitting two peaks:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Two BackB2Back exponential peaks</span>
<span class="n">peak1</span> <span class="o">=</span> <span class="s2">&quot;name=BackToBackExponential,I=6000,A=1,B=0.5,X0=15000,S=250&quot;</span>
<span class="n">peak2</span> <span class="o">=</span> <span class="s2">&quot;name=BackToBackExponential,I=5000,A=1,B=0.7,X0=35000,S=300&quot;</span>

<span class="c1"># Create workpsace with the above peaks and a single detector pixel</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s2">&quot;User Defined&quot;</span><span class="p">,</span>
                           <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="n">peak1</span> <span class="o">+</span> <span class="s2">&quot;;&quot;</span> <span class="o">+</span> <span class="n">peak2</span><span class="p">,</span>
                           <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">XMin</span><span class="o">=</span><span class="mi">6000</span><span class="p">,</span>
                           <span class="n">XMax</span><span class="o">=</span><span class="mi">45000</span><span class="p">,</span>
                           <span class="n">BinWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Update instrument geometry to something that would allow converting to some sane dSpacing values</span>
<span class="n">EditInstrumentGeometry</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="n">ws</span><span class="p">,</span> <span class="n">L2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">],</span> <span class="n">Polar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">PrimaryFlightPath</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Run the algorithm. Defaults are shown below. Files entered must be in .csv format and if both ExpectedPeaks and ExpectedPeaksFromFile are entered, the latter will be used.</span>

<span class="n">peaks_tbl</span> <span class="o">=</span> <span class="n">EnggFitPeaks</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">])</span>


<span class="c1"># Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of peaks fitted: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First peak expected (dSpacing): </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;dSpacing&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;First fitted peak center (ToF): </span><span class="si">{0:.1f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;X0&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second peak expected (dSpacing): </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;dSpacing&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Second fitted peak center (ToF): </span><span class="si">{0:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;X0&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Number of peaks fitted: 2
First peak expected (dSpacing): 0.8
First fitted peak center (ToF): 15006.0
Second peak expected (dSpacing): 1.9
Second fitted peak center (ToF): 35010
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a> | <a class="reference external" href="categories/Diffraction/Fitting.html">Diffraction\Fitting</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/a412251b161c30a0be7a42eaf858d03199961661/Framework/PythonInterface/plugins/algorithms/EnggFitPeaks.py">EnggFitPeaks.py</a> <em>(last modified: 2020-02-07)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnggCalibrateFull-v1.html" title="Previous Chapter: EnggCalibrateFull v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; EnggCalibrateFull v1</span>
    </a>
  </li>
  <li>
    <a href="EnggFitTOFFromPeaks-v1.html" title="Next Chapter: EnggFitTOFFromPeaks v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">EnggFitTOFFro... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2020-03-14.<br/>
    </p>
  </div>
</footer>
  </body>
</html>