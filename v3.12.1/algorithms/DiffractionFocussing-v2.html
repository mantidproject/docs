<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DiffractionFocussing v2</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DirectILLApplySelfShielding v1" href="DirectILLApplySelfShielding-v1.html" />
    <link rel="prev" title="DiffractionFocussing v1" href="DiffractionFocussing-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="diffractionfocussing-v2">
<span id="algm-diffractionfocussing"></span><span id="algm-diffractionfocussing-v2"></span><h1>DiffractionFocussing v2<a class="headerlink" href="#diffractionfocussing-v2" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DiffractionFocussing-v2_dlg.png"><img alt="../_images/DiffractionFocussing-v2_dlg.png" class="screenshot" src="../_images/DiffractionFocussing-v2_dlg.png" style="width: 346px;" /></a>
<p class="caption"><strong>DiffractionFocussing</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a><ul>
<li><a class="reference internal" href="#for-eventworkspaces" id="id5">For EventWorkspaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#previous-versions" id="id7">Previous Versions</a><ul>
<li><a class="reference internal" href="#version-1" id="id8">Version 1</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source" id="id9">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Algorithm to focus powder diffraction data into a number of histograms according to a grouping scheme defined in a CalFile.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="3%" />
<col width="18%" />
<col width="5%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A 2D workspace with X values of d-spacing/Q-spacing</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The result of diffraction focussing of InputWorkspace</td>
</tr>
<tr class="row-even"><td>GroupingFileName</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Optional: The name of the CalFile with grouping data. Allowed extensions: [&#8216;.cal&#8217;]</td>
</tr>
<tr class="row-odd"><td>GroupingWorkspace</td>
<td>Input</td>
<td>GroupingWorkspace</td>
<td>&nbsp;</td>
<td>Optional: GroupingWorkspace to use instead of a grouping file.</td>
</tr>
<tr class="row-even"><td>PreserveEvents</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Keep the output workspace as an EventWorkspace, if the input has events (default). If false, then the workspace gets converted to a Workspace2D histogram.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><img alt="Example of RAW GEM data focused across the 5 detector banks" src="../_images/GEM_Focused.png" /> Given an
InputWorkspace and a Grouping filename, the algorithm performs the
following:</p>
<ol class="arabic simple">
<li>The calibration file is read and a map of corresponding udet-group is
created.</li>
<li>The algorithm determines the X boundaries for each group as the upper
and lower limits of all contributing detectors. It then calculates
a logarithmic step that preserves the number of bins in the initial workspace.
It assumes that the entire data set uses logarithmic binning in the process
(i.e. it does not check for constant width binning).</li>
<li>All histograms are read and rebinned to the new grid for their group.</li>
<li>A new workspace with N histograms is created.</li>
</ol>
<p>Within the <a class="reference external" href="http://www.mantidproject.org/CalFile">CalFile</a> any detectors with the &#8216;select&#8217; flag
can be set to zero or with a group number of 0 or -ve groups are not
included in the analysis.</p>
<p>Since the new X boundaries depend on the group and not the entire
workspace, this focusing algorithm does not create overestimated X
ranges for multi-group instruments. However it is important to remember
that this means that this algorithm outputs a <a class="reference internal" href="../concepts/Ragged_Workspace.html#ragged-workspace"><em>ragged workspace</em></a>.
Some 2D and 3D plots will not display the data correctly.</p>
<p>The DiffractionFocussing algorithm uses GroupDetectors algorithm to
combine data from several spectra according to GroupingFileName file
which is a <a class="reference external" href="http://www.mantidproject.org/CalFile">CalFile</a>.</p>
<div class="section" id="for-eventworkspaces">
<h3><a class="toc-backref" href="#id5">For EventWorkspaces</a><a class="headerlink" href="#for-eventworkspaces" title="Permalink to this headline">¶</a></h3>
<p>The algorithm can be used with an <a class="reference external" href="http://www.mantidproject.org/EventWorkspace">EventWorkspace</a>
input, and will create an EventWorkspace output if a different workspace
is specified.</p>
<p>The main difference vs. using a Workspace2D is that the event lists from
all the incoming pixels are simply appended in the grouped spectra; this
means that you can rebin the resulting spectra to finer bins with no
loss of data. In fact, it is unnecessary to bin your incoming data at
all; binning can be performed as the very last step.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Diffraction focussing of HRPD data:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Load HRP dataset</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&quot;HRP39180.RAW&quot;</span><span class="p">)</span>

<span class="c"># specify groupping file, here using CalFile format</span>
<span class="n">cal_file</span> <span class="o">=</span> <span class="s">&quot;hrpd_new_072_01_corr.cal&quot;</span>

<span class="c"># For HRPD data, perform a unit convertion TOF-&gt;d-spacing, taking into account detector position offsets</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">AlignDetectors</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;ws&#39;</span><span class="p">,</span><span class="n">CalibrationFile</span><span class="o">=</span><span class="n">cal_file</span><span class="p">)</span>
<span class="c"># Focus the data</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">DiffractionFocussing</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;ws&#39;</span><span class="p">,</span><span class="n">GroupingFileName</span><span class="o">=</span><span class="n">cal_file</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;The 51st y-value is: </span><span class="si">%.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The 51st y-value is: 900.709
</pre></div>
</div>
<p><strong>Example - Demonstrating option PreserveEvents:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create event workspace with one bank of 4 detectors</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&quot;Event&quot;</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s">&quot;dSpacing&quot;</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c"># focus data in 4 spectra to 2 spectra according to .cal file and don&#39;t perserve events</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">DiffractionFocussing</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;ws&#39;</span><span class="p">,</span> <span class="n">GroupingFileName</span><span class="o">=</span><span class="s">&quot;4detector_cal_example_file.cal&quot;</span> \
     <span class="p">,</span> <span class="n">PreserveEvents</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Number of focussed spectra: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;What type is the workspace after focussing: &quot;</span> <span class="o">+</span> <span class="n">ws</span><span class="o">.</span><span class="n">id</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Number of focussed spectra: 2
What type is the workspace after focussing: Workspace2D
</pre></div>
</div>
</div>
<div class="section" id="previous-versions">
<h2><a class="toc-backref" href="#id7">Previous Versions</a><a class="headerlink" href="#previous-versions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="version-1">
<h3><a class="toc-backref" href="#id8">Version 1</a><a class="headerlink" href="#version-1" title="Permalink to this headline">¶</a></h3>
<p>Version 1 did not support the use of workspaces to carry grouping
workspaces and only worked with CalFiles.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Diffraction/Focussing.html">Diffraction\Focussing</a></p>
</div>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id9">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5d6dddaa6354533ad7536be123c78a52660a8bbb/Framework/Algorithms/src/DiffractionFocussing2.cpp">DiffractionFocussing2.cpp</a> <em>(last modified: 2018-03-07)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5d6dddaa6354533ad7536be123c78a52660a8bbb/Framework/Algorithms/inc/MantidAlgorithms/DiffractionFocussing2.h">DiffractionFocussing2.h</a> <em>(last modified: 2018-03-07)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DiffractionFocussing-v1.html" title="Previous Chapter: DiffractionFocussing v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DiffractionFocus...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLApplySelfShielding-v1.html" title="Next Chapter: DirectILLApplySelfShielding v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLApplySe... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-04-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>