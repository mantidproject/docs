<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DetectorEfficiencyCorUser v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DetectorEfficiencyVariation v1" href="DetectorEfficiencyVariation-v1.html" />
    <link rel="prev" title="DetectorEfficiencyCor v1" href="DetectorEfficiencyCor-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="detectorefficiencycoruser-v1">
<span id="algm-detectorefficiencycoruser"></span><span id="algm-detectorefficiencycoruser-v1"></span><h1>DetectorEfficiencyCorUser v1<a class="headerlink" href="#detectorefficiencycoruser-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DetectorEfficiencyCorUser-v1_dlg.png"><img alt="../_images/DetectorEfficiencyCorUser-v1_dlg.png" class="screenshot" src="../_images/DetectorEfficiencyCorUser-v1_dlg.png" style="width: 341px;" /></a>
<p class="caption"><strong>DetectorEfficiencyCorUser</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Corrects for detector efficiency. The correction factor is calculated using an instrument specific formula as a function of the final neutron energy E_f=E_i-E. Note that the formula is implemented only for a limited number of TOF instruments.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="5%" />
<col width="31%" />
<col width="9%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The workspace to correct for detector efficiency</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the workspace in which to store the result.</td>
</tr>
<tr class="row-even"><td>IncidentEnergy</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>The energy of neutrons leaving the source.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm will correct detector efficiency according to the ILL INX
program for time-of-flight data reduction.</p>
<p>A formula named &#8220;formula_eff&#8221; must be defined in the instrument
parameters file and linked to all detectors in the input workspace. Different
components can have different formulas. The formula for each detector is
searched recursively. Thus, there can be, for example, a global formula for the
entire instrument and a specific formula for a bank or tube overriding the
global one.</p>
<p>The input workspace must be in DeltaE units.</p>
<p>The output data will be corrected as:</p>
<p><img class="math" src="../_images/math/ce6db02f91ee58f087cd9923ca01421b74c0eab4.png" alt="y = \frac{y}{eff}" style="vertical-align: -9px"/></p>
<p>where <img class="math" src="../_images/math/91a7a9cb77e59ae9d475fcecaefd6631391603a0.png" alt="eff" style="vertical-align: -4px"/> is</p>
<p><img class="math" src="../_images/math/1c517cf693509653128889363f1cd87ce3e1d19c.png" alt="eff = \frac{f(Ei - \Delta E)}{f(E_i)}" style="vertical-align: -9px"/></p>
<p>The function <img class="math" src="../_images/math/e3d61564e5203232caf00b3bd459ab5db464235b.png" alt="f" style="vertical-align: -4px"/> is defined as &#8220;formula_eff&#8221; in the IDF. To date
this has been implemented at the ILL for ILL IN4, IN5 and IN6, and at
the MLZ for TOFTOF.</p>
<p>Unlike <a class="reference internal" href="DetectorEfficiencyCor-v1.html#algm-detectorefficiencycor"><em>DetectorEfficiencyCor v1</em></a> algorithm, which uses tabulated formula
accounting for neutron adsorption efficiency dependence on neutron energy,
the formula used by this algorithm
is provided by instrument scientist and is adjusted for the instrument,
accounting for a number of additional instrument specific factors.</p>
<p>As example, for <a class="reference external" href="http://www.mlz-garching.de/toftof">TOFTOF</a> instrument, the energy-dependent intensity
loss factor accounts also for absorption of neutrons by the Ar gas in the flight chamber, Al windows
of sample environment etc.
The formula used by DetectorEfficiencyCorUser algorithm is derived for TOFTOF in paper of
T. Unruh, 2007, doi:10.1016/j.nima.2007.07.015 and is set up in the TOFTOF instrument parameters file.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - A sample correction</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># a sample workspace with a sample instrument</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="c"># convert to Wavelength</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="s">&quot;DeltaE&quot;</span><span class="p">,</span><span class="n">EMode</span><span class="o">=</span><span class="s">&quot;Direct&quot;</span><span class="p">,</span><span class="n">EFixed</span><span class="o">=</span><span class="mf">3.27</span><span class="p">)</span>

<span class="n">correction_formula</span> <span class="o">=</span> <span class="s">&quot;exp(-0.0565/sqrt(e))*(1.0-exp(-3.284/sqrt(e)))&quot;</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">ParameterName</span><span class="o">=</span><span class="s">&quot;formula_eff&quot;</span><span class="p">,</span><span class="n">Value</span><span class="o">=</span><span class="n">correction_formula</span><span class="p">)</span>


<span class="c"># Now we are ready to run the correction</span>
<span class="n">wsCorrected</span> <span class="o">=</span> <span class="n">DetectorEfficiencyCorUser</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>


<span class="k">print</span><span class="p">(</span><span class="s">&quot;The correction for the data by the user defined function.&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;In this case: &quot;</span> <span class="o">+</span> <span class="n">correction_formula</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">wsCorrected</span><span class="o">.</span><span class="n">blocksize</span><span class="p">(),</span><span class="mi">10</span><span class="p">):</span>
  <span class="k">print</span><span class="p">(</span><span class="s">&quot;The correct value in bin {} is {:.2f} compared to {:.2f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">wsCorrected</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The correction for the data by the user defined function.
In this case: exp(-0.0565/sqrt(e))*(1.0-exp(-3.284/sqrt(e)))
The correct value in bin 0 is 4.30 compared to 0.30
The correct value in bin 10 is 0.52 compared to 0.30
The correct value in bin 20 is 0.35 compared to 0.30
The correct value in bin 30 is 0.30 compared to 0.30
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a> | <a class="reference external" href="categories/Inelastic/Corrections.html">Inelastic\Corrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5d6dddaa6354533ad7536be123c78a52660a8bbb/Framework/Algorithms/src/DetectorEfficiencyCorUser.cpp">DetectorEfficiencyCorUser.cpp</a> <em>(last modified: 2018-03-07)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5d6dddaa6354533ad7536be123c78a52660a8bbb/Framework/Algorithms/inc/MantidAlgorithms/DetectorEfficiencyCorUser.h">DetectorEfficiencyCorUser.h</a> <em>(last modified: 2018-03-07)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DetectorEfficiencyCor-v1.html" title="Previous Chapter: DetectorEfficiencyCor v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DetectorEfficien...</span>
    </a>
  </li>
  <li>
    <a href="DetectorEfficiencyVariation-v1.html" title="Next Chapter: DetectorEfficiencyVariation v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DetectorEfficien... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-04-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>