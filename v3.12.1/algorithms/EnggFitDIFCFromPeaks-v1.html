<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>EnggFitDIFCFromPeaks v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="EnggFitPeaks v1" href="EnggFitPeaks-v1.html" />
    <link rel="prev" title="EnggCalibrateFull v1" href="EnggCalibrateFull-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="enggfitdifcfrompeaks-v1">
<span id="algm-enggfitdifcfrompeaks"></span><span id="algm-enggfitdifcfrompeaks-v1"></span><h1>EnggFitDIFCFromPeaks v1<a class="headerlink" href="#enggfitdifcfrompeaks-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/EnggFitDIFCFromPeaks-v1_dlg.png"><img alt="../_images/EnggFitDIFCFromPeaks-v1_dlg.png" class="screenshot" src="../_images/EnggFitDIFCFromPeaks-v1_dlg.png" style="width: 330px;" /></a>
<p class="caption"><strong>EnggFitDIFCFromPeaks</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>The algorithm fits an expected diffraction pattern to a workpace spectrum by performing single peak fits.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="2%" />
<col width="10%" />
<col width="3%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>FittedPeaks</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Information on fitted peaks, in the format produced by EnggFitPeaks. The table must contain, for every peak fitted the expected peak value (in d-spacing), and the parameters fitted. The expected values are given in the column labelled &#8216;dSpacing&#8217;. When using the back-to-back exponential peak function, the &#8216;X0&#8217; column must have the fitted peak center.</td>
</tr>
<tr class="row-odd"><td>OutParametersTable</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Name for a table workspace with the fitted values calculated by this algorithm (DIFC and TZERO calibration parameters) for GSAS. These two parameters are added as two columns in a single row. If not given, the table workspace is not created.</td>
</tr>
<tr class="row-even"><td>DIFA</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Fitted DIFA value. This parameter is not effectively considered and it is always zero in this version of the algorithm.</td>
</tr>
<tr class="row-odd"><td>DIFC</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Fitted DIFC calibration parameter</td>
</tr>
<tr class="row-even"><td>TZERO</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Fitted TZERO calibration parameter</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It
might undergo significant changes, should instrument scientists
decide to do so.</p>
</div>
<p>Finds the calibration parameters DIFC and TZERO (as defined in GSAS)
from a list of peaks fitted to a diffraction pattern. The peaks can be
fitted to a Mantid workspace spectrum using the algorithm
<a class="reference internal" href="EnggFitPeaks-v1.html#algm-enggfitpeaks"><em>EnggFitPeaks</em></a> which produces a table with
parameter values for peaks in time-of-flight (TOF, see
<a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><em>Unit Factory</em></a>). The table is the essential
input to this algorithm.</p>
<p>This algorithm fits the adjusted peak time-of-fligth value positions
that are fitted against expected dSpacing values (d) according to the
expression:</p>
<div class="math">
<p><img src="../_images/math/bef98cfd7a9f51ce0e9380f1401ed7a2d26f0f2e.png" alt="TOF = DIFC*d + TZERO"/></p>
</div><p>The calibration parameters TZERO and DIFC can then be used within the
GSAS program or in other Mantid algorithms (see <a class="reference internal" href="EnggCalibrate-v1.html#algm-enggcalibrate"><em>EnggCalibrate</em></a> and <a class="reference internal" href="EnggCalibrateFull-v1.html#algm-enggcalibratefull"><em>EnggCalibrateFull</em></a>).  These parameters are returned and can be
retrieved as output properties as well. The DIFA coefficient
(quadratic term on d) is not considered and is fixed to zero in this
version of the algorithm.</p>
<p>If a name is given in OutParametersTable this algorithm also produces
a table workspace with that name, containing the parameters fitted
(DIFA, DIFC, TZERO).</p>
<p>The parameters DIFA, DIFC, TZERO are also used in other Mantid
algorithms. For example see <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><em>AlignDetectors</em></a> where these parameters are used to convert
units from time-of-flight to d-spacing.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Fitting DIFC parameter with two peaks:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Two BackB2Back exponential peaks</span>
<span class="n">peak1</span> <span class="o">=</span> <span class="s">&quot;name=BackToBackExponential,I=6000,A=1,B=0.5,X0=15000,S=250&quot;</span>
<span class="n">peak2</span> <span class="o">=</span> <span class="s">&quot;name=BackToBackExponential,I=5000,A=1,B=0.7,X0=35000,S=300&quot;</span>

<span class="c"># Create workpsace with the above peaks and a single detector pixel</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s">&quot;User Defined&quot;</span><span class="p">,</span>
                           <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="n">peak1</span> <span class="o">+</span> <span class="s">&quot;;&quot;</span> <span class="o">+</span> <span class="n">peak2</span><span class="p">,</span>
                           <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">XMin</span><span class="o">=</span><span class="mi">6000</span><span class="p">,</span>
                           <span class="n">XMax</span><span class="o">=</span><span class="mi">45000</span><span class="p">,</span>
                           <span class="n">BinWidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c"># Update instrument geometry to something that would allow converting to some sane dSpacing values</span>
<span class="n">EditInstrumentGeometry</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="n">ws</span><span class="p">,</span> <span class="n">L2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">],</span> <span class="n">Polar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">PrimaryFlightPath</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>

<span class="c"># Run the algorithm. Defaults are shown below. Files entered must be in .csv format and if both ExpectedPeaks and ExpectedPeaksFromFile are entered, the latter will be used.</span>

<span class="n">peaks_tbl</span> <span class="o">=</span> <span class="n">EnggFitPeaks</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">])</span>
<span class="n">out_tbl_name</span> <span class="o">=</span> <span class="s">&#39;difc_from_peaks&#39;</span>
<span class="n">difa</span><span class="p">,</span> <span class="n">difc</span><span class="p">,</span> <span class="n">tzero</span> <span class="o">=</span> <span class="n">EnggFitDIFCFromPeaks</span><span class="p">(</span><span class="n">FittedPeaks</span><span class="o">=</span><span class="n">peaks_tbl</span><span class="p">,</span> <span class="n">OutParametersTable</span><span class="o">=</span><span class="n">out_tbl_name</span><span class="p">)</span>

<span class="c"># Print the results</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;DIFA: </span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">difa</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;DIFC: </span><span class="si">%.0f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">round</span><span class="p">(</span><span class="n">difc</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;TZERO: </span><span class="si">%.0f</span><span class="s">&quot;</span> <span class="o">%</span><span class="nb">round</span><span class="p">(</span><span class="n">tzero</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="n">out_tbl_name</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;The output table has </span><span class="si">%d</span><span class="s"> row(s)&quot;</span> <span class="o">%</span> <span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Parameters from the table, DIFA: </span><span class="si">%.1f</span><span class="s">, DIFC: </span><span class="si">%.0f</span><span class="s">, TZERO: </span><span class="si">%.0f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Number of peaks fitted: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;First peak expected (dSpacing): {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">&#39;dSpacing&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;First fitted peak center (ToF): {0:.1f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">&#39;X0&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Second peak expected (dSpacing): {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">&#39;dSpacing&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Second fitted peak center (ToF): {0:.0f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">peaks_tbl</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">&#39;X0&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>DIFA: 0.0
DIFC: 18180
TZERO: 460
The output table has 1 row(s)
Parameters from the table, DIFA: 0.0, DIFC: 18180, TZERO: 460
Number of peaks fitted: 2
First peak expected (dSpacing): 0.8
First fitted peak center (ToF): 15006.0
Second peak expected (dSpacing): 1.9
Second fitted peak center (ToF): 35010
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a> | <a class="reference external" href="categories/Diffraction/Fitting.html">Diffraction\Fitting</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5d6dddaa6354533ad7536be123c78a52660a8bbb/Framework/PythonInterface/plugins/algorithms/EnggFitDIFCFromPeaks.py">EnggFitDIFCFromPeaks.py</a> <em>(last modified: 2018-03-07)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnggCalibrateFull-v1.html" title="Previous Chapter: EnggCalibrateFull v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; EnggCalibrateFul...</span>
    </a>
  </li>
  <li>
    <a href="EnggFitPeaks-v1.html" title="Next Chapter: EnggFitPeaks v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">EnggFitPeaks v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-04-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>