<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DNSMergeRuns v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DPDFreduction v1" href="DPDFreduction-v1.html" />
    <link rel="prev" title="DNSFlippingRatioCorr v1" href="DNSFlippingRatioCorr-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="dnsmergeruns-v1">
<span id="algm-dnsmergeruns"></span><span id="algm-dnsmergeruns-v1"></span><h1>DNSMergeRuns v1<a class="headerlink" href="#dnsmergeruns-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DNSMergeRuns-v1_dlg.png"><img alt="../_images/DNSMergeRuns-v1_dlg.png" class="screenshot" src="../_images/DNSMergeRuns-v1_dlg.png" style="width: 348px;" /></a>
<p class="caption"><strong>DNSMergeRuns</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id3">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a><ul>
<li><a class="reference internal" href="#valid-input-workspaces" id="id6">Valid input workspaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id3">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Merges runs performed at different detector bank positions into one matrix workspace.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="4%" />
<col width="22%" />
<col width="6%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WorkspaceNames</td>
<td>Input</td>
<td>str list</td>
<td>&nbsp;</td>
<td>List of Workspace names to merge.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace name to save the merged data.</td>
</tr>
<tr class="row-even"><td>HorizontalAxis</td>
<td>Input</td>
<td>string</td>
<td>2theta</td>
<td>X axis in the merged workspace. Allowed values: [&#8216;2theta&#8217;, &#8216;<a href="#id1"><span class="problematic" id="id2">|Q|</span></a>&#8216;, &#8216;d-Spacing&#8217;]</td>
</tr>
<tr class="row-odd"><td>Normalize</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If checked, the merged data will be normalized, otherwise the separate normalization workspace will be created.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It might get changed or even
removed without a notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm merges given matrix workspaces to a <a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><em>Workspace2D</em></a>. The purpose of this algorithm is to merge the DNS diffraction mode data measured at different detector bank positions. The algorithm is not suitable to merge DNS single crystal diffraction data measured at different sample rotation angles.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>OutputWorkspace</strong> will have no connection to the instrument. Part of the sample logs will be lost either. This algorithm can be executed at any step of the data reduction to view the result. However, further data reduction must be performed on the original workspaces.</p>
</div>
<p>As a result, following output will be produced:</p>
<ul class="simple">
<li>Output workspace with corrected data. Part of sample logs will be copied from the first data workspace. The data will be normalized to monitor or run duration if the <strong>Normalize</strong> option is checked.</li>
<li>If the <strong>Normalize</strong> option is unchecked, workspace with normalization data (monitor counts or run duration) will be created. The normalization workspace is named same as the data workspace, but has suffix &#8220;_NORM&#8221;.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Normalization workspaces are created by the <a class="reference internal" href="LoadDNSLegacy-v1.html#algm-loaddnslegacy"><em>LoadDNSLegacy v1</em></a> algorithm.
It is responsibility of the user to take care about the same type of normalization (monitor counts or run duration) for all given workspaces.</p>
</div>
<p>Absolute value of the momentum transfer <img class="math" src="../_images/math/f37952523e95841ce81d125203d04becdc541e95.png" alt="|Q|" style="vertical-align: -5px"/> is calculated as</p>
<p><img class="math" src="../_images/math/8dc780dbb7398e2fd08b38756ada93e8691356c5.png" alt="|Q| = \left|\frac{4\pi\sin\theta}{\lambda}\right|" style="vertical-align: -7px"/></p>
<p>where <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> is the scattering angle and <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/> is the neutron wavelength.</p>
<p>d-Spacing <img class="math" src="../_images/math/c86042ffb3d3d357c09df77fee86d0b5ecc0ae02.png" alt="d" style="vertical-align: 0px"/> is calculated as:</p>
<p><img class="math" src="../_images/math/4c68c5a0ac680886431f8cdf7c0783d5f58088e0.png" alt="d = \left|\frac{\lambda}{2\,\sin\theta}\right|" style="vertical-align: -7px"/></p>
<div class="section" id="valid-input-workspaces">
<h3><a class="toc-backref" href="#id6">Valid input workspaces</a><a class="headerlink" href="#valid-input-workspaces" title="Permalink to this headline">¶</a></h3>
<p>The input workspaces (<strong>WorkspaceNames</strong>) have to have the following in order to be valid inputs for this algorithm.</p>
<ul class="simple">
<li>The same number of dimensions</li>
<li>The same number of spectra</li>
<li>The same number of bins</li>
<li>The same wavelength in the sample logs</li>
<li>Sample log <strong>normalized</strong> must be set to &#8220;yes&#8221; for normalized data or &#8220;no&#8221; for not normalized data. <strong>Important:</strong> this value must be the same for all given workspaces. The mixture of normalized and not normalized workspaces is not accepted: algorithm will terminate with an error message.</li>
<li>If sample log <strong>normalized</strong> is set to &#8220;no&#8221;, all workspaces must have the corresponding normalization workspace.</li>
</ul>
<p>For the physically meaningful merge result, it is also important that these workspaces have the same slits size, polarisation, and flipper status. If some of these parameters are different, algorithm produces warning. If these properties are not specified in the workspace sample logs, no comparison is performed.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Merge a set of selected runs</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">splitext</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c"># path to the directory containing data files</span>
<span class="n">mypath</span> <span class="o">=</span> <span class="s">&quot;/path/to/data/dns/rc36b_standard_dz&quot;</span>

<span class="c"># filter the data files in the given directory</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;^dz(\d{8})vana.d_dat$&#39;</span><span class="p">)</span>

<span class="c"># we choose only the runs with &#39;x&#39; polarisation</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">29100501</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">is_in_filelist</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">flist</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">flist</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="n">datafiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listdir</span><span class="p">(</span><span class="n">mypath</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span><span class="n">f</span><span class="p">))</span> <span class="ow">and</span> <span class="n">is_in_filelist</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">filelist</span><span class="p">)])</span>

<span class="c"># load data to workspaces</span>
<span class="n">wslist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">datafiles</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wname</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#print &quot;Processing &quot;, wname  # uncomment if needed</span>
        <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">wname</span><span class="p">,</span> <span class="n">Polarisation</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">err</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span>

<span class="c"># merge the given workspaces</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">DNSMergeRuns</span><span class="p">(</span><span class="n">wslist</span><span class="p">,</span> <span class="n">HorizontalAxis</span><span class="o">=</span><span class="s">&#39;2theta&#39;</span><span class="p">,</span> <span class="n">Normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">mergedQ</span> <span class="o">=</span> <span class="n">DNSMergeRuns</span><span class="p">(</span><span class="n">wslist</span><span class="p">,</span> <span class="n">HorizontalAxis</span><span class="o">=</span><span class="s">&#39;|Q|&#39;</span><span class="p">)</span>
<span class="n">mergedD</span> <span class="o">=</span> <span class="n">DNSMergeRuns</span><span class="p">(</span><span class="n">wslist</span><span class="p">,</span> <span class="n">HorizontalAxis</span><span class="o">=</span><span class="s">&#39;d-Spacing&#39;</span><span class="p">)</span>

<span class="c"># print selected values from merged workspaces</span>
<span class="n">two_theta</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">extractX</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;First 5 2Theta values: &quot;</span><span class="p">,</span> <span class="n">two_theta</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">mergedQ</span><span class="o">.</span><span class="n">extractX</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;First 5 |Q| values: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">q</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">mergedD</span><span class="o">.</span><span class="n">extractX</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;First 5 d values: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<blockquote>
<div><p>First 5 2Theta values:  [ 7.5  8.   8.5  9.   9.5]</p>
<p>First 5 Q values:  [ 0.249  0.266  0.282  0.299  0.315]</p>
<p>First 5 d values:  [ 1.844  1.848  1.852  1.856  1.86 ]</p>
</div></blockquote>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/PythonAlgorithms.html">PythonAlgorithms</a> | <a class="reference external" href="categories/MLZ.html">MLZ</a> | <a class="reference external" href="categories/DNS.html">DNS</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/613f181e9f72836daa8dfbef179177ec3655c251/Code/Mantid/Framework/PythonInterface/plugins/algorithms/DNSMergeRuns.py">DNSMergeRuns.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DNSFlippingRatioCorr-v1.html" title="Previous Chapter: DNSFlippingRatioCorr v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; DNSFlippingRatio...</span>
    </a>
  </li>
  <li>
    <a href="DPDFreduction-v1.html" title="Next Chapter: DPDFreduction v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">DPDFreduction v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>