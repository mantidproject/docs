<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>AlignAndFocusPowder v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="AlignDetectors v1" href="AlignDetectors-v1.html" />
    <link rel="prev" title="AddTimeSeriesLog v1" href="AddTimeSeriesLog-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="alignandfocuspowder-v1">
<span id="algm-alignandfocuspowder"></span><span id="algm-alignandfocuspowder-v1"></span><h1>AlignAndFocusPowder v1<a class="headerlink" href="#alignandfocuspowder-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/AlignAndFocusPowder-v1_dlg.png"><img alt="../_images/AlignAndFocusPowder-v1_dlg.png" class="screenshot" src="../_images/AlignAndFocusPowder-v1_dlg.png" style="width: 235px;" /></a>
<p class="caption"><strong>AlignAndFocusPowder</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a><ul>
<li><a class="reference internal" href="#workflow" id="id5">Workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Algorithm to focus powder diffraction data into a number of histograms according to a grouping scheme defined in a CalFile.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="1%" />
<col width="8%" />
<col width="3%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The input workspace</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The result of diffraction focussing of InputWorkspace</td>
</tr>
<tr class="row-even"><td>CalFileName</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>The name of the CalFile with offset, masking, and grouping data. Allowed extensions: [&#8216;.h5&#8217;, &#8216;.hd5&#8217;, &#8216;.hdf&#8217;, &#8216;.cal&#8217;]</td>
</tr>
<tr class="row-odd"><td>GroupingWorkspace</td>
<td>Input</td>
<td>GroupingWorkspace</td>
<td>&nbsp;</td>
<td>Optional: A GroupingWorkspace giving the grouping info.</td>
</tr>
<tr class="row-even"><td>CalibrationWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Optional: A Workspace containing the calibration information. Either this or CalibrationFile needs to be specified.</td>
</tr>
<tr class="row-odd"><td>OffsetsWorkspace</td>
<td>Input</td>
<td>OffsetsWorkspace</td>
<td>&nbsp;</td>
<td>Optional: An OffsetsWorkspace giving the detector calibration values.</td>
</tr>
<tr class="row-even"><td>MaskWorkspace</td>
<td>Input</td>
<td>MaskWorkspace</td>
<td>&nbsp;</td>
<td>Optional: A workspace giving which detectors are masked.</td>
</tr>
<tr class="row-odd"><td>MaskBinTable</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Optional: A workspace giving pixels and bins to mask.</td>
</tr>
<tr class="row-even"><td>Params</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>A comma separated list of first bin boundary, width, last bin boundary. Optionally this can be followed by a comma and more widths and last boundary pairs. Negative width values indicate logarithmic binning.</td>
</tr>
<tr class="row-odd"><td>ResampleX</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Number of bins in x-axis. Non-zero value overrides &#8220;Params&#8221; property. Negative value means logorithmic binning.</td>
</tr>
<tr class="row-even"><td>Dspacing</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Bin in Dspace. (True is Dspace; False is TOF)</td>
</tr>
<tr class="row-odd"><td>DMin</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Minimum for Dspace axis. (Default 0.)</td>
</tr>
<tr class="row-even"><td>DMax</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Maximum for Dspace axis. (Default 0.)</td>
</tr>
<tr class="row-odd"><td>TMin</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Minimum for TOF axis. Defaults to 0.</td>
</tr>
<tr class="row-even"><td>TMax</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Maximum for TOF or dspace axis. Defaults to 0.</td>
</tr>
<tr class="row-odd"><td>PreserveEvents</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>If the InputWorkspace is an EventWorkspace, this will preserve the full event list (warning: this will use much more memory!).</td>
</tr>
<tr class="row-even"><td>RemovePromptPulseWidth</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Width of events (in microseconds) near the prompt pulse to remove. 0 disables</td>
</tr>
<tr class="row-odd"><td>CompressTolerance</td>
<td>Input</td>
<td>number</td>
<td>0.01</td>
<td>Compress events (in microseconds) within this tolerance. (Default 0.01)</td>
</tr>
<tr class="row-even"><td>UnwrapRef</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Reference total flight path for frame unwrapping. Zero skips the correction</td>
</tr>
<tr class="row-odd"><td>LowResRef</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Reference DIFC for resolution removal. Zero skips the correction</td>
</tr>
<tr class="row-even"><td>CropWavelengthMin</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Crop the data at this minimum wavelength. Overrides LowResRef.</td>
</tr>
<tr class="row-odd"><td>CropWavelengthMax</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Crop the data at this maximum wavelength. Forces use of CropWavelengthMin.</td>
</tr>
<tr class="row-even"><td>PrimaryFlightPath</td>
<td>Input</td>
<td>number</td>
<td>-1</td>
<td>If positive, focus positions are changed.  (Default -1)</td>
</tr>
<tr class="row-odd"><td>SpectrumIDs</td>
<td>Input</td>
<td>int list</td>
<td>&nbsp;</td>
<td>Optional: Spectrum IDs (note that it is not detector ID or workspace indices).</td>
</tr>
<tr class="row-even"><td>L2</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Optional: Secondary flight (L2) paths for each detector</td>
</tr>
<tr class="row-odd"><td>Polar</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Optional: Polar angles (two thetas) for detectors</td>
</tr>
<tr class="row-even"><td>Azimuthal</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Azimuthal angles (out-of-plain) for detectors</td>
</tr>
<tr class="row-odd"><td>LowResSpectrumOffset</td>
<td>Input</td>
<td>number</td>
<td>-1</td>
<td>Offset on spectrum ID of low resolution spectra from high resolution one. If negative, then all the low resolution TOF will not be processed.  Otherwise, low resolution TOF will be stored in an additional set of spectra. If offset is equal to 0, then the low resolution will have same spectrum IDs as the normal ones.  Otherwise, the low resolution spectra will have spectrum IDs offset from normal ones.</td>
</tr>
<tr class="row-even"><td>ReductionProperties</td>
<td>Input</td>
<td>string</td>
<td>__powdereduction</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This is a workflow algorithm that does the bulk of the work for time
focusing diffraction data. This is done by executing several
sub-algorithms as listed below.</p>
<ol class="arabic simple">
<li><a class="reference internal" href="RemovePromptPulse-v1.html#algm-removepromptpulse"><em>RemovePromptPulse v1</em></a> (event workspace only)</li>
<li><a class="reference internal" href="CompressEvents-v1.html#algm-compressevents"><em>CompressEvents v1</em></a> (event workspace only)</li>
<li><a class="reference internal" href="CropWorkspace-v1.html#algm-cropworkspace"><em>CropWorkspace v1</em></a></li>
<li><a class="reference internal" href="MaskDetectors-v1.html#algm-maskdetectors"><em>MaskDetectors v1</em></a></li>
<li><a class="reference internal" href="Rebin-v1.html#algm-rebin"><em>Rebin v1</em></a> or <a class="reference internal" href="ResampleX-v1.html#algm-resamplex"><em>ResampleX v1</em></a> if not d-space binning</li>
<li><a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><em>AlignDetectors v1</em></a></li>
<li>If LRef, minwl, or DIFCref are specified:<ol class="arabic">
<li><a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><em>ConvertUnits v1</em></a> to time-of-flight</li>
<li><a class="reference internal" href="UnwrapSNS-v1.html#algm-unwrapsns"><em>UnwrapSNS v1</em></a></li>
<li><a class="reference internal" href="RemoveLowResTOF-v1.html#algm-removelowrestof"><em>RemoveLowResTOF v1</em></a></li>
<li><a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><em>ConvertUnits v1</em></a> to d-spacing</li>
</ol>
</li>
<li><a class="reference internal" href="Rebin-v1.html#algm-rebin"><em>Rebin v1</em></a> if d-space binning</li>
<li><a class="reference internal" href="DiffractionFocussing-v2.html#algm-diffractionfocussing"><em>DiffractionFocussing v2</em></a></li>
<li><a class="reference internal" href="SortEvents-v1.html#algm-sortevents"><em>SortEvents v1</em></a> (event workspace only)</li>
<li><a class="reference internal" href="EditInstrumentGeometry-v1.html#algm-editinstrumentgeometry"><em>EditInstrumentGeometry v1</em></a> (if appropriate)</li>
<li><a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><em>ConvertUnits v1</em></a> to time-of-flight</li>
</ol>
<div class="section" id="workflow">
<h3><a class="toc-backref" href="#id5">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/AlignAndFocusPowder-v1_wkflw.png" src="../_images/AlignAndFocusPowder-v1_wkflw.png" />
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example: A simple Powgen example</strong></p>
<p>The files needed for this example are not present in our standard usage data
download due to their size.  They can however be downloaded using these links:
<a class="reference external" href="https://github.com/mantidproject/systemtests/blob/master/Data/PG3_9830_event.nxs?raw=true">PG3_9830_event.nxs</a>
and
<a class="reference external" href="http://198.74.56.37/ftp/external-data/MD5/e2b281817b76eadbc26a0a2617477e97">pg3_mantid_det.cal</a>.</p>
<p>You will have to rename <tt class="docutils literal"><span class="pre">pg3_mantid_det.cal</span></tt> manually, as its name in the link above is a list of random characters.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PG3_9830_event</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;PG3_9830_event.nxs&#39;</span><span class="p">)</span>
<span class="n">PG3_9830_event</span> <span class="o">=</span> <span class="n">AlignAndFocusPowder</span><span class="p">(</span><span class="n">PG3_9830_event</span><span class="p">,</span>
    <span class="n">CalFileName</span><span class="o">=</span><span class="s">&#39;pg3_mantid_det.cal&#39;</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Workflow.html">Workflow</a> | <a class="reference external" href="categories/Diffraction.html">Diffraction</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/613f181e9f72836daa8dfbef179177ec3655c251/Code/Mantid/Framework/WorkflowAlgorithms/src/AlignAndFocusPowder.cpp">AlignAndFocusPowder.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/613f181e9f72836daa8dfbef179177ec3655c251/Code/Mantid/Framework/WorkflowAlgorithms/inc/MantidWorkflowAlgorithms/AlignAndFocusPowder.h">AlignAndFocusPowder.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="AddTimeSeriesLog-v1.html" title="Previous Chapter: AddTimeSeriesLog v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; AddTimeSeriesLog...</span>
    </a>
  </li>
  <li>
    <a href="AlignDetectors-v1.html" title="Next Chapter: AlignDetectors v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">AlignDetectors v... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>