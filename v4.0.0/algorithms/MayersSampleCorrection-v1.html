<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MayersSampleCorrection v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="Mean v1" href="Mean-v1.html" />
    <link rel="prev" title="MaxMin v1" href="MaxMin-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="mayerssamplecorrection-v1">
<span id="algm-mayerssamplecorrection"></span><span id="algm-mayerssamplecorrection-v1"></span><h1>MayersSampleCorrection v1<a class="headerlink" href="#mayerssamplecorrection-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/MayersSampleCorrection-v1_dlg.png"><img alt="../_images/MayersSampleCorrection-v1_dlg.png" class="screenshot" src="../_images/MayersSampleCorrection-v1_dlg.png" style="width: 344px;" /></a>
<p class="caption"><strong>MayersSampleCorrection</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id3">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id4">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id5">Properties</a></li>
<li><a class="reference internal" href="#description" id="id6">Description</a></li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#references" id="id8">References</a></li>
<li><a class="reference internal" href="#source" id="id9">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id3">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Corrects the input data for the effects of attenuation &amp; multiple scattering</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id4">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><em>MonteCarloAbsorption</em></a>, <a class="reference internal" href="CarpenterSampleCorrection-v1.html#algm-carpentersamplecorrection"><em>CarpenterSampleCorrection</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id5">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="3%" />
<col width="16%" />
<col width="5%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Input workspace with X units in TOF. The workspace must also have a sample with a cylindrical shape and an instrument with a defined source and sample position.</td>
</tr>
<tr class="row-odd"><td>MultipleScattering</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If True then also correct for the effects of multiple scattering.Please note that the MS correction assumes the scattering is elastic.</td>
</tr>
<tr class="row-even"><td>MSEvents</td>
<td>Input</td>
<td>number</td>
<td>10000</td>
<td>Controls the number of second-scatter events generated. Only applicable where MultipleScattering=True.</td>
</tr>
<tr class="row-odd"><td>MSRuns</td>
<td>Input</td>
<td>number</td>
<td>10</td>
<td>Controls the number of simulations, each containing MSEvents, performed. The final MS correction is computed as the average over the runs. Only applicablewhere MultipleScattering=True.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An output workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id6">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Calculates and applies corrections due to the effects of absorption (plus optionally multiple scattering)
on the signal and error values for a given workspace. The full background to the algorithm
is described by Lindley et al. <a class="footnote-reference" href="#id2" id="id1">[1]</a> and is briefly described here.</p>
<p>The following assumptions are made:</p>
<ul>
<li><p class="first">the sample shape is a cylinder</p>
</li>
<li><dl class="first docutils">
<dt>for multiple scattering:</dt>
<dd><ul class="first last simple">
<li>the scattering is assumed to be elastic and isotropic</li>
<li>the ratio of successive orders of scattering are all equal to <img class="math" src="../_images/math/ddd8385b1ff00fb7a64436afab88523f66b728a7.png" alt="\beta(\theta, \phi, E)" style="vertical-align: -4px"/></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The aim is to correct the number of neutrons at a given detector (<img class="math" src="../_images/math/aef386c8243d143d71fc890e1a4758f63c73fb0f.png" alt="N_d" style="vertical-align: -3px"/>) to compute the number
of neutrons (<img class="math" src="../_images/math/04f7643f02652bdfdeb1fc9699fa8292abb9f1d1.png" alt="N_c" style="vertical-align: -3px"/>) that would reach the detector if there was no absorption (or multiple scattering). Ignoring
detector efficiency we can write:</p>
<div class="math">
<p><img src="../_images/math/c648bef54eaffa9fb28eeeb64a835a7fb16d6a39.png" alt="N_d = \frac{N_c}{A_s} \cdot \frac{1}{1-\beta}"/></p>
</div><p>where <img class="math" src="../_images/math/40ca439e0c299f76220ce6a3f4b96a1e33f6f343.png" alt="A_s(\theta, \phi, E)" style="vertical-align: -4px"/> is the absorption and self-shielding factor and is computed by
numerical integration over the sample cylinder.</p>
<p>The multiple scattering factor (if requested) is computed by simulating over a fixed number of
second order scattering events and computing the ratio of second order and first order scattering.
Since we have assumed the ratio is the same between successive orders, the <img class="math" src="../_images/math/e5f6c9390274878c631f38b111dda3c4c9103028.png" alt="\frac{1}{1-\beta}" style="vertical-align: -9px"/>
factor simply comes from taking the sum of a geometric series.</p>
<p>The cylinder radius <img class="math" src="../_images/math/3293e7078f4805bf0742b947e522da0a58d8e2b5.png" alt="r" style="vertical-align: 0px"/> combined with the inverse attenuation length <img class="math" src="../_images/math/3b2b3dd2275c18bc4bfa9d7c0f14335cecd61ffb.png" alt="\mu = \mu(E)" style="vertical-align: -4px"/>
(derived from the total scattering cross-section) gives a range of <img class="math" src="../_images/math/464ad3bc10f1fd1617625f4ac5d11cce60cd3d78.png" alt="\mu r" style="vertical-align: -4px"/> against input
time-of-flight (&#8220;energy&#8221;) for the cylinder.
The <img class="math" src="../_images/math/464ad3bc10f1fd1617625f4ac5d11cce60cd3d78.png" alt="\mu r" style="vertical-align: -4px"/> range is divided into a discrete number of points for each point.</p>
<p>A weighted least-squares fit is applied to both the set of attenuation and multiple scattering factors
to allow interpolation of the correction factor from any time-of-flight value in the input range.
For each time-of-flight value the factor is computed from the fit coefficients and the correction
applied multiplicatively:</p>
<div class="math">
<p><img src="../_images/math/3b2df2b7b57421f87067c4686c4cba7ffb390d37.png" alt="\begin{aligned}
y_{out} &amp;= y_{in} * corrfact \\
e_{out} &amp;= y_{out} * e_{in} / y_{in}
\end{aligned}"/></p>
</div><p>The above procedure is repeated separately for each spectrum in the workspace.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Correct Vanadium For Both Absorption &amp; Multiple Scattering</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a fake workspace with TOF data</span>
<span class="n">sample_ws</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="s">&#39;Powder Diffraction&#39;</span><span class="p">,</span>
                                  <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">XUnit</span><span class="o">=</span><span class="s">&#39;TOF&#39;</span><span class="p">,</span>
                                  <span class="n">XMin</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">XMax</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="c"># Set meta data about shape and material</span>
<span class="n">cyl_height_cm</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">cyl_radius_cm</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">material</span> <span class="o">=</span> <span class="s">&#39;V&#39;</span>
<span class="n">num_density</span> <span class="o">=</span> <span class="mf">0.07261</span>
<span class="n">SetSample</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">,</span>
    <span class="n">Geometry</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;Shape&#39;</span><span class="p">:</span> <span class="s">&#39;Cylinder&#39;</span><span class="p">,</span> <span class="s">&#39;Height&#39;</span><span class="p">:</span> <span class="n">cyl_height_cm</span><span class="p">,</span>
              <span class="s">&#39;Radius&#39;</span><span class="p">:</span> <span class="n">cyl_radius_cm</span><span class="p">,</span> <span class="s">&#39;Center&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]},</span>
    <span class="n">Material</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;ChemicalFormula&#39;</span><span class="p">:</span> <span class="n">material</span><span class="p">,</span> <span class="s">&#39;SampleNumberDensity&#39;</span><span class="p">:</span> <span class="n">num_density</span><span class="p">})</span>

<span class="c"># Run corrections</span>
<span class="n">corrected_sample</span> <span class="o">=</span> <span class="n">MayersSampleCorrection</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">,</span>
                                          <span class="n">MultipleScattering</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Print a bin</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Uncorrected signal: {0:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">25</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Corrected signal: {0:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corrected_sample</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">25</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Uncorrected signal: 0.0556
Corrected signal: 0.0736
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id8">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Lindley, E.J., &amp; Mayers, J. Cywinski, R. (Ed.). (1988). Experimental method and corrections to data. United Kingdom: Adam Hilger. - <a class="reference external" href="https://inis.iaea.org/search/search.aspx?orig_q=RN:20000574">https://inis.iaea.org/search/search.aspx?orig_q=RN:20000574</a></td></tr>
</tbody>
</table>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">Algorithm Index</a> | <a class="reference external" href="categories/CorrectionFunctions/AbsorptionCorrections.html">CorrectionFunctions\AbsorptionCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id9">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/de259314d655b6c31c46dac22c46bbf8fd7d5abd/Framework/Algorithms/src/SampleCorrections/MayersSampleCorrection.cpp">MayersSampleCorrection.cpp</a> <em>(last modified: 2018-10-05)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/de259314d655b6c31c46dac22c46bbf8fd7d5abd/Framework/Algorithms/inc/MantidAlgorithms/SampleCorrections/MayersSampleCorrection.h">MayersSampleCorrection.h</a> <em>(last modified: 2018-10-05)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="MaxMin-v1.html" title="Previous Chapter: MaxMin v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; MaxMin v1</span>
    </a>
  </li>
  <li>
    <a href="Mean-v1.html" title="Next Chapter: Mean v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Mean v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-03-25.<br/>
    </p>
  </div>
</footer>
  </body>
</html>