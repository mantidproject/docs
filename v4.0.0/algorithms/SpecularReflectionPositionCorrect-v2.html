<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SpecularReflectionPositionCorrect v2</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="SphericalAbsorption v1" href="SphericalAbsorption-v1.html" />
    <link rel="prev" title="SpecularReflectionPositionCorrect v1" href="SpecularReflectionPositionCorrect-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="specularreflectionpositioncorrect-v2">
<span id="algm-specularreflectionpositioncorrect"></span><span id="algm-specularreflectionpositioncorrect-v2"></span><h1>SpecularReflectionPositionCorrect v2<a class="headerlink" href="#specularreflectionpositioncorrect-v2" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/SpecularReflectionPositionCorrect-v2_dlg.png"><img alt="../_images/SpecularReflectionPositionCorrect-v2_dlg.png" class="screenshot" src="../_images/SpecularReflectionPositionCorrect-v2_dlg.png" style="width: 332px;" /></a>
<p class="caption"><strong>SpecularReflectionPositionCorrect</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#previous-versions" id="id5">Previous Versions</a></li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Corrects a reflectometer&#8217;s detector component&#8217;s position.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="SpecularReflectionCalculateTheta-v2.html#algm-specularreflectioncalculatetheta"><em>SpecularReflectionCalculateTheta</em></a>, <a class="reference internal" href="FindReflectometryLines-v2.html#algm-findreflectometrylines"><em>FindReflectometryLines</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="3%" />
<col width="18%" />
<col width="9%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An input workspace to correct.</td>
</tr>
<tr class="row-odd"><td>TwoTheta</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Angle used to correct the detector component [degrees].</td>
</tr>
<tr class="row-even"><td>DetectorCorrectionType</td>
<td>Input</td>
<td>string</td>
<td>VerticalShift</td>
<td>Whether detectors should be shifted vertically or rotated around the sample position. Allowed values: [&#8216;VerticalShift&#8217;, &#8216;RotateAroundSample&#8217;]</td>
</tr>
<tr class="row-odd"><td>DetectorComponentName</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Name of the detector component to correct, for example point-detector</td>
</tr>
<tr class="row-even"><td>DetectorID</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>The ID of the detector to correct; if both the component name and the detector ID are set the latter will be used.</td>
</tr>
<tr class="row-odd"><td>SampleComponentName</td>
<td>Input</td>
<td>string</td>
<td>some-surface-holder</td>
<td>Name of the sample component; if the given name is not found in the instrument, the default sample is used.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with corrected detector position.</td>
</tr>
<tr class="row-odd"><td>DetectorFacesSample</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If true, a normal vector at the centre of the detector always points towards the sample.</td>
</tr>
<tr class="row-even"><td>LinePosition</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>A fractional workspace index for the specular line centre.</td>
</tr>
<tr class="row-odd"><td>DirectLinePosition</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>A fractional workspace index for the direct line centre.</td>
</tr>
<tr class="row-even"><td>PixelSize</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Size of a detector pixel, in metres.</td>
</tr>
<tr class="row-odd"><td>DirectLineWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A direct beam workspace for reference.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Moves the specified detector component to a given angle between the beam and
the sample-to-detector vector. The detector component is moved as a
block. The rest of the instrument components remain in original positions. The component
can be shifted vertically (default), or rotated around the sample position. When rotating
around the sample, an optional rotation can be applied so that the detector always faces
the sample.</p>
<p>In the most basic operation, the detector is moved to the angle specified by <tt class="docutils literal"><span class="pre">TwoTheta</span></tt>.
This case is schematically shown below for rotation around the sample position and
<tt class="docutils literal"><span class="pre">DetectorFacesSample</span></tt> set to <tt class="docutils literal"><span class="pre">True</span></tt>.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/SpecularReflectionCorrection_figure1.png"><img alt="Schematic representation of angle correction when only TwoTheta is given." src="../_images/SpecularReflectionCorrection_figure1.png" style="width: 449.0px; height: 184.0px;" /></a>
</div>
<p>If <tt class="docutils literal"><span class="pre">LinePosition</span></tt> and <tt class="docutils literal"><span class="pre">PixelSize</span></tt> are also given, the detector will be moved such
that the angle will be <tt class="docutils literal"><span class="pre">TwoTheta</span></tt> for the pixel at workspace index <tt class="docutils literal"><span class="pre">LinePosition</span></tt>.
Note that <tt class="docutils literal"><span class="pre">LinePosition</span></tt> can be a fractional index making it possible to adjust the
detector angle to a fitted line position. The figure below illustrates this option.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/SpecularReflectionCorrection_figure2.png"><img alt="Schematic representation of angle correction when TwoTheta and LinePosition are given." src="../_images/SpecularReflectionCorrection_figure2.png" style="width: 449.0px; height: 184.0px;" /></a>
</div>
<p>The last possible detector position correction is calibration by a separate direct beam
measurement. The idea is to correct the detector angle by difference between the
nominal beam axis and the measured direct beam as shown in the figure below. In this mode
<tt class="docutils literal"><span class="pre">TwoTheta</span></tt> is omitted but <tt class="docutils literal"><span class="pre">DirectLinePosition</span></tt>, <tt class="docutils literal"><span class="pre">DirectLineWorkspace</span></tt> and <tt class="docutils literal"><span class="pre">PixelSize</span></tt>
have to be specified.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/SpecularReflectionCorrection_figure3.png"><img alt="Schematic representation of angle correction when direct beam reference is used." src="../_images/SpecularReflectionCorrection_figure3.png" style="width: 463.0px; height: 241.0px;" /></a>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The line positions can be acquired by using, for instance,
<a class="reference internal" href="FindReflectometryLines-v2.html#algm-findreflectometrylines"><em>FindReflectometryLines</em></a>.</p>
</div>
</div>
<div class="section" id="previous-versions">
<h2><a class="toc-backref" href="#id5">Previous Versions</a><a class="headerlink" href="#previous-versions" title="Permalink to this headline">¶</a></h2>
<p>For version 1 of the algorithm, please see <a class="reference internal" href="SpecularReflectionPositionCorrect-v1.html#algm-specularreflectionpositioncorrect-v1"><em>SpecularReflectionPositionCorrect-v1.</em></a></p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Correct &#8216;point-detector&#8217;</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;point-detector&#39;</span><span class="p">)</span>
<span class="n">polref</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">r&#39;POLREF00004699.raw&#39;</span><span class="p">,</span> <span class="n">PeriodList</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">polref</span> <span class="o">=</span> <span class="n">polref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">instr</span> <span class="o">=</span> <span class="n">polref</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Original position: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;point-detector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>

<span class="n">polref_vert</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span><span class="n">polref</span><span class="p">,</span> <span class="n">TwoTheta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;point-detector&#39;</span><span class="p">,</span> <span class="n">DetectorCorrectionType</span><span class="o">=</span><span class="s">&#39;VerticalShift&#39;</span><span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">polref_vert</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Vertical shift:    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;point-detector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>

<span class="n">polref_rot</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span><span class="n">polref</span><span class="p">,</span> <span class="n">TwoTheta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;point-detector&#39;</span><span class="p">,</span> <span class="n">DetectorCorrectionType</span><span class="o">=</span><span class="s">&#39;RotateAroundSample&#39;</span><span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">polref_rot</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Rotated:           &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;point-detector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<p>Note that in this case the difference between shifting the detectors vertically or rotating them is negligible.</p>
<div class="highlight-none"><div class="highlight"><pre>point-detector
Original position: [25.6,0,0.0444961]
Vertical shift:    [25.6,0,0.0444753]
Rotated:           [25.6,0,0.0444753]
</pre></div>
</div>
<p><strong>Example - Correct &#8216;lineardetector&#8217;</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;lineardetector&#39;</span><span class="p">)</span>
<span class="n">polref</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">r&#39;POLREF00004699.raw&#39;</span><span class="p">,</span> <span class="n">PeriodList</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">polref</span> <span class="o">=</span> <span class="n">polref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">instr</span> <span class="o">=</span> <span class="n">polref</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Original position: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;lineardetector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>

<span class="n">polref_vert</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span><span class="n">polref</span><span class="p">,</span> <span class="n">TwoTheta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;lineardetector&#39;</span><span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">polref_vert</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Vertical shift:    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;lineardetector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>

<span class="n">polref_rot</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span><span class="n">polref</span><span class="p">,</span> <span class="n">TwoTheta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;lineardetector&#39;</span><span class="p">,</span> <span class="n">DetectorCorrectionType</span><span class="o">=</span><span class="s">&#39;RotateAroundSample&#39;</span><span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">polref_rot</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Rotated:           &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;lineardetector&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>lineardetector
Original position: [26,0,0]
Vertical shift:    [26,0,0.0513177]
Rotated:           [25.9996,0,0.0513102]
</pre></div>
</div>
<p><strong>Example - Correct &#8216;OSMOND&#8217;</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;OSMOND&#39;</span><span class="p">)</span>
<span class="n">polref</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">r&#39;POLREF00004699.raw&#39;</span><span class="p">,</span> <span class="n">PeriodList</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">polref</span> <span class="o">=</span> <span class="n">polref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">instr</span> <span class="o">=</span> <span class="n">polref</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Original position: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;OSMOND&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>

<span class="n">polref_vert</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span><span class="n">polref</span><span class="p">,</span> <span class="n">TwoTheta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;OSMOND&#39;</span><span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">polref_vert</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Vertical shift:    &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;OSMOND&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>

<span class="n">polref_rot</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span><span class="n">polref</span><span class="p">,</span> <span class="n">TwoTheta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mf">0.49</span><span class="p">,</span> <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;OSMOND&#39;</span><span class="p">,</span> <span class="n">DetectorCorrectionType</span><span class="o">=</span><span class="s">&#39;RotateAroundSample&#39;</span><span class="p">)</span>
<span class="n">instr</span> <span class="o">=</span> <span class="n">polref_rot</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Rotated:           &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">instr</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s">&#39;OSMOND&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>OSMOND
Original position: [26,0,0]
Vertical shift:    [26,0,0.0513177]
Rotated:           [25.9996,0,0.0513102]
</pre></div>
</div>
<p><strong>Example - Rotate given pixel</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="c"># We&#39;ll just use an empty workspace here.</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;D17&#39;</span><span class="p">)</span>
<span class="c"># Get rid of monitors</span>
<span class="n">ExtractMonitors</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">DetectorWorkspace</span><span class="o">=</span><span class="s">&#39;ws&#39;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;ws&#39;</span><span class="p">]</span>
<span class="n">line_position</span> <span class="o">=</span> <span class="mf">22.</span>
<span class="n">spectrum_info</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">spectrumInfo</span><span class="p">()</span>
<span class="n">two_theta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">spectrum_info</span><span class="o">.</span><span class="n">twoTheta</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_position</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Pixel {} 2theta&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_position</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;before angle correction: {:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">two_theta</span><span class="p">))</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span>
    <span class="n">ws</span><span class="p">,</span>
    <span class="n">TwoTheta</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">DetectorCorrectionType</span><span class="o">=</span><span class="s">&#39;RotateAroundSample&#39;</span><span class="p">,</span>
    <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;detector&#39;</span><span class="p">,</span>
    <span class="n">DetectorFacesSample</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">LinePosition</span><span class="o">=</span><span class="n">line_position</span><span class="p">,</span>
    <span class="n">PixelSize</span><span class="o">=</span><span class="mf">0.001195</span><span class="p">)</span>
<span class="n">spectrum_info</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">spectrumInfo</span><span class="p">()</span>
<span class="n">two_theta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">spectrum_info</span><span class="o">.</span><span class="n">twoTheta</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_position</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;after angle correction: {:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">two_theta</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Pixel 22 2theta
before angle correction: 2.33
after angle correction: 1.5
</pre></div>
</div>
<p><strong>Example - Use direct beam for angle calibration</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="c"># We&#39;ll just use empty workspaces here.</span>
<span class="n">reflected</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;Figaro&#39;</span><span class="p">)</span>
<span class="n">direct</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;Figaro&#39;</span><span class="p">)</span>
<span class="c"># Get rid of monitors</span>
<span class="n">ExtractMonitors</span><span class="p">(</span><span class="n">reflected</span><span class="p">,</span> <span class="n">DetectorWorkspace</span><span class="o">=</span><span class="s">&#39;reflected&#39;</span><span class="p">)</span>
<span class="n">reflected</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;reflected&#39;</span><span class="p">]</span>
<span class="n">ExtractMonitors</span><span class="p">(</span><span class="n">direct</span><span class="p">,</span> <span class="n">DetectorWorkspace</span><span class="o">=</span><span class="s">&#39;direct&#39;</span><span class="p">)</span>
<span class="n">direct</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;direct&#39;</span><span class="p">]</span>
<span class="n">line_position</span> <span class="o">=</span> <span class="mf">202.</span>
<span class="n">spectrum_info</span> <span class="o">=</span> <span class="n">reflected</span><span class="o">.</span><span class="n">spectrumInfo</span><span class="p">()</span>
<span class="n">two_theta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">spectrum_info</span><span class="o">.</span><span class="n">twoTheta</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_position</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Pixel {} 2theta&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_position</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;before angle correction: {:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">two_theta</span><span class="p">))</span>
<span class="n">direct_line_position</span> <span class="o">=</span> <span class="mf">130.7</span>  <span class="c"># This could come from some fitting procedure</span>
<span class="n">reflected</span> <span class="o">=</span> <span class="n">SpecularReflectionPositionCorrect</span><span class="p">(</span>
    <span class="n">reflected</span><span class="p">,</span>
    <span class="n">DetectorCorrectionType</span><span class="o">=</span><span class="s">&#39;RotateAroundSample&#39;</span><span class="p">,</span>
    <span class="n">DetectorComponentName</span><span class="o">=</span><span class="s">&#39;detector&#39;</span><span class="p">,</span>
    <span class="n">DetectorFacesSample</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">PixelSize</span><span class="o">=</span><span class="mf">0.001195</span><span class="p">,</span>
    <span class="n">DirectLineWorkspace</span><span class="o">=</span><span class="n">direct</span><span class="p">,</span>
    <span class="n">DirectLinePosition</span><span class="o">=</span><span class="n">direct_line_position</span><span class="p">)</span>
<span class="n">spectrum_info</span> <span class="o">=</span> <span class="n">reflected</span><span class="o">.</span><span class="n">spectrumInfo</span><span class="p">()</span>
<span class="n">two_theta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">spectrum_info</span><span class="o">.</span><span class="n">twoTheta</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line_position</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;after angle correction: {:.3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">two_theta</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Pixel 202 2theta
before angle correction: 5.11
after angle correction: 4.89
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">Algorithm Index</a> | <a class="reference external" href="categories/Reflectometry.html">Reflectometry</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/de259314d655b6c31c46dac22c46bbf8fd7d5abd/Framework/Algorithms/src/SpecularReflectionPositionCorrect2.cpp">SpecularReflectionPositionCorrect2.cpp</a> <em>(last modified: 2019-02-21)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/de259314d655b6c31c46dac22c46bbf8fd7d5abd/Framework/Algorithms/inc/MantidAlgorithms/SpecularReflectionPositionCorrect2.h">SpecularReflectionPositionCorrect2.h</a> <em>(last modified: 2019-01-23)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SpecularReflectionPositionCorrect-v1.html" title="Previous Chapter: SpecularReflectionPositionCorrect v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SpecularReflecti...</span>
    </a>
  </li>
  <li>
    <a href="SphericalAbsorption-v1.html" title="Next Chapter: SphericalAbsorption v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SphericalAbsorpt... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-03-25.<br/>
    </p>
  </div>
</footer>
  </body>
</html>