<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SaveGDA v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="SaveGEMMAUDParamFile v1" href="SaveGEMMAUDParamFile-v1.html" />
    <link rel="prev" title="SaveFullprofResolution v1" href="SaveFullprofResolution-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="savegda-v1">
<span id="algm-savegda"></span><span id="algm-savegda-v1"></span><h1>SaveGDA v1<a class="headerlink" href="#savegda-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/SaveGDA-v1_dlg.png"><img alt="../_images/SaveGDA-v1_dlg.png" class="screenshot" src="../_images/SaveGDA-v1_dlg.png" style="width: 391px;" /></a>
<p class="caption"><strong>SaveGDA</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#gda-format" id="id5">GDA Format</a></li>
<li><a class="reference internal" href="#d-to-tof-conversion" id="id6">D to TOF Conversion</a></li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Save a group of focused banks to the MAUD three-column GDA format</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="SaveBankScatteringAngles-v1.html#algm-savebankscatteringangles"><em>SaveBankScatteringAngles</em></a>, <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><em>AlignDetectors</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="4%" />
<col width="9%" />
<col width="7%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>WorkspaceGroup</td>
<td><em>Mandatory</em></td>
<td>A GroupWorkspace where every sub-workspace is a single-spectra focused run corresponding to a particular bank</td>
</tr>
<tr class="row-odd"><td>OutputFilename</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The name of the file to save to. Allowed extensions: [&#8216;.gda&#8217;]</td>
</tr>
<tr class="row-even"><td>GSASParamFile</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>GSAS calibration file containing conversion factors from D to TOF. Allowed extensions: [&#8216;.ipf&#8217;, &#8216;.prm&#8217;, &#8216;.parm&#8217;, &#8216;.iprm&#8217;]</td>
</tr>
<tr class="row-odd"><td>GroupingScheme</td>
<td>Input</td>
<td>int list</td>
<td>&nbsp;</td>
<td>An array of bank IDs, where the value at element i is the ID of the bank in GSASParamFile to associate spectrum i with</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Takes a WorkspaceGroup whose children are single-spectra workspaces
corresponding to focused banks, and saves them to the MAUD-readable
<tt class="docutils literal"><span class="pre">.gda</span></tt> format.</p>
</div>
<div class="section" id="gda-format">
<h2><a class="toc-backref" href="#id5">GDA Format</a><a class="headerlink" href="#gda-format" title="Permalink to this headline">¶</a></h2>
<p>GDA is a text-based format. The file is divided into sections for each
bank. Each section begins with a header, which has the following
format::</p>
<div class="highlight-python"><div class="highlight"><pre>BANK &lt;bank number&gt; &lt;number of points&gt; &lt;number of lines&gt; RALF &lt;min TOF&gt; 96 &lt;min TOF&gt; &lt;resolution&gt; ALT
</pre></div>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bank</span> <span class="pre">number</span></tt> is simply and index for the bank</li>
<li><tt class="docutils literal"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">points</span></tt> is the number of sets of data-points which will
be saved from this bank</li>
<li><tt class="docutils literal"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">lines</span></tt> is the number of lines the points will take
up. Since there are 4 points per line, this will be <tt class="docutils literal"><span class="pre">number</span> <span class="pre">of</span>
<span class="pre">points</span> <span class="pre">/</span> <span class="pre">4</span></tt>, rounded up</li>
<li><tt class="docutils literal"><span class="pre">min</span> <span class="pre">TOF</span></tt> is the minimum time-of-flight value in this bank</li>
<li><tt class="docutils literal"><span class="pre">resolution</span></tt> is the mean difference between adjacent TOF-values
(normalised by TOF) in the bank</li>
</ul>
<p>The data then follows. We have 4 points per line, where each point
consists of three values, <tt class="docutils literal"><span class="pre">TOF</span> <span class="pre">*</span> <span class="pre">32</span></tt> (time-of-flight is scaled by 32
for legacy reasons in MAUD - see <a class="reference internal" href="#save-gda-tof"><em>D to TOF Conversion</em></a> for a detailed
explanation of where the TOF values come from), <tt class="docutils literal"><span class="pre">intensity</span> <span class="pre">*</span> <span class="pre">1000</span></tt>
and <tt class="docutils literal"><span class="pre">error</span> <span class="pre">*</span> <span class="pre">1000</span></tt>. <tt class="docutils literal"><span class="pre">TOF</span></tt>, <tt class="docutils literal"><span class="pre">intensity</span></tt> and <tt class="docutils literal"><span class="pre">error</span></tt> correspond
to the <tt class="docutils literal"><span class="pre">x</span></tt>, <tt class="docutils literal"><span class="pre">y</span></tt> and <tt class="docutils literal"><span class="pre">e</span></tt> columns of a Mantid workspaces
respectively.</p>
<p>All numbers apart from resolution are saved as integers. In addition,
every line, including the header, must be exactly 80 characters long,
so any short lines are right-padded with spaces.</p>
</div>
<div class="section" id="d-to-tof-conversion">
<span id="save-gda-tof"></span><h2><a class="toc-backref" href="#id6">D to TOF Conversion</a><a class="headerlink" href="#d-to-tof-conversion" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">TOF values in the output file will only match the actual recorded
TOF values if the GSAS calibration file contains the correct
conversion factors for each bank.</p>
</div>
<p>SaveGDA takes input in D-spacing, and applies the GSAS conversion
(explained at <a class="reference internal" href="AlignDetectors-v1.html#algm-aligndetectors"><em>AlignDetectors</em></a>), using
parameters from the calibration file, to convert back to
time-of-flight. The caveat here is that, if the calibration file
contains the wrong conversion factors, then the TOF values will not
match the ones that were actually recorded.</p>
<p>This is not necessarily a problem, as once the file is loaded into
MAUD, as long as the same conversion factors are used (ie the MAUD
calibration file should be created from the same GSAS calibration file
as was used to run SaveGDA), the data will still be aligned in
MAUD. When doing texture focusing with <a class="reference internal" href="../techniques/ISISPowder-GEM-v1.html#isis-powder-diffraction-gem-ref"><em>ISIS_Powder for GEM</em></a>, matching up all the calibration
files should be taken care of automatically.</p>
<p>This approach is taken because it was impractical to create a MAUD
calibration file containing the correct conversion factors for a
workspace with a large number of banks - we just don&#8217;t have enough
data to do it. Instead we fake the time-of-flight recordings in order
to get good alignment in MAUD.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="c"># Banks 1 to 4 of a previous texture focus in isis_powder</span>
<span class="c"># We don&#39;t use the full 160 banks as the test becomes too slow</span>
<span class="n">input_group</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">&quot;GEM61785_D_texture_banks_1_to_4.nxs&quot;</span><span class="p">,</span>
                   <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&quot;SaveGDAtest_GEM61785&quot;</span><span class="p">)</span>

<span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&quot;defaultsave.directory&quot;</span><span class="p">],</span> <span class="s">&quot;GEM61785.gda&quot;</span><span class="p">)</span>
<span class="n">SaveGDA</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_group</span><span class="p">,</span>
        <span class="n">OutputFilename</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
        <span class="n">GSASParamFile</span><span class="o">=</span><span class="s">&quot;GEM_PF1_PROFILE.IPF&quot;</span><span class="p">,</span>
        <span class="c"># Assign spectra 1, 2 and 3 to bank 2 in calib file, and spectrum 4 to bank 3</span>
        <span class="n">GroupingScheme</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">file_contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

<span class="c"># Print the header and the 4 lines from the middle of the file</span>
<span class="c"># rstrip the header just to make the doctest script happy</span>
<span class="k">print</span><span class="p">(</span><span class="n">file_contents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">104</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">file_contents</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>BANK 1 4246  1062 RALF  27388  96  27388 0.001 ALT
   40348    380   60   40388    285   52   40427    338   56   40467    218   47
   40507    232   49   40546    181   44   40586    171   43   40626    206   47
   40666    246   50   40706    161   40   40746    126   37   40786    124   37
   40826    131   40   40866    221   48   40906    157   40   40946    169   41
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">Algorithm Index</a> | <a class="reference external" href="categories/DataHandling/Text.html">DataHandling\Text</a> | <a class="reference external" href="categories/Diffraction/DataHandling.html">Diffraction\DataHandling</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/de259314d655b6c31c46dac22c46bbf8fd7d5abd/Framework/DataHandling/src/SaveGDA.cpp">SaveGDA.cpp</a> <em>(last modified: 2018-10-05)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/de259314d655b6c31c46dac22c46bbf8fd7d5abd/Framework/DataHandling/inc/MantidDataHandling/SaveGDA.h">SaveGDA.h</a> <em>(last modified: 2018-10-05)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SaveFullprofResolution-v1.html" title="Previous Chapter: SaveFullprofResolution v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SaveFullprofReso...</span>
    </a>
  </li>
  <li>
    <a href="SaveGEMMAUDParamFile-v1.html" title="Next Chapter: SaveGEMMAUDParamFile v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SaveGEMMAUDParam... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-03-25.<br/>
    </p>
  </div>
</footer>
  </body>
</html>