<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PreprocessDetectorsToMD v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="ProcessBackground v1" href="ProcessBackground-v1.html" />
    <link rel="prev" title="PredictPeaks v1" href="PredictPeaks-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="preprocessdetectorstomd-v1">
<span id="algm-preprocessdetectorstomd"></span><span id="algm-preprocessdetectorstomd-v1"></span><h1>PreprocessDetectorsToMD v1<a class="headerlink" href="#preprocessdetectorstomd-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/PreprocessDetectorsToMD-v1_dlg.png"><img alt="../_images/PreprocessDetectorsToMD-v1_dlg.png" class="screenshot" src="../_images/PreprocessDetectorsToMD-v1_dlg.png" style="width: 449px;" /></a>
<p class="caption"><strong>PreprocessDetectorsToMD</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id3">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id3">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Its a helper algorithm, used to make common part of transformation from real to reciprocal space. It is used by <a class="reference internal" href="ConvertToMD-v1.html#algm-converttomd"><em>ConvertToMD v1</em></a> and <a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><em>ConvertToMDMinMaxLocal v1</em></a> algorithms to save time spent on this transformation when the algorithm used multiple times for multiple measurements on the same instrument.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="2%" />
<col width="9%" />
<col width="3%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Name of an input Matrix Workspace with instrument.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Name of the output Table workspace with pre-processed detectors data. If the workspace exists, it will be replaced.</td>
</tr>
<tr class="row-even"><td>GetMaskState</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Returns masked state of the detectors. If this option is false, the masked detectors are just dropped from the resulting workspace and spectra-to detectors map has to be used to analyse the spectra. This is temporary parameter and logic necessary until Mantid masks signal by 0 rather then NaN.</td>
</tr>
<tr class="row-odd"><td>UpdateMasksInfo</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If target workspace already exists as the result of previous deployment of this algorithm, the algorithm just updated masks states column instead of calculating the whole target workspace. The target workspace has to be appropriate for the source workspace This is temporary parameter and logic necessary until Mantid masks signal by 0 rather then NaN.</td>
</tr>
<tr class="row-even"><td>GetEFixed</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>This option makes sense for Indirect instrument, where each detector can have its own energy, defined by correspondent crystal-analyzer position. If this option is selected for other instrument types, the value of eFixed is taken from workspace property Ei or eFixed if Ei is missing and is set to NaN if no such properties are defined on the input workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The algorithm calculates expensive part of the transformation from real to reciprocal space, calculating namely,
detector positions, sample-detector distances, angular detectors positions, etc. These values can be slow to calculate
for composite detectors and other algorithms can substantially benifit from using preprocessed values.</p>
<p>The algorithm places processed values into a table workspace with the following colums:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="10%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column Name :</th>
<th class="head">Type</th>
<th class="head">Description:</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DetDirections</td>
<td>V3D</td>
<td>unit 3D vector directed from sample to detector</td>
</tr>
<tr class="row-odd"><td>L2</td>
<td>double</td>
<td>sample-detector distance</td>
</tr>
<tr class="row-even"><td>TwoTheta</td>
<td>double</td>
<td>Composite detectors Polar angle</td>
</tr>
<tr class="row-odd"><td>Azimuthal</td>
<td>double</td>
<td>Composite detectors Azimutal angle</td>
</tr>
<tr class="row-even"><td>DetectorID</td>
<td>int</td>
<td>Unique detector number</td>
</tr>
<tr class="row-odd"><td>detIDMap</td>
<td>size_t</td>
<td>index of the detector in the detector&#8217;s array</td>
</tr>
<tr class="row-even"><td>detMask <a class="footnote-reference" href="#f1" id="id1">[1]</a></td>
<td>int</td>
<td>1 if masked and 0 if not</td>
</tr>
<tr class="row-odd"><td>efixed <a class="footnote-reference" href="#f2" id="id2">[2]</a></td>
<td>double</td>
<td>energy of the detector (intirect only)</td>
</tr>
</tbody>
</table>
<p>In addition to the preprocessed detectors intofmation, the following log entries are added to the table workspace:</p>
<ul>
<li><p class="first"><strong>Ei</strong> &#8211; Incident neurtorns energy if such log value is attached to input workspace.</p>
</li>
<li><p class="first"><strong>L1</strong> &#8211; Source-sample distance.</p>
</li>
<li><p class="first"><strong>ActualDetectorsNum</strong> &#8211; total number of existing preprocessed detectors (number of rows in the table above).</p>
</li>
<li><p class="first"><strong>InstrumentName</strong> &#8211; the name of the source instrument.</p>
</li>
<li><dl class="first docutils">
<dt><strong>FakeDetectors</strong> &#8211; if detectors posisions were not actually preprocessed but fake detectros were used instread</dt>
<dd><p class="first last">(InstrumentName==*FakeInstrument* in this case).</p>
</dd>
</dl>
</li>
</ul>
<p class="rubric">Notes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Present if property <strong>GetMaskState</strong> is set to True.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Present if <strong>Indirect</strong> mode selected.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Find min-max values for |Q| transformation :</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Simulates Load of a workspace with all necessary parameters #################</span>
<span class="n">detWS</span> <span class="o">=</span> <span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;DeltaE&#39;</span><span class="p">)</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">detWS</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s">&#39;Ei&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s">&#39;52.&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">);</span>
<span class="c">#</span>
<span class="n">preprDetWS</span> <span class="o">=</span> <span class="n">PreprocessDetectorsToMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">detWS</span><span class="p">,</span><span class="n">GetMaskState</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">GetEFixed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># Look at sample results:</span>
<span class="k">print</span> <span class="s">&quot;The resulting table has the following columns:&quot;</span>
<span class="k">print</span> <span class="n">preprDetWS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;The number of rows in the workspace is : &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">preprDetWS</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">&#39;L2&#39;</span><span class="p">))</span>
<span class="n">polar</span> <span class="o">=</span> <span class="n">preprDetWS</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s">&#39;TwoTheta&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;The polar angle for detector N {0} is {1:5f} rad&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">polar</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&quot;The table workspace logs (properties) are currently not availible from python&quot;</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none"><div class="highlight"><pre>The resulting table has the following columns:
[&#39;DetDirections&#39;, &#39;L2&#39;, &#39;TwoTheta&#39;, &#39;Azimuthal&#39;, &#39;DetectorID&#39;, &#39;detIDMap&#39;, &#39;spec2detMap&#39;, &#39;detMask&#39;, &#39;eFixed&#39;]
The number of rows in the workspace is :  918
The polar angle for detector N 10 is 0.314159 rad
The table workspace logs (properties) are currently not availible from python
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/MDAlgorithms/Utility.html">MDAlgorithms\Utility</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/0e727092bfa714fd0d7f12ee4b2c3bb864e1ef06/Framework/MDAlgorithms/src/PreprocessDetectorsToMD.cpp">PreprocessDetectorsToMD.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/0e727092bfa714fd0d7f12ee4b2c3bb864e1ef06/Framework/MDAlgorithms/inc/MantidMDAlgorithms/PreprocessDetectorsToMD.h">PreprocessDetectorsToMD.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PredictPeaks-v1.html" title="Previous Chapter: PredictPeaks v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; PredictPeaks v1</span>
    </a>
  </li>
  <li>
    <a href="ProcessBackground-v1.html" title="Next Chapter: ProcessBackground v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">ProcessBackgroun... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>