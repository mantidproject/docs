<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyChop</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="up" title="Interfaces" href="index.html" />
    <link rel="next" title="QE Coverage" href="QECoverage.html" />
    <link rel="prev" title="Muon Analysis Unscripted Testing" href="Muon_Analysis_unscripted_testing_guide.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="pychop">
<span id="id1"></span><h1>PyChop<a class="headerlink" href="#pychop" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id6">Overview</a></li>
<li><a class="reference internal" href="#options" id="id7">Options</a></li>
<li><a class="reference internal" href="#command-line-interface" id="id8">Command line interface</a></li>
<li><a class="reference internal" href="#theory" id="id9">Theory</a></li>
<li><a class="reference internal" href="#references" id="id10">References</a></li>
</ul>
</div>
<div class="figure align-right">
<a class="reference internal image-reference" href="../_images/PyChop2.png"><img alt="PyChop2.png" src="../_images/PyChop2.png" style="width: 455px;" /></a>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id6">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>PyChop is a tool to allow direct inelastic neutron scattering users to estimate
the inelastic resolution and incident flux for a given spectrometer setting.
Currently, the four direct geometry spectrometers at ISIS (LET, MAPS, MARI, and
MERLIN) are supported.</p>
<p>For MERLIN and LET, in addition, PyChop will also calculate the allowed Ei&#8217;s in
multi-rep mode, and plot the time-distance diagrams for the desired setting.</p>
</div>
<div class="section" id="options">
<h2><a class="toc-backref" href="#id7">Options</a><a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p>First, the instrument, chopper slit packages (or instrument configurations for
LET) and chopper frequency(ies) have to be selected from the pull-down menus
(combo boxes). Then the user should enter the desired incident energy (or the Ei
to focus on for multi-rep operation) in the line edit box.</p>
<p>Clicking the <em>Calculate</em> button will cause PyChop to run the resolution and flux
calculations, which will take 1-2s and update the plots in the tabs on the right
hand side of the GUI. Alternatively, in the options menu, the user can select
the option of having the calculations run when enter (return) is pressed when
the focus is on the Ei line edit box.</p>
<p>If the <em>Hold current plot</em> check box is enabled (selected) then the resolution
vs energy plots will overplot the current axes.</p>
<p>If the <em>Show multi-reps</em> check box is enabled (selected) then the resolution vs
energy for all allowed Ei&#8217;s will be plotted on the current axes. This only
applies to LET or MERLIN with the G (gadolinium) chopper slit package.</p>
<p>In the <em>Flux-Ei</em> plot tab, there is a slider at the bottom and a line edit box
to allow the user to select the maximum x-range (incident energy range) to plot.
The plot updates when the slider or edit box is changed. To save computation
time, the flux / elastic resolution is only calculated at twenty incident energy
points from 0.1 meV to the maximum selected.</p>
<p>The flux and elastic resolution as a function of chopper frequency for the
specified Ei is shown in the <em>Flux-Freq</em> plot tab. If <em>Hold current plot</em> is
selected then several settings can be overplotted. The program will not overplot
if it detects that only the frequency has changed.</p>
<p>If the instrument is LET (or MERLIN with the G chopper), the time-distance plot
is enabled, and an additional option to change the phase of chopper 2 is
available. This chopper has a wide openning and can be used to suppress low
energy reps. The time delay which is specified in the chopper 2 phase edit box
is the time-of-flight in microseconds relative to the moderator pulse when the
chopper first opens.</p>
<p>If the <em>Instrument scientist mode</em> option is selected, a similar option is
enabled for MERLIN if the G chopper is used. In this case, the phase (time
delay) of the thick disk chopper can be adjusted. The time delay is the time-of-
flight at which the chopper slit first opens (sweeps across the beam profile).</p>
<p>The Matplotlib axes showing the calculated data have the standard toolbars.</p>
</div>
<div class="section" id="command-line-interface">
<h2><a class="toc-backref" href="#id8">Command line interface</a><a class="headerlink" href="#command-line-interface" title="Permalink to this headline">¶</a></h2>
<p>In addition to the GUI, there is also a python commandline interface to PyChop.
This is encapsulated in the <tt class="docutils literal"><span class="pre">PyChop2</span></tt> class within the <tt class="docutils literal"><span class="pre">PyChop</span></tt> module. Within
MantidPlot, to do a single point calculation of the flux and resolution</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">PyChop</span> <span class="kn">import</span> <span class="n">PyChop2</span>
<span class="n">resolution</span><span class="p">,</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">PyChop2</span><span class="o">.</span><span class="n">calculate</span><span class="p">(</span><span class="n">inst</span><span class="o">=</span><span class="s">&#39;maps&#39;</span><span class="p">,</span> <span class="n">chtyp</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">ei</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">etrans</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">550</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>The parameters are in order, so <tt class="docutils literal"><span class="pre">PyChop2.calculate('maps','a',500,600,range(0,550,50))</span></tt>
also works.</p>
<p>In addition, an object orient interface is provided:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">mapsres</span> <span class="o">=</span> <span class="n">PyChop2</span><span class="p">(</span><span class="s">&#39;maps&#39;</span><span class="p">)</span>
<span class="n">mapsres</span><span class="o">.</span><span class="n">setChopper</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="n">mapsres</span><span class="o">.</span><span class="n">setFrequency</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">mapsres</span><span class="o">.</span><span class="n">setEi</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mapsres</span><span class="o">.</span><span class="n">getResolution</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">550</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
<p>In particular, the method <tt class="docutils literal"><span class="pre">getResolution</span></tt>, which takes the energy transfers to
calculate the resolution for as an input, can be directly passed to third party
programs for resolution convolution purposes.</p>
<p>For further help, use <tt class="docutils literal"><span class="pre">help(PyChop2)</span></tt> after importing the class.</p>
</div>
<div class="section" id="theory">
<h2><a class="toc-backref" href="#id9">Theory</a><a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p>The energy resolution calculated by <tt class="docutils literal"><span class="pre">PyChop</span></tt> has contributions from the time
width of the moderator pulse <img class="math" src="../_images/math/1e24362ddba254066134f4603458acb4e3173688.png" alt="\tau_{\mathrm{mod}}" style="vertical-align: -3px"/>, the opening times of the
choppers, <img class="math" src="../_images/math/7abf94b4709f34e94dc4efec42e67c8a70adf388.png" alt="\tau_{\mathrm{chop}}" style="vertical-align: -6px"/>, the response time of the detector,
<img class="math" src="../_images/math/84ecf0791a93d18efdd87efc63d5a250c8d3f412.png" alt="\tau_{\mathrm{det}}" style="vertical-align: -3px"/>, and the effect of the sample, <img class="math" src="../_images/math/1e8011aba174952fe4686e6dff09e09a140d16a1.png" alt="\tau_{\mathrm{sam}}" style="vertical-align: -3px"/>.
The first two contributions dominate so we will only concentrate on those.</p>
<p>The moderator time width is determined from fitting data above 100 meV to a
<img class="math" src="../_images/math/4dcb4a08df7a8b829443c0b6705fa279c77218c3.png" alt="\chi^2" style="vertical-align: -4px"/> distribution <a class="reference internal" href="#id2">[1]</a> which has a variance <img class="math" src="../_images/math/75bf6ff2c2bfd0b99c7eaab6a2cf0c882e4a12cf.png" alt="\tau_{\mathrm{mod}}^2
=3/(\Sigma v)^2" style="vertical-align: -5px"/> where <img class="math" src="../_images/math/136effb3ac8e9d84421b7df6e8615d963f70b1c0.png" alt="\Sigma" style="vertical-align: 0px"/> is the macroscopic scattering cross-section
of the moderator and <img class="math" src="../_images/math/cf4c2f9cafb5b0074abef55afea9b0f5802b349a.png" alt="v" style="vertical-align: 0px"/> is the neutron velocity. However, experimentally
it was found that this underestimates the widths at high energy <a class="reference internal" href="#id3">[2]</a>, so that a
modified form for the variance</p>
<div class="math">
<p><img src="../_images/math/89d8a27a332efcc0e1d65fca05c519790fe5da61.png" alt="\tau_{\mathrm{mod}}^2 = \tau_0 + \frac{3}{(\Sigma v)^2}"/></p>
</div><p>is used in PyChop. In future versions, the moderator lineshape will be reparameterised
to use an Ikeda-Carpenter lineshape, which more accurately describes the ToF spectrum
at lower neutron energies.</p>
<p>The chopper time width is determined from the geometry of chopper and is given by
<a class="reference internal" href="#id3">[2]</a>, <a class="reference internal" href="#id4">[3]</a></p>
<div class="math">
<p><img src="../_images/math/72aa3dae020b3075e266440597c0f503ffb55c0b.png" alt="\tau_{\mathrm{chop}}^2 \left\{ \begin{array}{ll} \frac{(\Delta T)^2}{6}
\left[\frac{1-\gamma^4/10}{1-\gamma^2/6}\right] &amp; 0 \leq \gamma &lt; 1 \\
\frac{(\Delta T)^2}{6} \left[\frac{3}{5}
\frac{\gamma(\sqrt{\gamma}-2)^2(\sqrt{\gamma}+8)}{\sqrt{\gamma}+4}\right]
&amp; 1 \leq \gamma &lt; 4 \\
\mathrm{undefined} &amp; \gamma \geq 4 \end{array} \right."/></p>
</div><p>where</p>
<div class="math">
<p><img src="../_images/math/6c14978e4daf848157e70809272507e1b0c00e22.png" alt="\begin{array}{rcl} \Delta T &amp;=&amp; \frac{p}{2R\omega} \\
\gamma &amp;=&amp; \frac{2R}{\Delta T} \left| \frac{1}{s} - \frac{1}{v} \right| \\
s &amp;=&amp; 2\omega\rho \end{array}"/></p>
</div><p>and <img class="math" src="../_images/math/e4b98fa2422dae77531f07b1bbdd8599962267df.png" alt="p" style="vertical-align: -4px"/> is the width of the slits of the Fermi chopper, <img class="math" src="../_images/math/80ea11cbf3510e6208511b42c16940439a65a7e2.png" alt="R" style="vertical-align: 0px"/> is the radius
of the chopper package (assumed cylindrical), <img class="math" src="../_images/math/2250acb05b0e6780be4be1a2effa3670e4c8f882.png" alt="\omega" style="vertical-align: 0px"/> is its rotation speed,
<img class="math" src="../_images/math/cf4c2f9cafb5b0074abef55afea9b0f5802b349a.png" alt="v" style="vertical-align: 0px"/> is the neutron velocity and <img class="math" src="../_images/math/817f1f11a271a306890d322b311ff30209cc5209.png" alt="\rho" style="vertical-align: -4px"/> is the curvature of Fermi chopper
slits.</p>
<p>The time variances above are defined at the moderator and chopper positions respectively.
As the neutron bunches travel towards the sample and detector they also spread out,
and the final time (energy) widths are determined by the geometry (distances) of the
instrument. Specifically, the relative energy width is given by the sum in quadrature
of each of the contributing time widths, which we will restrict here to the two major
terms, <img class="math" src="../_images/math/1e24362ddba254066134f4603458acb4e3173688.png" alt="\tau_{\mathrm{mod}}" style="vertical-align: -3px"/> and <img class="math" src="../_images/math/7abf94b4709f34e94dc4efec42e67c8a70adf388.png" alt="\tau_{\mathrm{chop}}" style="vertical-align: -6px"/> <a class="reference internal" href="#id5">[4]</a>:</p>
<div class="math">
<p><img src="../_images/math/86993ceb734a1a2ba2144d7d0e1fcb74c4db979d.png" alt="\left( \frac{\Delta E}{E_i}\right )^2 =
\left[ 2\frac{\tau_{\mathrm{chop}}}{t_{\mathrm{chop}}} \left(1+\frac{l_0+l_1}{l_2}
\left(\frac{E_f}{E_i}\right)^{\frac{3}{2}} \right) \right]^2
+ \left[ 2\frac{\tau_{\mathrm{mod}}}{t_{\mathrm{chop}}} \left(1+\frac{l_1}{l_2}
\left(\frac{E_f}{E_i}\right)^{\frac{3}{2}} \right) \right]^2"/></p>
</div><p>where <img class="math" src="../_images/math/38cc330ea70cd0b078b91bdce3177f49d76d8cc9.png" alt="t_{\mathrm{chop}}" style="vertical-align: -6px"/> is the time of arrival of the neutron bunch at the
Fermi (or final resolution disk) chopper, <img class="math" src="../_images/math/4528fb6280451f482ca3aad6b32a895bd77434b8.png" alt="l_0" style="vertical-align: -3px"/> is the moderator-chopper,
<img class="math" src="../_images/math/e5b8410e9d4e6e7e507f56fe9b31f3b0f9701861.png" alt="l_1" style="vertical-align: -4px"/> the chopper-sample and <img class="math" src="../_images/math/131b1e65987add365d3597ba61291d62cf21f525.png" alt="l_2" style="vertical-align: -3px"/> the sample-detector distance. <img class="math" src="../_images/math/67a0b078f2a23c2a112fa770355a05c391d59569.png" alt="E_i" style="vertical-align: -3px"/>
and <img class="math" src="../_images/math/40bfef00f5c4b68f21cd987ae4423b63f9250c9a.png" alt="E_f" style="vertical-align: -6px"/> are the incident and scattered neutron energies.</p>
<p>The flux is obtained from lookup tables of measured (white-beam) flux on each instrument.</p>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id10">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="id2">[1] <a class="reference external" href="http://www.neutronresearch.com/parch/1993/01/199301013280.pdf">RAL-94-025: The resolution function of the chopper spectrometer HET at ISIS,
T G Perring, Proceedings of ICANS XII (1993)</a></p>
<p id="id3">[2] RALT-028-94: High energy magnetic excitations in hexagonal cobalt,
T G Perring, Ph.D. Thesis, University of Cambridge (1991)</p>
<p id="id4">[3] <a class="reference external" href="http://dx.doi.org/10.1016/0029-554X(59)90066-7">M. Marseguerra and G. Pauli, Neutron transmission probability through a
curved revolving slit, Nucl. Inst. Meth. 4 (1959) 140</a></p>
<p id="id5">[4] RAL-85-052: MARS - A Multi-Angle Rotor Spectrometer for the SNS,
C J Carlile, A D Taylor and W G Williams (1985)</p>
<p><strong>Category</strong>: <a class="reference external" href="categories/Interfaces.html">Interfaces</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="Muon_Analysis_unscripted_testing_guide.html" title="Previous Chapter: Muon Analysis Unscripted Testing"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Muon Analysis Un...</span>
    </a>
  </li>
  <li>
    <a href="QECoverage.html" title="Next Chapter: QE Coverage"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">QE Coverage &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>