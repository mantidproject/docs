<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DirectILLSelfShielding v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="Divide v1" href="Divide-v1.html" />
    <link rel="prev" title="DirectILLReduction v1" href="DirectILLReduction-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.13</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="directillselfshielding-v1">
<span id="algm-directillselfshielding"></span><span id="algm-directillselfshielding-v1"></span><h1>DirectILLSelfShielding v1<a class="headerlink" href="#directillselfshielding-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DirectILLSelfShielding-v1_dlg.png"><img alt="../_images/DirectILLSelfShielding-v1_dlg.png" class="screenshot" src="../_images/DirectILLSelfShielding-v1_dlg.png" style="width: 280px;" /></a>
<p class="caption"><strong>DirectILLSelfShielding</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculates self-shielding correction for the direct geometry TOF spectrometers at ILL.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="DirectILLReduction-v1.html#algm-directillreduction"><em>DirectILLReduction</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="3%" />
<col width="18%" />
<col width="8%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A workspace for which to simulate the self shielding.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace containing the self shielding correction factors.</td>
</tr>
<tr class="row-even"><td>Cleanup</td>
<td>Input</td>
<td>string</td>
<td>Cleanup ON</td>
<td>What to do with intermediate workspaces. Allowed values: [&#8216;Cleanup ON&#8217;, &#8216;Cleanup OFF&#8217;]</td>
</tr>
<tr class="row-odd"><td>SubalgorithmLogging</td>
<td>Input</td>
<td>string</td>
<td>Logging OFF</td>
<td>Enable or disable subalgorithms to print in the logs. Allowed values: [&#8216;Logging OFF&#8217;, &#8216;Logging ON&#8217;]</td>
</tr>
<tr class="row-even"><td>SimulationInstrument</td>
<td>Input</td>
<td>string</td>
<td>Sparse Instrument</td>
<td>Select if the simulation should be performed on full or approximated instrument. Allowed values: [&#8216;Sparse Instrument&#8217;, &#8216;Full Instrument&#8217;]</td>
</tr>
<tr class="row-odd"><td>SparseInstrumentRows</td>
<td>Input</td>
<td>number</td>
<td>5</td>
<td>Number of detector rows in sparse simulation instrument.</td>
</tr>
<tr class="row-even"><td>SparseInstrumentColumns</td>
<td>Input</td>
<td>number</td>
<td>20</td>
<td>Number of detector columns in sparse simulation instrument.</td>
</tr>
<tr class="row-odd"><td>NumberOfSimulatedWavelengths</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Number of wavelength points where the simulation is performed (default: all).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm calculates self shielding correction factors for the input workspace. It is part of <a class="reference internal" href="../techniques/DirectILL.html#directill"><em>ILL&#8217;s direct geometry reduction suite</em></a>. <em>InputWorkspace</em> should have a sample defined using <a class="reference internal" href="SetSample-v1.html#algm-setsample"><em>SetSample</em></a>. Beam profile can be optionally set using <a class="reference internal" href="SetBeam-v1.html#algm-setbeam"><em>SetBeam</em></a>. The algorithm uses <a class="reference internal" href="MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><em>MonteCarloAbsorption</em></a> as its backend.</p>
<p>To speed up the simulation, the sparse instrument option of <a class="reference internal" href="MonteCarloAbsorption-v1.html#algm-montecarloabsorption"><em>MonteCarloAbsorption</em></a> is used by default. The number of detectors to simulate can be given by <em>SparseInstrumentRows</em> and <em>SparseInstrumentColumns</em>.</p>
<p>By default the correction factors are calculated for each bin. By specifying <em>NumberOfSimulatedWavelengths</em>, one can restrict the number of points at which the calculation is done thus reducing the execution time. In this case CSplines are used to interpolate the correction factor over all bins.</p>
<p>The correction factor contained within the <em>OutputWorkspace</em> can be further fed to <a class="reference internal" href="DirectILLApplySelfShielding-v1.html#algm-directillapplyselfshielding"><em>DirectILLApplySelfShielding</em></a>.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Absorption corrections of fake IN4 workspace</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="c"># Create a fake IN4 workspace.</span>
<span class="c"># We need an instrument and a template first.</span>
<span class="n">empty_IN4</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;IN4&#39;</span><span class="p">)</span>
<span class="n">nHist</span> <span class="o">=</span> <span class="n">empty_IN4</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>
<span class="c"># Make TOF bin edges.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">530.0</span><span class="p">,</span> <span class="mf">2420.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="c"># Make some Gaussian spectra.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">970</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="c"># Repeat data for each histogram.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span>
    <span class="n">DataX</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span>
    <span class="n">DataY</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span>
    <span class="n">NSpec</span><span class="o">=</span><span class="n">nHist</span><span class="p">,</span>
    <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;TOF&#39;</span><span class="p">,</span>
    <span class="n">ParentWorkspace</span><span class="o">=</span><span class="n">empty_IN4</span>
<span class="p">)</span>
<span class="c"># Manually correct monitor spectrum number as LoadEmptyInstrument does</span>
<span class="c"># not know about such details.</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">ParameterName</span><span class="o">=</span><span class="s">&#39;default-incident-monitor-spectrum&#39;</span><span class="p">,</span>
    <span class="n">ParameterType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="c"># Add incident energy information to sample logs.</span>
<span class="n">AddSampleLog</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">LogName</span><span class="o">=</span><span class="s">&#39;Ei&#39;</span><span class="p">,</span>
    <span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">57</span><span class="p">),</span>
    <span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">LogUnit</span><span class="o">=</span><span class="s">&#39;meV&#39;</span><span class="p">,</span>
    <span class="n">NumberType</span><span class="o">=</span><span class="s">&#39;Double&#39;</span>
<span class="p">)</span>
<span class="c"># Elastic channel information is missing in the sample logs.</span>
<span class="c"># It can be given as single valued workspace, as well.</span>
<span class="n">elasticChannelWS</span> <span class="o">=</span> <span class="n">CreateSingleValuedWorkspace</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span>

<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">ElasticChannelWorkspace</span><span class="o">=</span><span class="n">elasticChannelWS</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s">&#39;Energy Calibration OFF&#39;</span><span class="p">,</span> <span class="c"># Normally we would do this for IN4.</span>
<span class="p">)</span>

<span class="n">sampleGeometry</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Shape&#39;</span><span class="p">:</span> <span class="s">&#39;Cylinder&#39;</span><span class="p">,</span>
    <span class="s">&#39;Height&#39;</span><span class="p">:</span> <span class="mf">8.0</span><span class="p">,</span>
    <span class="s">&#39;Radius&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
    <span class="s">&#39;Center&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">sampleMaterial</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;ChemicalFormula&#39;</span><span class="p">:</span> <span class="s">&#39;V&#39;</span><span class="p">,</span>
    <span class="s">&#39;SampleNumberDensity&#39;</span><span class="p">:</span> <span class="mf">0.05</span>
<span class="p">}</span>
<span class="n">SetSample</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">Geometry</span><span class="o">=</span><span class="n">sampleGeometry</span><span class="p">,</span>
    <span class="n">Material</span><span class="o">=</span><span class="n">sampleMaterial</span>
<span class="p">)</span>

<span class="n">DirectILLSelfShielding</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;absorption_corrections&#39;</span><span class="p">,</span>
    <span class="n">SimulationInstrument</span><span class="o">=</span><span class="s">&#39;Full Instrument&#39;</span><span class="p">,</span> <span class="c"># IN4 is small enough.</span>
    <span class="n">NumberOfSimulatedWavelengths</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="c"># The correction factors should be applied using DirectILLApplySelfShielding.</span>
<span class="n">corrections</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;absorption_corrections&#39;</span><span class="p">]</span>
<span class="n">f_short</span> <span class="o">=</span> <span class="n">corrections</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f_long</span> <span class="o">=</span> <span class="n">corrections</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Absoprtion corrections factors for detector 1&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Short final wavelengths: {:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_short</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Long final wavelengths:  {:.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_long</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre> Absoprtion corrections factors for detector 1
 Short final wavelengths: 0.4...
 Long final wavelengths:  0.2...
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/ILL/Direct.html">ILL\Direct</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/fac942f0ecd8b18481b6a1cc7225ecff7aae436c/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/DirectILLSelfShielding.py">DirectILLSelfShielding.py</a> <em>(last modified: 2018-04-09)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DirectILLReduction-v1.html" title="Previous Chapter: DirectILLReduction v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DirectILLReducti...</span>
    </a>
  </li>
  <li>
    <a href="Divide-v1.html" title="Next Chapter: Divide v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Divide v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-07-25.<br/>
    </p>
  </div>
</footer>
  </body>
</html>