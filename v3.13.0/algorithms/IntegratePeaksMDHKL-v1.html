<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IntegratePeaksMDHKL v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="IntegratePeaksProfileFitting v1" href="IntegratePeaksProfileFitting-v1.html" />
    <link rel="prev" title="IntegratePeaksMD v2" href="IntegratePeaksMD-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.13</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="integratepeaksmdhkl-v1">
<span id="algm-integratepeaksmdhkl"></span><span id="algm-integratepeaksmdhkl-v1"></span><h1>IntegratePeaksMDHKL v1<a class="headerlink" href="#integratepeaksmdhkl-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/IntegratePeaksMDHKL-v1_dlg.png"><img alt="../_images/IntegratePeaksMDHKL-v1_dlg.png" class="screenshot" src="../_images/IntegratePeaksMDHKL-v1_dlg.png" style="width: 236px;" /></a>
<p class="caption"><strong>IntegratePeaksMDHKL</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Integrate single-crystal peaks in reciprocal space, for MDHistoWorkspaces.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="IntegratePeaksHybrid-v1.html#algm-integratepeakshybrid"><em>IntegratePeaksHybrid</em></a>, <a class="reference internal" href="IntegratePeaksUsingClusters-v1.html#algm-integratepeaksusingclusters"><em>IntegratePeaksUsingClusters</em></a>, <a class="reference internal" href="IntegratePeaksMD-v2.html#algm-integratepeaksmd"><em>IntegratePeaksMD</em></a>, <a class="reference internal" href="IntegratePeaksCWSD-v1.html#algm-integratepeakscwsd"><em>IntegratePeaksCWSD</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="2%" />
<col width="12%" />
<col width="4%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>IMDWorkspace</td>
<td><em>Mandatory</em></td>
<td>An input Sample MDHistoWorkspace or MDEventWorkspace in HKL.</td>
</tr>
<tr class="row-odd"><td>DeltaHKL</td>
<td>Input</td>
<td>number</td>
<td>0.5</td>
<td>Distance from integer HKL to integrate peak.</td>
</tr>
<tr class="row-even"><td>GridPoints</td>
<td>Input</td>
<td>number</td>
<td>201</td>
<td>Number of grid points for each dimension of HKL box.</td>
</tr>
<tr class="row-odd"><td>NeighborPoints</td>
<td>Input</td>
<td>number</td>
<td>10</td>
<td>Number of points in 5^3 surrounding points above intensity threshold for point to be part of peak.</td>
</tr>
<tr class="row-even"><td>FluxWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>An optional input workspace containing momentum dependent flux for normalization.</td>
</tr>
<tr class="row-odd"><td>SolidAngleWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>An optional input workspace containing momentum integrated vanadium for normalization (a measure of the solid angle).</td>
</tr>
<tr class="row-even"><td>PeaksWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>A PeaksWorkspace containing the peaks to integrate.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>The output PeaksWorkspace will be a copy of the input PeaksWorkspace with the peaks&#8217; integrated intensities.</td>
</tr>
<tr class="row-even"><td>BackgroundInnerRadius</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Optional:Inner radius to use to evaluate the background of the peak. If omitted background is region of HKL box - peak.</td>
</tr>
<tr class="row-odd"><td>BackgroundOuterRadius</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Optional:Outer radius to use to evaluate the background of the peak. The signal density around the peak (BackgroundInnerRadius &lt; r &lt; BackgroundOuterRadius) is used to estimate the background under the peak. If omitted background is region of HKL box - peak.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#algm-integratepeaksmdhkl"><em>IntegratePeaksMDHKL</em></a> provides integration of a
<a class="reference internal" href="../concepts/MDHistoWorkspace.html#mdhistoworkspace"><em>MDHistoWorkspace</em></a> or <a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><em>MDEventWorkspace</em></a> in 3-dimensions.
The units of the workspace must be HKL.  The  main usage will be for data normalized by
<a class="reference internal" href="MDNormSCD-v1.html#algm-mdnormscd"><em>MDNormSCD</em></a>.
A 3D box is created for each peak and the background and peak data are separated.  The intensity and sigma of the
intensity is found from the grid inside the peak and the background is subtracted.  The boxes are created and integrated
in parallel and less memory is required than binning all HKL at once.</p>
<p><img class="math" src="../_images/math/db9abfd3a0d2d9b459724d337246f742984f90e9.png" alt="I_{corr} = I_{peak} - pts_{peak}/pts_{bg} * I_{bg}" style="vertical-align: -6px"/></p>
<p>with the errors summed in quadrature:</p>
<p><img class="math" src="../_images/math/30d8b18fbc57ec6a9d53dd2f45e55523804ac4a8.png" alt="\sigma_{I,corr}^2 = \sigma_{I,peak}^2 + (pts_{peak}/pts_{bg})^2 * \sigma_{I,bg}^2" style="vertical-align: -8px"/></p>
<p>Using the DeltaHKL parameter, the problem of nearly peaks or regions of diffuse scattering can be avoided.  Also for
normalized data, the unmeasured data points are excluded from the background. See white regions in last figure.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/peak3d.png"><img alt="peak3d.png" src="../_images/peak3d.png" style="width: 400px;" /></a>
<p class="caption">Peak Integration Input. 3D Box.</p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/IntegratePeaksMDHKLbox.png"><img alt="IntegratePeaksMDHKLbox.png" src="../_images/IntegratePeaksMDHKLbox.png" style="width: 400px;" /></a>
<p class="caption">Integration slice at center of box.</p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/IntegratePeaksMDHKLpeak.png"><img alt="IntegratePeaksMDHKLpeak.png" src="../_images/IntegratePeaksMDHKLpeak.png" style="width: 400px;" /></a>
<p class="caption">Integration slice of peak grid points.</p>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/IntegratePeaksMDHKLbkg.png"><img alt="IntegratePeaksMDHKLbkg.png" src="../_images/IntegratePeaksMDHKLbkg.png" style="width: 400px;" /></a>
<p class="caption">Integration slice of background grid points.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - IntegratePeaksMDHKL event histo</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#Create PeaksWorkspace</span>
<span class="n">sampleWs</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="n">pws</span> <span class="o">=</span> <span class="n">CreatePeaksWorkspace</span><span class="p">(</span><span class="n">InstrumentWorkspace</span><span class="o">=</span><span class="n">sampleWs</span><span class="p">,</span><span class="n">NumberOfPeaks</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">setHKL</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">setHKL</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">setHKL</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="c">#Test with MDEventWorkspace</span>
<span class="n">mdws</span> <span class="o">=</span> <span class="n">CreateMDWorkspace</span><span class="p">(</span><span class="n">Dimensions</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">Names</span><span class="o">=</span><span class="s">&#39;[H,0,0],[0,K,0],[0,0,L]&#39;</span><span class="p">,</span><span class="n">Units</span><span class="o">=</span><span class="s">&#39;A^-1,A^-1,A^-1&#39;</span><span class="p">,</span><span class="n">Frames</span><span class="o">=</span><span class="s">&#39;HKL,HKL,HKL&#39;</span><span class="p">)</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">mdws</span><span class="p">,</span> <span class="n">PeakParams</span><span class="o">=</span><span class="p">[</span><span class="mi">100000</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">mdws</span><span class="p">,</span> <span class="n">PeakParams</span><span class="o">=</span><span class="p">[</span><span class="mi">100000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">FakeMDEventData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">mdws</span><span class="p">,</span> <span class="n">PeakParams</span><span class="o">=</span><span class="p">[</span><span class="mi">100000</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">pws</span> <span class="o">=</span><span class="n">IntegratePeaksMDHKL</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">mdws</span><span class="p">,</span><span class="n">PeaksWorkspace</span><span class="o">=</span><span class="n">pws</span><span class="p">,</span><span class="n">DeltaHKL</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">GridPoints</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;{:.7f} {:.9f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">getIntensity</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">getSigmaIntensity</span><span class="p">()))</span>
<span class="c">#Test with MDHistoWorkspace</span>
<span class="n">mdws</span> <span class="o">=</span> <span class="n">BinMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">mdws</span><span class="p">,</span><span class="n">AlignedDim0</span><span class="o">=</span><span class="s">&quot;[H,0,0],-10,10,101&quot;</span><span class="p">,</span><span class="n">AlignedDim1</span><span class="o">=</span><span class="s">&quot;[0,K,0],-10,10,101&quot;</span><span class="p">,</span><span class="n">AlignedDim2</span><span class="o">=</span><span class="s">&quot;[0,0,L],-10,10,101&quot;</span><span class="p">)</span>
<span class="n">pws</span> <span class="o">=</span><span class="n">IntegratePeaksMDHKL</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">mdws</span><span class="p">,</span><span class="n">PeaksWorkspace</span><span class="o">=</span><span class="n">pws</span><span class="p">,</span><span class="n">DeltaHKL</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">GridPoints</span><span class="o">=</span><span class="mi">21</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pws</span><span class="o">.</span><span class="n">getPeak</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;{:.7f} {:.9f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">getIntensity</span><span class="p">(),</span><span class="n">p</span><span class="o">.</span><span class="n">getSigmaIntensity</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>99913.3212993 316.123352485
99913.3212993 316.123352485
99913.3212993 316.123352485
99945.2374619 316.157736186
99951.6716018 316.164910575
99926.3456269 316.133414893
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/MDAlgorithms/Peaks.html">MDAlgorithms\Peaks</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/fac942f0ecd8b18481b6a1cc7225ecff7aae436c/Framework/MDAlgorithms/src/IntegratePeaksMDHKL.cpp">IntegratePeaksMDHKL.cpp</a> <em>(last modified: 2017-11-05)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/fac942f0ecd8b18481b6a1cc7225ecff7aae436c/Framework/MDAlgorithms/inc/MantidMDAlgorithms/IntegratePeaksMDHKL.h">IntegratePeaksMDHKL.h</a> <em>(last modified: 2018-04-09)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IntegratePeaksMD-v2.html" title="Previous Chapter: IntegratePeaksMD v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; IntegratePeaksMD...</span>
    </a>
  </li>
  <li>
    <a href="IntegratePeaksProfileFitting-v1.html" title="Next Chapter: IntegratePeaksProfileFitting v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">IntegratePeaksPr... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-07-25.<br/>
    </p>
  </div>
</footer>
  </body>
</html>