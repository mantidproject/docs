<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DirectILLReduction v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DirectILLSelfShielding v1" href="DirectILLSelfShielding-v1.html" />
    <link rel="prev" title="DirectILLIntegrateVanadium v1" href="DirectILLIntegrateVanadium-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.13</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="directillreduction-v1">
<span id="algm-directillreduction"></span><span id="algm-directillreduction-v1"></span><h1>DirectILLReduction v1<a class="headerlink" href="#directillreduction-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DirectILLReduction-v1_dlg.png"><img alt="../_images/DirectILLReduction-v1_dlg.png" class="screenshot" src="../_images/DirectILLReduction-v1_dlg.png" style="width: 233px;" /></a>
<p class="caption"><strong>DirectILLReduction</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a><ul>
<li><a class="reference internal" href="#input-workspaces" id="id5">Input workspaces</a></li>
<li><a class="reference internal" href="#outputs" id="id6">Outputs</a></li>
<li><a class="reference internal" href="#normalisation-to-absolute-units" id="id7">Normalisation to absolute units</a></li>
<li><a class="reference internal" href="#re-binning-in-energy-and-momentum-transfer" id="id8">(Re)binning in energy and momentum transfer</a></li>
<li><a class="reference internal" href="#transposing-output" id="id9">Transposing output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id10">Usage</a></li>
<li><a class="reference internal" href="#source" id="id11">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Data reduction workflow for the direct geometry time-of-flight spectrometers at ILL.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="DirectILLApplySelfShielding-v1.html#algm-directillapplyselfshielding"><em>DirectILLApplySelfShielding</em></a>, <a class="reference internal" href="DirectILLCollectData-v1.html#algm-directillcollectdata"><em>DirectILLCollectData</em></a>, <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><em>DirectILLDiagnostics</em></a>, <a class="reference internal" href="DirectILLIntegrateVanadium-v1.html#algm-directillintegratevanadium"><em>DirectILLIntegrateVanadium</em></a>, <a class="reference internal" href="DirectILLSelfShielding-v1.html#algm-directillselfshielding"><em>DirectILLSelfShielding</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="3%" />
<col width="20%" />
<col width="9%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace to reduce.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The reduced S(Q, DeltaE) workspace.</td>
</tr>
<tr class="row-even"><td>Cleanup</td>
<td>Input</td>
<td>string</td>
<td>Cleanup ON</td>
<td>What to do with intermediate workspaces. Allowed values: [&#8216;Cleanup ON&#8217;, &#8216;Cleanup OFF&#8217;]</td>
</tr>
<tr class="row-odd"><td>SubalgorithmLogging</td>
<td>Input</td>
<td>string</td>
<td>Logging OFF</td>
<td>Enable or disable subalgorithms to print in the logs. Allowed values: [&#8216;Logging OFF&#8217;, &#8216;Logging ON&#8217;]</td>
</tr>
<tr class="row-even"><td>IntegratedVanadiumWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>An integrated vanadium workspace.</td>
</tr>
<tr class="row-odd"><td>AbsoluteUnitsNormalisation</td>
<td>Input</td>
<td>string</td>
<td>Absolute Units OFF</td>
<td>Enable or disable normalisation to absolute units. Allowed values: [&#8216;Absolute Units OFF&#8217;, &#8216;Absolute Units ON&#8217;]</td>
</tr>
<tr class="row-even"><td>DiagnosticsWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Detector diagnostics workspace for masking.</td>
</tr>
<tr class="row-odd"><td>EnergyRebinningParams</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Manual energy rebinning parameters.</td>
</tr>
<tr class="row-even"><td>QBinningParams</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Manual q rebinning parameters.</td>
</tr>
<tr class="row-odd"><td>Transposing</td>
<td>Input</td>
<td>string</td>
<td>Transposing ON</td>
<td>Enable or disable OutputWorkspace transposing. Allowed values: [&#8216;Transposing ON&#8217;, &#8216;Transposing OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>OutputSofThetaEnergyWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td>&nbsp;</td>
<td>Output workspace for reduced S(theta, DeltaE).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This is the main data reduction algorithm in <a class="reference internal" href="../techniques/DirectILL.html#directill"><em>ILL&#8217;s time-of-flight reduction suite</em></a>. It performs the last steps of the reduction workflow, namely vanadium normalisation and transformation to <img class="math" src="../_images/math/04aac0ccf3b627925273ef7351471c3afff8f7c9.png" alt="S(q,\omega)" style="vertical-align: -4px"/> space (optionally <img class="math" src="../_images/math/8418164127ba4bd05e9306c9cf40d68f3814c949.png" alt="S(2\theta,\omega)" style="vertical-align: -4px"/>). The algorithm&#8217;s workflow diagram is shown below:</p>
<img alt="../_images/DirectILLReduction-v1_wkflw.png" src="../_images/DirectILLReduction-v1_wkflw.png" />
<div class="section" id="input-workspaces">
<h3><a class="toc-backref" href="#id5">Input workspaces</a><a class="headerlink" href="#input-workspaces" title="Permalink to this headline">¶</a></h3>
<p><em>InputWorkspace</em> should contain data treated by <a class="reference internal" href="DirectILLCollectData-v1.html#algm-directillcollectdata"><em>DirectILLCollectData</em></a> and, optionally, by <a class="reference internal" href="DirectILLApplySelfShielding-v1.html#algm-directillapplyselfshielding"><em>DirectILLApplySelfShielding</em></a>.</p>
<p>The mandatory <em>IntegratedVanadiumWorkspace</em> should have gone through <a class="reference internal" href="DirectILLIntegrateVanadium-v1.html#algm-directillintegratevanadium"><em>DirectILLIntegrateVanadium</em></a>. This workspace is used for the vanadium normalisation.</p>
<p><em>DiagnosticsWorkspace</em> should be a product of <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><em>DirectILLDiagnostics</em></a>. It is used to mask the spectra of <em>InputWorkspace</em>.</p>
</div>
<div class="section" id="outputs">
<h3><a class="toc-backref" href="#id6">Outputs</a><a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h3>
<p>The algorithm will transform the time-of-flight and spectrum numbers of <em>InputWorkspace</em> into <img class="math" src="../_images/math/04aac0ccf3b627925273ef7351471c3afff8f7c9.png" alt="S(q,\omega)" style="vertical-align: -4px"/> at its output. For <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> to <img class="math" src="../_images/math/fa6736677bcc2f4a1261bf930522ddbe4c7979d3.png" alt="q" style="vertical-align: -4px"/> transformation, <a class="reference internal" href="SofQWNormalisedPolygon-v1.html#algm-sofqwnormalisedpolygon"><em>SofQWNormalisedPolygon</em></a> is used. By default, the output is transposed by <a class="reference internal" href="Transpose-v1.html#algm-transpose"><em>Transpose</em></a>. This behavior can be turned off by the <em>Transpose</em> property.</p>
<p>The optional <img class="math" src="../_images/math/8418164127ba4bd05e9306c9cf40d68f3814c949.png" alt="S(2\theta,\omega)" style="vertical-align: -4px"/> output can be enabled by the <em>OutputSofThetaEnergyWorkspace</em>.</p>
</div>
<div class="section" id="normalisation-to-absolute-units">
<h3><a class="toc-backref" href="#id7">Normalisation to absolute units</a><a class="headerlink" href="#normalisation-to-absolute-units" title="Permalink to this headline">¶</a></h3>
<p>Normalisation to absolute units can be enabled by setting <em>AbsoluteUnitsNormalisation</em> to <tt class="docutils literal"><span class="pre">'Absolute</span> <span class="pre">Units</span> <span class="pre">ON'</span></tt>. In this case the data is multiplied by a factor</p>
<blockquote>
<div><img class="math" src="../_images/math/90da39ceb58304c4443f817da6213e4a5a2dd4fb.png" alt="f = \frac{N_V \sigma_V}{N_S}" style="vertical-align: -8px"/></div></blockquote>
<p>after normalisation to vanadium giving units of barn to the data. In the above, <img class="math" src="../_images/math/6f6e838f8c1195d5695fb2699386247183f33a9d.png" alt="N_V" style="vertical-align: -3px"/> stands for the vanadium number density, <img class="math" src="../_images/math/ed18bf85fabb781734cc886c0381cda068fd8077.png" alt="\sigma_V" style="vertical-align: -3px"/> for vanadium total scattering cross section and <img class="math" src="../_images/math/b2a95b516dadc21f668de2c030ce0a8f6e0e5c60.png" alt="N_S" style="vertical-align: -3px"/> sample number density.</p>
<p>The material properties should be set for <em>InputWorkspace</em> and <em>IntegratedVanadiumWorkspace</em> by <a class="reference internal" href="SetSample-v1.html#algm-setsample"><em>SetSample</em></a> before running this algorithm .</p>
</div>
<div class="section" id="re-binning-in-energy-and-momentum-transfer">
<h3><a class="toc-backref" href="#id8">(Re)binning in energy and momentum transfer</a><a class="headerlink" href="#re-binning-in-energy-and-momentum-transfer" title="Permalink to this headline">¶</a></h3>
<p>After conversion from time-of-flight to energy transfer, the binning may differ from spectrum to spectrum if the sample to detector distances are unequal. The <a class="reference internal" href="SofQWNormalisedPolygon-v1.html#algm-sofqwnormalisedpolygon"><em>SofQWNormalisedPolygon</em></a> algorithm cannot work with such ragged workspaces and thus rebinning is necessary. The rebinning can be specified by the <em>EnergyRebinningParams</em> property. This is directly passed to <a class="reference internal" href="Rebin-v1.html#algm-rebin"><em>Rebin</em></a> as the <em>Params</em> property. If <em>EnergyRebinningParams</em> is not specified, an automatic rebinning scheme is used:
- Find the spectrum with smallest bin border. Copy binning from this spectrum for negative energy transfers.
- For positive energy transfers, use the median bin width at zero energy transfer.</p>
<p><em>QBinningParams</em> are passed to <a class="reference internal" href="SofQWNormalisedPolygon-v1.html#algm-sofqwnormalisedpolygon"><em>SofQWNormalisedPolygon</em></a> and have the same format as <em>EnergyRebinningParamas</em>. If the property is not specified, <img class="math" src="../_images/math/fa6736677bcc2f4a1261bf930522ddbe4c7979d3.png" alt="q" style="vertical-align: -4px"/> is binned to a value that depends on the <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> separation of the detectors and the wavelength.</p>
</div>
<div class="section" id="transposing-output">
<h3><a class="toc-backref" href="#id9">Transposing output</a><a class="headerlink" href="#transposing-output" title="Permalink to this headline">¶</a></h3>
<p>After conversion to momentum transfer, the vertical axis of the data is in units of momentum transfer while the horizontal axis is in energy transfer. By default, the data is transposed such that momentum transfer is on the horizontal axis and energy transfer in the vertical. This can be turned off by setting <em>Transposing</em> to <tt class="docutils literal"><span class="pre">'Transposing</span> <span class="pre">OFF'</span></tt>.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id10">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Fake IN4 workspace reduction</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">mantid.kernel</span> <span class="kn">import</span> <span class="n">DeltaEModeType</span><span class="p">,</span> <span class="n">UnitConversion</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="c"># Create a fake IN4 workspace.</span>
<span class="c"># We need an instrument and a template first.</span>
<span class="n">empty_IN4</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;IN4&#39;</span><span class="p">)</span>
<span class="n">nHist</span> <span class="o">=</span> <span class="n">empty_IN4</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>
<span class="c"># Make TOF bin edges.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">530.0</span><span class="p">,</span> <span class="mf">2420.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="c"># Make some Gaussian spectra.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">970</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="c"># Repeat data for each histogram.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span>
    <span class="n">DataX</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span>
    <span class="n">DataY</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span>
    <span class="n">NSpec</span><span class="o">=</span><span class="n">nHist</span><span class="p">,</span>
    <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;TOF&#39;</span><span class="p">,</span>
    <span class="n">ParentWorkspace</span><span class="o">=</span><span class="n">empty_IN4</span>
<span class="p">)</span>
<span class="c"># Set some histograms to zero for detector diagnostics.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">*=</span> <span class="mf">0.0</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">*=</span> <span class="mf">0.0</span>

<span class="c"># Manually correct monitor spectrum number as LoadEmptyInstrument does</span>
<span class="c"># not know about such details.</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">ParameterName</span><span class="o">=</span><span class="s">&#39;default-incident-monitor-spectrum&#39;</span><span class="p">,</span>
    <span class="n">ParameterType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="c"># Add incident energy information to sample logs.</span>
<span class="n">AddSampleLog</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">LogName</span><span class="o">=</span><span class="s">&#39;Ei&#39;</span><span class="p">,</span>
    <span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">57</span><span class="p">),</span>
    <span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">LogUnit</span><span class="o">=</span><span class="s">&#39;meV&#39;</span><span class="p">,</span>
    <span class="n">NumberType</span><span class="o">=</span><span class="s">&#39;Double&#39;</span>
<span class="p">)</span>
<span class="c"># Add wavelength to sample logs</span>
<span class="n">wl</span> <span class="o">=</span> <span class="n">UnitConversion</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">&#39;Energy&#39;</span><span class="p">,</span> <span class="s">&#39;Wavelength&#39;</span><span class="p">,</span> <span class="mf">57.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">DeltaEModeType</span><span class="o">.</span><span class="n">Direct</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">AddSampleLog</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">LogName</span><span class="o">=</span><span class="s">&#39;wavelength&#39;</span><span class="p">,</span>
    <span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">wl</span><span class="p">),</span>
    <span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">LogUnit</span><span class="o">=</span><span class="s">&#39;Angstrom&#39;</span><span class="p">,</span>
    <span class="n">NumberType</span><span class="o">=</span><span class="s">&#39;Double&#39;</span>
<span class="p">)</span>
<span class="c"># Elastic channel information is missing in the sample logs.</span>
<span class="c"># It can be given as single valued workspace, as well.</span>
<span class="n">elasticChannelWS</span> <span class="o">=</span> <span class="n">CreateSingleValuedWorkspace</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span>

<span class="c"># Create a fake &#39;vanadium&#39; reference workspace.</span>
<span class="n">V_ws</span> <span class="o">=</span> <span class="n">Scale</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">Factor</span><span class="o">=</span><span class="mf">1.3</span>
<span class="p">)</span>

<span class="c"># Process vanadium.</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">V_ws</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">ElasticChannelWorkspace</span><span class="o">=</span><span class="n">elasticChannelWS</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s">&#39;Energy Calibration OFF&#39;</span><span class="p">,</span> <span class="c"># Normally we would do this for IN4.</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s">&#39;epps&#39;</span> <span class="c"># Needed for diagnostics and integration.</span>
<span class="p">)</span>

<span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;diagnostics_mask&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s">&#39;epps&#39;</span><span class="p">,</span>
    <span class="n">MaskedComponents</span><span class="o">=</span><span class="s">&#39;rosace&#39;</span><span class="p">,</span> <span class="c">#Exclude small-angle detectors.</span>
<span class="p">)</span>

<span class="n">DirectILLIntegrateVanadium</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;vanadium&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;vanadium_factors&#39;</span><span class="p">,</span>
    <span class="n">SubalgorithmLogging</span><span class="o">=</span><span class="s">&#39;Logging ON&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s">&#39;epps&#39;</span><span class="p">,</span>
    <span class="n">Temperature</span><span class="o">=</span><span class="mf">273.0</span>
<span class="p">)</span>

<span class="c"># Process sample.</span>
<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">ElasticChannelWorkspace</span><span class="o">=</span><span class="n">elasticChannelWS</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s">&#39;Energy Calibration OFF&#39;</span>
<span class="p">)</span>

<span class="c"># Absorption corrections and empty container subtractions could be added here.</span>

<span class="n">DirectILLReduction</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;SofQW&#39;</span><span class="p">,</span>
    <span class="n">IntegratedVanadiumWorkspace</span><span class="o">=</span><span class="s">&#39;vanadium_factors&#39;</span><span class="p">,</span>
    <span class="n">DiagnosticsWorkspace</span><span class="o">=</span><span class="s">&#39;diagnostics_mask&#39;</span>
<span class="p">)</span>

<span class="n">sofqw</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;SofQW&#39;</span><span class="p">]</span>
<span class="n">nHist</span> <span class="o">=</span> <span class="n">sofqw</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>
<span class="n">nBin</span> <span class="o">=</span> <span class="n">sofqw</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Size of the final S(q,w) workspace: {} histograms, {} bins&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nHist</span><span class="p">,</span> <span class="n">nBin</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Size of the final S(q,w) workspace: 177 histograms, 260 bins
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/ILL/Direct.html">ILL\Direct</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id11">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/fac942f0ecd8b18481b6a1cc7225ecff7aae436c/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/DirectILLReduction.py">DirectILLReduction.py</a> <em>(last modified: 2018-06-14)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DirectILLIntegrateVanadium-v1.html" title="Previous Chapter: DirectILLIntegrateVanadium v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DirectILLIntegra...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLSelfShielding-v1.html" title="Next Chapter: DirectILLSelfShielding v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLSelfShi... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-07-25.<br/>
    </p>
  </div>
</footer>
  </body>
</html>