<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Description</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DakotaChiSquared v1" href="DakotaChiSquared-v1.html" />
    <link rel="prev" title="DPDFreduction v1" href="DPDFreduction-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>5.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<div class="section" id="description">
<h1>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h1>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>DSFinterp(Workspaces, OutputWorkspaces, [LoadErrors], [ParameterValues], [LocalRegression], [RegressionWindow], [RegressionType], TargetParameters], [Version])</p>
</div>
<div class="section" id="required">
<h2>Required<a class="headerlink" href="#required" title="Permalink to this headline">¶</a></h2>
<p>This algorithm requires python package <a class="reference external" href="https://github.com/camm-sns/dsfinterp">dsfinterp</a>, available at the
<a class="reference external" href="https://pypi.python.org/pypi/dsfinterp">python package index</a>.
If the package is not present, this algorithm will not be available. To install, type in a terminal ‘sudo pip install dsfinterp’</p>
</div>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<p>For every “dynamical channel” defined by one particular (Q,E) pair, the sequence of scalars
{<img class="math" src="../_images/math/83b7e18fbe78e18309a3d67dc98c7f444aab8105.png" alt="{S_i \equiv S(Q,E,T_i)}" style="vertical-align: -4px"/>} ordered by increasing value of T is interpolated
with a cubic spline, which then can be invoked to obtain
<img class="math" src="../_images/math/c6e2af9ec8e0c84231334b9155715b978aac1a80.png" alt="S(Q,E,T)" style="vertical-align: -4px"/> at any T value.</p>
<p>Errors in the structure factor are incorporated when constructing the spline, so that the spline
need not necessarily pass trough the <img class="math" src="../_images/math/dbd052a678981f1c03fc93393b5f6c1b4ae43f49.png" alt="(T_i, S_i)" style="vertical-align: -4px"/> points.
This has the desirable effect of producing smooth spline curves when the variation of the
structure factors versus <img class="math" src="../_images/math/5830b1441ec19bff0c7f338ee28ccd12654c1f69.png" alt="T" style="vertical-align: 0px"/> contains significant noise.
For more details on the construction of the spline, see <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.UnivariateSpline.html">UnivariateSpline</a></p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/DSFinterp_local_regression.png"><img alt="DSFinterp_local_regression.png" src="../_images/DSFinterp_local_regression.png" style="width: 600pt; height: 400pt;" /></a>
<p class="caption"><span class="caption-text">Local quadratic regression of windowsize w=7 starting at index n=2</span></p>
</div>
<p>If the structure factors have no associated errors, an scenario typical of structure factors derived from simulations,
then error estimation can be implemented with the running, local regression option.
A local regression of windowsize <img class="math" src="../_images/math/efe9dc01d6e2fca16dbf81148e1aebaef667c4cb.png" alt="w" style="vertical-align: 0px"/> starting at index <img class="math" src="../_images/math/3492c6d4b042ddb93d57b7a5aa9532131d9af611.png" alt="n" style="vertical-align: 0px"/> performs a
linear squares minimization <img class="math" src="../_images/math/68b0fc4683e0c8842b3a6cc6920f022f1c0db3fa.png" alt="F" style="vertical-align: 0px"/> on the set of points <img class="math" src="../_images/math/9c94e07478f7dd06934f9f754f4f26accd7f6dd2.png" alt="(T_n,S_n),..,(T_{n+w},S_{n+w})" style="vertical-align: -5px"/>.
After the minimization is done, we record the expected value and error at <img class="math" src="../_images/math/5a1fd3b1a174e5103abf7d295adb18d814e81887.png" alt="T_{n+w/2}" style="vertical-align: -6px"/>:</p>
<p>value: <img class="math" src="../_images/math/df74568cbef47a254ae088800038ad85f547974c.png" alt="S'_{n+w/2} = F(T_{n+w/2})" style="vertical-align: -8px"/></p>
<p>error: <img class="math" src="../_images/math/f35753a165c30e6602054160073327fff45eb0c0.png" alt="e_{n+w/2} = \sqrt(\frac{1}{w}\sum_{j=n}^{n+w}(S_j-F(T_j))^2)" style="vertical-align: -8px"/></p>
<p>As we slide the window along the T-axis, we obtain values and errors at every <img class="math" src="../_images/math/dc37f5d4a9b5700fdf7fa29a22cab9bfccf11fea.png" alt="T_i" style="vertical-align: -3px"/>.
We use the {<img class="math" src="../_images/math/767be2fb6944a6707894bbea036f9f3e8921119d.png" alt="F(T_i)" style="vertical-align: -4px"/>} values and {<img class="math" src="../_images/math/8914f7cb384432adc4af50ef616b0b4327f39488.png" alt="e_i" style="vertical-align: -3px"/>} errors to produce a smooth spline,
as well as expected errors at any <img class="math" src="../_images/math/5830b1441ec19bff0c7f338ee28ccd12654c1f69.png" alt="T" style="vertical-align: 0px"/> value.</p>
</div>
</div>
<div class="section" id="example">
<h1>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h1>
<p>Our example system is a simulation of a small crystal of octa-methyl <a class="reference external" href="http://en.wikipedia.org/wiki/Silsesquioxane">silsesqioxane</a> molecules.
A total of 26 molecular dynamics simulations were performed under different values of the energy barrier
to methyl rotations, <img class="math" src="../_images/math/e1c28c5aafda6ce10cad81bcc71b15a182ee21cb.png" alt="K" style="vertical-align: 0px"/>. Dynamics structure factors S(Q,E) were derived from each simulation.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/DSFinterp_fig3.png"><img alt="DSFinterp_fig3.png" src="../_images/DSFinterp_fig3.png" style="width: 600pt; height: 400pt;" /></a>
<p class="caption"><span class="caption-text">Interpolated spline (solid line) with associated errors at one (Q,E) dynamical channel. Red dots are values from the simulation used to construct the spline.</span></p>
</div>
<p>There are as many splines as dynamical channels. The algorithm gathers the interpolations
for each channel and aggregates them into an interpolated structure factor.</p>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../_images/DSFinterp_fig4.png"><img alt="DSFinterp_fig4.png" src="../_images/DSFinterp_fig4.png" style="width: 600pt; height: 400pt;" /></a>
<p class="caption"><span class="caption-text">Interpolated structure factor <img class="math" src="../_images/math/422ab889230f8cc616a7771c660e940c6644d7ee.png" alt="S(K,E|Q)" style="vertical-align: -5px"/>, in logarithm scaling, at fixed <img class="math" src="../_images/math/9e5357062396ac56ea944f38ec653ff8b7636f8d.png" alt="Q=0.9A^{-1}" style="vertical-align: -4px"/>.</span></p>
</div>
</div>
<div class="section" id="id1">
<h1>Usage<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>In this example, we load experimental QENS data derived from a powder of octa-methyl silsesquioxane microcrystals
at temperatures 100 150 200 250 300 350, then user DSFinterp to guess structure factors for temperatures 175 and 275.
Finally, we load experimental data for these two temperatures so that we can compare with the DSFinterp predictions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">temp_flt</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">350</span><span class="p">]</span>
<span class="n">workspaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exp100K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp150K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp200K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp250K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp300K&#39;</span><span class="p">,</span> <span class="s1">&#39;exp350K&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_flt</span><span class="p">)</span> <span class="p">):</span>
  <span class="n">LoadNexus</span><span class="p">(</span><span class="n">FileName</span><span class="o">=</span><span class="s1">&#39;DSFinterp/{0}.nxs&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">workspaces</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">workspaces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1">#load QENS data</span>
<span class="n">target_temps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">175</span><span class="p">,</span> <span class="mi">225</span><span class="p">]</span>
<span class="n">outworkspaces</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int175K&#39;</span><span class="p">,</span> <span class="s1">&#39;int225K&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">dsfinterp</span>  <span class="c1"># Have you installed the dsfinterp module? (pip install dsfinterp)</span>
<span class="n">DSFinterp</span><span class="p">(</span><span class="n">Workspaces</span><span class="o">=</span><span class="n">workspaces</span><span class="p">,</span> <span class="n">ParameterValues</span><span class="o">=</span><span class="n">temp_flt</span><span class="p">,</span> <span class="n">RegressionWindow</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">TargetParameters</span><span class="o">=</span><span class="n">target_temps</span><span class="p">,</span> <span class="n">OutputWorkspaces</span><span class="o">=</span><span class="n">outworkspaces</span><span class="p">)</span>

<span class="c1">#Now load experimental data for target temperatures</span>
<span class="n">LoadNexus</span><span class="p">(</span><span class="n">FileName</span><span class="o">=</span><span class="s1">&#39;DSFinterp/exp175K.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;exp175K&#39;</span><span class="p">)</span>
<span class="n">LoadNexus</span><span class="p">(</span><span class="n">FileName</span><span class="o">=</span><span class="s1">&#39;DSFinterp/exp225K.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;exp225K&#39;</span><span class="p">)</span>

<span class="c1">#Compare one of the predicted spectrum with a fit to experimental data</span>
<span class="n">myFunc</span><span class="o">=</span> <span class="s1">&#39;name=TabulatedFunction,Workspace=int225K,WorkspaceIndex=8,Scaling=1.00424&#39;</span>
<span class="n">fitStatus</span><span class="p">,</span> <span class="n">chiSq</span><span class="p">,</span> <span class="n">covarianceTable</span><span class="p">,</span> <span class="n">paramTable</span><span class="p">,</span> <span class="n">fitWorkspace</span> <span class="o">=</span>\
<span class="n">Fit</span><span class="p">(</span><span class="n">Function</span><span class="o">=</span><span class="n">myFunc</span><span class="p">,</span> <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;exp225K&#39;</span><span class="p">,</span> <span class="n">WorkspaceIndex</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">Output</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
<p><strong>ERROR: No algorithm ‘DSFinterp’ version ‘1’, skipping directive</strong></p>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DPDFreduction-v1.html" title="Previous Chapter: DPDFreduction v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DPDFreduction v1</span>
    </a>
  </li>
  <li>
    <a href="DakotaChiSquared-v1.html" title="Next Chapter: DakotaChiSquared v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DakotaChiSquared v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2020-09-29.<br/>
    </p>
  </div>
</footer>
  </body>
</html>