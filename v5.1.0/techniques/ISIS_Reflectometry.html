<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ISIS Reflectometry</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SANS TOML Files" href="SANS-Toml-v1.html" />
    <link rel="prev" title="ISIS Powder Diffraction Scripts Workflow Diagrams" href="ISISPowder-Workflows-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>5.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="isis-reflectometry">
<span id="id1"></span><h1>ISIS Reflectometry<a class="headerlink" href="#isis-reflectometry" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id6">Overview</a><ul>
<li><a class="reference internal" href="#introduction" id="id7">Introduction</a></li>
<li><a class="reference internal" href="#experimental-setup" id="id8">Experimental Setup</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reduction" id="id9">Reduction</a><ul>
<li><a class="reference internal" href="#specular-reflection" id="id10">Specular Reflection</a><ul>
<li><a class="reference internal" href="#divergent-beam" id="id11">Divergent Beam</a></li>
<li><a class="reference internal" href="#non-flat-sample" id="id12">Non-Flat Sample</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#instruments" id="id13">Instruments</a><ul>
<li><a class="reference internal" href="#isis-instruments" id="id14">ISIS Instruments</a></li>
<li><a class="reference internal" href="#detectors" id="id15">Detectors</a></li>
<li><a class="reference internal" href="#instrument-definition-files" id="id16">Instrument Definition Files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mantid" id="id17">Mantid</a><ul>
<li><a class="reference internal" href="#algorithms" id="id18">Algorithms</a></li>
<li><a class="reference internal" href="#interface" id="id19">Interface</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id6">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This document explains set up of reflectometry instruments at ISIS and how Mantid is used to perform reduction of ISIS reflectometry data.</p>
<div class="section" id="introduction">
<h3><a class="toc-backref" href="#id7">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>Reflectometry is a non-invasive technique that allows us to analyse the properties of planar media and surfaces such as biological and metallic thin films.</p>
<p>Interfaces and surfaces are scientifically crucial as they allow symmetry breaking, leading too many novel and interesting phenomena, such as ferroelectricity, wetting, adhesion and superconductivity. Interfaces are also critical in governing many important chemical and biological processes such as corrosion, catalysis and how cell membranes and antimicrobials work. Reflectivity is unique in its ability to probe buried interfaces while still providing the ensemble average of the properties of these buried interfaces. Most other probes are surface limited and local in nature.</p>
<p>Reflectivity occurs whenever there is an equivalent refractive index change across a material boundary/interface; this is analogous to how light (travelling through air) reflects off the surface of water (our interface of interest). As a result it is very sensitive to the structural/magnetic profile of interfaces. Reflectivity allows the structural, sometimes called “nuclear”, scattering length density (SLD) depth profile to be obtained via a modelling and iterative fitting process. The SLD profile is the important piece of information that the reflectivity technique provides.</p>
<p>To obtain the SLD profile, a model of the sample is used to create an initial SLD profile that via a fast Fourier transform is turned into a reflectivity curve. This curve is then compared to the actual reflectivity data curve. The iterative fitting procedure is used to modify the initial model and SLD profile until the generated reflectivity matches, to some goodness of fit metric, the actual data. Then end result being the final SLD profile.</p>
<p>Assuming the most common model and parametrisation type, based on layers, then the SLD can then be deconvolved into a series of layers each with three fundamental properties: (1) The structural layer thicknesses, (2) interface roughness/grading (3) density/composition. These three properties can be linked back to a wealth of technological and scientifically relevant phenomena. Further to this, by polarising the incident neutron beam the magnetic equivalents of the above can also be obtained. It is also important to note that there are other models and parameterisation schemes that can be used, to generate SLD profiles.</p>
<p>A reflectivity measurement is made by shining a collimated beam (low angular divergence) of neutrons onto a flat surface and the reflected intensity is measured as a function of angle and neutron wavelength. Reflectivity has two fundamental modes of operation. (1) Monochromatic (angle dispersive, fixed incident wavelength) and chromatic (wavelength dispersive, fixed angle). (2) Chromatic is usually referred to as Time of Flight (<img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/>) and <img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/> is the primary mode of operation on all the ISIS reflectometers and what is referred to throughout this document.</p>
<p>Further to this, there are two geometric modes of operation. By far the most common is specular reflectivity. In this case the angle of incidence is equal to the angle of reflection or <img class="math" src="../_images/math/d4cb4929c591037a359b39556efe2c1069710534.png" alt="\theta_i = \theta_f" style="vertical-align: -6px"/>. This is called the specular condition. It provides the SLD profile/information that is directly normal or perpendicular to the surface of the sample. Secondly there is off-specular reflectivity where the angle of incidence is not equal to the angle of reflection or <img class="math" src="../_images/math/494240a71e95c9b21de968d8f42e14129a1942b7.png" alt="\theta_i \ne \theta_f" style="vertical-align: -6px"/> . This provides structural information in the plane of the sample.</p>
<p>As a quick aside it is worth mentioning that there is an added complication in describing scattering geometries in that different techniques, sources and institutions use different notations for the same things. For instance the specular condition can also be referred to as the <img class="math" src="../_images/math/c1472e7126d45156e4cc6d20a04161bd1a999f3a.png" alt="\frac{\theta}{2\theta}" style="vertical-align: -6px"/> (where <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> is the scattering/detector angle and <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> the sample angle) or <img class="math" src="../_images/math/5bccbcca4bf6241caf502ee9f4c5b60421ff3c5a.png" alt="\frac{\omega}{\theta}" style="vertical-align: -6px"/> (where <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> is not the scattering/detector angle and <img class="math" src="../_images/math/2250acb05b0e6780be4be1a2effa3670e4c8f882.png" alt="\omega" style="vertical-align: 0px"/> the sample angle) conditions. At ISIS reflectometers for historic reasons the detector angle is referred to as <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> and the sample angle as <img class="math" src="../_images/math/4e13925d12ab61313a097e34a9d890df7dd247b0.png" alt="\Phi" style="vertical-align: -1px"/>.</p>
<p>For more information, see the <a class="reference external" href="https://www.isis.stfc.ac.uk/Pages/Reflectometry.aspx">ISIS website</a>.</p>
</div>
<div class="section" id="experimental-setup">
<h3><a class="toc-backref" href="#id8">Experimental Setup</a><a class="headerlink" href="#experimental-setup" title="Permalink to this headline">¶</a></h3>
<p>The main components in the instrument are shown below:</p>
<div class="figure align-center">
<img alt="Diagram showing the basic setup of ISIS Reflectometry instruments" src="../_images/ISISReflectometry_setup_diagram.png" />
</div>
<p>The basic reflectometry instrument setup as used on the Inter, Crisp and Surf beamlines. The black line is the incident beam and the red line the reflected beam. The dotted black line is the horizon of the sample which is at an angle <img class="math" src="../_images/math/047e27b15cc42d8a3c8447360b79e2218dd5883a.png" alt="\theta_i" style="vertical-align: -3px"/> with respect to the incident beam. There are several caveats; the diagram depicts what happens with the 1D linear detectors’ on Inter, Crisp and Surf. In the case of the 0D point detectors on these beamlines the detector changes angle such that the beam is always perpendicular incident on the 0D detector surface. On Polref and Offspec, the detector plane rotates with the detector angle such that the beam is always perpendicular incident on the detector plane whether it is a 0D, 1D or 2D detector. This needs to be taken account of in the IDF depending on the beamline and detector in use.</p>
<ul class="simple">
<li><em>Source</em>: The source of neutrons</li>
<li><em>Sample</em>: The planar material under analysis</li>
<li><em>Slits</em>: These are used to collimate the beam. These have two primary effects:<ul>
<li>They set the angular divergence/resolution <img class="math" src="../_images/math/23bf3bdd8ce99fdb75f17e8b49934c62e9cf0841.png" alt="\alpha" style="vertical-align: 0px"/> of the beamline via the collimation equation <img class="math" src="../_images/math/ce1ad9a9a81d8f8685aedaf98458067645a4c318.png" alt="\alpha = \frac{S_1+S_2}{L}" style="vertical-align: -6px"/>, where <img class="math" src="../_images/math/5d9660747e4acca665b3cb5cb9a108b80c3e0255.png" alt="S_1,S_2" style="vertical-align: -4px"/> are the widths of the slit gaps and <img class="math" src="../_images/math/d4cb4cb97b65f55811d2f06e045948b77f3e81c5.png" alt="L" style="vertical-align: 0px"/> is the distance between Slit 1 and Slit 2. The resolution is often defined as <img class="math" src="../_images/math/5f9c1b8d0f8f6ac169ef75bb3eb03ece968170ba.png" alt="\frac{\delta Q}{Q}" style="vertical-align: -9px"/>, where <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> is the momentum transfer. Please see the <a class="reference internal" href="../algorithms/NRCalculateSlitResolution-v1.html#algm-nrcalculateslitresolution"><span class="std std-ref">NRCalculateSlitResolution v1</span></a> algorithm for more details.</li>
<li>They set the illuminated area on the sample. There are two regimes, under and over illumination and ideally you want to be under illuminating but that is not always possible as in the case of small samples.</li>
</ul>
</li>
<li><em>Monitors</em>: These are low efficiency detectors used to normalize the detector signal and mainly provide scaling.</li>
<li><em>Detectors</em>: These are high efficiency detectors. Scattered neutrons are recorded by a detector or banks of detectors located at different <em>scattering angles</em>, <img class="math" src="../_images/math/0ea33e9472d4547d1d1be51eb39ae0716d6f3759.png" alt="2\theta_{det}" style="vertical-align: -3px"/>. Note that the terminology here differs from that in neutron diffraction, where <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> is referred to as the scattering angle rather than <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/>. We define three types of general geometry of detector:<ul>
<li><em>0D</em> or <em>point detectors</em>, where a simple tube is used to integrate intensity, the detector itself has no position sensitivity, just the angle it is positioned at.</li>
<li><em>1D</em> also referred to as <em>linear</em>, <em>area</em> or <em>multidetector</em>’s, where a stack of tubes/pixels is used to integrate intensity with either vertical or horizontal position sensitivity equal to the pixel size.</li>
<li><em>2D</em>, which can also be referred to as an <em>area</em> detector. Similar to the 1D but with both vertical and horizontal position sensitivity. Note pixels may not be uniform in horizontal/vertical size.</li>
</ul>
</li>
<li><img class="math" src="../_images/math/047e27b15cc42d8a3c8447360b79e2218dd5883a.png" alt="\theta_i" style="vertical-align: -3px"/>: the <em>incident angle</em>, that is, the angle between the incident beam and the sample, commonly called the sample angle or at ISIS reflectometers the <img class="math" src="../_images/math/4e13925d12ab61313a097e34a9d890df7dd247b0.png" alt="\Phi" style="vertical-align: -1px"/> axis.</li>
<li><img class="math" src="../_images/math/7a707dcdc35a7da05d56b72a5d981151d48020bf.png" alt="\theta_f" style="vertical-align: -6px"/>: the <em>final angle</em>, that is, the angle between the reflected beam and the sample. At ISIS reflectometers this is referred to as <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/>. In specular reflection, <img class="math" src="../_images/math/d4cb4929c591037a359b39556efe2c1069710534.png" alt="\theta_i = \theta_f" style="vertical-align: -6px"/> and in off-specular analysis <img class="math" src="../_images/math/07bf93dbf685c6b4df58a64b06d25031e60915de.png" alt="\theta_i \neq \theta_f" style="vertical-align: -6px"/>.</li>
</ul>
<p>In addition, some instruments also use:</p>
<ul class="simple">
<li><em>Supermirrors</em>: Some samples, such as liquids, cannot be angled. Therefore non-polarising “supermirrors” can be used to change the incident angle of the beam to enable multiple angles to be measured from the surface.</li>
<li><em>Polarizers</em>: Magnetic sensitivity is acquired by polarizing the neutron beam, via polarizing supermirrors. &nbsp;Neutrons are in essence like little bar magnets; however the north/south alignment (referred to as the spin direction) is initially completely random. A polarizer is a magnetic supermirror where the magnetization direction of the mirror can be set by an applied magnetic field. When neutrons bounce off the polarizer, the neutrons align either parallel (spin “up”) or anti-parallel (spin “down”) to the magnetization direction of the mirror. The handy trick is that the refractive index of the magnetic mirror has a magnetic component, such that spin up neutrons have a different angle of reflection to spin down neutrons. Hence it is possible to reflect just one spin state down the beamline, while the other is rejected. It should be noted at this point that 50% of the incident flux is lost during this process.</li>
</ul>
</div>
</div>
<div class="section" id="reduction">
<h2><a class="toc-backref" href="#id9">Reduction</a><a class="headerlink" href="#reduction" title="Permalink to this headline">¶</a></h2>
<p>The main reduction algorithm is <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a>, which can be used from a python script or via the <a class="reference internal" href="../interfaces/ISIS Reflectometry.html#interface-isis-refl"><span class="std std-ref">ISIS Reflectometry Interface</span></a>. It currently only deals with specular reflection, but off-specular analysis is planned. It also currently only deals with point detectors or linear detectors, but 2D detectors are planned.</p>
<div class="section" id="specular-reflection">
<h3><a class="toc-backref" href="#id10">Specular Reflection</a><a class="headerlink" href="#specular-reflection" title="Permalink to this headline">¶</a></h3>
<p>In an experiment, the reflected intensity, <img class="math" src="../_images/math/8cbabf0be514c984d6ec320163dd139dc67e0d12.png" alt="I" style="vertical-align: 0px"/> (i.e. the number of neutrons received at the detector) is measured as a function of time-of-flight, <img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/>. The desired outcome of the reduction is a one-dimensional plot (summed over the detectors) of reflectivity normalised by an un-reflected beam, <img class="math" src="../_images/math/6441eeddadcad65022025dfeb5bc9bfc3db26d6c.png" alt="\frac{I}{I_0}" style="vertical-align: -8px"/> against momentum transfer, <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>. <img class="math" src="../_images/math/6441eeddadcad65022025dfeb5bc9bfc3db26d6c.png" alt="\frac{I}{I_0}" style="vertical-align: -8px"/> is referred to as reflectivity and is dimensionless and by definition. Total reflection, below the critical edge is then by definition <img class="math" src="../_images/math/a6b5f5b75670112aae5c257826971d1c8220b06c.png" alt="\frac{I}{I_0} = 1" style="vertical-align: -8px"/></p>
<p>To achieve this, the input workspace in <img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/> is first converted to wavelength, <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>, and normalised by some combination of monitors and direct beam transmission runs, that have all also been converted to <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>. It is critical that the detector and monitor workspaces all have the same binning regarding number of bins and bin size in <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>.</p>
<p>The workspace is summed over all detectors in the region of interest, using either constant-<img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/> or constant-<img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> binning. The result is a one-dimensional array of <img class="math" src="../_images/math/8cbabf0be514c984d6ec320163dd139dc67e0d12.png" alt="I" style="vertical-align: 0px"/> against <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>. The summed workspace is converted to <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> and rebinned to the required resolution, as determined either by the slits or the user. The <a class="reference internal" href="../algorithms/NRCalculateSlitResolution-v1.html#algm-nrcalculateslitresolution"><span class="std std-ref">NRCalculateSlitResolution v1</span></a> algorithm is used to calculate the slit resolution.</p>
<p>The resulting one-dimensional plot of <img class="math" src="../_images/math/8cbabf0be514c984d6ec320163dd139dc67e0d12.png" alt="I" style="vertical-align: 0px"/> against <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> is typically referred to as <code class="docutils literal"><span class="pre">IvsQ</span></code>. <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> also outputs the unbinned workspace in <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>, as well as the summed workspace in <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>, and these are typically referred to as <code class="docutils literal"><span class="pre">IvsQ_unbinned</span></code> and <code class="docutils literal"><span class="pre">IvsLam</span></code> respectively.</p>
<p>A standard measurement will involve sample under certain conditions (temperature, magnetic field, etc) being measured at two or three different incident angles, <img class="math" src="../_images/math/047e27b15cc42d8a3c8447360b79e2218dd5883a.png" alt="\theta_i" style="vertical-align: -3px"/>. This means that we typically end up with two or three <img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/> workspaces that are combined (stitched) and processed to give a single plot covering a larger range of <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>. The stitching is achieved using the <a class="reference internal" href="../algorithms/Stitch1D-v3.html#algm-stitch1d"><span class="std std-ref">Stitch1D v3</span></a> and <a class="reference internal" href="../algorithms/Stitch1DMany-v1.html#algm-stitch1dmany"><span class="std std-ref">Stitch1DMany v1</span></a> algorithms.</p>
<p>The actual reduction is relatively simple and produces a simple one dimensional plot which can be saved as an ASCII file. However, there can be many files to deal with and we need to make sure that we process the correct runs together and with the correct parameters, transmission runs etc.</p>
<div class="section" id="divergent-beam">
<h4><a class="toc-backref" href="#id11">Divergent Beam</a><a class="headerlink" href="#divergent-beam" title="Permalink to this headline">¶</a></h4>
<p>If the divergence of the input beam is significant, we need to take the variability in <img class="math" src="../_images/math/047e27b15cc42d8a3c8447360b79e2218dd5883a.png" alt="\theta_i" style="vertical-align: -3px"/> and <img class="math" src="../_images/math/7a707dcdc35a7da05d56b72a5d981151d48020bf.png" alt="\theta_f" style="vertical-align: -6px"/> into account. Consider a range of incident angles on a sample of fixed orientation:</p>
<div class="figure align-center" id="id2">
<img alt="Diagram showing the divergent beam case" src="../_images/ISISReflectometry_divergent_beam_diagram.png" />
<p class="caption"><span class="caption-text">A range of incident angles from a divergent beam on a sample of fixed orientation <img class="math" src="../_images/math/047e27b15cc42d8a3c8447360b79e2218dd5883a.png" alt="\theta_i" style="vertical-align: -3px"/>. The black lines show the expected beam and reflection directions, and the red lines show a divergent beam path and reflection.</span></p>
</div>
<p>The difference between the actual and expected beam directions is the same as that between the actual and expected reflection directions:</p>
<p><img class="math" src="../_images/math/1d543953a0a388134f7b21d95df9a13e13153a29.png" alt="\phi = 2\theta_{det} - 2\theta_i" style="vertical-align: -4px"/></p>
<p>Therefore, <img class="math" src="../_images/math/7a707dcdc35a7da05d56b72a5d981151d48020bf.png" alt="\theta_f" style="vertical-align: -6px"/> can be calculated as:</p>
<p><img class="math" src="../_images/math/c5e0af06a8c2f53cd1d466dd2c95a0cb2e855c4e.png" alt="\theta_f = \theta_i + \phi = 2\theta_{det} - \theta_i" style="vertical-align: -6px"/></p>
<p>The effect of the divergence is that the data follow lines of constant-<img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>. Therefore we need to sum along lines of constant-<img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> rather than constant-<img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>. <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> has an option to do this.</p>
<div class="figure align-center" id="id3">
<img alt="Plot showing the measured intensity" src="../_images/ISISReflectometry_divergent_beam_measured.png" />
<p class="caption"><span class="caption-text">Measured intensity for each detector vs <img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/>. The data follow lines of constant <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>.</span></p>
</div>
<div class="figure align-center" id="id4">
<img alt="Plot showing the reduced data" src="../_images/ISISReflectometry_divergent_beam_result.png" />
<p class="caption"><span class="caption-text">The reduced data as a plot of <img class="math" src="../_images/math/8cbabf0be514c984d6ec320163dd139dc67e0d12.png" alt="I" style="vertical-align: 0px"/> vs <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>, showing the improved resolution when summing in <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> rather than <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/></span></p>
</div>
</div>
<div class="section" id="non-flat-sample">
<h4><a class="toc-backref" href="#id12">Non-Flat Sample</a><a class="headerlink" href="#non-flat-sample" title="Permalink to this headline">¶</a></h4>
<p>A bent sample causes variability in the reflected angle, <img class="math" src="../_images/math/7a707dcdc35a7da05d56b72a5d981151d48020bf.png" alt="\theta_f" style="vertical-align: -6px"/>. It can be considered as a flat sample of variable orientation:</p>
<div class="figure align-center" id="id5">
<img alt="Diagram showing the non-flat sample case" src="../_images/ISISReflectometry_non_flat_sample_diagram.png" />
<p class="caption"><span class="caption-text">Divergence in the reflected angle from a non-flat sample is considered as a flat sample of variable orientation. The black lines show the incident beam and the expected reflection direction with the sample horizon at <img class="math" src="../_images/math/047e27b15cc42d8a3c8447360b79e2218dd5883a.png" alt="\theta_i" style="vertical-align: -3px"/>. The red line shows a divergent reflected beam, and the dotted blue line shows the related sample horizon.</span></p>
</div>
<p>The difference between the actual and expected reflection directions is:</p>
<p><img class="math" src="../_images/math/1d543953a0a388134f7b21d95df9a13e13153a29.png" alt="\phi = 2\theta_{det} - 2\theta_i" style="vertical-align: -4px"/></p>
<p>Therefore, <img class="math" src="../_images/math/7a707dcdc35a7da05d56b72a5d981151d48020bf.png" alt="\theta_f" style="vertical-align: -6px"/> can be calculated as:</p>
<p><img class="math" src="../_images/math/66812e625792fe6fb048a1e40ec2f81f9ed1a69d.png" alt="\theta_f = \theta_i + \frac{\phi}{2} = \frac{2\theta_{det}}{2}" style="vertical-align: -6px"/></p>
<p>Similarly to the divergent beam case, the data should be summed along lines of constant-<img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> using the relevant options in <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="instruments">
<h2><a class="toc-backref" href="#id13">Instruments</a><a class="headerlink" href="#instruments" title="Permalink to this headline">¶</a></h2>
<div class="section" id="isis-instruments">
<h3><a class="toc-backref" href="#id14">ISIS Instruments</a><a class="headerlink" href="#isis-instruments" title="Permalink to this headline">¶</a></h3>
<p>There are five reflectometry instruments at ISIS:</p>
<ul class="simple">
<li><em>Inter</em>: High-intensity reflectometer. Specialised for free liquid surfaces.</li>
<li><em>Offspec</em>: Polarised neutron reflectometer with optional polarisation analysis, using a high resolution position sensitive detector. Used to study magnetic ordering in and between the layers and surfaces of thin film materials.</li>
<li><em>Polref</em>: Polarised neutron reflectometer. Used to study magnetic ordering in and between the layers and surfaces of thin film materials.</li>
<li><em>Crisp</em>: Designed for studies of a wide range of interfacial phenomena.</li>
<li><em>Surf</em>: Optimised for higher flux and short wavelengths. Designed for liquid interface research.</li>
</ul>
</div>
<div class="section" id="detectors">
<h3><a class="toc-backref" href="#id15">Detectors</a><a class="headerlink" href="#detectors" title="Permalink to this headline">¶</a></h3>
<p>Currently at ISIS we deal with two types of detector: point-detectors (e.g. Inter) or multi-/linear-detectors (e.g. Polref and Offspec). Note that most instruments have both point and linear detectors. We are expecting to add 2D detectors in the near future.</p>
<p>Because runs are performed at different incident angles, the <strong>detectors are moved</strong> between different runs. Some instruments (e.g. Inter) move detectors vertically, whereas others (Polref, Offspec) rotate them around the sample.</p>
<p>Historically, detector positions needed to be adjusted within the reflectometry reduction algorithms. The <a class="reference internal" href="../algorithms/SpecularReflectionPositionCorrect-v2.html#algm-specularreflectionpositioncorrect"><span class="std std-ref">SpecularReflectionPositionCorrect v2</span></a> algorithm deals with this. However, some instruments (e.g. Inter) now move detectors to the correct position on load, so correcting positions within the reflectometry algorithms is not required. This is the preferred approach going forward.</p>
</div>
<div class="section" id="instrument-definition-files">
<h3><a class="toc-backref" href="#id16">Instrument Definition Files</a><a class="headerlink" href="#instrument-definition-files" title="Permalink to this headline">¶</a></h3>
<p>Mantid can handle instruments with different <strong>reference frames</strong> because it uses the beam direction, sample position, detector positions, etc. The reference frames currently used by ISIS reflectometry instruments are:</p>
<ul class="simple">
<li>Inter, Offspec, Crisp and Surf define the beam direction along the <img class="math" src="../_images/math/4764300df3b118f2c580952e9fb04e7cd7943ba5.png" alt="z" style="vertical-align: 0px"/> axis and <em>Up</em> (perpendicular to the beam) along the <img class="math" src="../_images/math/95ca3c6a1fbeaaafe5800c3269c4c9c2cf2e5406.png" alt="y" style="vertical-align: -4px"/> axis.</li>
<li>Polref defines the beam direction along the <img class="math" src="../_images/math/86e784d473f5fc5713b6ad4bea7af624b76966c2.png" alt="x" style="vertical-align: 0px"/> axis and <em>Up</em> along the <img class="math" src="../_images/math/4764300df3b118f2c580952e9fb04e7cd7943ba5.png" alt="z" style="vertical-align: 0px"/> axis.</li>
</ul>
<p>The way in which <strong>components are arranged</strong> in the IDF is different. Some instruments, such as Offspec, have a component “DetectorBench” that is the parent component of all the detectors. Others don’t have this component. This has to be taken into account when moving detectors.</p>
<p>Some of the instrument IDFs are set up such that detectors are at the correct <strong>position on loading</strong> a run. Some instruments are not be set up to do this yet, so <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> has an option to correct detector positions using another algorithm, <a class="reference internal" href="../algorithms/SpecularReflectionPositionCorrect-v2.html#algm-specularreflectionpositioncorrect"><span class="std std-ref">SpecularReflectionPositionCorrect v2</span></a>. It is important that the detectors are in the correct position in order for Mantid algorithms to produce the correct results, otherwise some calculations (e.g. the conversion from <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/> to <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>) will be wrong. There are plans to try and harmonise the IDF’s as much as possible.</p>
</div>
</div>
<div class="section" id="mantid">
<h2><a class="toc-backref" href="#id17">Mantid</a><a class="headerlink" href="#mantid" title="Permalink to this headline">¶</a></h2>
<div class="section" id="algorithms">
<h3><a class="toc-backref" href="#id18">Algorithms</a><a class="headerlink" href="#algorithms" title="Permalink to this headline">¶</a></h3>
<p>The main reduction algorithm is <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a>. This sets a lot of the input properties from defaults in the instrument parameter file. It must also populate some input properties so that they can be updated in the GUI (this has to work both for single period datasets and multi period datasets). This algorithm is a wrapper around <a class="reference internal" href="../algorithms/ReflectometryReductionOne-v2.html#algm-reflectometryreductionone"><span class="std std-ref">ReflectometryReductionOne v2</span></a>, which actually does the work. This arrangement seems to be unusual in Mantid.</p>
<p><a class="reference internal" href="../algorithms/SpecularReflectionPositionCorrect-v2.html#algm-specularreflectionpositioncorrect"><span class="std std-ref">SpecularReflectionPositionCorrect v2</span></a> can be used to correct detector positions if they are not at the correct position when loaded. It can shift them vertically or rotate then around the sample position. This algorithm is called as a child by <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a>.</p>
<p>Related to <a class="reference internal" href="../algorithms/ReflectometryReductionOne-v2.html#algm-reflectometryreductionone"><span class="std std-ref">ReflectometryReductionOne v2</span></a> and <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> we also have <a class="reference internal" href="../algorithms/CreateTransmissionWorkspace-v2.html#algm-createtransmissionworkspace"><span class="std std-ref">CreateTransmissionWorkspace v2</span></a> and <a class="reference internal" href="../algorithms/CreateTransmissionWorkspaceAuto-v2.html#algm-createtransmissionworkspaceauto"><span class="std std-ref">CreateTransmissionWorkspaceAuto v2</span></a>, which converts transmission run(s) to wavelength and stitches transmission runs together when two are provided.</p>
<p><a class="reference internal" href="../algorithms/Stitch1DMany-v1.html#algm-stitch1dmany"><span class="std std-ref">Stitch1DMany v1</span></a> does the work to stitch multiple runs together, which is quite a complicated operation.</p>
<p><a class="reference internal" href="../algorithms/ConvertToReflectometryQ-v1.html#algm-converttoreflectometryq"><span class="std std-ref">ConvertToReflectometryQ v1</span></a>: This algorithm is generally used to examine off-specular scattering. The input is a workspace in wavelength, and the output is a <img class="math" src="../_images/math/022bf5f3e6e76c5e7ae97d988b44a8ae5796124a.png" alt="QxQz" style="vertical-align: -4px"/> map (or <img class="math" src="../_images/math/cc5b84a1fee3bfe840a72f16343e5584361e94ae.png" alt="KiKf" style="vertical-align: -4px"/> or <img class="math" src="../_images/math/5739d78fbf93c6a21c5fb2041b4ba5941874437a.png" alt="PiPf" style="vertical-align: -4px"/>). It doesn’t normalize by monitors, transmission run, etc (in fact, scientists typically run <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> prior to running this algorithm, so that they obtain the normalized intensity). This algorithm is generally used to examine off-specular scattering.</p>
</div>
<div class="section" id="interface">
<h3><a class="toc-backref" href="#id19">Interface</a><a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../interfaces/ISIS Reflectometry.html#interface-isis-refl"><span class="std std-ref">ISIS Reflectometry Interface</span></a> provides a graphical front-end for the <a class="reference internal" href="../algorithms/ReflectometryReductionOneAuto-v3.html#algm-reflectometryreductiononeauto"><span class="std std-ref">ReflectometryReductionOneAuto v3</span></a> algorithm. It includes the facility to:</p>
<ul class="simple">
<li>batch process all runs from an experiment (or a selected subset);</li>
<li>apply default settings, which can be overridden on a per-run basis;</li>
<li>process data in histogram or event modes;</li>
<li>output processing steps to an IPython notebook; and</li>
<li>output reduced data to ASCII files.</li>
</ul>
<p>See the <a class="reference internal" href="../interfaces/ISIS Reflectometry.html#interface-isis-refl"><span class="std std-ref">full documentation</span></a> for more information.</p>
<p>Note that the main table on the <code class="docutils literal"><span class="pre">Runs</span></code> tab is designed to be a <a class="reference internal" href="../interfaces/DataProcessorWidget.html#dataprocessorwidget-developersguide-ref"><span class="std std-ref">generic batch-processing table</span></a> which can be customised and re-used for other technique areas in their own interfaces. The table and interface are both tested in unit tests using gmock. The interface uses the MVP pattern at different levels and communication happens between presenters.</p>
<p>Note that the current interface replaces the <code class="docutils literal"><span class="pre">ISIS</span> <span class="pre">Reflectometry</span> <span class="pre">(Old)</span></code> interface, which was written in Python and had several limitations, including lack of automated testing. The old interface will shortly be removed.</p>
<p><strong>Category</strong>: <a class="reference external" href="categories/Techniques.html">Techniques</a></p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ISISPowder-Workflows-v1.html" title="Previous Chapter: ISIS Powder Diffraction Scripts Workflow Diagrams"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ISIS Powder D...</span>
    </a>
  </li>
  <li>
    <a href="SANS-Toml-v1.html" title="Next Chapter: SANS TOML Files"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SANS TOML Files &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2020-09-29.<br/>
    </p>
  </div>
</footer>
  </body>
</html>