<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TransformToIqt v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transpose v1" href="Transpose-v1.html" />
    <link rel="prev" title="TransformMD v1" href="TransformMD-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="transformtoiqt-v1">
<span id="algm-transformtoiqt"></span><span id="algm-transformtoiqt-v1"></span><h1>TransformToIqt v1<a class="headerlink" href="#transformtoiqt-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/TransformToIqt-v1_dlg.png"><img alt="../_images/TransformToIqt-v1_dlg.png" class="screenshot" src="../_images/TransformToIqt-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>TransformToIqt</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#theory" id="id5">Theory</a></li>
<li><a class="reference internal" href="#references" id="id6">References</a></li>
<li><a class="reference internal" href="#workflow" id="id7">Workflow</a></li>
<li><a class="reference internal" href="#usage" id="id8">Usage</a></li>
<li><a class="reference internal" href="#source" id="id9">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Transforms an inelastic reduction to I(Q, t)</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="4%" />
<col width="21%" />
<col width="6%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SampleWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Name for the sample workspace.</td>
</tr>
<tr class="row-odd"><td>ResolutionWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Name for the resolution workspace.</td>
</tr>
<tr class="row-even"><td>EnergyMin</td>
<td>Input</td>
<td>number</td>
<td>-0.5</td>
<td>Minimum energy for fit. Default=-0.5</td>
</tr>
<tr class="row-odd"><td>EnergyMax</td>
<td>Input</td>
<td>number</td>
<td>0.5</td>
<td>Maximum energy for fit. Default=0.5</td>
</tr>
<tr class="row-even"><td>BinReductionFactor</td>
<td>Input</td>
<td>number</td>
<td>10</td>
<td>Decrease total number of spectrum points by this ratio through merging of intensities from neighbouring bins. Default=1</td>
</tr>
<tr class="row-odd"><td>NumberOfIterations</td>
<td>Input</td>
<td>number</td>
<td>50</td>
<td>Number of randomised simulations for monte-carlo error calculation.</td>
</tr>
<tr class="row-even"><td>SeedValue</td>
<td>Input</td>
<td>number</td>
<td>89631139</td>
<td>Seed for pseudo-random number generator in monte-carlo error calculation.</td>
</tr>
<tr class="row-odd"><td>ParameterWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td>&#160;</td>
<td>Table workspace for saving TransformToIqt properties</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>Output workspace</td>
</tr>
<tr class="row-odd"><td>DryRun</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Only calculate and output the parameters</td>
</tr>
<tr class="row-even"><td>CalculateErrors</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Calculate monte-carlo errors.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm transforms either a reduced (<em>_red</em>) or S(Q, w) (<em>_sqw</em>)
workspace to a I(Q, t) workspace.</p>
</div>
<div class="section" id="theory">
<h2><a class="toc-backref" href="#id5">Theory</a><a class="headerlink" href="#theory" title="Permalink to this headline">¶</a></h2>
<p>The measured spectrum <span class="math">\(I(Q, \omega)\)</span> is proportional to the four
dimensional convolution of the scattering law <span class="math">\(S(Q, \omega)\)</span> with the
resolution function <span class="math">\(R(Q, \omega)\)</span> of the spectrometer via <span class="math">\(I(Q,
\omega) = S(Q, \omega) ⊗ R(Q, \omega)\)</span>, so <span class="math">\(S(Q, \omega)\)</span> can be obtained,
in principle, by a deconvolution in <span class="math">\(Q\)</span> and <span class="math">\(\omega\)</span>. The method
employed here is based on the Fourier Transform (FT) technique [6,7]. On Fourier
transforming the equation becomes <span class="math">\(I(Q, t) = S(Q, t) x R(Q, t)\)</span> where the
convolution in <span class="math">\(\omega\)</span>-space is replaced by a simple multiplication in
<span class="math">\(t\)</span>-space. The intermediate scattering law <span class="math">\(I(Q, t)\)</span> is then
obtained by simple division and the scattering law <span class="math">\(S(Q, \omega)\)</span> itself
can be obtained by back transformation. The latter however is full of pitfalls
for the unwary. The advantage of this technique over that of a fitting procedure
such as SWIFT is that a functional form for <span class="math">\(I(Q, t)\)</span> does not have to be
assumed. On IRIS the resolution function is close to a Lorentzian and the
scattering law is often in the form of one or more Lorentzians. The FT of a
Lorentzian is a decaying exponential, <span class="math">\(exp(-\alpha t)\)</span> , so that plots of
<span class="math">\(ln(I(Q, t))\)</span> against t would be straight lines thus making interpretation
easier.</p>
<p>In general, the origin in energy for the sample run and the resolution run need
not necessarily be the same or indeed be exactly zero in the conversion of the
RAW data from time-of-flight to energy transfer. This will depend, for example,
on the sample and vanadium shapes and positions and whether the analyser
temperature has changed between the runs. The procedure takes this into account
automatically, without using an arbitrary fitting procedure, in the following
way. From the general properties of the FT, the transform of an offset
Lorentzian has the form <span class="math">\((cos(\omega_{0}t) + isin(\omega_{0}t))exp(-\Gamma
t)\)</span> , thus taking the modulus produces the exponential <span class="math">\(exp(-\Gamma t)\)</span>
which is the required function. If this is carried out for both sample and
resolution, the difference in the energy origin is automatically removed. The
results of this procedure should however be treated with some caution when
applied to more complicated spectra in which it is possible for <span class="math">\(I(Q, t)\)</span>
to become negative, for example, when inelastic side peaks are comparable in
height to the elastic peak.</p>
<p>The interpretation of the data must also take into account the propagation of
statistical errors (counting statistics) in the measured data as discussed by
Wild et al [1]. If the count in channel <span class="math">\(k\)</span> is <span class="math">\(X_{k}\)</span> , then
<span class="math">\(X_{k}=&lt;X_{k}&gt;+\Delta X_{k}\)</span> where <span class="math">\(&lt;X_{k}&gt;\)</span> is the mean value and
<span class="math">\(\Delta X_{k}\)</span> the error. The standard deviation for channel <span class="math">\(k\)</span> is
<span class="math">\(\sigma k\)</span> <span class="math">\(2=&lt;\Delta X_{k}&gt;2\)</span> which is assumed to be given by
<span class="math">\(\sigma k=&lt;X_{k}&gt;\)</span>. The FT of <span class="math">\(X_{k}\)</span> is defined by
<span class="math">\(X_{j}=&lt;X_{j}&gt;+\Delta X_{j}\)</span> and the real and imaginary parts denoted by
<span class="math">\(X_{j} I\)</span> and <span class="math">\(X_{j} I\)</span> respectively. The standard deviations on
<span class="math">\(X_{j}\)</span> are then given by <span class="math">\(\sigma 2(X_{j} R)=1/2 X0 R + 1/2 X2j R\)</span>
and <span class="math">\(\sigma 2(X_{j} I)=1/2 X0 I - 1/2 X2j I\)</span>.</p>
<p>Note that <span class="math">\(\sigma 2(X_{0} R) = X_{0} R\)</span> and from the properties of FT
<span class="math">\(X_{0} R = X_{k}\)</span>.  Thus the standard deviation of the first coefficient
of the FT is the square root of the integrated intensity of the spectrum. In
practice, apart from the first few coefficients, the error is nearly constant
and close to <span class="math">\(X_{0} R\)</span>.  A further point to note is that the errors make
the imaginary part of <span class="math">\(I(Q, t)\)</span> non-zero and that, although these will be
distributed about zero, on taking the modulus of <span class="math">\(I(Q, t)\)</span>, they become
positive at all times and are distributed about a non-zero positive value. When
<span class="math">\(I(Q, t)\)</span> is plotted on a log-scale the size of the error bars increases
with time (coefficient) and for the resolution will reach a point where the
error on a coefficient is comparable to its value. This region must therefore be
treated with caution. For a true deconvolution by back transforming, the data
would be truncated to remove this poor region before back transforming. If the
truncation is severe the back transform may contain added ripples, so an
automatic back transform is not provided.</p>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id6">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>U P Wild, R Holzwarth &amp; H P Good, <a class="reference external" href="http://dx.doi.org/10.1063/1.1134962">Rev Sci Instr 48 1621 (1977)</a></li>
</ol>
</div>
<div class="section" id="workflow">
<h2><a class="toc-backref" href="#id7">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/TransformToIqt-v1_wkflw.svg" src="../_images/TransformToIqt-v1_wkflw.svg" /></div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id8">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - TransformToIqt with IRIS data.</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;irs26176_graphite002_red.nxs&#39;</span><span class="p">)</span>
<span class="n">can</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;irs26173_graphite002_red.nxs&#39;</span><span class="p">)</span>

<span class="n">params</span><span class="p">,</span> <span class="n">iqt</span> <span class="o">=</span> <span class="n">TransformToIqt</span><span class="p">(</span><span class="n">SampleWorkspace</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
                             <span class="n">ResolutionWorkspace</span><span class="o">=</span><span class="n">can</span><span class="p">,</span>
                             <span class="n">EnergyMin</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span>
                             <span class="n">EnergyMax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                             <span class="n">BinReductionFactor</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of output bins: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s1">&#39;SampleOutputBins&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resolution bins: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s1">&#39;ResolutionBins&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Number of output bins: 172
Resolution bins: 6
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a> | <a class="reference external" href="categories/Workflow/MIDAS.html">Workflow\MIDAS</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id9">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/bf806d7983f959aff3ce91819ad740a97f95ef50/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/TransformToIqt.py">TransformToIqt.py</a> <em>(last modified: 2020-03-27)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="TransformMD-v1.html" title="Previous Chapter: TransformMD v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; TransformMD v1</span>
    </a>
  </li>
  <li>
    <a href="Transpose-v1.html" title="Next Chapter: Transpose v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Transpose v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-09-29.<br/>
    </p>
  </div>
</footer>
  </body>
</html>