<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Instrument Viewer Widget</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IPython Console" href="ipythonconsole.html" />
    <link rel="prev" title="Algorithm Toolbox" href="algorithmtoolbox.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="instrument-viewer-widget">
<span id="instrumentviewer"></span><h1>Instrument Viewer Widget<a class="headerlink" href="#instrument-viewer-widget" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Mantid visualisation system allows users to view the geometry of an instrument and also select and query individual detectors.
An instrument is always shown in the context of a workspace containing data recorded with this instrument.
The detectors are coloured according to the data in the corresponding spectra of the workspace.
The user can select individual detectors by clicking on them and request to see the data recorded by this detector as a table or a graph.
The instrument view also allows users to see close-ups of any component.</p>
</div>
<div class="section" id="instrument-view-pane">
<h2>Instrument View Pane<a class="headerlink" href="#instrument-view-pane" title="Permalink to this headline">¶</a></h2>
<p>The instrument view window can be obtained by right clicking on the workspace of interest and selecting “Show instrument”.
A 2D projection of the detector arrangement will be visible with each detector pixel color coded depending on the integrated number of counts in its corresponding spectrum, as in the image below.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/Overview.png"><img alt="../_images/Overview.png" src="../_images/Overview.png" style="width: 635px;" /></a>
</div>
<p>It is possible to alter the view of the instrument by holding down, either, mouse button and moving (dragging) it within the window.
There are other mouse and key board controls and these are listed at the bottom of the instrument view window.
There are other ways to change the view, find and get information about components and these are described in the next sections.</p>
<p>The control panel of the instrument view has four tabs: Render, Pick, Mask, and Instrument Tree.</p>
</div>
<div class="section" id="render-tab">
<h2>Render Tab<a class="headerlink" href="#render-tab" title="Permalink to this headline">¶</a></h2>
<p>The Render tab contains controls for managing the on-screen appearance of the instrument and collected data.
The top-most combo-box control allows the user to select the way the instrument is projected onto the screen.
The default setting is “Full 3D” which gives a 3D view of the instrument in an orthogonal projection.
The other options are “unwrapped views” projecting the instrument onto a curved surface and then unwrapping it onto the screen.
There is a choice between cylinders and spheres.
The unwrapped (or flat) views allow zooming by selecting a rectangular region with the mouse (left click and drag).
Right mouse click undoes the last zoom.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/RenderTab.png"><img alt="../_images/RenderTab.png" src="../_images/RenderTab.png" style="width: 635px;" /></a>
</div>
<p>The next control is Axis View, visible only in the 3D mode, which resets the view so that the instrument is fully visible and the specified axis is perpendicular to the screen.</p>
<p>The Display Settings button controls the appearance of the instrument in the view.
It’s worth mentioning the “Use OpenGL” option.
It toggles between two display modes of a flat view: the one that uses OpenGL to render the instrument and the one that doesn’t.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/DisplaySettings1.png"><img alt="../_images/DisplaySettings1.png" src="../_images/DisplaySettings1.png" style="width: 635px;" /></a>
</div>
<p>This option can be useful if the instrument is viewed over a slow network connection for example.</p>
<p>The “Save image” button allows the image to be save into a file.</p>
<p>The colour bar axis below maps the colours of the detectors to the integrated number of counts in their spectra.
The axis also defines the minimum and maximum values which can be edited using the text boxes below and above the colour bar and also by clicking on the bar and dragging in the vertical direction.
Clicking and dragging the upper half of the bar changes the maximum while the lower half modifies the minimum.
Mantid comes with a number of color map files and these can be loaded by selecting the “Display Settings”-&gt;”Color Map”.</p>
</div>
<div class="section" id="pick-tab">
<h2>Pick Tab<a class="headerlink" href="#pick-tab" title="Permalink to this headline">¶</a></h2>
<p>Pick Tab is for displaying information about detectors of an instruments and data collected by them. The parameters defined for each component may be hidden if the attribute ‘visible’ is specified as false. You can also manipulate the peak markers in this tab.
At the top of the tab there is a tool bar for switching between different interactive tools.
The text box below the tool bar show textual information about selected detector: its name, ID, index in the workspace, cartesian coordinates of the detector (xyz) in metres, spherical coordinates of the detector (rtp, which stands for r, theta, and phi) where the distance is in metres and the angles are in degrees, the full path of the detector in the instrument tree, integrated counts, and the units of the X vector in the underlying workspace.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/PickTab.png"><img alt="../_images/PickTab.png" src="../_images/PickTab.png" style="width: 635px;" /></a>
</div>
<p>Documentation will be updated as additional features are added.</p>
</div>
<div class="section" id="draw-tab">
<h2>Draw Tab<a class="headerlink" href="#draw-tab" title="Permalink to this headline">¶</a></h2>
<p>The Draw tab contains tools for creating and editing geometrical shapes which can be used for selecting regions of interest (ROI), masking or grouping detectors.
The tab contains a mini toolbar, a shape property browser and a set of buttons to use the shapes.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/DrawTab.png"><img alt="../_images/DrawTab.png" src="../_images/DrawTab.png" style="width: 635px;" /></a>
</div>
<p>More doc will be migrated from MantidPlot as new features being consolidated.</p>
</div>
<div class="section" id="python-control">
<h2>Python Control<a class="headerlink" href="#python-control" title="Permalink to this headline">¶</a></h2>
<p>Many aspects of the instrument view can be controlled from Python.
To use the Python interface for InstrumentViewer, use the following code to import the necessary libraries</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mantidqt.widgets.instrumentview.api</span> <span class="kn">import</span> <span class="n">get_instrumentview</span>
</pre></div>
</div>
<p>then load the Nexus data into a workspace</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ws</span> <span class="o">=</span> <span class="n">LoadEventNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">nexus_path</span><span class="p">,</span> <span class="n">NumberOfBins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we are done with the necesary preparation, time to get a handle to the window itself (this will create a fresh window)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myiv</span> <span class="o">=</span> <span class="n">get_instrumentview</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">show_view</span><span class="p">()</span>
</pre></div>
</div>
<p>To set the integration range (time-of-flight), use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myiv</span><span class="o">.</span><span class="n">set_bin_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>To switch to a different tab, use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myiv</span><span class="o">.</span><span class="n">select_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># TabIndex</span>
                    <span class="c1"># 0: Render, 1: Pick, 2: Draw, 3: Instrument</span>
</pre></div>
</div>
<p>To select the projection type (surface type), use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myiv</span><span class="o">.</span><span class="n">select_surface_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># SurfaceTypeIndex</span>
                            <span class="c1"># 0: FULL3D</span>
                            <span class="c1"># 1: CYLINDRICAL_X, 2: CYLINDRICAL_Y, 3: CYLINDRICAL_Z,</span>
                            <span class="c1"># 4: SPHERICAL_X,   5: SPHERICAL_Y,   6: SPHERICAL_Z,</span>
                            <span class="c1"># 7: SideBySide</span>
</pre></div>
</div>
<p>To switch to a different viewing axis, use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myiv</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span><span class="s2">&quot;Y+&quot;</span><span class="p">)</span>  <span class="c1"># (Z+, Z-, Y+, Y-, X+, X-)</span>
</pre></div>
</div>
<p>To select the range for the data (intensity, color map legend), use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">myiv</span><span class="o">.</span><span class="n">set_auto_scaling</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>         <span class="c1"># need to turn off autoscaling before changing anything</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>          <span class="c1"># minimum value for the colorbar</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>       <span class="c1"># maximum value for the colorbar</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>  <span class="c1"># full range of the colorbar</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_scale</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>              <span class="c1"># color legend scale type</span>
                                     <span class="c1"># 0: Linear, 1: SymmetricLog10, 2: Power</span>
</pre></div>
</div>
<p>To start the app outside <code class="docutils literal"><span class="pre">MantidWorkbench</span></code>, use the following code snippet as a starting point</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mantidqt.gui_helper</span> <span class="kn">import</span> <span class="n">get_qapplication</span>
<span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="n">LoadEventNexus</span>
<span class="kn">from</span> <span class="nn">mantidqt.widgets.instrumentview.api</span> <span class="kn">import</span> <span class="n">get_instrumentview</span>
<span class="c1"># check if launched within Workbench, if not return a parent QApp for this widget</span>
<span class="c1"># to attach to</span>
<span class="n">app</span><span class="p">,</span> <span class="n">within_mantid</span> <span class="o">=</span> <span class="n">get_qapplication</span><span class="p">()</span>
<span class="c1"># prepare a valid workspace from any nexus file</span>
<span class="n">nexus_path</span> <span class="o">=</span> <span class="s1">&#39;/SNS/EQSANS/shared/sans-backend/data/new/ornl/sans/hfir/gpsans/CG2_9177.nxs.h5&#39;</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">LoadEventNexus</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">nexus_path</span><span class="p">,</span> <span class="n">NumberOfBins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># setup the instrument view</span>
<span class="n">myiv</span> <span class="o">=</span> <span class="n">get_instrumentview</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
<span class="c1"># to open the app</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">show_view</span><span class="p">()</span>
<span class="c1"># select tab</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">select_tab</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># select projection (surface type)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">select_surface_type</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># select axis</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span><span class="s2">&quot;Z-&quot;</span><span class="p">)</span>
<span class="c1"># select the range for the data (intensity, color map legend)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_auto_scaling</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_max</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_color_scale</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># select the integration range (time of flight)</span>
<span class="n">myiv</span><span class="o">.</span><span class="n">set_bin_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="c1"># if running as a standalone app, start the QApp</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">within_mantid</span><span class="p">:</span>
  <span class="n">myiv</span><span class="o">.</span><span class="n">reset_view</span><span class="p">()</span>
  <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
</pre></div>
</div>
<p>NOTE: If the instrument view app is launched outside <code class="docutils literal"><span class="pre">MantidWorkbench</span></code> on RHEL_7, the user need click on the viewing widget to get it rendered properly.
For other OS, the instrument viewing widget should display the instrument properly upon launching.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="algorithmtoolbox.html" title="Previous Chapter: Algorithm Toolbox"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Algorithm Toolbox</span>
    </a>
  </li>
  <li>
    <a href="ipythonconsole.html" title="Next Chapter: IPython Console"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">IPython Console &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-09-29.<br/>
    </p>
  </div>
</footer>
  </body>
</html>