<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SortHKL v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="SortPeaksWorkspace v1" href="SortPeaksWorkspace-v1.html" />
    <link rel="prev" title="SortEvents v1" href="SortEvents-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.6</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="sorthkl-v1">
<span id="algm-sorthkl"></span><span id="algm-sorthkl-v1"></span><h1>SortHKL v1<a class="headerlink" href="#sorthkl-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/SortHKL-v1_dlg.png"><img alt="../_images/SortHKL-v1_dlg.png" class="screenshot" src="../_images/SortHKL-v1_dlg.png" style="width: 377px;" /></a>
<p class="caption"><strong>SortHKL</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Sorts a PeaksWorkspace by HKL. Averages intensities using point group.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="1%" />
<col width="1%" />
<col width="3%" />
<col width="1%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>An input PeaksWorkspace with an instrument.</td>
</tr>
<tr class="row-odd"><td>PointGroup</td>
<td>Input</td>
<td>string</td>
<td>-1 (Triclinic)</td>
<td>Which point group applies to this crystal? Allowed values: [&#8216;-1 (Triclinic)&#8217;, &#8216;-3 (Trigonal - Hexagonal)&#8217;, &#8216;-3 r (Trigonal - Rhombohedral)&#8217;, &#8216;-31m (Trigonal - Hexagonal)&#8217;, &#8216;-3m (Trigonal - Hexagonal)&#8217;, &#8216;-3m r (Trigonal - Rhombohedral)&#8217;, &#8216;-3m1 (Trigonal - Hexagonal)&#8217;, &#8216;-4 (Tetragonal)&#8217;, &#8216;-42m (Tetragonal)&#8217;, &#8216;-43m (Cubic)&#8217;, &#8216;-4m2 (Tetragonal)&#8217;, &#8216;-6 (Hexagonal)&#8217;, &#8216;-62m (Hexagonal)&#8217;, &#8216;-6m2 (Hexagonal)&#8217;, &#8216;1 (Triclinic)&#8217;, &#8216;112 (Monoclinic, unique axis c)&#8217;, &#8216;112/m (Monoclinic, unique axis c)&#8217;, &#8216;11m (Monoclinic, unique axis c)&#8217;, &#8216;2 (Monoclinic, unique axis b)&#8217;, &#8216;2/m (Monoclinic, unique axis b)&#8217;, &#8216;222 (Orthorombic)&#8217;, &#8216;23 (Cubic)&#8217;, &#8216;2mm (Orthorombic)&#8217;, &#8216;3 (Trigonal - Hexagonal)&#8217;, &#8216;3 r (Trigonal - Rhombohedral)&#8217;, &#8216;312 (Trigonal - Hexagonal)&#8217;, &#8216;31m (Trigonal - Hexagonal)&#8217;, &#8216;32 (Trigonal - Hexagonal)&#8217;, &#8216;32 r (Trigonal - Rhombohedral)&#8217;, &#8216;321 (Trigonal - Hexagonal)&#8217;, &#8216;3m (Trigonal - Hexagonal)&#8217;, &#8216;3m r (Trigonal - Rhombohedral)&#8217;, &#8216;3m1 (Trigonal - Hexagonal)&#8217;, &#8216;4 (Tetragonal)&#8217;, &#8216;4/m (Tetragonal)&#8217;, &#8216;4/mmm (Tetragonal)&#8217;, &#8216;422 (Tetragonal)&#8217;, &#8216;432 (Cubic)&#8217;, &#8216;4mm (Tetragonal)&#8217;, &#8216;6 (Hexagonal)&#8217;, &#8216;6/m (Hexagonal)&#8217;, &#8216;6/mmm (Hexagonal)&#8217;, &#8216;622 (Hexagonal)&#8217;, &#8216;6mm (Hexagonal)&#8217;, &#8216;m (Monoclinic, unique axis b)&#8217;, &#8216;m-3 (Cubic)&#8217;, &#8216;m-3m (Cubic)&#8217;, &#8216;m2m (Orthorombic)&#8217;, &#8216;mm2 (Orthorombic)&#8217;, &#8216;mmm (Orthorombic)&#8217;]</td>
</tr>
<tr class="row-even"><td>LatticeCentering</td>
<td>Input</td>
<td>string</td>
<td>Primitive</td>
<td>Appropriate lattice centering for the peaks. Allowed values: [&#8216;Primitive&#8217;, &#8216;C-face centred&#8217;, &#8216;A-face centred&#8217;, &#8216;B-face centred&#8217;, &#8216;Body centred&#8217;, &#8216;All-face centred&#8217;, &#8216;Rhombohedrally centred, obverse&#8217;, &#8216;Rhombohedrally centred, reverse&#8217;, &#8216;Hexagonally centred, reverse&#8217;]</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td>&nbsp;</td>
<td>Output PeaksWorkspace</td>
</tr>
<tr class="row-even"><td>OutputChi2</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Chi-square is available as output</td>
</tr>
<tr class="row-odd"><td>StatisticsTable</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>StatisticsTable</td>
<td>An output table workspace for the statistics of the peaks.</td>
</tr>
<tr class="row-even"><td>RowName</td>
<td>Input</td>
<td>string</td>
<td>Overall</td>
<td>name of row</td>
</tr>
<tr class="row-odd"><td>Append</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Append to output table workspace if true. If false, new output table workspace (default).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>SortHKL calculates some data set statistics using the intensities of the peaks in the
supplied input workspace, such as <img class="math" src="../_images/math/1cd628424c3fa25acaad42ed08605e5d96aea6ee.png" alt="R_{merge}" style="vertical-align: -6px"/> and <img class="math" src="../_images/math/baca4ff36f4eb4fdd44786454eb5e8205213f5bd.png" alt="R_{p.i.m.}" style="vertical-align: -6px"/>, (formulas
and references for example <a class="reference external" href="http://strucbio.biologie.uni-konstanz.de/ccp4wiki/index.php/R-factors">here</a>)
but also redundancy and completeness.</p>
<p>At first, the algorithm determines the minimum and maximum <img class="math" src="../_images/math/c86042ffb3d3d357c09df77fee86d0b5ecc0ae02.png" alt="d" style="vertical-align: 0px"/>-value from the
input peaks. Using these limits, the unit cell, centering and point group all possible
unique reflections are calculated, the number of which is <img class="math" src="../_images/math/a416fcba4cda7f6175a69ffb91b596becc706433.png" alt="N_{theor.}" style="vertical-align: -3px"/>.</p>
<p>After removing invalid peaks with <img class="math" src="../_images/math/44eaa7efc93102b6ef20139779e27bd7ee297a9e.png" alt="I \leq 0" style="vertical-align: -3px"/>, <img class="math" src="../_images/math/4cbff4d0f8b43e92b7e20f79f46ff2a5c1e4d932.png" alt="\sigma \leq 0" style="vertical-align: -3px"/> and <img class="math" src="../_images/math/60994c89d90dc6d99191b930fa7bd72eb0f6a114.png" alt="h=k=l=0" style="vertical-align: 0px"/>,
the peaks are assigned to their respective unique reflection so that each theoretically present
reflection may have <img class="math" src="../_images/math/3492c6d4b042ddb93d57b7a5aa9532131d9af611.png" alt="n" style="vertical-align: 0px"/> observations (<img class="math" src="../_images/math/3492c6d4b042ddb93d57b7a5aa9532131d9af611.png" alt="n" style="vertical-align: 0px"/> can be zero). The number of unique reflections
which have at least one observation can be labeled <img class="math" src="../_images/math/1e73483e4b1246fe9b03fc115e80f62a8ed31914.png" alt="N_{unique}" style="vertical-align: -6px"/>. The completeness
is defined as the fraction <img class="math" src="../_images/math/6077f12d1dc1754ed2ae943849f4d9316163fc7a.png" alt="\frac{N_{unique}}{N_{theor.}}" style="vertical-align: -8px"/> and ranges between 0 and 1.
The total number of observations <img class="math" src="../_images/math/d42cdc2a6e57cb9eba2b1cbaef30b4191d30b3a9.png" alt="N_{observed}" style="vertical-align: -3px"/> and <img class="math" src="../_images/math/1e73483e4b1246fe9b03fc115e80f62a8ed31914.png" alt="N_{unique}" style="vertical-align: -6px"/> determine the average
redundancy <img class="math" src="../_images/math/96a4756323013033583dc54148e307b71e0d4f3b.png" alt="\frac{N_{observed}}{N_{unique}}" style="vertical-align: -10px"/> in the data set, which is the average number of
observations for each unique reflection.</p>
<p>The intensities of peaks in each reflection are checked for outliers, which are removed. Outliers
in this context are peaks with an intensity that deviates more than <img class="math" src="../_images/math/84e9ae89ad0d306f7d95aab71ed402d3906048ef.png" alt="3\sigma_{hkl}" style="vertical-align: -3px"/> from the
mean of the reflection, where <img class="math" src="../_images/math/9ecf43d060882a5eb8b4330e6a46be6186164cc5.png" alt="\sigma_{hkl}" style="vertical-align: -3px"/> is the standard deviation of the peak intensities.</p>
<p>The intensities and errors of each peak is set to the mean intensity and sigma of the unique reflection
it belongs to, so that equivalent reflections have the same intensity and error in the output workspace.</p>
<p>Finally, the peaks in the output workspace are sorted by H, K and L.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The following usage example uses data obtained from a trigonal structure. The peaks are loaded and a UB-matrix
is determined. The peaks are transformed to conform with a conventional cell, which has hexagonal metric
and rhombohedral centering:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Load example peak data and find cell</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">r&#39;Peaks5637.integrate&#39;</span><span class="p">)</span>

<span class="n">FindUBUsingFFT</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">MinD</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">MaxD</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">SelectCellWithForm</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">FormNumber</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">OptimizeLatticeForCellType</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span>
                           <span class="n">CellType</span><span class="o">=</span><span class="s">&#39;Hexagonal&#39;</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c"># Run the SortHKL algorithm</span>
<span class="nb">sorted</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">statistics_table</span> <span class="o">=</span> <span class="n">SortHKL</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">PointGroup</span><span class="o">=</span><span class="s">&#39;-3m1 (Trigonal - Hexagonal)&#39;</span><span class="p">,</span>
                                         <span class="n">LatticeCentering</span><span class="o">=</span><span class="s">&#39;Rhombohedrally centred, obverse&#39;</span><span class="p">)</span>

<span class="n">statistics</span> <span class="o">=</span> <span class="n">statistics_table</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Data set statistics:&#39;</span>
<span class="k">print</span> <span class="s">&#39;        Peaks: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sorted</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&#39;       Unique: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;No. of Unique Reflections&#39;</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39; Completeness: {0}%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Data Completeness&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;   Redundancy: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s">&#39;Multiplicity&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Data set statistics:
        Peaks: 408
       Unique: 337
 Completeness: 9.11%
   Redundancy: 1.21
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Crystal/Peaks.html">Crystal\Peaks</a> | <a class="reference external" href="categories/DataHandling/Text.html">DataHandling\Text</a> | <a class="reference external" href="categories/Utility/Sorting.html">Utility\Sorting</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/928349c406ed0cdd1d18d429ed0a1a931814016c/Framework/Crystal/src/SortHKL.cpp">SortHKL.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/928349c406ed0cdd1d18d429ed0a1a931814016c/Framework/Crystal/inc/MantidCrystal/SortHKL.h">SortHKL.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SortEvents-v1.html" title="Previous Chapter: SortEvents v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; SortEvents v1</span>
    </a>
  </li>
  <li>
    <a href="SortPeaksWorkspace-v1.html" title="Next Chapter: SortPeaksWorkspace v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">SortPeaksWorkspa... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>