<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MergeCalFiles v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="MergeLogs v1" href="MergeLogs-v1.html" />
    <link rel="prev" title="MedianDetectorTest v1" href="MedianDetectorTest-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.6</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="mergecalfiles-v1">
<span id="algm-mergecalfiles"></span><span id="algm-mergecalfiles-v1"></span><h1>MergeCalFiles v1<a class="headerlink" href="#mergecalfiles-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/MergeCalFiles-v1_dlg.png"><img alt="../_images/MergeCalFiles-v1_dlg.png" class="screenshot" src="../_images/MergeCalFiles-v1_dlg.png" style="width: 305px;" /></a>
<p class="caption"><strong>MergeCalFiles</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Combines the data from two Cal Files.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="5%" />
<col width="6%" />
<col width="9%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>UpdateFile</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The cal file containing the updates to merge into another file. Allowed values: [&#8216;cal&#8217;]</td>
</tr>
<tr class="row-odd"><td>MasterFile</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The master file to be altered, the file must be sorted by UDET. Allowed values: [&#8216;cal&#8217;]</td>
</tr>
<tr class="row-even"><td>OutputFile</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The file to contain the results. Allowed values: [&#8216;cal&#8217;]</td>
</tr>
<tr class="row-odd"><td>MergeOffsets</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If True, the offsets from file1 will be merged to the master file. Default: False</td>
</tr>
<tr class="row-even"><td>MergeSelections</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If True, the selections from file1 will be merged to the master file. Default: False</td>
</tr>
<tr class="row-odd"><td>MergeGroups</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If True, the Groups from file1 will be merged to the master file. Default: False</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Combines the data contained in two cal files, based on the selections
offsets, selections and groups can be merged. The matching rows are
determined by UDET. Any unmatched records are added at the end of the
file.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Merging and appending files</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="c">#find a suitable directory to save the files</span>
<span class="n">file_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&quot;defaultsave.directory&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span>
    <span class="c">#use the users home directory if default save is not set</span>
    <span class="n">file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">writeCalFile</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">num_dets</span><span class="p">,</span><span class="n">inc_group</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inc_offset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inc_selected</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span><span class="n">file_name</span><span class="o">+</span><span class="s">&quot;.cal&quot;</span><span class="p">)</span>
    <span class="c">#write the cal file out</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dets</span><span class="p">):</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="se">\t</span><span class="si">%i</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%i</span><span class="se">\t</span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">line_no</span><span class="p">,</span>
             <span class="n">line_no</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span>
             <span class="p">(</span><span class="n">line_no</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">inc_offset</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
             <span class="p">(</span><span class="n">line_no</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">inc_selected</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
             <span class="p">(</span><span class="n">line_no</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">inc_group</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">file_path</span>

<span class="n">calFile_master</span> <span class="o">=</span> <span class="n">writeCalFile</span><span class="p">(</span><span class="s">&quot;masterCal&quot;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">calFile_updates</span> <span class="o">=</span> <span class="n">writeCalFile</span><span class="p">(</span><span class="s">&quot;updateCal&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">inc_group</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inc_offset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inc_selected</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span><span class="s">&quot;output.cal&quot;</span><span class="p">)</span>

<span class="n">MergeCalFiles</span><span class="p">(</span>
    <span class="n">UpdateFile</span> <span class="o">=</span> <span class="n">calFile_updates</span><span class="p">,</span>
    <span class="n">MasterFile</span> <span class="o">=</span> <span class="n">calFile_master</span><span class="p">,</span>
    <span class="n">OutputFile</span> <span class="o">=</span> <span class="n">output_file</span><span class="p">,</span>
    <span class="n">MergeOffsets</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">MergeSelections</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
    <span class="n">MergeGroups</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

<span class="c">#Load and print the resulting file</span>
<span class="k">print</span> <span class="s">&quot;The result file has been updated with 0 for group, select and offset</span><span class="se">\n</span><span class="s">where the detector id&#39;s match&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

<span class="c">#cleanup</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">calFile_master</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">calFile_updates</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The result file has been updated with 0 for group, select and offset
where the detector id&#39;s match
        0             100       0.0000000        0        1
        1             101       0.0000000        0        1
        2             102       0.0000000        0        1
        3             103       0.0030000        1        0
        4             104       0.0040000        0        1
        5             105       0.0050000        1        2
</pre></div>
</div>
<p><strong>Example - Appending files</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="c">#find a suitable directory to save the files</span>
<span class="n">file_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">&quot;defaultsave.directory&quot;</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_dir</span><span class="p">):</span>
    <span class="c">#use the users home directory if default save is not set</span>
    <span class="n">file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">writeCalFile</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="n">num_dets</span><span class="p">,</span><span class="n">inc_group</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inc_offset</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">inc_selected</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span><span class="n">file_name</span><span class="o">+</span><span class="s">&quot;.cal&quot;</span><span class="p">)</span>
    <span class="c">#write the cal file out</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_dets</span><span class="p">):</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="se">\t</span><span class="si">%i</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%i</span><span class="se">\t</span><span class="si">%i</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">line_no</span><span class="p">,</span>
             <span class="n">line_no</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span>
             <span class="p">(</span><span class="n">line_no</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="k">if</span> <span class="n">inc_offset</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">,</span>
             <span class="p">(</span><span class="n">line_no</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">inc_selected</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
             <span class="p">(</span><span class="n">line_no</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="k">if</span> <span class="n">inc_group</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">file_path</span>

<span class="n">calFile_master</span> <span class="o">=</span> <span class="n">writeCalFile</span><span class="p">(</span><span class="s">&quot;masterCal&quot;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">calFile_updates</span> <span class="o">=</span> <span class="n">writeCalFile</span><span class="p">(</span><span class="s">&quot;updateCal&quot;</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">inc_group</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inc_offset</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inc_selected</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_dir</span><span class="p">,</span><span class="s">&quot;output.cal&quot;</span><span class="p">)</span>

<span class="n">MergeCalFiles</span><span class="p">(</span>
    <span class="n">UpdateFile</span> <span class="o">=</span> <span class="n">calFile_updates</span><span class="p">,</span>
    <span class="n">MasterFile</span> <span class="o">=</span> <span class="n">calFile_master</span><span class="p">,</span>
    <span class="n">OutputFile</span> <span class="o">=</span> <span class="n">output_file</span><span class="p">,</span>
    <span class="n">MergeOffsets</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">MergeSelections</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">MergeGroups</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="c">#Load and print the resulting file</span>
<span class="k">print</span> <span class="s">&quot;Any additional rows in the update file will be added,</span><span class="se">\n</span><span class="s">set the Merge options to False if you don&#39;t want to affect existing values&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="k">print</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

<span class="c">#cleanup</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">calFile_master</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">calFile_updates</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Any additional rows in the update file will be added,
set the Merge options to False if you don&#39;t want to affect existing values
        0             100       0.0000000        0        0
        1             101       0.0010000        1        1
        2             102       0.0020000        0        2
        3             103       0.0030000        1        0
        4             104       0.0040000        0        1
        5             105       0.0050000        1        2
        6             106       0.0000000        0        1
        7             107       0.0000000        0        1
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/DataHandling/Text.html">DataHandling\Text</a> | <a class="reference external" href="categories/Diffraction/DataHandling/CalFiles.html">Diffraction\DataHandling\CalFiles</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/928349c406ed0cdd1d18d429ed0a1a931814016c/Framework/PythonInterface/plugins/algorithms/MergeCalFiles.py">MergeCalFiles.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="MedianDetectorTest-v1.html" title="Previous Chapter: MedianDetectorTest v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; MedianDetectorTe...</span>
    </a>
  </li>
  <li>
    <a href="MergeLogs-v1.html" title="Next Chapter: MergeLogs v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">MergeLogs v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>