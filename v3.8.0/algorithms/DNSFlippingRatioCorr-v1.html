<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DNSFlippingRatioCorr v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DNSMergeRuns v1" href="DNSMergeRuns-v1.html" />
    <link rel="prev" title="DNSComputeDetEffCorrCoefs v1" href="DNSComputeDetEffCorrCoefs-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="dnsflippingratiocorr-v1">
<span id="algm-dnsflippingratiocorr"></span><span id="algm-dnsflippingratiocorr-v1"></span><h1>DNSFlippingRatioCorr v1<a class="headerlink" href="#dnsflippingratiocorr-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DNSFlippingRatioCorr-v1_dlg.png"><img alt="../_images/DNSFlippingRatioCorr-v1_dlg.png" class="screenshot" src="../_images/DNSFlippingRatioCorr-v1_dlg.png" style="width: 277px;" /></a>
<p class="caption"><strong>DNSFlippingRatioCorr</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#valid-input-workspaces" id="id4">Valid input workspaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Performs flipping ratio correction on a given dataset using the NiCr data.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="5%" />
<col width="29%" />
<col width="9%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SFDataWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with spin-flip experimental data from sample.</td>
</tr>
<tr class="row-odd"><td>NSFDataWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with non spin-flip experimental data from sample.</td>
</tr>
<tr class="row-even"><td>SFNiCrWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with spin-flip NiCr data.</td>
</tr>
<tr class="row-odd"><td>NSFNiCrWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with non spin-flip NiCr data.</td>
</tr>
<tr class="row-even"><td>SFBkgrWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with spin-flip background for NiCr.</td>
</tr>
<tr class="row-odd"><td>NSFBkgrWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with non spin-flip background for NiCr.</td>
</tr>
<tr class="row-even"><td>SFOutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace to save the corrected spin-flip data.</td>
</tr>
<tr class="row-odd"><td>NSFOutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace to save the corrected non spin-flip data.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It might get changed or even
removed without a notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm applies flipping ratio correction to a given data workspaces. As a result, following workspaces will be created:</p>
<ul class="simple">
<li>output workspace with corrected spin-flip data. Sample logs will be copied from the data spin-flip workspace.</li>
<li>output workspace with corrected non-spin-flip data. Sample logs will be copied from the data non-spin-flip workspace.</li>
</ul>
<p>Flipping ratio correction is performed using the measurements of <img class="math" src="../_images/math/f427189fd47595f37a4d09e9aa0d537e10187354.png" alt="Ni_{0.89}\,Cr_{0.11}" style="vertical-align: -4px"/> standard sample (hereafter NiCr). Background for NiCr must be also measured and provided to the algorithm as an input. Both, spin-flip anf non-spin-flip measurements are required. This algorithm performs the flipping ratio correction according to J. Appl. Cryst. 42, 69-84, 2009. Calculations are made in a following steps:</p>
<ol class="arabic">
<li><p class="first">Subtract Background from NiCr:</p>
<p><img class="math" src="../_images/math/049f39aa833d1aebe0f916729ef6fda0720da3e9.png" alt="N^{SF,\,NSF}_i = (N^{SF,\,NSF}_i)_{raw} - (B^{SF,\,NSF}_i)" style="vertical-align: -5px"/></p>
<p>The <a class="reference internal" href="Minus-v1.html#algm-minus"><em>Minus v1</em></a> algorithm is used for this step. In the case of negative result, the error message will be produced and the algorithm terminates.</p>
</li>
<li><p class="first">Calculate the correction coefficients:</p>
<p><img class="math" src="../_images/math/f6bf0bef492a1ad5cd2535e4649850cd812854e2.png" alt="k_i = \frac{N^{NSF}_i}{N^{SF}_i} - 1" style="vertical-align: -11px"/></p>
<p>The <a class="reference internal" href="Divide-v1.html#algm-divide"><em>Divide v1</em></a> algorithm is used for this step.</p>
</li>
<li><p class="first">Apply correction to the data:</p>
<p><img class="math" src="../_images/math/6b453b817a93e831e12888d21e81374d19aa2fcb.png" alt="(I^{NSF}_i)_{corr} = I^{NSF}_i + \frac{1}{k_i}\cdot\left(I^{NSF}_i - I^{SF}_i\right)" style="vertical-align: -8px"/></p>
<p><img class="math" src="../_images/math/a53b45b46778492b9ff8c089e1aac0bf2befccfc.png" alt="(I^{SF}_i)_{corr} = I^{SF}_i - \frac{1}{k_i}\cdot\left(I^{NSF}_i - I^{SF}_i\right)" style="vertical-align: -8px"/></p>
<p>where <img class="math" src="../_images/math/e6313904c2ef1055d2725f543389fd906f6fc86a.png" alt="I^{SF,\,NSF}_i" style="vertical-align: -5px"/> are the neutron counts in the <strong>SFDataWorkspace</strong> and <strong>NSFDataWorkspace</strong>, respectively.</p>
</li>
</ol>
<div class="section" id="valid-input-workspaces">
<h3><a class="toc-backref" href="#id4">Valid input workspaces</a><a class="headerlink" href="#valid-input-workspaces" title="Permalink to this headline">¶</a></h3>
<p>The input workspaces have to have the following in order to be valid inputs for this algorithm.</p>
<ul class="simple">
<li>The same number of dimensions</li>
<li>The same number of spectra</li>
<li>The same number of bins</li>
<li>All given workspaces must have the same polarisation (algorithm checks for the &#8216;polarisation&#8217; and &#8216;polarisation_comment&#8217; sample logs)</li>
<li>All given workspaces must be normalized either to monitor counts or to experiment duration</li>
<li>All given workspaces must have the same kind of normalization (algorithm checks for &#8216;normalized&#8217; sample log)</li>
<li>All given workspaces must have the appropriate flipper status (algorithm checks for &#8216;flipper&#8217; sample log): spin-flip workspaces must have flipper &#8216;ON&#8217; and non-spin-flip workspaces must have flipper &#8216;OFF&#8217;</li>
</ul>
<p>If any of these conditions is not fulfilled, the algorithm terminates.</p>
<p>For the physically meaningful correction it is also important that these workspaces have the same slits size, detector bank rotation angle and the neutron wavelength. If some of these parameters are different, algorithm produces warning. If these properties are not specified in the workspace sample logs, no comparison is performed.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Apply flipping ratio correction to a Vanadium run:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">datapath</span> <span class="o">=</span> <span class="s">&quot;/path/to/data/dns/rc36b_standard_dz&quot;</span>
<span class="n">coilcurrents</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;currents.txt&#39;</span><span class="p">)</span>

<span class="c"># define input files.</span>
<span class="n">sf_vanafile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;dz29100525vana.d_dat&#39;</span><span class="p">)</span>
<span class="n">nsf_vanafile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;dz29100526vana.d_dat&#39;</span><span class="p">)</span>

<span class="n">sf_bkgrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;dz29100645leer.d_dat&#39;</span><span class="p">)</span>
<span class="n">nsf_bkgrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;dz29100646leer.d_dat&#39;</span><span class="p">)</span>

<span class="n">sf_nicrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;dz29100585nicr.d_dat&#39;</span><span class="p">)</span>
<span class="n">nsf_nicrfile</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">datapath</span><span class="p">,</span> <span class="s">&#39;dz29100586nicr.d_dat&#39;</span><span class="p">)</span>

<span class="c"># load files to workspaces</span>
<span class="n">sf_vana</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">sf_vanafile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>
<span class="n">nsf_vana</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">nsf_vanafile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>

<span class="n">sf_nicr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">sf_nicrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>
<span class="n">nsf_nicr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">nsf_nicrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>

<span class="n">sf_bkgr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">sf_bkgrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>
<span class="n">nsf_bkgr</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">nsf_bkgrfile</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">CoilCurrentsTable</span><span class="o">=</span><span class="n">coilcurrents</span><span class="p">)</span>

<span class="c"># for a physically meaningful correction, we must subtract background from Vanadium</span>
<span class="c"># this step is usually not required for other kinds of samples</span>
<span class="n">sf_vana_bg</span> <span class="o">=</span> <span class="n">sf_vana</span> <span class="o">-</span> <span class="n">sf_bkgr</span>
<span class="n">nsf_vana_bg</span> <span class="o">=</span> <span class="n">nsf_vana</span> <span class="o">-</span> <span class="n">nsf_bkgr</span>

<span class="c"># apply correction</span>
<span class="n">DNSFlippingRatioCorr</span><span class="p">(</span><span class="n">sf_vana_bg</span><span class="p">,</span> <span class="n">nsf_vana_bg</span><span class="p">,</span> <span class="n">sf_nicr</span><span class="p">,</span> <span class="n">nsf_nicr</span><span class="p">,</span> <span class="n">sf_bkgr</span><span class="p">,</span> <span class="n">nsf_bkgr</span><span class="p">,</span>
                     <span class="n">SFOutputWorkspace</span><span class="o">=</span><span class="s">&#39;sf_corrected&#39;</span><span class="p">,</span> <span class="n">NSFOutputWorkspace</span><span class="o">=</span><span class="s">&#39;nsf_corrected&#39;</span><span class="p">)</span>

<span class="c"># retrieve output workspaces</span>
<span class="n">sf_corrected</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;sf_corrected&#39;</span><span class="p">]</span>
<span class="n">nsf_corrected</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;nsf_corrected&#39;</span><span class="p">]</span>

<span class="c"># calculate ratio of spin-flip to non-spin-flip</span>
<span class="n">vana_ratio</span> <span class="o">=</span> <span class="n">sf_corrected</span><span class="o">/</span><span class="n">nsf_corrected</span>

<span class="c"># ratio must be around 2, print first 5 points of the data array</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">vana_ratio</span><span class="o">.</span><span class="n">extractY</span><span class="p">()[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<p>Output:</p>
<blockquote>
<div>[[ 2.]
[ 2.]
[ 2.]
[ 2.]
[ 2.]]</div></blockquote>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Workflow/MLZ/DNS.html">Workflow\MLZ\DNS</a> | <a class="reference external" href="categories/CorrectionFunctions/SpecialCorrections.html">CorrectionFunctions\SpecialCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c46a67d64e22c52f6c639900deb1c2a0efa0aa66/Framework/PythonInterface/plugins/algorithms/DNSFlippingRatioCorr.py">DNSFlippingRatioCorr.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DNSComputeDetEffCorrCoefs-v1.html" title="Previous Chapter: DNSComputeDetEffCorrCoefs v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; DNSComputeDetEff...</span>
    </a>
  </li>
  <li>
    <a href="DNSMergeRuns-v1.html" title="Next Chapter: DNSMergeRuns v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">DNSMergeRuns v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>