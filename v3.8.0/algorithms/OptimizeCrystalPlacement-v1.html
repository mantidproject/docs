<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OptimizeCrystalPlacement v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="OptimizeLatticeForCellType v1" href="OptimizeLatticeForCellType-v1.html" />
    <link rel="prev" title="OneStepMDEW v1" href="OneStepMDEW-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="optimizecrystalplacement-v1">
<span id="algm-optimizecrystalplacement"></span><span id="algm-optimizecrystalplacement-v1"></span><h1>OptimizeCrystalPlacement v1<a class="headerlink" href="#optimizecrystalplacement-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/OptimizeCrystalPlacement-v1_dlg.png"><img alt="../_images/OptimizeCrystalPlacement-v1_dlg.png" class="screenshot" src="../_images/OptimizeCrystalPlacement-v1_dlg.png" style="width: 258px;" /></a>
<p class="caption"><strong>OptimizeCrystalPlacement</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This algorithm  optimizes goniometer settings  and sample orientation to better index the peaks.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="3%" />
<col width="20%" />
<col width="6%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>PeaksWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>Workspace of Peaks with UB loaded</td>
</tr>
<tr class="row-odd"><td>KeepGoniometerFixedfor</td>
<td>Input</td>
<td>int list</td>
<td>&nbsp;</td>
<td>List of run Numbers for which the goniometer settings will NOT be changed</td>
</tr>
<tr class="row-even"><td>ModifiedPeaksWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td>&nbsp;</td>
<td>Output Workspace of Peaks with optimized sample Orientations</td>
</tr>
<tr class="row-odd"><td>FitInfoTable</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>FitInfoTable</td>
<td>Workspace of Results</td>
</tr>
<tr class="row-even"><td>AdjustSampleOffsets</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If true sample offsets will be adjusted to give better fits, otherwise they will be fixed as zero(def=true)</td>
</tr>
<tr class="row-odd"><td>OptimizeGoniometerTilt</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Set true if main error is due to a tilted Goniometer(def=false)</td>
</tr>
<tr class="row-even"><td>Chi2overDoF</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>chi squared over dof</td>
</tr>
<tr class="row-odd"><td>nPeaks</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Number of Peaks Used</td>
</tr>
<tr class="row-even"><td>nParams</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Number of Parameters fit</td>
</tr>
<tr class="row-odd"><td>nIndexed</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Number of new Peaks that WOULD be indexed at &#8216;MaxIndexingError&#8217;</td>
</tr>
<tr class="row-even"><td>MaxAngularChange</td>
<td>Input</td>
<td>number</td>
<td>5</td>
<td>Max offset in degrees from current settings(def=5)</td>
</tr>
<tr class="row-odd"><td>MaxIndexingError</td>
<td>Input</td>
<td>number</td>
<td>0.25</td>
<td>Use only peaks whose fractional hkl values are below this tolerance(def=.25)</td>
</tr>
<tr class="row-even"><td>MaxHKLPeaks2Use</td>
<td>Input</td>
<td>number</td>
<td>-1</td>
<td>If less than 0 all peaks are used, otherwise only peaks whose h,k, and l values are below the level are used(def=-1)</td>
</tr>
<tr class="row-odd"><td>MaxSamplePositionChangeMeters</td>
<td>Input</td>
<td>number</td>
<td>0.0005</td>
<td>Maximum Change in Sample position in meters(def=.0005)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm basically optimizes h,k, and l offsets from an integer by
varying the parameters sample positions, sample orientations ( chi,phi,
and omega), and/or the tilt of the goniometer for an experiment.</p>
<p>If the crystal orientation matrix, UB, was created from one run, that
run may not need to have its goniometer settings optimized. There is a
property to list the run numbers to NOT have their goniometer settings
changed. This entry is IGNORED if the tilt or sample positions are
included in the optimization. In this case NONE of the goniometer
angles, relative to any tilt, will be changed.</p>
<p>The goniometer angles displayed are relative to the tilt,i,e, phi is
the rotation around the axis perpendicular to the tilted plane. The
resultant PeaksWorkspace has the goniometer angles relative to the Y and
Z axes at that time.</p>
<p>The crystal orientation matrix, UB, from the PeaksWorkspace should
index all the runs &#8220;very well&#8221;. Otherwise iterations that slowly build a
UB with corrected sample orientations may be needed.</p>
<p>The parameters for the tilt are GRotx, GRoty, and GRotz in
degrees. The usage for this information is as follows:</p>
<p><img class="math" src="../_images/math/4c25fd5e42c9489d182f35f4aec033dbc6e1e51b.png" alt="rotate(x,GRotx)*rotate(y,GRoty)*rotate(z,GRotz)*&nbsp;SampleOrientation" style="vertical-align: -4px"/>
<img class="math" src="../_images/math/0db4a7a08250ad7ea4e6651ba4170951ae52a537.png" alt="(&nbsp;i.e.&nbsp;omegaRot*chiRot*phiRot))." style="vertical-align: -4px"/></p>
<p>Note: To optimize by the tilt in the goniometer and then by the angles
or by the sample position, it is possible to run with one optimization,
then using the resultant PeaksWorkspace for input, run another
optimization.</p>
<p>Rerunning the same optimization with the result is also a good idea. If
the first guess is very close, the optimize algorithm does try cases far
away and may not get back to the best value. Check the chisquared
values. If they increase, that optimization should probably not be used.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ws</span><span class="o">=</span><span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="s">&quot;TOPAZ_3007.peaks&quot;</span><span class="p">)</span>
<span class="n">LoadIsawUB</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="s">&quot;ls5637.mat&quot;</span><span class="p">)</span>
<span class="n">wsd</span> <span class="o">=</span> <span class="n">OptimizeCrystalPlacement</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
<span class="p">(</span><span class="n">wsPeakOut</span><span class="p">,</span><span class="n">fitInfoTable</span><span class="p">,</span><span class="n">chi2overDoF</span><span class="p">,</span><span class="n">nPeaks</span><span class="p">,</span><span class="n">nParams</span><span class="p">,</span><span class="n">nIndexed</span><span class="p">,</span><span class="n">covrianceInfoTable</span><span class="p">)</span> <span class="o">=</span> <span class="n">OptimizeCrystalPlacement</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Chi2: </span><span class="si">%.4f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">chi2overDoF</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Chi2: 0.0203
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Crystal/Corrections.html">Crystal\Corrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c46a67d64e22c52f6c639900deb1c2a0efa0aa66/Framework/Crystal/src/OptimizeCrystalPlacement.cpp">OptimizeCrystalPlacement.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c46a67d64e22c52f6c639900deb1c2a0efa0aa66/Framework/Crystal/inc/MantidCrystal/OptimizeCrystalPlacement.h">OptimizeCrystalPlacement.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="OneStepMDEW-v1.html" title="Previous Chapter: OneStepMDEW v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; OneStepMDEW v1</span>
    </a>
  </li>
  <li>
    <a href="OptimizeLatticeForCellType-v1.html" title="Next Chapter: OptimizeLatticeForCellType v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">OptimizeLatticeF... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>