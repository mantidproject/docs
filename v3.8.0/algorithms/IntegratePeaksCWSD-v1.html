<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>IntegratePeaksCWSD v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.8.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="IntegratePeaksHybrid v1" href="IntegratePeaksHybrid-v1.html" />
    <link rel="prev" title="IntegratePeakTimeSlices v1" href="IntegratePeakTimeSlices-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.8</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="integratepeakscwsd-v1">
<span id="algm-integratepeakscwsd"></span><span id="algm-integratepeakscwsd-v1"></span><h1>IntegratePeaksCWSD v1<a class="headerlink" href="#integratepeakscwsd-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/IntegratePeaksCWSD-v1_dlg.png"><img alt="../_images/IntegratePeaksCWSD-v1_dlg.png" class="screenshot" src="../_images/IntegratePeaksCWSD-v1_dlg.png" style="width: 230px;" /></a>
<p class="caption"><strong>IntegratePeaksCWSD</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#inputs" id="id4">Inputs</a></li>
<li><a class="reference internal" href="#calculations" id="id5">Calculations</a><ul>
<li><a class="reference internal" href="#simple-peak-integration" id="id6">Simple Peak Integration</a></li>
<li><a class="reference internal" href="#calculation-of-integrated-background" id="id7">Calculation of integrated background</a></li>
<li><a class="reference internal" href="#outputs" id="id8">Outputs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#masking" id="id9">Masking</a></li>
<li><a class="reference internal" href="#background-subtraction" id="id10">Background Subtraction</a></li>
</ul>
</li>
<li><a class="reference internal" href="#workflow" id="id11">Workflow</a></li>
<li><a class="reference internal" href="#usage" id="id12">Usage</a></li>
<li><a class="reference internal" href="#source" id="id13">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Integrate single-crystal peaks in reciprocal space, for MDEventWorkspaces from reactor-source single crystal diffractometer.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="2%" />
<col width="10%" />
<col width="3%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><em>MDEventWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An input MDEventWorkspace.</td>
</tr>
<tr class="row-odd"><td>PeaksWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td>&nbsp;</td>
<td>A PeaksWorkspace containing the peaks to integrate.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td>&nbsp;</td>
<td>The output PeaksWorkspace will be a copy of the input PeaksWorkspace with the peaks&#8217; integrated intensities.</td>
</tr>
<tr class="row-odd"><td>MaskWorkspace</td>
<td>Input</td>
<td>MaskWorkspace</td>
<td>&nbsp;</td>
<td>Output Masking Workspace</td>
</tr>
<tr class="row-even"><td>PeakCentre</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>A comma separated list for peak centre in Q-sample frame. Its length is either 3 (Qx, Qy, Qz) or 0. If peak center is defined, then all the data among all the runs will be integrated in respect to this peak center. Otherwise, the peaks that will be integrated shall be found in the given peak workspace.</td>
</tr>
<tr class="row-odd"><td>PeakRadius</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Radius of a peak.</td>
</tr>
<tr class="row-even"><td>MergePeaks</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>In case that there are more than 1 run number in the given PeaksWorkspace and MDEVentWorkspace, if it is set to true, then the peaks&#8217; intensities will be merged.</td>
</tr>
<tr class="row-odd"><td>NormalizeByMonitor</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If selected, then all the signals will be normalized by monitor counts.Otherwise, the output peak intensity will be just simple addition of peak intensity.It is only applied to the situation that Mergepeaks is not selected.</td>
</tr>
<tr class="row-even"><td>NormalizeByTime</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>It selected, then all the signals will be normalized by time in the case that the counting time is very short and thus the beam monitor is not accurate.</td>
</tr>
<tr class="row-odd"><td>ScaleFactor</td>
<td>Input</td>
<td>number</td>
<td>1000</td>
<td>If NormalizeByMonitor or NormalizeByTime is selected, the intensity will be scaled by this factor.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm performs integration of single-crystal peaks ... ...</p>
<div class="section" id="inputs">
<h3><a class="toc-backref" href="#id4">Inputs</a><a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h3>
<p>The algorithms takes 2 mandatory input workspaces and 1 optional workspace:</p>
<ul class="simple">
<li>A MDEventWorkspace containing the events in multi-dimensional space.</li>
<li>A PeaksWorkspace containing the peaks to be integrated.</li>
<li>An optional MaskWorkspace to mask the pixels on the detector</li>
</ul>
</div>
<div class="section" id="calculations">
<h3><a class="toc-backref" href="#id5">Calculations</a><a class="headerlink" href="#calculations" title="Permalink to this headline">¶</a></h3>
<p>There are a few of algorithms that are or will be supported to integrate
single crystal diffraction peaks measured by a constant-wavelength reactor-based
diffractometer (aka. 4-circle).</p>
<div class="section" id="simple-peak-integration">
<h4><a class="toc-backref" href="#id6">Simple Peak Integration</a><a class="headerlink" href="#simple-peak-integration" title="Permalink to this headline">¶</a></h4>
<p>Integration is performed by summing the signal from all MDEvents that
are not masked.
The integrated value will be normalized by the monitor counts.</p>
<p>The <strong>assumption</strong> is to load an experiment point (<em>Pt</em>) and convert to MDEventWorkspace in Q-space.
This <em>Pt</em>, i.e., workspace, contains at most one peak.
Algorithm <em>FindPeaksMD</em> is able to find a peak in the MDEventWorkspace and output to a PeaksWorkspace.
A UB matrix is set to this PeaksWorkspace as an option.</p>
<dl class="docutils">
<dt>The <strong>pseduo-code</strong> of this algorith is:</dt>
<dd><ol class="first last arabic simple">
<li>Go over all the MDEvents;</li>
<li>For Pt. (aka, run number) i, its integrated intensity <img class="math" src="../_images/math/a90a8d380e36c0d0a77ef2a866250b28f5714ee2.png" alt="I_{i}" style="vertical-align: -3px"/> is calculated as
<img class="math" src="../_images/math/be7c781b0165a90c2501a75af0e084bf484b944f.png" alt="I_{i} = \sum_{d=0}^{256\times 256}\frac{s_d}{m}" style="vertical-align: -6px"/>, where <img class="math" src="../_images/math/0e4f2adbaa7818857e80844a28cf835b5c73b2d1.png" alt="s_i" style="vertical-align: -3px"/> is the signal of detector i,
and m is the monitor counts;</li>
</ol>
</dd>
<dt>Here is how this peak integration algorithm is applied to GUI</dt>
<dd><ol class="first last arabic simple">
<li>Find out all the run numbers by experiment number and scan number;</li>
<li>Execute FindPeaksMD() on all runs (i.e., Pts);</li>
<li>Calculate peak center by <img class="math" src="../_images/math/2bc296bf92b73bc85a0e2f62fab4b8561a9431a7.png" alt="\vec{p} = \frac{1}{\sum_i C_i} \sum_i C_i * \vec{p}_i" style="vertical-align: -10px"/>, where
<img class="math" src="../_images/math/fdce0f8c8d68b0db2590b9624df817f0d84c518c.png" alt="\vec{p}" style="vertical-align: -4px"/> is the center of the peak, <img class="math" src="../_images/math/9454726fb4304aba31c8af0f71903451758cab8d.png" alt="C_i" style="vertical-align: -3px"/> is the bin count of run i;</li>
<li>Execute IntegratePeaksCWSD() to integrate peak for each run (or Pt.) regardless whether a peak is found;</li>
<li>Loop all the Pt. and sum the intensity as <img class="math" src="../_images/math/4b0ac116a58d2d1f9136d99255035c6e36debcb0.png" alt="I = \sum_i I_i" style="vertical-align: -5px"/>, where :math:</li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="calculation-of-integrated-background">
<h4><a class="toc-backref" href="#id7">Calculation of integrated background</a><a class="headerlink" href="#calculation-of-integrated-background" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>There are two approaches that are proposed to estimate integrated background.</dt>
<dd><ol class="first last arabic simple">
<li>Simple background removal (3D to 2D)<ul>
<li>Assuming that <img class="math" src="../_images/math/74c365241e01411b0723656a47c580910fec79ea.png" alt="r_p" style="vertical-align: -6px"/> and <img class="math" src="../_images/math/5740b7e60f90de38435eadf458572c1e6590af80.png" alt="r_b" style="vertical-align: -3px"/> are defined for the radius of peak and background respectively.</li>
<li>Calculate <img class="math" src="../_images/math/e9fd50627549cc39b88dcf2b5a697e4a87963228.png" alt="I_p" style="vertical-align: -6px"/> by integrating the signals within <img class="math" src="../_images/math/74c365241e01411b0723656a47c580910fec79ea.png" alt="r_p" style="vertical-align: -6px"/>;</li>
<li>Calculate <img class="math" src="../_images/math/b655f0a3dcd92d9e441cafe02b1d95e8a42bc354.png" alt="I_pb" style="vertical-align: -6px"/> by integrating the signals within <img class="math" src="../_images/math/5740b7e60f90de38435eadf458572c1e6590af80.png" alt="r_b" style="vertical-align: -3px"/>;</li>
<li>Then integrated background <img class="math" src="../_images/math/a4ebe13905edff81dd53f73598fd66becbd1adef.png" alt="I_b = I_pb - I_p" style="vertical-align: -6px"/>;</li>
</ul>
</li>
<li>Rock scan</li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="outputs">
<h4><a class="toc-backref" href="#id8">Outputs</a><a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h4>
<p>Here are some values to be output.</p>
<blockquote>
<div><ul class="simple">
<li><img class="math" src="../_images/math/6d81d5c276f478f7f42323ad58b21b2630722c4d.png" alt="I_{scan} \cdot sin(2\theta)" style="vertical-align: -4px"/> for each scan with <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> fixed,
where <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> is to the center of the detector.</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="masking">
<h3><a class="toc-backref" href="#id9">Masking</a><a class="headerlink" href="#masking" title="Permalink to this headline">¶</a></h3>
<p>Algorithm IntegratePeaksCWSD supports masking detectors.
An optional MaskWorkspace will define all the detectors that will be masked.</p>
<p>Because the reactor-based single crystal diffratometer may have a moving detector,
the best way to mark a detector to be masked is by its original detector ID.</p>
</div>
<div class="section" id="background-subtraction">
<h3><a class="toc-backref" href="#id10">Background Subtraction</a><a class="headerlink" href="#background-subtraction" title="Permalink to this headline">¶</a></h3>
<p>The background signal within PeakRadius is calculated by scaling the
background signal density in the shell to the volume of the peak:</p>
<p>...</p>
</div>
</div>
<div class="section" id="workflow">
<h2><a class="toc-backref" href="#id11">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/HB3A-v1_wokflw.png" src="../_images/HB3A-v1_wokflw.png" />
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id12">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - IntegratePeaks:</strong></p>
<p><strong>Output:</strong></p>
<div class="highlight-python"><div class="highlight"><pre>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/MDAlgorithms/Peaks.html">MDAlgorithms\Peaks</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id13">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c46a67d64e22c52f6c639900deb1c2a0efa0aa66/Framework/MDAlgorithms/src/IntegratePeaksCWSD.cpp">IntegratePeaksCWSD.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/c46a67d64e22c52f6c639900deb1c2a0efa0aa66/Framework/MDAlgorithms/inc/MantidMDAlgorithms/IntegratePeaksCWSD.h">IntegratePeaksCWSD.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="IntegratePeakTimeSlices-v1.html" title="Previous Chapter: IntegratePeakTimeSlices v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; IntegratePeakTim...</span>
    </a>
  </li>
  <li>
    <a href="IntegratePeaksHybrid-v1.html" title="Next Chapter: IntegratePeaksHybrid v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">IntegratePeaksHy... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>