<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PoldiProjectRun v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="PoldiRemoveDeadWires v1" href="PoldiRemoveDeadWires-v1.html" />
    <link rel="prev" title="PoldiProjectAddFile v1" href="PoldiProjectAddFile-v1.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="poldiprojectrun-v1">
<span id="algm-poldiprojectrun"></span><span id="algm-poldiprojectrun-v1"></span><h1>PoldiProjectRun v1<a class="headerlink" href="#poldiprojectrun-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/PoldiProjectRun-v1_dlg.png"><img alt="../_images/PoldiProjectRun-v1_dlg.png" class="screenshot" src="../_images/PoldiProjectRun-v1_dlg.png" style="width: 346px;" /></a>
<p class="caption"><strong>PoldiProjectRun</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#data-manager" id="id4">Data manager</a></li>
<li><a class="reference internal" href="#poldi-setup-manager" id="id5">POLDI setup manager</a></li>
<li><a class="reference internal" href="#analysis-steps" id="id6">Analysis steps</a></li>
<li><a class="reference internal" href="#loading-the-data" id="id7">Loading the data</a></li>
<li><a class="reference internal" href="#loading-poldi-parameters" id="id8">Loading POLDI parameters</a></li>
<li><a class="reference internal" href="#pre-analyzing-data" id="id9">Pre-analyzing data</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is currently under review and may change or appear with a different name in future releases. The documentation may be outdated.</p>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Run the POLDI analysis process for a bunch of data files stored in a tableWorkspace.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="7%" />
<col width="16%" />
<col width="17%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>TableWorkspace</td>
<td>Mandatory</td>
<td>Poldi analysis main worksheet</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td>TableWorkspace</td>
<td>PoldiIPPmanager</td>
<td>Poldi IPP table manager</td>
</tr>
<tr class="row-even"><td>wlenmin</td>
<td>Input</td>
<td>number</td>
<td>1.1</td>
<td>minimal wavelength considered</td>
</tr>
<tr class="row-odd"><td>wlenmax</td>
<td>Input</td>
<td>number</td>
<td>5</td>
<td>maximal wavelength considered</td>
</tr>
<tr class="row-even"><td>BadWiresThreshold</td>
<td>Input</td>
<td>number</td>
<td>0.8</td>
<td>Bad wires threshold parameter</td>
</tr>
<tr class="row-odd"><td>PeakDetectionThreshold</td>
<td>Input</td>
<td>number</td>
<td>0.2</td>
<td>Peak detection threshold parameter</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>PoldiProjectRun algorithm is used to analyze a bunch of POLDI raw data
files, following a standard POLDI analysis process. This algorithm take
as parameter a tableMatrix with a list of the sample to analyze, and for
each sample a bunch of setup information for the different algorithms
(such as the data file path, etc...).</p>
<p>This tableWorkspace can be built easily using the two algorithms
<a class="reference internal" href="PoldiProjectAddFile-v1.html#algm-poldiprojectaddfile"><em>PoldiProjectAddFile v1</em></a> and
<a class="reference internal" href="PoldiProjectAddDir-v1.html#algm-poldiprojectadddir"><em>PoldiProjectAddDir v1</em></a>, which will create and/or
fill properly a targeted tableWorkspace. The needed columns and there
content are describe in the following <a class="reference external" href="PoldiProjectRun#Data_Manager">Data
Manager</a> paragraph.</p>
<p>The algorithm is used the classical way. Only one parameter is
compulsory.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="n">PoldiProjectRun</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">sample_manager_ws</span><span class="p">)</span>
</pre></div>
</div>
<p>Data are processed alone, or grouped together. For each acquisition
file, setup information have to be loaded. During the data treatment
process, transitional workspace are created.</p>
<p>In a close future, it will possible to share different workspace between
data-file: for example when one knows that some acquisitions should be
strictly the same, auto-correlation and peak detection could be done
only one for all the data.</p>
<div class="section" id="data-manager">
<h3><a class="toc-backref" href="#id4">Data manager</a><a class="headerlink" href="#data-manager" title="Permalink to this headline">¶</a></h3>
<p>A MatrixWorkspace is created to store all the information about
data-files and the future workspace needed during the analysis. The
stored information are:</p>
<ul class="simple">
<li>spl Name - name of the sample, extract from the sample file name, without the extension</li>
<li>year - year of the acquisition</li>
<li>number - id number of the acquisition</li>
<li>data file - full path of the data file</li>
<li>spl log - name of the MatrixWorkspace where the data log are loaded</li>
<li>spl corr - name of the MatrixWorkspace where the correlated spectra is loaded</li>
<li>spl dead wires - name of the MatrixWorkspace where the dead wires are loaded</li>
<li>spl peak - name of the MatrixWorkspace where the detected peak information are stored</li>
</ul>
</div>
<div class="section" id="poldi-setup-manager">
<h3><a class="toc-backref" href="#id5">POLDI setup manager</a><a class="headerlink" href="#poldi-setup-manager" title="Permalink to this headline">¶</a></h3>
<p>For each acquisition file, the IDF are loaded:</p>
<ul class="simple">
<li>Instrument Definition files - The POLDI instrument geometry.</li>
<li>Instrument Parameters files - The setup parameters for the data, at t he time of the acquisition.</li>
</ul>
<p>The POLDI setup informations can be shared between acquisition obtained
during the same beam-time. While loading each instrument files, the
different POLDI configurations used are stored in a MatrixWorkspace
(most often, there is only one per year), with an example of data. The
needed POLDI setup informations will then be extracted from the IDF of
each of these example sample.</p>
<p>Therefore each POLDI setup are loaded only once and shared between the
different data files.</p>
</div>
<div class="section" id="analysis-steps">
<h3><a class="toc-backref" href="#id6">Analysis steps</a><a class="headerlink" href="#analysis-steps" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="loading-the-data">
<h3><a class="toc-backref" href="#id7">Loading the data</a><a class="headerlink" href="#loading-the-data" title="Permalink to this headline">¶</a></h3>
<p>Each data-file is loaded on a 2DWorkspace. The associated log and setup
information are loaded in dedicated workspace as specified in the
sample-manager TableWorkspace.</p>
<p><a class="reference internal" href="LoadSINQFile-v1.html#algm-loadsinqfile"><em>LoadSINQFile v1</em></a></p>
<p>The raw data are loaded in a 2DWorkspace, using the generic file-loader
for SINQ data, given the instrument name <em>POLDI</em> as parameter.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LoadSINQFile</span><span class="p">(</span><span class="n">Instrument</span>      <span class="o">=</span> <span class="s">&quot;POLDI&quot;</span><span class="p">,</span>
             <span class="n">Filename</span>        <span class="o">=</span> <span class="n">sample_file_path</span><span class="p">,</span>
             <span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="n">sample_name</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="PoldiLoadLog-v1.html#algm-poldiloadlog"><em>PoldiLoadLog v1</em></a></p>
<p>The associated <em>logs</em> informations are extracted from the <em>hdf</em> raw data
file, an store in a dedicated MatrixWorkspace. A dictionary file
contains the set of key/path to extract and store all the needed
information. More specifically, the acquisition starting time is
extracted and store in the sample WS to initialize the <em>run_start</em>
variable.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PoldiLoadLog</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">sample_output_ws</span><span class="p">,</span>
             <span class="n">Filename</span>       <span class="o">=</span> <span class="n">sample_file_path</span><span class="p">,</span>
             <span class="n">Dictionary</span>     <span class="o">=</span> <span class="n">poldi_dictionnary_file_path</span><span class="p">,</span>
             <span class="n">PoldiLog</span>       <span class="o">=</span> <span class="n">sample_log_ws</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="LoadInstrument-v1.html#algm-loadinstrument"><em>LoadInstrument v1</em></a></p>
<p>For each raw data WS, the corresponding IDF is loaded, based on the
acquisition starting time.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LoadInstrument</span><span class="p">(</span><span class="n">Workspace</span>         <span class="o">=</span> <span class="n">sample_output_ws</span><span class="p">,</span>
               <span class="n">InstrumentName</span>    <span class="o">=</span> <span class="s">&quot;Poldi&quot;</span><span class="p">,</span>
               <span class="n">RewriteSpectraMap</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="PoldiRemoveDeadWires-v1.html#algm-poldiremovedeadwires"><em>PoldiRemoveDeadWires v1</em></a></p>
<p>Some wires are permanently dead and should not be taken into account.
They are listed in the IDF of a given setup (IPP). Some others wires
should not be used, because they seem untrustable (dead wires, hot
wires, random behavior,...). These wires are detected by successive
comparison with there neighbors: intensity from two successive wires
should not differ more than <em>BadWiresThreshold</em>(*100)%. One by one,
the most deviant wires are checks and removed until they all fit the
condition.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PoldiRemoveDeadWires</span><span class="p">(</span><span class="n">InputWorkspace</span>      <span class="o">=</span> <span class="n">sample_output_ws</span><span class="p">,</span>
                     <span class="n">RemoveExcludedWires</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="n">AutoRemoveBadWires</span>  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="n">BadWiresThreshold</span>   <span class="o">=</span> <span class="n">BadWiresThreshold</span><span class="p">,</span>
                     <span class="n">PoldiDeadWires</span>      <span class="o">=</span> <span class="n">sample_dead_wires_ws</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-poldi-parameters">
<h3><a class="toc-backref" href="#id8">Loading POLDI parameters</a><a class="headerlink" href="#loading-poldi-parameters" title="Permalink to this headline">¶</a></h3>
<p>While loading the data, the different needed setup have been store in a
dedicated workspace.</p>
<p>they are now all extracted, using an example sample for each of them.</p>
<p><a class="reference internal" href="PoldiLoadChopperSlits-v1.html#algm-poldiloadchopperslits"><em>PoldiLoadChopperSlits v1</em></a></p>
<p>The chopper configuration is loaded in a dedicated Workspace, one per
<em>Poldi IPP</em> setup detected.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PoldiLoadChopperSlits</span><span class="p">(</span><span class="n">InputWorkspace</span>    <span class="o">=</span> <span class="n">ex_of_sample_ws</span><span class="p">,</span>
                      <span class="n">PoldiChopperSlits</span> <span class="o">=</span> <span class="n">ipp_chopper_slits</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="PoldiLoadSpectra-v1.html#algm-poldiloadspectra"><em>PoldiLoadSpectra v1</em></a></p>
<p>The characteristic Poldi spectra (<em>Intensity=f(wavelength)</em>) is
extracted from each IDF.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PoldiLoadSpectra</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">ex_of_sample_ws</span><span class="p">,</span>
                 <span class="n">PoldiSpectra</span>   <span class="o">=</span> <span class="n">ipp_Poldi_spectra</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="PoldiLoadIPP-v1.html#algm-poldiloadipp"><em>PoldiLoadIPP v1</em></a></p>
<p>Local setup information (such as the detector position, chopper offset,
etc...) are extracted and stores in a dedicated workspace.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PoldiLoadIPP</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">ex_of_sample_ws</span><span class="p">,</span>
             <span class="n">PoldiIPP</span>       <span class="o">=</span> <span class="n">ipp_ipp_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pre-analyzing-data">
<h3><a class="toc-backref" href="#id9">Pre-analyzing data</a><a class="headerlink" href="#pre-analyzing-data" title="Permalink to this headline">¶</a></h3>
<p>In order to setup the 2D fit to analyze the data, some information need
to be extracted from the file, such as an idea of the peaks position.
This is done using an autocorrelation function, following by a peak
detection algorithm.</p>
<p>The process has been cut in different algorithm in order to give the
possibility to change/improve/modify each steps. For example, the peak
detection process can be based on some previous results to not start
from scratch, or given the sample crystal structure/symetries/space
group...</p>
<p><a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><em>PoldiAutoCorrelation v5</em></a></p>
<p>Almost all the previous loaded workspace are used by this algorithm.
From the sample manager workspace, and the Poldi setup workspace, all
the targeted workspace can be found and given as parameters to the
algorithm. The auto-correlated graph is store in a dedicated workspace,
on row (0).</p>
<p><a class="reference internal" href="PoldiPeakDetection-v2.html#algm-poldipeakdetection"><em>PoldiPeakDetection v2</em></a></p>
<p>The previous autocorrelation function is analyzed to detected possible
peaks. The found peak are stored in a dedicated workspace, and added to
the previously created <em>sample_correlated_ws</em>: on row (1) the detected
peak, on row (2) the fitted peak.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">PoldiPeakDetection</span><span class="p">(</span><span class="n">InputWorkspace</span>         <span class="o">=</span> <span class="n">sample_correlated_ws</span><span class="p">,</span>
                   <span class="n">PeakDetectionThreshold</span> <span class="o">=</span> <span class="n">PeakDetectionThreshold</span><span class="p">,</span>
                   <span class="n">OutputWorkspace</span>        <span class="o">=</span> <span class="n">sample_peak_ws</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/SINQ.html">SINQ</a> | <a class="reference external" href="categories/Poldi.html">Poldi</a> | <a class="reference external" href="categories/Obsolete.html">Obsolete</a></p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014, Mantid.<br/>
    </p>
  </div>
</footer>
  </body>
</html>