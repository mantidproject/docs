<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LoadMcStas v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="LoadMcStasNexus v1" href="LoadMcStasNexus-v1.html" />
    <link rel="prev" title="LoadMask v1" href="LoadMask-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="loadmcstas-v1">
<span id="algm-loadmcstas"></span><span id="algm-loadmcstas-v1"></span><h1>LoadMcStas v1<a class="headerlink" href="#loadmcstas-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/LoadMcStas-v1_dlg.png"><img alt="../_images/LoadMcStas-v1_dlg.png" class="screenshot" src="../_images/LoadMcStas-v1_dlg.png" style="width: 417px;" /></a>
<p class="caption"><strong>LoadMcStas</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#information-about-the-required-structure-of-the-input-nexus-file" id="id4">Information about the required structure of the input Nexus file</a></li>
<li><a class="reference internal" href="#references" id="id5">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Loads a McStas NeXus file into an workspace.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="3%" />
<col width="13%" />
<col width="5%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Filename</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The name of the Nexus file to load. Allowed extensions: [&#8216;.h5&#8217;, &#8216;.nxs&#8217;]</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An output workspace.</td>
</tr>
<tr class="row-even"><td>ErrorBarsSetTo1</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>When this property is set to false errors are set equal to data values, and when set to true all errors are set equal to one. This property defaults to false</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Reads a McStas Nexus file into a Mantid WorkspaceGroup with the name of
the algorithm property OutputWorkspace. Data generated by McStas monitor components are
stored in workspaces of type Workspace2D and/or EventWorkspace. The name of a
workspace equals that of the mcstas component name + &#8216;_&#8217; + name of the OutputWorkspace.
In addition an EventWorkspace with the name &#8216;EventData&#8217; + &#8216;_&#8217; + name of the OutputWorkspace
is created which contains the sum of all event datasets in the Nexus file; if the Nexus
file contains just one event dataset this is the only EventWorkspace created.</p>
<p>For information about how to create McStas outputs that can
readily be read by this loader, see <a class="reference external" href="https://github.com/McStasMcXtrace/McCode/wiki/McStas-and-Mantid">here</a>.
For more information about McStas, and combined McStas and Mantid analyses see references below.</p>
<p>The ErrorBarsSetTo1 property applies to event data, but not to histogram data.</p>
<p>LoadMcStas replaces LoadMcStasEventNexus. LoadMcStas can be used for
reading McStas 2.1 histogram and event data.
<a class="reference internal" href="LoadMcStasNexus-v1.html#algm-loadmcstasnexus"><em>LoadMcStasNexus v1</em></a> can be used
for reading McStas 2.0 histogram data.</p>
<div class="section" id="information-about-the-required-structure-of-the-input-nexus-file">
<h3><a class="toc-backref" href="#id4">Information about the required structure of the input Nexus file</a><a class="headerlink" href="#information-about-the-required-structure-of-the-input-nexus-file" title="Permalink to this headline">¶</a></h3>
<p>The input file must have an
<tt class="docutils literal"><span class="pre">/entry1/simulation/name</span></tt> item whose value is <tt class="docutils literal"><span class="pre">&quot;mccode&quot;</span></tt>.</p>
<p>The output workspace will contain one workspace for each group of
class <tt class="docutils literal"><span class="pre">NXdata</span></tt> in the input NeXus file, which is not of name <tt class="docutils literal"><span class="pre">&quot;content_nxs&quot;</span></tt>
found in a group of class <tt class="docutils literal"><span class="pre">NXDetector</span></tt> of name <tt class="docutils literal"><span class="pre">&quot;Data&quot;</span></tt>.
The name of the workspace is the same as the name of the group,
but with with the name of the outputworkspace, as specified in the algorithm properties,
added to the end.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="37%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Description of Data</th>
<th class="head">Found in Nexus file (within &#8216;run&#8217;)</th>
<th class="head">Placed in Workspace (Workspace2D)
or output</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>All data</td>
<td>Group of class <tt class="docutils literal"><span class="pre">NXDetector</span></tt>
of name <tt class="docutils literal"><span class="pre">&quot;data&quot;</span></tt></td>
<td>See below</td>
</tr>
<tr class="row-odd"><td>Generic group including either
event or histrogram data</td>
<td>each group of class <tt class="docutils literal"><span class="pre">NXdata</span></tt> in
<tt class="docutils literal"><span class="pre">&quot;data&quot;</span></tt>, henceforth referred to as
[DATA]</td>
<td>one workspace each</td>
</tr>
<tr class="row-even"><td>Event data</td>
<td>item in a [DATA] with a <tt class="docutils literal"><span class="pre">long_name</span></tt>
attribute containing <tt class="docutils literal"><span class="pre">&quot;Neutron_ID&quot;</span></tt>
and name <tt class="docutils literal"><span class="pre">&quot;events&quot;</span></tt></td>
<td>event data</td>
</tr>
<tr class="row-odd"><td>Histrogram data</td>
<td>items in a [DATA] with a <tt class="docutils literal"><span class="pre">long_name</span></tt>
attribute <strong>not</strong> containing
<tt class="docutils literal"><span class="pre">&quot;Neutron_ID&quot;</span></tt></td>
<td>histogram data</td>
</tr>
<tr class="row-even"><td>Instrument</td>
<td><tt class="docutils literal"><span class="pre">/instrument</span></tt></td>
<td>loaded into workspace, only if
events are loaded</td>
</tr>
<tr class="row-odd"><td>Instrument definition</td>
<td><tt class="docutils literal"><span class="pre">/instrument/instrument_xml/data</span></tt>
is needed for events to be loaded</td>
<td>loaded into workspace, only if
events are loaded</td>
</tr>
</tbody>
</table>
<p>The event data of the McStas file occurs in a NeXus table with six columns:</p>
<ol class="arabic simple">
<li>Weight</li>
<li>X coordinate</li>
<li>Y coordinate</li>
<li>Number of previous events</li>
<li>Detector ID</li>
<li>Time</li>
</ol>
</div>
<div class="section" id="references">
<h3><a class="toc-backref" href="#id5">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p>For more information about McStas and its general usage for simulating neutron
scattering instruments and experiments visit the <a class="reference external" href="http://www.mcstas.org">McStas homepage</a> .</p>
<p>For examples of how combined McStas and Mantid analyses can help
instrument simulation and data treatment/analysis tasks see Nielsen., T.R. et al., McStas
and Mantid integration, Journal of Neutron Research, vol. 18, no. 2-3, pp. 61-77, 2015
<a class="reference external" href="http://dx.doi.org/10.3233/JNR-160026">DOI: 10.3233/JNR-160026</a>
[<a class="reference external" href="http://arxiv.org/abs/1607.02498">arXiv</a>].</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Load McStas data containing both event and histogram data:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Load the data into tuple</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">LoadMcStas</span><span class="p">(</span><span class="s">&#39;mcstas_event_hist.h5&#39;</span><span class="p">)</span>

<span class="c"># workspace group is first entry in tuple</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;ws&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Number of entries in group: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">()))</span>

<span class="n">eventData</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;EventData_ws&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Number of histograms in event data: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eventData</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Name of event data: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eventData</span><span class="o">.</span><span class="n">getName</span><span class="p">()))</span>

<span class="n">someHistogramData</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;Edet.dat_ws&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Number of histograms in hist data: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">someHistogramData</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Name of hist data: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">someHistogramData</span><span class="o">.</span><span class="n">getName</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Number of entries in group: 7
Number of histograms in event data: 8192
Name of event data: EventData_ws
Number of histograms in hist data: 1
Name of hist data: Edet.dat_ws
</pre></div>
</div>
<p><strong>Example - Comparing event data entries in a McStas Nexus file:</strong></p>
<p>The mccode_multiple_scattering.h5 McStas Nexus file contains two event data entries:
named single_list_p_x_y_n_id_t and multi_list_p_x_y_n_id_t, one
from each of two detector banks of the instrument simulated. These are loaded
individually into separate workspaces. In addition, this algorithm returns the
workspace EventData_ws, which contains the sum of all event data entries in the
McStas Nexus file. The example below performs a test to show that the summation
of the workspaces has been executed correctly.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Load the data into tuple</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">LoadMcStas</span><span class="p">(</span><span class="s">&#39;mccode_multiple_scattering.h5&#39;</span><span class="p">)</span>

<span class="c"># Calculate total of all event data entries</span>
<span class="n">all_scattering_event_ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;EventData_ws&#39;</span><span class="p">]</span>
<span class="n">total_all</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_scattering_event_ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()):</span>
  <span class="n">total_all</span> <span class="o">+=</span> <span class="n">all_scattering_event_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;The sum of all scattering spectra: {0:.6e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_all</span><span class="p">))</span>

<span class="c"># Calculate total scattering from the single event bank</span>
<span class="n">single_scatter_event_ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;single_list_p_x_y_n_id_t_ws&#39;</span><span class="p">]</span>
<span class="n">total_single</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">single_scatter_event_ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()):</span>
  <span class="n">total_single</span> <span class="o">+=</span> <span class="n">single_scatter_event_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;The sum of all single scattering spectra: {0:.6e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_single</span><span class="p">))</span>

<span class="c"># Calculate total scattering from the &#39;k02&#39; detector bank</span>
<span class="n">multiple_scatter_event_ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;multi_list_p_x_y_n_id_t_ws&#39;</span><span class="p">]</span>
<span class="n">total_multiple</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">multiple_scatter_event_ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()):</span>
  <span class="n">total_multiple</span> <span class="o">+=</span> <span class="n">multiple_scatter_event_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;The sum of all multiple scattering spectra: {0:.6e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_multiple</span><span class="p">))</span>

<span class="c"># Check equality</span>
<span class="n">sum_of_scattering</span> <span class="o">=</span> <span class="n">total_multiple</span> <span class="o">+</span> <span class="n">total_single</span>
<span class="c"># This is equal to the sum of all scattering spectra</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Sum of single and multiple scattering workspaces: {0:.6e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_single</span> <span class="o">+</span> <span class="n">total_multiple</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The sum of all scattering spectra: 2.038678e-11
The sum of all single scattering spectra: 1.907862e-11
The sum of all multiple scattering spectra: 1.308161e-12
Sum of single and multiple scattering workspaces: 2.038678e-11
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/DataHandling/Nexus.html">DataHandling\Nexus</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/DataHandling/src/LoadMcStas.cpp">LoadMcStas.cpp</a> <em>(last modified: 2018-02-24)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/DataHandling/inc/MantidDataHandling/LoadMcStas.h">LoadMcStas.h</a> <em>(last modified: 2018-02-21)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="LoadMask-v1.html" title="Previous Chapter: LoadMask v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; LoadMask v1</span>
    </a>
  </li>
  <li>
    <a href="LoadMcStasNexus-v1.html" title="Next Chapter: LoadMcStasNexus v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">LoadMcStasNexus ... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-03-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>