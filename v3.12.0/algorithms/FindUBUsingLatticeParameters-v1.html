<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FindUBUsingLatticeParameters v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="FindUBUsingMinMaxD v1" href="FindUBUsingMinMaxD-v1.html" />
    <link rel="prev" title="FindUBUsingIndexedPeaks v1" href="FindUBUsingIndexedPeaks-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="findubusinglatticeparameters-v1">
<span id="algm-findubusinglatticeparameters"></span><span id="algm-findubusinglatticeparameters-v1"></span><h1>FindUBUsingLatticeParameters v1<a class="headerlink" href="#findubusinglatticeparameters-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/FindUBUsingLatticeParameters-v1_dlg.png"><img alt="../_images/FindUBUsingLatticeParameters-v1_dlg.png" class="screenshot" src="../_images/FindUBUsingLatticeParameters-v1_dlg.png" style="width: 188px;" /></a>
<p class="caption"><strong>FindUBUsingLatticeParameters</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculate the UB matrix from a peaks workspace, given lattice parameters.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="6%" />
<col width="15%" />
<col width="12%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>PeaksWorkspace</td>
<td>InOut</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>Input Peaks Workspace</td>
</tr>
<tr class="row-odd"><td>a</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Lattice parameter a</td>
</tr>
<tr class="row-even"><td>b</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Lattice parameter b</td>
</tr>
<tr class="row-odd"><td>c</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Lattice parameter c</td>
</tr>
<tr class="row-even"><td>alpha</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Lattice parameter alpha</td>
</tr>
<tr class="row-odd"><td>beta</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Lattice parameter beta</td>
</tr>
<tr class="row-even"><td>gamma</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Lattice parameter gamma</td>
</tr>
<tr class="row-odd"><td>NumInitial</td>
<td>Input</td>
<td>number</td>
<td>15</td>
<td>Number of Peaks to Use on First Pass(15)</td>
</tr>
<tr class="row-even"><td>Tolerance</td>
<td>Input</td>
<td>number</td>
<td>0.15</td>
<td>Indexing Tolerance (0.15)</td>
</tr>
<tr class="row-odd"><td>FixParameters</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Do not optimise the UB after finding the orientation</td>
</tr>
<tr class="row-even"><td>Iterations</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>Iterations to refine UB (1)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Given a set of peaks, and given lattice parameters
(<img class="math" src="../_images/math/87e522cc627762a0b5d5fa65759d868c09b3c718.png" alt="a,b,c,alpha,beta,gamma" style="vertical-align: -4px"/>), this algorithm will find the
<a class="reference internal" href="../concepts/Lattice.html#lattice"><em>UB matrix</em></a>, that best fits the data. The algorithm
searches over a large range of possible orientations for the orientation
for which the rotated B matrix best fits the data. The search for the
best orientation involves several steps.</p>
<p>During the first step, a reduced set of peaks typically at lower |Q|
are used, since it is easier to index peaks at low |Q|. Specifically,
if there are at least 5 peaks, the peaks are shifted to be centered at
the strongest peaks and then sorted in order of increasing distance from
the strongest peak. If there are fewer than 5 peaks the list is just
sorted in order of increasing |Q|. Only peaks from the initial portion
of this sorted list are used in the first step. The number of peaks from
this list to be used initially is specified by the user with the
parameter NumInitial. The search first finds a list of possible
orientations for which the <a class="reference internal" href="../concepts/Lattice.html#lattice"><em>UB matrix</em></a> will index the maximum
number of peaks from the initial set of peaks to within the specified tolerance
on h,k,l values. Subsequently, only the <a class="reference internal" href="../concepts/Lattice.html#lattice"><em>UB matrix</em></a> that indexes
that maximum number of peaks with the minimum distance between the calculated h,k,l
values and integers is kept and passed on to the second step.</p>
<p>During the second step, additional peaks are gradually added to the
initial list of peaks. Each time peaks are added to the list, the subset
of peaks from the new list that are indexed within the specified
tolerance on k,k,l are used in a least squares calculation to optimize
the <a class="reference internal" href="../concepts/Lattice.html#lattice"><em>UB matrix</em></a> to best index those peaks. The process of
gradually adding more peaks from the sorted list and optimizing the UB based
on the peaks that are indexed, continues until all peaks have been added to
the list. Finally, one last optimization of the <a class="reference internal" href="../concepts/Lattice.html#lattice"><em>UB matrix</em></a> is
carried out using the full list of peaks.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ws</span><span class="o">=</span><span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="s">&quot;TOPAZ_3007.peaks&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;After LoadIsawPeaks does the workspace have an orientedLattice: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">hasOrientedLattice</span><span class="p">()))</span>

<span class="n">FindUBUsingLatticeParameters</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mf">14.131</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mf">19.247</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mf">8.606</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mf">105.071</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mf">90.0</span><span class="p">,</span><span class="n">NumInitial</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;After FindUBUsingLatticeParameters does the workspace have an orientedLattice: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">hasOrientedLattice</span><span class="p">()))</span>

<span class="k">print</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">getOrientedLattice</span><span class="p">()</span><span class="o">.</span><span class="n">getUB</span><span class="p">())</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>After LoadIsawPeaks does the workspace have an orientedLattice: False
After FindUBUsingLatticeParameters does the workspace have an orientedLattice: True
[[ 0.04542062  0.04061954  0.01223576]
 [-0.00140377 -0.00318446 -0.11654506]
 [-0.05749773  0.03223779 -0.02737294]]
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Crystal/UBMatrix.html">Crystal\UBMatrix</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/Crystal/src/FindUBUsingLatticeParameters.cpp">FindUBUsingLatticeParameters.cpp</a> <em>(last modified: 2017-11-30)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/Crystal/inc/MantidCrystal/FindUBUsingLatticeParameters.h">FindUBUsingLatticeParameters.h</a> <em>(last modified: 2016-11-22)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindUBUsingIndexedPeaks-v1.html" title="Previous Chapter: FindUBUsingIndexedPeaks v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindUBUsingIndex...</span>
    </a>
  </li>
  <li>
    <a href="FindUBUsingMinMaxD-v1.html" title="Next Chapter: FindUBUsingMinMaxD v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindUBUsingMinMa... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-03-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>