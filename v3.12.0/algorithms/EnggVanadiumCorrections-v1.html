<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>EnggVanadiumCorrections v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="EqualToMD v1" href="EqualToMD-v1.html" />
    <link rel="prev" title="EnggFocus v1" href="EnggFocus-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="enggvanadiumcorrections-v1">
<span id="algm-enggvanadiumcorrections"></span><span id="algm-enggvanadiumcorrections-v1"></span><h1>EnggVanadiumCorrections v1<a class="headerlink" href="#enggvanadiumcorrections-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/EnggVanadiumCorrections-v1_dlg.png"><img alt="../_images/EnggVanadiumCorrections-v1_dlg.png" class="screenshot" src="../_images/EnggVanadiumCorrections-v1_dlg.png" style="width: 321px;" /></a>
<p class="caption"><strong>EnggVanadiumCorrections</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculates correction features and / or uses them to correct diffraction data with respect to reference Vanadium data.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="2%" />
<col width="13%" />
<col width="1%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Workspace</td>
<td>InOut</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Workspace with the diffraction data to correct. The Vanadium corrections will be applied on it.</td>
</tr>
<tr class="row-odd"><td>VanadiumWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Workspace with the reference Vanadium diffraction data.</td>
</tr>
<tr class="row-even"><td>OutIntegrationWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Output integration workspace produced when given an input Vanadium workspace</td>
</tr>
<tr class="row-odd"><td>OutCurvesWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Output curves workspace produced when given an input Vanadium workspace</td>
</tr>
<tr class="row-even"><td>SplineBreakPoints</td>
<td>Input</td>
<td>number</td>
<td>50</td>
<td>Number of break points used when fitting the bank profiles with a spline function.</td>
</tr>
<tr class="row-odd"><td>IntegrationWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Workspace with the integrated values for every spectra of the reference Vanadium diffraction data. One row per spectrum.</td>
</tr>
<tr class="row-even"><td>CurvesWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Workspace with the curves fitted on bank-aggregated Vanadium diffraction data, one per bank. This workspace has three spectra per bank, as produced by the algorithm Fit. This is meant to be used as an alternative input VanadiumWorkspace</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument and
technique. It might get changed or even removed without a
notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm performs calculations related to two types of
corrections with respect to a reference Vanadium diffraction dataset
(workspace), in the following order:</p>
<ol class="arabic simple">
<li>sensitivity correction</li>
<li>pixel-by-pixel correction</li>
</ol>
<p>The algorithm outputs the features extracted from the Vanadium data
that are used to perform the two types of corrections, respectively:</p>
<ol class="arabic simple">
<li>the <em>integration</em> of every individual Vanadium spectrum</li>
<li>a list of <em>curves</em> of aggregated counts as a function of
time-of-flight (one per bank)</li>
</ol>
<p>If an input/output workspace with diffraction data is passed, the
algorithm applies the corrections on the diffraction data workspace by
using the integration and curves calculated from the reference
Vanadium datasset.</p>
<p>These outputs can be used to apply the corrections on a diffraction
data workspace in the same algorithm run, or be used subsequently to
apply corrections to different input workspaces. In practice, both
outputs need to be calculated only once for every reference Vanadium
dataset, while they would normally be used to correct a (possibly
long) series of different diffraction data workspaces.</p>
<p>If a vanadium data workspace is passed, the algorithm will calculate
features that can then be used to apply Vanadium corrections in other
<em>Engg</em> algorithms. If in addition an input/output workspace with
diffraction data is passed, the corrections will be applied on
it. Afterwards the same corrections can be applied on different
diffraction data workspaces by calling again this algorithm and
providing as inputs the integraion and curves workspaces produced by
the first call. The same correction features (integration and curves)
can be re-used for as long as the same reference Vanadium diffraction
data is still valid.</p>
<p>Normally this algorithm can be used in two different ways:</p>
<ol class="arabic simple">
<li>Pre-calculate correction features from a Vanadium data workspace.</li>
<li>Apply Vanadium corrections once the correction features have been
calculated.</li>
</ol>
<p>Examples of these two alternatives are shown below. In the first
option, only the input VanadiumWorkspace is required, and the two
outputs (integration and curves workspaces) are produced
normally. Optionally, a diffraction data workspace can be passed in
the input property InputWorkspace for it to be corrected. In the
second option, the corrections can be applied by using pre-calculated
features from a previous run of this algorithm (both
IntegrationWorkspace and CurvesWorkspace have to be passed as input
properties, If these two properties are not passed, they will be
re-calculated provided that a VanadiumWorkspace is passed which is not
recommended). All the calculations (integration, sums, divisions,
etc.) are done in the d-spacing space.</p>
<p>This algorithm is used as a child algorithm in the algorithms
<a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus v1</em></a> and <a class="reference internal" href="EnggCalibrateFull-v1.html#algm-enggcalibratefull"><em>EnggCalibrateFull v1</em></a>.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - apply Vanadium corrections on a sample workspace from an EnginX run file:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># # To generate the pre-calculated features (integration and curves), for a new</span>
<span class="c"># Vanadium run, and apply the corrections on a workspace:</span>
<span class="c">#</span>
<span class="c"># sample_ws = Load(&#39;ENGINX00213855.nxs&#39;)</span>
<span class="c"># van_ws = Load(&#39;ENGINX00236516.nxs&#39;)</span>
<span class="c"># EnggVanadiumCorrections(Workspace = sample_ws, VanadiumWorkspace = van_ws</span>
<span class="c">#                         OutIntegrationWorkspace = &#39;integ_ws&#39;,</span>
<span class="c">#                         OutCurvesWorkspace = &#39;curves_ws&#39;)</span>
<span class="c">#</span>
<span class="c"># # Now you can save the two pre-calculated features / workspaces:</span>
<span class="c"># SaveNexus(InputWorkspace=&#39;integ_ws&#39;,</span>
<span class="c">#           Filename=&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;,)</span>
<span class="c"># SaveNexus(InputWorkspace=&#39;curves_ws&#39;,</span>
<span class="c">#           Filename=&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;)</span>
<span class="c">#</span>
<span class="c"># # (not done here because the Vanadium run file has a large number of events)</span>
<span class="c">#</span>
<span class="c"># # Below we use the pre-calculated features that can be obtained with</span>
<span class="c"># # the commands listed above.</span>

<span class="n">sample_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;ENGINX00213855.nxs&#39;</span><span class="p">)</span>
<span class="n">integ_ws</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="s">&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;</span><span class="p">)</span>
<span class="n">curves_ws</span> <span class="o">=</span> <span class="n">LoadNexus</span><span class="p">(</span><span class="s">&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;</span><span class="p">)</span>
<span class="n">EnggVanadiumCorrections</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="n">sample_ws</span><span class="p">,</span>
                        <span class="n">IntegrationWorkspace</span> <span class="o">=</span> <span class="n">integ_ws</span><span class="p">,</span>
                        <span class="n">CurvesWorkspace</span> <span class="o">=</span> <span class="n">curves_ws</span><span class="p">)</span>

<span class="c"># Should have one spectrum only</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;No. of spectra: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>

<span class="c"># Print a few arbitrary integrated spectra</span>
<span class="n">ws_idx</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">idx_count</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">integ_ws</span> <span class="o">=</span> <span class="n">Integration</span><span class="p">(</span><span class="n">sample_ws</span><span class="p">,</span> <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="n">ws_idx</span><span class="p">,</span>
                       <span class="n">EndWorkspaceIndex</span><span class="o">=</span><span class="n">ws_idx</span><span class="o">+</span><span class="n">idx_count</span><span class="p">)</span>
<span class="n">fmt</span> <span class="o">=</span> <span class="s">&quot;For workspace index {0:d} the spectrum integration is {1:.3f}&quot;</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_count</span><span class="p">):</span>
   <span class="k">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws_idx</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">integ_ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>No. of spectra: 2513
For workspace index 400 the spectrum integration is 23.998
For workspace index 401 the spectrum integration is 23.799
For workspace index 402 the spectrum integration is 22.872
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a> | <a class="reference external" href="categories/CorrectionFunctions/BackgroundCorrections.html">CorrectionFunctions\BackgroundCorrections</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a> | <a class="reference external" href="categories/CorrectionFunctions/NormalisationCorrections.html">CorrectionFunctions\NormalisationCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/PythonInterface/plugins/algorithms/EnggVanadiumCorrections.py">EnggVanadiumCorrections.py</a> <em>(last modified: 2017-10-30)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnggFocus-v1.html" title="Previous Chapter: EnggFocus v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; EnggFocus v1</span>
    </a>
  </li>
  <li>
    <a href="EqualToMD-v1.html" title="Next Chapter: EqualToMD v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">EqualToMD v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-03-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>