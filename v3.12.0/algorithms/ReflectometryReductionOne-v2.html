<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ReflectometryReductionOne v2</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.12.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="ReflectometryReductionOneAuto v1" href="ReflectometryReductionOneAuto-v1.html" />
    <link rel="prev" title="ReflectometryReductionOne v1" href="ReflectometryReductionOne-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.12</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="reflectometryreductionone-v2">
<span id="algm-reflectometryreductionone"></span><span id="algm-reflectometryreductionone-v2"></span><h1>ReflectometryReductionOne v2<a class="headerlink" href="#reflectometryreductionone-v2" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/ReflectometryReductionOne-v2_dlg.png"><img alt="../_images/ReflectometryReductionOne-v2_dlg.png" class="screenshot" src="../_images/ReflectometryReductionOne-v2_dlg.png" style="width: 297px;" /></a>
<p class="caption"><strong>ReflectometryReductionOne</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#conversion-to-wavelength" id="id4">Conversion to Wavelength</a></li>
<li><a class="reference internal" href="#create-direct-beam-workspace" id="id5">Create Direct Beam Workspace</a></li>
<li><a class="reference internal" href="#create-monitor-workspace" id="id6">Create Monitor Workspace</a></li>
<li><a class="reference internal" href="#transmission-correction" id="id7">Transmission Correction</a></li>
<li><a class="reference internal" href="#sum-in-q" id="id8">Sum in Q</a></li>
<li><a class="reference internal" href="#conversion-to-momentum-transfer-q" id="id9">Conversion to Momentum Transfer (Q)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#previous-versions" id="id10">Previous Versions</a></li>
<li><a class="reference internal" href="#usage" id="id11">Usage</a></li>
<li><a class="reference internal" href="#source" id="id12">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Reduces a single TOF/Lambda reflectometry run into a mod Q vs I/I0 workspace. Performs monitor normalization and transmission corrections.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="2%" />
<col width="12%" />
<col width="4%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Run to reduce.</td>
</tr>
<tr class="row-odd"><td>SummationType</td>
<td>Input</td>
<td>string</td>
<td>SumInLambda</td>
<td>The type of summation to perform. Allowed values: [&#8216;SumInLambda&#8217;, &#8216;SumInQ&#8217;]</td>
</tr>
<tr class="row-even"><td>ReductionType</td>
<td>Input</td>
<td>string</td>
<td>Normal</td>
<td>The type of reduction to perform when summing in Q. Allowed values: [&#8216;Normal&#8217;, &#8216;DivergentBeam&#8217;, &#8216;NonFlatSample&#8217;]</td>
</tr>
<tr class="row-odd"><td>ThetaIn</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Angle in degrees</td>
</tr>
<tr class="row-even"><td>ProcessingInstructions</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>Grouping pattern on workspace indexes to yield only the detectors of interest. See GroupDetectors for details.</td>
</tr>
<tr class="row-odd"><td>WavelengthMin</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Wavelength minimum in angstroms</td>
</tr>
<tr class="row-even"><td>WavelengthMax</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>Wavelength maximum in angstroms</td>
</tr>
<tr class="row-odd"><td>I0MonitorIndex</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>I0 monitor workspace index</td>
</tr>
<tr class="row-even"><td>MonitorBackgroundWavelengthMin</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Wavelength minimum for monitor background subtraction in angstroms.</td>
</tr>
<tr class="row-odd"><td>MonitorBackgroundWavelengthMax</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Wavelength maximum for monitor background subtraction in angstroms.</td>
</tr>
<tr class="row-even"><td>MonitorIntegrationWavelengthMin</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Wavelength minimum for integration in angstroms.</td>
</tr>
<tr class="row-odd"><td>MonitorIntegrationWavelengthMax</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Wavelength maximum for integration in angstroms.</td>
</tr>
<tr class="row-even"><td>NormalizeByIntegratedMonitors</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Normalize by dividing by the integrated monitors.</td>
</tr>
<tr class="row-odd"><td>FirstTransmissionRun</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>First transmission run, or the low wavelength transmission run if SecondTransmissionRun is also provided.</td>
</tr>
<tr class="row-even"><td>SecondTransmissionRun</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Second, high wavelength transmission run. Optional. Causes the FirstTransmissionRun to be treated as the low wavelength transmission run.</td>
</tr>
<tr class="row-odd"><td>Params</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>A comma separated list of first bin boundary, width, last bin boundary. These parameters are used for stitching together transmission runs. Values are in wavelength (angstroms). This input is only needed if a SecondTransmission run is provided.</td>
</tr>
<tr class="row-even"><td>StartOverlap</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Start wavelength for stitching transmission runs together. Only used if a second transmission run is provided.</td>
</tr>
<tr class="row-odd"><td>EndOverlap</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>End wavelength (angstroms) for stitching transmission runs together. Only used if a second transmission run is provided.</td>
</tr>
<tr class="row-even"><td>StrictSpectrumChecking</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Enforces spectrum number checking prior to normalization by transmission workspace. Applies to input workspace and transmission workspace.</td>
</tr>
<tr class="row-odd"><td>CorrectionAlgorithm</td>
<td>Input</td>
<td>string</td>
<td>None</td>
<td>The type of correction to perform. Allowed values: [&#8216;None&#8217;, &#8216;PolynomialCorrection&#8217;, &#8216;ExponentialCorrection&#8217;]</td>
</tr>
<tr class="row-even"><td>Polynomial</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>Coefficients to be passed to the PolynomialCorrection algorithm.</td>
</tr>
<tr class="row-odd"><td>C0</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>C0 value to be passed to the ExponentialCorrection algorithm.</td>
</tr>
<tr class="row-even"><td>C1</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>C1 value to be passed to the ExponentialCorrection algorithm.</td>
</tr>
<tr class="row-odd"><td>Diagnostics</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Whether to enable the output of interim workspaces for debugging purposes.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Output Workspace IvsQ.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspaceWavelength</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Output Workspace IvsLam. Intermediate workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm is not meant to be used directly by users. Please see
<a class="reference internal" href="ReflectometryReductionOneAuto-v2.html#algm-reflectometryreductiononeauto"><em>ReflectometryReductionOneAuto v2</em></a> which is a facade over this
algorithm.</p>
<p>This algorithm reduces a single reflectometry run into a mod Q vs I/I0 workspace.
The mandatory input properties, <tt class="docutils literal"><span class="pre">WavelengthMin</span></tt>, <tt class="docutils literal"><span class="pre">WavelengthMax</span></tt>
and <tt class="docutils literal"><span class="pre">ProcessingInstructions</span></tt>, must be manually set by the user. In addition, for
the algorithm to be able to convert from wavelength to momentum transfer correctly,
instrument components, specially detectors, must be located at the correct positions.
The expected experimental setup for the algorithm to produce correct results is
shown below, where the angle between the beam direction and the sample-to-detector
vector must be <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/>.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/ReflectometryReductionOneDetectorPositions.png"><img alt="../_images/ReflectometryReductionOneDetectorPositions.png" src="../_images/ReflectometryReductionOneDetectorPositions.png" style="width: 400px;" /></a>
</div>
<p>The figure below displays a high-level workflow diagram illustrating the main
steps taking place in the reduction. For the sake of clarity, all possible
steps are illustrated, even if some of them are optional.</p>
<img alt="../_images/ReflectometryReductionOne_HighLvl-v2_wkflw.png" src="../_images/ReflectometryReductionOne_HighLvl-v2_wkflw.png" />
<p>First, the algorithm checks the X units of the input workspace. If the input
workspace is already in wavelength, summation and normalization by monitors and
direct beam are not performed, as it is considered that the input run was
already reduced using this algorithm.</p>
<p>If summation is to be done in wavelength, then this is done first. The the
conversion to wavelength and normalisation by monitors and direct beam is done,
followed by the transmission correction. Transmission correction is always
done, even if the input was already in wavelength. The resulting workspace is
cropped in wavelength according to <tt class="docutils literal"><span class="pre">WavelengthMin</span></tt> and
<tt class="docutils literal"><span class="pre">WavelengthMax</span></tt>, which are both mandatory properties.</p>
<p>If summation is to be done in Q, this is done after the normalisations and
cropping, but again, only if the reduction has not already been done.</p>
<p>Finally, the output workspace in wavelength is converted to momentum transfer
(Q).</p>
<div class="section" id="conversion-to-wavelength">
<h3><a class="toc-backref" href="#id4">Conversion to Wavelength</a><a class="headerlink" href="#conversion-to-wavelength" title="Permalink to this headline">¶</a></h3>
<p>If summing in wavelength, detectors of interest are extracted and summed in TOF
using <a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><em>GroupDetectors v2</em></a> with <tt class="docutils literal"><span class="pre">ProcessingInstructions</span></tt> as input. (If
summing in Q, summation is not done yet as it is done in a later step after all
normalisations have been done.) The workspace is then converted to wavelength
with <tt class="docutils literal"><span class="pre">AlignBins</span></tt> set to <tt class="docutils literal"><span class="pre">True</span></tt>.</p>
<p>Next, normalization by direct beam and monitors is optionally done using
<a class="reference internal" href="Divide-v1.html#algm-divide"><em>Divide v1</em></a>.  A summary of the steps is shown in the workflow diagram
below.</p>
<img alt="../_images/ReflectometryReductionOne_ConvertToWavelength-v2_wkflw.png" src="../_images/ReflectometryReductionOne_ConvertToWavelength-v2_wkflw.png" />
</div>
<div class="section" id="create-direct-beam-workspace">
<h3><a class="toc-backref" href="#id5">Create Direct Beam Workspace</a><a class="headerlink" href="#create-direct-beam-workspace" title="Permalink to this headline">¶</a></h3>
<p>Direct Beam and Monitor corrections can be applied to the workspace. These are
both optional steps and will only take place if the required inputs are
provided - otherwise, these steps will be skipped.</p>
<p>The region of direct beam is extracted from the input workspace in TOF using
<a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><em>GroupDetectors v2</em></a> with <tt class="docutils literal"><span class="pre">RegionOfDirectBeam</span></tt> as input. This is only
done if <tt class="docutils literal"><span class="pre">RegionOfDirectBeam</span></tt> is specified. The resulting workspace is
converted to wavelength with <tt class="docutils literal"><span class="pre">AlignBins</span></tt> set to <tt class="docutils literal"><span class="pre">True</span></tt>.</p>
<img alt="../_images/ReflectometryReductionOne_DirectBeamCorrection-v2_wkflw.png" src="../_images/ReflectometryReductionOne_DirectBeamCorrection-v2_wkflw.png" />
</div>
<div class="section" id="create-monitor-workspace">
<h3><a class="toc-backref" href="#id6">Create Monitor Workspace</a><a class="headerlink" href="#create-monitor-workspace" title="Permalink to this headline">¶</a></h3>
<p>Monitors are extracted from the input workspace in TOF using
<a class="reference internal" href="CropWorkspace-v1.html#algm-cropworkspace"><em>CropWorkspace v1</em></a> with <tt class="docutils literal"><span class="pre">I0MonitorIndex</span></tt> as input. The resulting
workspace is converted to wavelength with <tt class="docutils literal"><span class="pre">AlignBins</span></tt> set to
<tt class="docutils literal"><span class="pre">True</span></tt>. Monitor normalisation is only done if <tt class="docutils literal"><span class="pre">I0MonitorIndex</span></tt>,
<tt class="docutils literal"><span class="pre">MonitorBackgroundWavelengthMin</span></tt> and <tt class="docutils literal"><span class="pre">MonitorBackgroundWavelengthMax</span></tt> are
all specified.</p>
<p>Normalisation can be done by integrated monitors by setting
<tt class="docutils literal"><span class="pre">NormalizeByIntegratedMonitors</span></tt> to true, in which case
<tt class="docutils literal"><span class="pre">MonitorIntegrationWavelengthMin</span></tt> and
<tt class="docutils literal"><span class="pre">MonitorIntegrationWavelengthMax</span></tt> are used as the integration
range. If monitors are not integrated, detectors are rebinned to monitors using
<a class="reference internal" href="RebinToWorkspace-v1.html#algm-rebintoworkspace"><em>RebinToWorkspace v1</em></a> so that the normalization by monitors can take
place.</p>
<img alt="../_images/ReflectometryReductionOne_MonitorCorrection-v2_wkflw.png" src="../_images/ReflectometryReductionOne_MonitorCorrection-v2_wkflw.png" />
</div>
<div class="section" id="transmission-correction">
<h3><a class="toc-backref" href="#id7">Transmission Correction</a><a class="headerlink" href="#transmission-correction" title="Permalink to this headline">¶</a></h3>
<p>Transmission corrections can be optionally applied to the workspace resulting
from the previous step. Transmission corrections can be either specified via
transmission runs or specific correction algorithms.</p>
<img alt="../_images/ReflectometryReductionOne_TransmissionCorrection-v2_wkflw.png" src="../_images/ReflectometryReductionOne_TransmissionCorrection-v2_wkflw.png" />
<p>When normalizing by transmission runs, i.e. when one or two transmission runs
are given, the spectrum numbers in the
transmission workspaces must be the same as those in the input run
workspace. If spectrum numbers do not match, the algorithm will throw and exception
and execution of the algorithm will be stopped. This behaviour can be optionally
switched off by setting <tt class="docutils literal"><span class="pre">StrictSpectrumChecking</span></tt> to false, in which case
a warning message will be shown instead.</p>
<p>When normalizing by transmission run, this algorithm will run
<a class="reference internal" href="CreateTransmissionWorkspace-v2.html#algm-createtransmissionworkspace"><em>CreateTransmissionWorkspace v2</em></a> as a child algorithm, with properties <tt class="docutils literal"><span class="pre">WavelengthMin</span></tt>,
<tt class="docutils literal"><span class="pre">WavelengthMax</span></tt>, <tt class="docutils literal"><span class="pre">I0MonitorIndex</span></tt>, <tt class="docutils literal"><span class="pre">MonitorBackgroundWavelengthMin</span></tt>,
<tt class="docutils literal"><span class="pre">MonitorBackgroundWavelengthMax</span></tt>, <tt class="docutils literal"><span class="pre">MonitorIntegrationWavelengthMin</span></tt>,
<tt class="docutils literal"><span class="pre">MonitorIntegrationWavelengthMax</span></tt>, and <tt class="docutils literal"><span class="pre">ProcessingInstructions</span></tt>.
In addition, when both <tt class="docutils literal"><span class="pre">FirstTransmissionRun</span></tt> and <tt class="docutils literal"><span class="pre">SecondTransmissionRun</span></tt>
are provided the stitching parameters <tt class="docutils literal"><span class="pre">Params</span></tt>, as well as <tt class="docutils literal"><span class="pre">StartOverlap</span></tt> and
<tt class="docutils literal"><span class="pre">EndOverlap</span></tt> will be used by <a class="reference internal" href="CreateTransmissionWorkspace-v2.html#algm-createtransmissionworkspace"><em>CreateTransmissionWorkspace v2</em></a> to create the
transmission workspace that will be used for the normalization.</p>
<p>If no transmission runs are provided, then algorithmic corrections can be
performed instead by setting <tt class="docutils literal"><span class="pre">CorrectionAlgorithm</span></tt> to either
<tt class="docutils literal"><span class="pre">PolynomialCorrection</span></tt> or <tt class="docutils literal"><span class="pre">ExponentialCorrection</span></tt>, the two
possible types of corrections at the moment. If <tt class="docutils literal"><span class="pre">PolynomialCorrection</span></tt>,
is selected, <a class="reference internal" href="PolynomialCorrection-v1.html#algm-polynomialcorrection"><em>PolynomialCorrection v1</em></a> algorithm will be run, with this
algorithm&#8217;s <tt class="docutils literal"><span class="pre">Polynomial</span></tt> property used as its <tt class="docutils literal"><span class="pre">Coefficients</span></tt>
property. If the <tt class="docutils literal"><span class="pre">CorrectionAlgorithm</span></tt> property is set to
<tt class="docutils literal"><span class="pre">ExponentialCorrection</span></tt>, then the <a class="reference internal" href="ExponentialCorrection-v1.html#algm-exponentialcorrection"><em>ExponentialCorrection v1</em></a>
algorithm is used, with <em>C0</em> and <em>C1</em> taken from the <tt class="docutils literal"><span class="pre">C0</span></tt> and <tt class="docutils literal"><span class="pre">C1</span></tt>
properties.</p>
</div>
<div class="section" id="sum-in-q">
<h3><a class="toc-backref" href="#id8">Sum in Q</a><a class="headerlink" href="#sum-in-q" title="Permalink to this headline">¶</a></h3>
<p>If summing in Q, the summation is done now, after all normalisations and
cropping have been done. As with summation in <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>, the summation is
only done if the reduction has not already been done.</p>
<p>The summation is done using the algorithm proposed by Cubitt et al
(J. Appl. Crystallogr., 48 (6) (2015)). This involves a projection to an
arbitrary reference angle, <img class="math" src="../_images/math/99bce4c46421acf1491e6a0a300a80526b459238.png" alt="2\theta_R" style="vertical-align: -3px"/>, with a &#8220;virtual&#8221; wavelength,
<img class="math" src="../_images/math/4154f33e19aa4cfe0d6e20096c632c8757862c81.png" alt="\lambda_v" style="vertical-align: -3px"/>. This is the wavelength the neutron would have had if it had
arrived at <img class="math" src="../_images/math/99bce4c46421acf1491e6a0a300a80526b459238.png" alt="2\theta_R" style="vertical-align: -3px"/> with the same momentum transfer (<img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>).</p>
<p>Counts are considered to be spread evenly over the input pixel, and the
top-left and bottom-right corner of the pixel are projected onto
<img class="math" src="../_images/math/99bce4c46421acf1491e6a0a300a80526b459238.png" alt="2\theta_R" style="vertical-align: -3px"/> giving a range in <img class="math" src="../_images/math/4154f33e19aa4cfe0d6e20096c632c8757862c81.png" alt="\lambda_v" style="vertical-align: -3px"/> to project onto. Counts
are shared out proportionally into the output bins that overlap this range, and
the projected counts from all pixels are summed into the appropriate output
bins.</p>
<p>The resulting 1D workspace in <img class="math" src="../_images/math/4154f33e19aa4cfe0d6e20096c632c8757862c81.png" alt="\lambda_v" style="vertical-align: -3px"/> at <img class="math" src="../_images/math/99bce4c46421acf1491e6a0a300a80526b459238.png" alt="2\theta_R" style="vertical-align: -3px"/> becomes
the output workspace in wavelength.</p>
<img alt="../_images/ReflectometryReductionOne_SumInQ-v2_wkflw.png" src="../_images/ReflectometryReductionOne_SumInQ-v2_wkflw.png" />
</div>
<div class="section" id="conversion-to-momentum-transfer-q">
<h3><a class="toc-backref" href="#id9">Conversion to Momentum Transfer (Q)</a><a class="headerlink" href="#conversion-to-momentum-transfer-q" title="Permalink to this headline">¶</a></h3>
<p>Finally, the output workspace in wavelength is converted to momentum transfer
(<img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>) using <a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><em>ConvertUnits v1</em></a>. The equation used is
<img class="math" src="../_images/math/0954d22107751be6d29755cebdb47b5027329a66.png" alt="Q=4\pi sin(\theta_R)/\lambda_v" style="vertical-align: -5px"/> in the non-flat sample case or
<img class="math" src="../_images/math/cfe549751bb3f09844b5919960a14370f99ebd66.png" alt="Q=4\pi sin(2\theta_R-\theta_0)/\lambda_v" style="vertical-align: -5px"/> in the divergent beam
case. This is because the latter needs to take into account the divergence of
the beam from the assumed direct beam direction.</p>
<img alt="../_images/ReflectometryReductionOne_ConvertToMomentum-v2_wkflw.png" src="../_images/ReflectometryReductionOne_ConvertToMomentum-v2_wkflw.png" />
<p>Note that the output workspace in Q is a workspace with native binning, and no
rebin step is applied to it. If you wish to obtain a rebinned workspace in Q
you should consider using algorithm <a class="reference internal" href="ReflectometryReductionOneAuto-v2.html#algm-reflectometryreductiononeauto"><em>ReflectometryReductionOneAuto v2</em></a>
instead, which is a facade over this algorithm and has two extra steps
(<a class="reference internal" href="Rebin-v1.html#algm-rebin"><em>Rebin v1</em></a> and <a class="reference internal" href="Scale-v1.html#algm-scale"><em>Scale v1</em></a>) to produce an additional workspace in
Q with specified binning and scale factor. Please refer to
<a class="reference internal" href="ReflectometryReductionOneAuto-v2.html#algm-reflectometryreductiononeauto"><em>ReflectometryReductionOneAuto v2</em></a> for more information.</p>
</div>
</div>
<div class="section" id="previous-versions">
<h2><a class="toc-backref" href="#id10">Previous Versions</a><a class="headerlink" href="#previous-versions" title="Permalink to this headline">¶</a></h2>
<p>This is version 2 of the algorithm. For version 1, please see <a class="reference external" href="ReflectometryReductionOne-v1.html">here.</a></p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id11">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Reduce a run</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">run</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">&#39;INTER00013460.nxs&#39;</span><span class="p">)</span>
<span class="c"># Basic reduction with no transmission run</span>
<span class="n">IvsQ</span><span class="p">,</span> <span class="n">IvsLam</span> <span class="o">=</span> <span class="n">ReflectometryReductionOne</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
                                         <span class="n">WavelengthMin</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                         <span class="n">WavelengthMax</span><span class="o">=</span><span class="mf">17.0</span><span class="p">,</span>
                                         <span class="n">ProcessingInstructions</span><span class="o">=</span><span class="s">&#39;3:4&#39;</span><span class="p">,</span>
                                         <span class="n">I0MonitorIndex</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">MonitorBackgroundWavelengthMin</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
                                         <span class="n">MonitorBackgroundWavelengthMax</span><span class="o">=</span><span class="mf">17.0</span><span class="p">,</span>
                                         <span class="n">MonitorIntegrationWavelengthMin</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                                         <span class="n">MonitorIntegrationWavelengthMax</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsLam</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">533</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsLam</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">534</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsQ</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">327</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsQ</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">328</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>0.0003
0.0003
0.0003
0.0003
</pre></div>
</div>
<p><strong>Example - Reduce a run and normalize by transmission workspace</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">run</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">&#39;INTER00013460.nxs&#39;</span><span class="p">)</span>
<span class="n">trans1</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">&#39;INTER00013463.nxs&#39;</span><span class="p">)</span>
<span class="n">trans2</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">&#39;INTER00013464.nxs&#39;</span><span class="p">)</span>
<span class="c"># Basic reduction with two transmission runs</span>
<span class="n">IvsQ</span><span class="p">,</span> <span class="n">IvsLam</span> <span class="o">=</span> <span class="n">ReflectometryReductionOne</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">run</span><span class="p">,</span>
                                         <span class="n">WavelengthMin</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                         <span class="n">WavelengthMax</span><span class="o">=</span><span class="mf">17.0</span><span class="p">,</span>
                                         <span class="n">ProcessingInstructions</span><span class="o">=</span><span class="s">&#39;3-4&#39;</span><span class="p">,</span>
                                         <span class="n">I0MonitorIndex</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">MonitorBackgroundWavelengthMin</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
                                         <span class="n">MonitorBackgroundWavelengthMax</span><span class="o">=</span><span class="mf">17.0</span><span class="p">,</span>
                                         <span class="n">MonitorIntegrationWavelengthMin</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                                         <span class="n">MonitorIntegrationWavelengthMax</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                                         <span class="n">FirstTransmissionRun</span><span class="o">=</span><span class="n">trans1</span><span class="p">,</span>
                                         <span class="n">SecondTransmissionRun</span><span class="o">=</span><span class="n">trans2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsLam</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">480</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsLam</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">481</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsQ</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">107</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.4f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IvsQ</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">108</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>0.4592
0.4654
0.7278
1.0305
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Reflectometry.html">Reflectometry</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id12">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/Algorithms/src/ReflectometryReductionOne2.cpp">ReflectometryReductionOne2.cpp</a> <em>(last modified: 2017-12-01)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/e07b2bf50bc7eaeb32967b712b3665c1ffc8a2c4/Framework/Algorithms/inc/MantidAlgorithms/ReflectometryReductionOne2.h">ReflectometryReductionOne2.h</a> <em>(last modified: 2017-09-06)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ReflectometryReductionOne-v1.html" title="Previous Chapter: ReflectometryReductionOne v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ReflectometryRed...</span>
    </a>
  </li>
  <li>
    <a href="ReflectometryReductionOneAuto-v1.html" title="Next Chapter: ReflectometryReductionOneAuto v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ReflectometryRed... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2018-03-19.<br/>
    </p>
  </div>
</footer>
  </body>
</html>