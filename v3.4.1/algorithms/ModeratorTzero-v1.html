<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ModeratorTzero v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="ModeratorTzeroLinear v1" href="ModeratorTzeroLinear-v1.html" />
    <link rel="prev" title="MinusMD v1" href="MinusMD-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.4</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="moderatortzero-v1">
<span id="algm-moderatortzero"></span><span id="algm-moderatortzero-v1"></span><h1>ModeratorTzero v1<a class="headerlink" href="#moderatortzero-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/ModeratorTzero-v1_dlg.png"><img alt="../_images/ModeratorTzero-v1_dlg.png" class="screenshot" src="../_images/ModeratorTzero-v1_dlg.png" style="width: 335px;" /></a>
<p class="caption"><strong>ModeratorTzero</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Corrects the time of flight of an indirect geometry instrument by a time offset that is dependent on the energy of the neutron after passing through the moderator.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="4%" />
<col width="23%" />
<col width="7%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the input workspace, containing events and/or histogram data, in units of time-of-flight</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the output workspace</td>
</tr>
<tr class="row-even"><td>tolTOF</td>
<td>Input</td>
<td>number</td>
<td>0.1</td>
<td>Tolerance in the calculation of the emission time, in microseconds (default:1)</td>
</tr>
<tr class="row-odd"><td>Niter</td>
<td>Input</td>
<td>m</td>
<td>1</td>
<td>Number of iterations (default:1)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Corrects the time of flight (TOF) by a time offset that is dependent
on the energy of the neutron after passing through the moderator. A
heuristic formula for the correction is stored in the instrument
definition file. Below is shown the entry in the instrument file for the
VISION beamline:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- formula for t0 calculation. See http://muparser.sourceforge.net/mup_features.html#idDef2 for available operators--&gt;</span>
<span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;t0_formula&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;(incidentEnergy &lt; 34.7332) ? 37.011296*incidentEnergy^(-0.052874) : (incidentEnergy &lt; 88.7556) ? 124.267307*incidentEnergy^(-0.394282) : (incidentEnergy &lt; 252.471) ? 963.775145*incidentEnergy^(-0.850919) : (incidentEnergy &lt; 420.145) ? 33.225834*incidentEnergy^(-0.242105) : (incidentEnergy &lt; 100000.0) ? 120.569231*incidentEnergy^(-0.455477) : 0.0&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/parameter&gt;</span>
</pre></div>
</div>
<p>The recorded <img class="math" src="../_images/math/3121db8987516bbc518e3d7c8ceceb6af7c11a9b.png" alt="TOF = t_0 + t_i + t_f" style="vertical-align: -6px"/> with</p>
<ul class="simple">
<li><img class="math" src="../_images/math/80c2ba80101209091e1ec9f7e1d60cee93553edb.png" alt="t_0" style="vertical-align: -3px"/>: emission time from the moderator</li>
<li><img class="math" src="../_images/math/af5a28ca8a321b443076a2fa13d823926ea6a26e.png" alt="t_1" style="vertical-align: -4px"/>: time from moderator to sample or monitor</li>
<li><img class="math" src="../_images/math/fe8ef6267f2e4c6ecf2c54fa699f7499c89df730.png" alt="t_2" style="vertical-align: -3px"/>: time from sample to detector</li>
</ul>
<p>This algorithm will replace <img class="math" src="../_images/math/158ca5e243cd03e6dc48d91036e3d244d4b763e0.png" alt="TOF" style="vertical-align: 0px"/> with <img class="math" src="../_images/math/8a990487042bc403c68c27ce2dcddb75943a068f.png" alt="TOF^* = TOF-t_0 = t_i+t_f" style="vertical-align: -6px"/></p>
<p>For a direct geometry instrument, the incident energy <img class="math" src="../_images/math/5157461b1b4f86299a9f63718f2f4ebc54750e7f.png" alt="E_1" style="vertical-align: -4px"/> is
the same for all neutrons. Hence, the moderator emission time is the
same for all neutrons. For an indirect geometry instrument, <img class="math" src="../_images/math/5157461b1b4f86299a9f63718f2f4ebc54750e7f.png" alt="E_1" style="vertical-align: -4px"/>
is different for each neutron and is not known. However, the final
energy <img class="math" src="../_images/math/94e71870aec47854815e61786b721b8e14728e90.png" alt="E_2" style="vertical-align: -3px"/> selected by the analyzers is known.</p>
<ul class="simple">
<li><img class="math" src="../_images/math/8afb3272ee9ff232e1e6427006e0ef658fcba075.png" alt="t_0 = func(E_1)" style="vertical-align: -4px"/> , a function of the incident energy</li>
<li><img class="math" src="../_images/math/54bf2a6d5a42d7e540bbf3fb7d62e182e7fd6a66.png" alt="t_1 = L_1/v_1" style="vertical-align: -5px"/> with <img class="math" src="../_images/math/64501d33ba28bc7129b6ef952baecb9103fb5377.png" alt="L_1" style="vertical-align: -4px"/> the distance from moderator to
sample, and <img class="math" src="../_images/math/0ad6b08462d84a5173de14bfc0c31910556dd3b3.png" alt="v_1" style="vertical-align: -4px"/> the initial unknown velocity (<img class="math" src="../_images/math/4e2864f7dba4c9733c81b2fe46be24860086e573.png" alt="E_1=1/2*m*v_1^2" style="vertical-align: -6px"/>)</li>
<li><img class="math" src="../_images/math/a721dcb3291eaf800753ec2c170f389b24aca573.png" alt="t_2 = L_2/v_2" style="vertical-align: -5px"/> with <img class="math" src="../_images/math/759f02400705d52108cf148140feb3d28d9ba7fa.png" alt="L_2" style="vertical-align: -3px"/> the distance from sample to
detector, and <img class="math" src="../_images/math/455b0c175735d1e50842367209eed06b0ede5baa.png" alt="v_2" style="vertical-align: -3px"/> is the final fixed velocity (<img class="math" src="../_images/math/e9955f427d870b63f3d8363e1f79c4d18a196219.png" alt="E_2=1/2*m*v_2^2" style="vertical-align: -5px"/>)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We obtain <img class="math" src="../_images/math/eda81106824ac5533d9dcccbf8ad6ebfc801fdc0.png" alt="TOF^*" style="vertical-align: 0px"/> as an iterative process,
taking into account the fact that the correction <img class="math" src="../_images/math/80c2ba80101209091e1ec9f7e1d60cee93553edb.png" alt="t_0" style="vertical-align: -3px"/> is much
smaller than <img class="math" src="../_images/math/5748af0f4081ba8b8f28ff0c70fa0f7ca3c4fa32.png" alt="t_i+t_f" style="vertical-align: -6px"/>. Thus
<img class="math" src="../_images/math/639d6b43b2f2c02e9454664989460c5eb04be643.png" alt="TOF-t_0^{(n)} = L_1/v_1^{(n)} + L_2/v_2" style="vertical-align: -5px"/> , <img class="math" src="../_images/math/144b3414d4596fddf8b6852aba60e82f1d8db17d.png" alt="n=0, 1, 2,.." style="vertical-align: -4px"/>
Set <img class="math" src="../_images/math/fc4e1612f7d03d2bb0fbfa1bd7463ec04d8e1db5.png" alt="t_0^{(0)}=0" style="vertical-align: -4px"/> and obtain <img class="math" src="../_images/math/b942c391d0864fa999dd170c9167bd76653b4e3d.png" alt="v_1^{(0)}" style="vertical-align: -5px"/> from the previous
formula. From <img class="math" src="../_images/math/b942c391d0864fa999dd170c9167bd76653b4e3d.png" alt="v_1^{(0)}" style="vertical-align: -5px"/> we obtain <img class="math" src="../_images/math/b2b7098d4fd84a3e1376747575563adb34d4cf31.png" alt="E_1^{(0)}" style="vertical-align: -5px"/>
Set <img class="math" src="../_images/math/aef7654c6f6416b7b64b6e5d412f5aefba53469d.png" alt="t_0^{(1)}=func( E_1^{(0)} )" style="vertical-align: -5px"/> and repeat the steps until
<img class="math" src="../_images/math/4de7084a1a25c0b454419bdbeb5c9d48263e3be1.png" alt="|t_0^{(n+1)} - t_0^{(n+1)}| &lt; tolTOF" style="vertical-align: -5px"/>. With
<img class="math" src="../_images/math/cfbdc2bdec0a7918c3629fae26bdb0a8c86081bf.png" alt="tolTOF=0.1 microsecond" style="vertical-align: -1px"/>, only one iteration is needed for convergence.</p>
</div>
<p>Here&#8217;s the result of applying ModeratorTzero to both the event list and
the histogrammed data of a run in the VISION beamline. The
transformation of either events or histograms shifts the curve to
smaller TOF&#8217;s. The transformed curves are not supposed to be identical,
but similar and differenciated from the original curve.</p>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.1.jpeg"><img alt="Summed Histogram" src="../_images/ModeratorTzero_Fig.1.jpeg" style="width: 400px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.2.jpeg"><img alt="Elastic Line" src="../_images/ModeratorTzero_Fig.2.jpeg" style="width: 400px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../_images/ModeratorTzero_Fig.3.jpeg"><img alt="Inelastic Peaks" src="../_images/ModeratorTzero_Fig.3.jpeg" style="width: 400px;" /></a>
</div>
<p>For indirect instruments featuring an incoming neutron flux having a
sufficiently narrow distribution of energies, a linear relationship
between <img class="math" src="../_images/math/80c2ba80101209091e1ec9f7e1d60cee93553edb.png" alt="t_0" style="vertical-align: -3px"/> and the wavelength of the incoming neutron can be
established. This relation allows for coding of an algorithm with faster
execution times. For indirect instruments that comply with these
conditions, use of <a class="reference internal" href="ModeratorTzeroLinear-v1.html#algm-moderatortzerolinear"><em>ModeratorTzeroLinear v1</em></a> is
preferred.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/CorrectionFunctions.html">CorrectionFunctions</a> | <a class="reference external" href="categories/InstrumentCorrections.html">InstrumentCorrections</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, Mantid.<br/>
    </p>
  </div>
</footer>
  </body>
</html>