<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SofQWNormalisedPolygon v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="SofQWPolygon v1" href="SofQWPolygon-v1.html" />
    <link rel="prev" title="SofQWMomentsScan v1" href="SofQWMomentsScan-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="sofqwnormalisedpolygon-v1">
<span id="algm-sofqwnormalisedpolygon"></span><span id="algm-sofqwnormalisedpolygon-v1"></span><h1>SofQWNormalisedPolygon v1<a class="headerlink" href="#sofqwnormalisedpolygon-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/SofQWNormalisedPolygon-v1_dlg.png"><img alt="../_images/SofQWNormalisedPolygon-v1_dlg.png" class="screenshot" src="../_images/SofQWNormalisedPolygon-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><strong>SofQWNormalisedPolygon</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculate the intensity as a function of momentum transfer and energy.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="SofQW-v1.html#algm-sofqw"><em>SofQW</em></a>, <a class="reference internal" href="SofQWPolygon-v1.html#algm-sofqwpolygon"><em>SofQWPolygon</em></a>, <a class="reference internal" href="Rebin2D-v1.html#algm-rebin2d"><em>Rebin2D</em></a></p>
<p>This algorithm is also known as: <strong>SofQW3</strong></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="2%" />
<col width="14%" />
<col width="4%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Reduced data in units of energy transfer DeltaE. The workspace must contain histogram data and have common bins across all spectra.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name to use for the q-omega workspace.</td>
</tr>
<tr class="row-even"><td>QAxisBinning</td>
<td>Input</td>
<td>dbl list</td>
<td><em>Mandatory</em></td>
<td>The bin parameters to use for the q axis (in the format used by the <a class="reference internal" href="Rebin-v1.html#algm-rebin"><em>Rebin v1</em></a> algorithm).</td>
</tr>
<tr class="row-odd"><td>EMode</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The energy transfer analysis mode (Direct/Indirect). Allowed values: [&#8216;Direct&#8217;, &#8216;Indirect&#8217;]</td>
</tr>
<tr class="row-even"><td>EFixed</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>The value of fixed energy: <img class="math" src="../_images/math/67a0b078f2a23c2a112fa770355a05c391d59569.png" alt="E_i" style="vertical-align: -3px"/> (EMode=Direct) or <img class="math" src="../_images/math/40bfef00f5c4b68f21cd987ae4423b63f9250c9a.png" alt="E_f" style="vertical-align: -6px"/> (EMode=Indirect) (meV). Must be set here if not available in the instrument definition.</td>
</tr>
<tr class="row-odd"><td>ReplaceNaNs</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If true, all NaN values in the output workspace are replaced using the ReplaceSpecialValues algorithm.</td>
</tr>
<tr class="row-even"><td>EAxisBinning</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>The bin parameters to use for the E axis (optional, in the format used by the <a class="reference internal" href="Rebin-v1.html#algm-rebin"><em>Rebin v1</em></a> algorithm).</td>
</tr>
<tr class="row-odd"><td>DetectorTwoThetaRanges</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A table workspace use by SofQWNormalisedPolygon containing a &#8216;Detector ID&#8217; column as well as &#8216;Min two theta&#8217; and &#8216;Max two theta&#8217; columns listing the detector&#8217;s min and max scattering angles in radians.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Converts a 2D workspace from <a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><em>units</em></a>
of spectrum number/<strong>energy transfer</strong>
to the intensity as a function of <strong>momentum transfer</strong> <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/>
and <strong>energy transfer</strong> <img class="math" src="../_images/math/e7f3976c8fc98924a2661d692ffbe4a2f6b7e4d8.png" alt="\Delta E" style="vertical-align: 0px"/>.</p>
<div class="figure align-center">
<img alt="../_images/RebinnedOutputStep1.png" src="../_images/RebinnedOutputStep1.png" />
</div>
<p>As shown in the figure, the input grid (pink-shaded parallelopiped,
aligned in scattering angle and energy transfer) is not parallel to the
output grid (square grid, aligned in <img class="math" src="../_images/math/f59dd7fde255c3f2d4d4d2f0631914aa7604d031.png" alt="Q" style="vertical-align: -4px"/> and energy). This means
that the output bins will only ever partially overlap the input data. To
account for this, the signal <img class="math" src="../_images/math/00839aaaedc416a533d839086d66341205c7ffc4.png" alt="Y" style="vertical-align: 0px"/> and errors <img class="math" src="../_images/math/a9c4c0ee488c07deaee7584752e35cd1aac1b253.png" alt="E" style="vertical-align: 0px"/> in the new
bins are calculated as:</p>
<div class="math">
<p><img src="../_images/math/67fd9b8d70b310acc1026129389362f2f51ee88a.png" alt="Y^{\mathrm{new}} = \sum_i Y^{\mathrm{old}}_i F_i"/></p>
</div><div class="math">
<p><img src="../_images/math/dff8382387cc94113463b4a00b6abe3aa2ee2ab7.png" alt="E^{\mathrm{new}} = \sqrt{\sum_i (E^{\mathrm{old}}_i)^2 F_i}"/></p>
</div><p>In addition to weighting the signal and error values, the total
fractional weights:</p>
<div class="math">
<p><img src="../_images/math/d2f625ed05390a02aede1b3aa5c6fa7238e3226b.png" alt="F^{\mathrm{new}} = \sum_i F_i"/></p>
</div><p>are also stored in the output of this algorithm which is a new workspace
type: <strong>RebinnedOutput</strong>. To see why this is needed, consider rebinning
the output on a larger grid:</p>
<div class="figure align-center">
<img alt="../_images/RebinnedOutputStep2.png" src="../_images/RebinnedOutputStep2.png" />
</div>
<p>If the fractional weights are not chained as shown, then the area
shaded in a lighter blue under <img class="math" src="../_images/math/9553af89635e87864e5ed39e397c77d5dbb2515e.png" alt="A_1" style="vertical-align: -4px"/> (where originally there was
no data) would be included in the weights, which would be an
overestimate of the actual weights, leading to an overestimate of the
signal and error.</p>
<p>Finally, if there is a bin in the output grid which only has a very
small overlap with the input grid (for example at the edges of the
detector coverage), the fractional weight <img class="math" src="../_images/math/68b0fc4683e0c8842b3a6cc6920f022f1c0db3fa.png" alt="F" style="vertical-align: 0px"/> of this bin, and
hence its signal <img class="math" src="../_images/math/00839aaaedc416a533d839086d66341205c7ffc4.png" alt="Y" style="vertical-align: 0px"/> and error <img class="math" src="../_images/math/a9c4c0ee488c07deaee7584752e35cd1aac1b253.png" alt="E" style="vertical-align: 0px"/> would be very small
compared to its neighbours. Thus, for display purposes, the actual
signal and errors stored in a RebinnedOutput are renomalised by the
weights:</p>
<div class="math">
<p><img src="../_images/math/44549b51e27501a0757b8d474db0eba685a70ef6.png" alt="Y^{\mathrm{display}} = Y^{\mathrm{new}} / F^{\mathrm{new}}"/></p>
</div><div class="math">
<p><img src="../_images/math/70d0acdee9469b532ff1da91c9163d01f0544711.png" alt="E^{\mathrm{display}} = E^{\mathrm{new}} / F^{\mathrm{new}}"/></p>
</div><p>at the end of the algorithm. The biggest consequence of this method is
that in places where there are no counts (<img class="math" src="../_images/math/529140d338ed5e09a63e345d8e32dfe957d08bc3.png" alt="Y=0" style="vertical-align: 0px"/>) and no acceptance
(no fractional areas, <img class="math" src="../_images/math/a9df789074c6df20093732233add15f6718824bf.png" alt="F=0" style="vertical-align: 0px"/>), <img class="math" src="../_images/math/476db63be43ad387616656fc8d58db4c60b773f4.png" alt="Y/F=" style="vertical-align: -5px"/><strong>nan</strong>-s will
result.</p>
<p>The algorithm operates in <em>non-PSD mode</em> by default. This means that the
scattering angle <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> range covered by a detector is calculated for
each detector individually. For grouped detectors, it is the minimum and
maximum <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> of all detectors in the group. The computation is
accurate for simple detector shapes (cylinder, cuboid); for other shapes a
more rough method is used. It is possible to provide precalculated
per-detector <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> values using the <tt class="docutils literal"><span class="pre">DetectorTwoThetaRanges</span></tt> input
property.</p>
<p><em>PSD mode</em> will determine the detector <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/> ranges from the
instrument geometry. This mode is activated by placing the following named
parameter in the instrument definition file: <em>detector-neighbour-offset</em>. The
integer value of this parameter should be the number of pixels that separates
two pixels at the same vertical position in adjacent tubes.</p>
<p>See <a class="reference internal" href="SofQWCentre-v1.html#algm-sofqwcentre"><em>SofQWCentre v1</em></a> for centre-point binning or <a class="reference internal" href="SofQWPolygon-v1.html#algm-sofqwpolygon"><em>SofQWPolygon v1</em></a>
for simpler and less precise but faster binning strategies. The speed-up
is from ignoring the azimuthal positions of the detectors (as for the non-PSD
mode in this algorithm) but in addition, <a class="reference internal" href="SofQWPolygon-v1.html#algm-sofqwpolygon"><em>SofQWPolygon v1</em></a> treats
all detectors as being the same, and characterised by a single width in
scattering angle. Thereafter, it weights the signal and error by the fractional
overlap, similarly to that shown in the first figure above, but then discards
the summed weights, producing a <strong>Workspace2D</strong> rather than a
<strong>RebinnedOutput</strong> workspace.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - simple transformation of inelastic workspace:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create sample inelastic workspace for MARI instrument containing 1 at all spectra</span>
<span class="n">ws</span><span class="o">=</span><span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="s">&#39;-10,1,10&#39;</span><span class="p">)</span>
<span class="c"># convert workspace into Matrix workspace with Q-dE coordinates</span>
<span class="n">ws</span><span class="o">=</span><span class="n">SofQWNormalisedPolygon</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span><span class="n">QAxisBinning</span><span class="o">=</span><span class="s">&#39;-3,0.1,3&#39;</span><span class="p">,</span><span class="n">Emode</span><span class="o">=</span><span class="s">&#39;Direct&#39;</span><span class="p">,</span><span class="n">EFixed</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;The converted X-Y values are:&quot;</span><span class="p">)</span>
<span class="n">Xrow</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">59</span><span class="p">);</span>
<span class="n">Yrow</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">59</span><span class="p">);</span>
<span class="n">line1</span><span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;! {0:&gt;6.2f} {1:&gt;6.2f} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Xrow</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">Yrow</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">line1</span> <span class="o">+</span> <span class="s">&quot; !&quot;</span><span class="p">)</span>
<span class="n">line2</span><span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;! {0:&gt;6.2f} {1:&gt;6.2f} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Xrow</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">Yrow</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">line2</span> <span class="o">+</span> <span class="s">&quot; !&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;! {0:&gt;6.2f} ------- !&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Xrow</span><span class="p">[</span><span class="mi">20</span><span class="p">]))</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none"><div class="highlight"><pre>The converted X-Y values are:
! -10.00   1.00  !  -9.00   1.00  !  -8.00   1.00  !  -7.00   1.00  !  -6.00   1.00  !  -5.00   1.00  !  -4.00   1.00  !  -3.00   1.00  !  -2.00   1.00  !  -1.00   1.00  !
!   0.00   1.00  !   1.00   1.00  !   2.00   1.00  !   3.00   1.00  !   4.00   1.00  !   5.00   1.00  !   6.00   1.00  !   7.00   1.00  !   8.00   1.00  !   9.00   1.00  !
!  10.00 ------- !
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Inelastic/SofQW.html">Inelastic\SofQW</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/242afc63eface10e47f5e9e6aeaed50e11e3eb4c/Framework/Algorithms/src/SofQWNormalisedPolygon.cpp">SofQWNormalisedPolygon.cpp</a> <em>(last modified: 2019-11-14)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/242afc63eface10e47f5e9e6aeaed50e11e3eb4c/Framework/Algorithms/inc/MantidAlgorithms/SofQWNormalisedPolygon.h">SofQWNormalisedPolygon.h</a> <em>(last modified: 2019-09-11)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SofQWMomentsScan-v1.html" title="Previous Chapter: SofQWMomentsScan v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SofQWMomentsScan...</span>
    </a>
  </li>
  <li>
    <a href="SofQWPolygon-v1.html" title="Next Chapter: SofQWPolygon v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SofQWPolygon v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-11-18.<br/>
    </p>
  </div>
</footer>
  </body>
</html>