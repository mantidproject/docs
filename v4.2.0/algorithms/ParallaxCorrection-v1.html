<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ParallaxCorrection v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="Pause v1" href="Pause-v1.html" />
    <link rel="prev" title="PaddingAndApodization v1" href="PaddingAndApodization-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="parallaxcorrection-v1">
<span id="algm-parallaxcorrection"></span><span id="algm-parallaxcorrection-v1"></span><h1>ParallaxCorrection v1<a class="headerlink" href="#parallaxcorrection-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/ParallaxCorrection-v1_dlg.png"><img alt="../_images/ParallaxCorrection-v1_dlg.png" class="screenshot" src="../_images/ParallaxCorrection-v1_dlg.png" style="width: 399px;" /></a>
<p class="caption"><strong>ParallaxCorrection</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#example-of-adding-parameters-in-the-ipf" id="id4">Example of adding parameters in the IPF</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#example-of-correction" id="id6">Example of correction</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Performs parallax correction for tube based SANS instruments.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="5%" />
<col width="30%" />
<col width="9%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An input workspace.</td>
</tr>
<tr class="row-odd"><td>ComponentNames</td>
<td>Input</td>
<td>str list</td>
<td><em>Mandatory</em></td>
<td>List of instrument components to perform the corrections for.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An output workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm performs a geometrical correction for the so-called parallax effect in tube based SANS instruments.</p>
<p>The correction formula must be specified in the <a class="reference internal" href="../concepts/InstrumentParameterFile.html#instrumentparameterfile"><em>IPF</em></a> as follows:</p>
<ul class="simple">
<li>A string parameter named <strong>direction</strong> must hold <strong>x</strong> or <strong>y</strong> which is the direction of the tubes in the detector.</li>
<li>A string parameter named <strong>parallax</strong> must hold the <a class="reference external" href="http://beltoforion.de/article.php?a=muparser">muparser</a> expression, where <strong>t</strong> is reserved for the parallax angle:</li>
</ul>
<p><img class="math" src="../_images/math/e6fd1561bef15d200a512e367359a229fb053720.png" alt="t = \arctan(\frac{x}{z})" style="vertical-align: -6px"/> if direction is <strong>y</strong>, and <img class="math" src="../_images/math/9b87fe031a0a9f7fc0d7db1df3713f5146b50f8b.png" alt="t = \arctan(\frac{y}{z})" style="vertical-align: -6px"/> if direction is <strong>x</strong>.</p>
<p><img class="math" src="../_images/math/c03b088c1fc08ebe3adbdbcb9ad084a30be0832c.png" alt="x, y, z" style="vertical-align: -4px"/> are the coordinates of the detector pixel in the system where sample is at <img class="math" src="../_images/math/d66fd62c01a5959c1cfa93ee88859764199594a8.png" alt="0,0,0" style="vertical-align: -4px"/> and <img class="math" src="../_images/math/4764300df3b118f2c580952e9fb04e7cd7943ba5.png" alt="z" style="vertical-align: 0px"/> is the beam axis.
<img class="math" src="../_images/math/b70f7632ddf68f9bd3aa72aef83255c843495d52.png" alt="t \in (0,\frac{\pi}{2})" style="vertical-align: -6px"/> in radians.</p>
<p>The correction will be calculated for each pixel and the input data will be divided by the correction and stored in the output.</p>
<p>The instrument parameters must be defined for detector components and without loss of generality, different components can have different formulae.</p>
<p>At least one component name must be given as input.</p>
</div>
<div class="section" id="example-of-adding-parameters-in-the-ipf">
<h2><a class="toc-backref" href="#id4">Example of adding parameters in the IPF</a><a class="headerlink" href="#example-of-adding-parameters-in-the-ipf" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;component-link</span> <span class="na">name=</span><span class="s">&quot;some_bank&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;parallax&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Normally, the function would be increasing with t --&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;1 + 0.01 * t&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/parameter&gt;</span>

  <span class="nt">&lt;parameter</span> <span class="na">name=</span><span class="s">&quot;direction&quot;</span> <span class="na">type=</span><span class="s">&quot;string&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;value</span> <span class="na">val=</span><span class="s">&quot;x&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/parameter&gt;</span>

<span class="nt">&lt;/component-link&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - ParallaxCorrection</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XMin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">XMax</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&quot;One Peak&quot;</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s">&quot;Wavelength&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">)</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">,</span> <span class="n">ParameterName</span><span class="o">=</span><span class="s">&quot;direction&quot;</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s">&quot;bank1&quot;</span><span class="p">,</span> <span class="n">ParameterType</span><span class="o">=</span><span class="s">&quot;String&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="o">=</span><span class="s">&quot;y&quot;</span><span class="p">)</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">,</span> <span class="n">ParameterName</span><span class="o">=</span><span class="s">&quot;parallax&quot;</span><span class="p">,</span> <span class="n">ComponentName</span><span class="o">=</span><span class="s">&quot;bank1&quot;</span><span class="p">,</span> <span class="n">ParameterType</span><span class="o">=</span><span class="s">&quot;String&quot;</span><span class="p">,</span> <span class="n">Value</span><span class="o">=</span><span class="s">&quot;1+0.1*t&quot;</span><span class="p">)</span>
<span class="n">ParallaxCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">,</span> <span class="n">ComponentNames</span><span class="o">=</span><span class="s">&quot;bank1&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&quot;out&quot;</span><span class="p">)</span>
<span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="s">&quot;in&quot;</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="s">&quot;out&quot;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&quot;corr&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;The correction is {0:.4f} for the spectrum {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s">&quot;corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">1000</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The correction is 1.0016 for the spectrum 1000
</pre></div>
</div>
</div>
<div class="section" id="example-of-correction">
<h2><a class="toc-backref" href="#id6">Example of correction</a><a class="headerlink" href="#example-of-correction" title="Permalink to this headline">¶</a></h2>
<p>Below is an example of the corrections for the instrument D22. The tubes are vertical, the magnitude depends only on the horizontal coordinate.
The correction increases with increasing angle from the beam, reaching about 10% for the outmost tube for detector distance of 1.5 meters.</p>
<div class="figure">
<img alt="../_images/parallax.png" src="../_images/parallax.png" />
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/242afc63eface10e47f5e9e6aeaed50e11e3eb4c/Framework/Algorithms/src/ParallaxCorrection.cpp">ParallaxCorrection.cpp</a> <em>(last modified: 2019-06-05)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/242afc63eface10e47f5e9e6aeaed50e11e3eb4c/Framework/Algorithms/inc/MantidAlgorithms/ParallaxCorrection.h">ParallaxCorrection.h</a> <em>(last modified: 2018-12-03)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PaddingAndApodization-v1.html" title="Previous Chapter: PaddingAndApodization v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PaddingAndApodiz...</span>
    </a>
  </li>
  <li>
    <a href="Pause-v1.html" title="Next Chapter: Pause v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Pause v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-11-18.<br/>
    </p>
  </div>
</footer>
  </body>
</html>