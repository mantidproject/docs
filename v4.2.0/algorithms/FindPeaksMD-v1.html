<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FindPeaksMD v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="FindReflectometryLines v2" href="FindReflectometryLines-v2.html" />
    <link rel="prev" title="FindPeaksAutomatic v1" href="FindPeaksAutomatic-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="findpeaksmd-v1">
<span id="algm-findpeaksmd"></span><span id="algm-findpeaksmd-v1"></span><h1>FindPeaksMD v1<a class="headerlink" href="#findpeaksmd-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/FindPeaksMD-v1_dlg.png"><img alt="../_images/FindPeaksMD-v1_dlg.png" class="screenshot" src="../_images/FindPeaksMD-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><strong>FindPeaksMD</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a><ul>
<li><a class="reference internal" href="#calculate-goniometer-for-constant-wavelength" id="id5">Calculate Goniometer For Constant Wavelength</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Find peaks in reciprocal space in a MDEventWorkspace or a MDHistoWorkspace.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="FindPeaks-v1.html#algm-findpeaks"><em>FindPeaks</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="92%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>IMDWorkspace</td>
<td><em>Mandatory</em></td>
<td>An input MDEventWorkspace or MDHistoWorkspace with at least 3 dimensions.</td>
</tr>
<tr class="row-odd"><td>PeakDistanceThreshold</td>
<td>Input</td>
<td>number</td>
<td>0.1</td>
<td>Threshold distance for rejecting peaks that are found to be too close from each other. This should be some multiple of the radius of a peak. Default: 0.1.</td>
</tr>
<tr class="row-even"><td>MaxPeaks</td>
<td>Input</td>
<td>number</td>
<td>500</td>
<td>Maximum number of peaks to find. Default: 500.</td>
</tr>
<tr class="row-odd"><td>PeakFindingStrategy</td>
<td>Input</td>
<td>string</td>
<td>VolumeNormalization</td>
<td>Strategy for finding peaks in an MD workspace.1. VolumeNormalization: This is the default strategy. It will sort all boxes in the workspace by deacresing order of signal density (total weighted event sum divided by box volume). 2.NumberOfEventsNormalization: This option is only valid for MDEventWorkspaces. It will use the total weighted event sum dividedby the number of events. This can improve peak finding for histogram-basedraw data which has been converted to an EventWorkspace. The threshold forpeak finding can be controlled by the SingalThresholdFactor property which shouldbe larger than 1. Note that this approach does not work for event-based raw data.  Allowed values: [&#8216;VolumeNormalization&#8217;, &#8216;NumberOfEventsNormalization&#8217;]</td>
</tr>
<tr class="row-even"><td>DensityThresholdFactor</td>
<td>Input</td>
<td>number</td>
<td>10</td>
<td>The overall signal density of the workspace will be multiplied by this factor  to get a threshold signal density below which boxes are NOT considered to be peaks. See the help. Default: 10.0</td>
</tr>
<tr class="row-odd"><td>SignalThresholdFactor</td>
<td>Input</td>
<td>number</td>
<td>1.5</td>
<td>The overal signal value (not density!) normalized by the number of events is compared to the specified signal threshold. Boxes which are below this threshold are NOT considered to be peaks.This property is enabled when the PeakFindingStrategy has been set to NumberOfEventsNormalization. The value of boxes which contain peaks will be above 1. See the below for more information. Default: 1.50</td>
</tr>
<tr class="row-even"><td>CalculateGoniometerForCW</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>This will calculate the goniometer rotation (around y-axis only) for a constant wavelength. This only works for Q sample workspaces.</td>
</tr>
<tr class="row-odd"><td>Wavelength</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Wavelength to use when calculating goniometer angle. If notset will use the wavelength parameter on the instrument.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>An output PeaksWorkspace with the peaks&#8217; found positions.</td>
</tr>
<tr class="row-odd"><td>AppendPeaks</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If checked, then append the peaks in the output workspace if it exists.  If unchecked, the output workspace is replaced (Default).</td>
</tr>
<tr class="row-even"><td>EdgePixels</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Remove peaks that are at pixels this close to edge.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm is used to find single-crystal peaks in a
multi-dimensional workspace (<a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><em>MDEventWorkspace</em></a> or
<a class="reference internal" href="../concepts/MDHistoWorkspace.html#mdhistoworkspace"><em>MDHistoWorkspace</em></a>). It looks for high signal
density areas, and is based on an algorithm designed by Dennis Mikkelson
for ISAW.</p>
<p>The algorithm proceeds in this way:</p>
<ul class="simple">
<li>Sorts all the boxes in the workspace by decreasing order of signal
density (total weighted event sum divided by box volume).<ul>
<li>It will skip any boxes with a density below a threshold. The
threshold is
<img class="math" src="../_images/math/1e1a50b25944e833deff8a599c0eb0f8f48fec6a.png" alt="TotalSignal / TotalVolume * DensityThresholdFactor" style="vertical-align: -5px"/>.</li>
</ul>
</li>
<li>The centroid of the strongest box is considered a peak.</li>
<li>The centroid of the next strongest box is calculated.<ul>
<li>We look through all the peaks that have already been found. If the
box is too close to an existing peak, it is rejected. This
distance is PeakDistanceThreshold.</li>
</ul>
</li>
<li>This is repeated until we find up to MaxPeaks peaks.</li>
</ul>
<p>Each peak created is placed in the output
<a class="reference internal" href="../concepts/PeaksWorkspace.html#peaksworkspace"><em>PeaksWorkspace</em></a>, which can be a new workspace or
replace the old one.</p>
<p>This algorithm works on a <a class="reference internal" href="../concepts/MDHistoWorkspace.html#mdhistoworkspace"><em>MDHistoWorkspace</em></a>
resulting from the <a class="reference internal" href="BinMD-v1.html#algm-binmd"><em>BinMD v1</em></a> algorithm also. It works in the
same way, except that the center of each bin is used since the centroid
is not accessible. It may give better results on
<a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><em>Workspace2D</em></a>&#8216;s that were converted to
<a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><em>MDWorkspaces</em></a>.</p>
<p>For data which has originally been based on histogram-type data and that has been converted to
event-based data it might be beneficial to select the NumberOfEventNormalization for the <cite>PeakFindingStrategy</cite> property instead of the VolumeNormalization which is the default. This
will disable the <cite>DensityThresholdFactor</cite> property and enable the <cite>SignalThresholdFactor</cite> property.
The algorithmic steps remain the same as above but instead of using the signal density as the sorting
quantity the signal count (total weighted event sum divided by the number of events) is used. If
the events are weighted this will result in boxes with signal counts larger than one for peaks and for the majority of background counts the signal count will be 1. Hence it is possible to discriminate between peaks and background. Note that the NumberOfEventNormalization selection of the <cite>PeakFindingStrategy</cite> property  does not make sense for all scenarios and infact might not produce useful results for your particular case.</p>
<div class="section" id="calculate-goniometer-for-constant-wavelength">
<h3><a class="toc-backref" href="#id5">Calculate Goniometer For Constant Wavelength</a><a class="headerlink" href="#calculate-goniometer-for-constant-wavelength" title="Permalink to this headline">¶</a></h3>
<p>The CalculateGoniometerForCW option allows you to keep only one
instrument definition from a set of merged MD workspaces. It only
works for a constant wavelength source and only for Q sample
workspaces. It also assumes the goniometer rotation is around the
y-axis only.</p>
<p>The goniometer (<img class="math" src="../_images/math/c84f71ae19adcbb26fa01e52f08a0db53a2c5679.png" alt="G" style="vertical-align: 0px"/>) is calculated from
<img class="math" src="../_images/math/2f244eaae3d239b58bf6b99de08b7089dc35c5f0.png" alt="\textbf{Q}_{sample}" style="vertical-align: -7px"/> for a given wavelength (<img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>)
by:</p>
<p>First calculate the <img class="math" src="../_images/math/8ca42f0e1637d41c886b19444f3a42ccf026d0f4.png" alt="\textbf{Q}_{lab}" style="vertical-align: -4px"/> using
<img class="math" src="../_images/math/2f244eaae3d239b58bf6b99de08b7089dc35c5f0.png" alt="\textbf{Q}_{sample}" style="vertical-align: -7px"/> and <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/>.</p>
<div class="math">
<p><img src="../_images/math/d471c965b89485cde79371cbb214034d7c28bb97.png" alt="k = \frac{2 \pi}{\lambda}"/></p>
</div><div class="math">
<p><img src="../_images/math/eb63fef49c7fd44312aa6ed56d01e7ee30de0e15.png" alt="G \textbf{Q}_{sample} = \textbf{Q}_{lab} = \left(\begin{array}{c}
-k\sin(\theta)\cos(\phi) \\
-k\sin(\theta)\sin(\phi) \\
k (1-\cos(\theta))
\end{array}\right) (1)"/></p>
</div><div class="math">
<p><img src="../_images/math/8d72f45174b4e885cdadc45db70d5f1b1031e677.png" alt="|\textbf{Q}_{sample}|^2 = |\textbf{Q}_{lab}|^2 = 2 k^2 (1-\cos(\theta))"/></p>
</div><p><img class="math" src="../_images/math/62b49dedaed99110457e3e662e7a50a7f16fc76b.png" alt="\therefore" style="vertical-align: -2px"/></p>
<div class="math">
<p><img src="../_images/math/d1be6d3ed942b95f465cad1fae0d7d3f75c156f2.png" alt="\theta = \cos^{-1}(1-\frac{|\textbf{Q}_{sample}|^2}{2k^2})"/></p>
</div><div class="math">
<p><img src="../_images/math/dc4e41b61fce0c560dc2e5ff6010ce88d4d3736a.png" alt="\phi = \sin^{-1}(-\textbf{Q}_{sample}^y \sin(\theta)/k)"/></p>
</div><p>where <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> is from 0 to <img class="math" src="../_images/math/2dfc7c4dd47aff2a8de066912cb776bf02f08437.png" alt="\pi" style="vertical-align: 0px"/> and  <img class="math" src="../_images/math/31474b06c59f21db91bcb3c8a425561a2e44a583.png" alt="\phi" style="vertical-align: -4px"/> is from <img class="math" src="../_images/math/574352bf4403cf2ff6d259fc3f5d33e6db90e58f.png" alt="-\pi/2" style="vertical-align: -5px"/> to <img class="math" src="../_images/math/62ddeb4a598892e516ef1992d5ea0008f1208bab.png" alt="\pi/2" style="vertical-align: -5px"/>. This means that it will assume your detector position is on the left of the beam even it it&#8217;s not.</p>
<p>Now you have <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/>, <img class="math" src="../_images/math/31474b06c59f21db91bcb3c8a425561a2e44a583.png" alt="\phi" style="vertical-align: -4px"/> and k you can get <img class="math" src="../_images/math/8ca42f0e1637d41c886b19444f3a42ccf026d0f4.png" alt="\textbf{Q}_{lab}" style="vertical-align: -4px"/> using (1).</p>
<p>We need to now solve <img class="math" src="../_images/math/cda4fcac79d575c5acb037ce8ebdd730df8f2109.png" alt="G \textbf{Q}_{sample} =
\textbf{Q}_{lab}" style="vertical-align: -7px"/>. For a rotation around y-axis only we want to find
<img class="math" src="../_images/math/1307919199d7c794988a56c76ab32300e1918a8b.png" alt="\psi" style="vertical-align: -4px"/> for:</p>
<div class="math">
<p><img src="../_images/math/3fffb0c49cd3918d71c1dca7519db4ad095d70ea.png" alt="G = \begin{bmatrix}
\cos(\psi)  &amp; 0 &amp; \sin(\psi) \\
0           &amp; 1 &amp; 0 \\
-\sin(\psi) &amp; 0 &amp; \cos(\psi)
\end{bmatrix} (2)"/></p>
</div><p>which gives two equations</p>
<div class="math">
<p><img src="../_images/math/5685efe57e333cfd2e0db44bc3abdb85cc322357.png" alt="\cos(\psi)\textbf{Q}_{sample}^x+\sin(\psi)\textbf{Q}_{sample}^z = \textbf{Q}_{lab}^x"/></p>
</div><div class="math">
<p><img src="../_images/math/ef25eea517806257cb98bbcb8fbd6887eb5567f8.png" alt="-\sin(\psi)\textbf{Q}_{sample}^x+\cos(\psi)\textbf{Q}_{sample}^z = \textbf{Q}_{lab}^z"/></p>
</div><p>make</p>
<div class="math">
<p><img src="../_images/math/f0e7aebfa2a0b75543268ecfc4d8b6f4ecd207fb.png" alt="A = \begin{bmatrix}
\textbf{Q}_{sample}^x &amp; \textbf{Q}_{sample}^z \\
\textbf{Q}_{sample}^z &amp; \textbf{Q}_{sample}^x
\end{bmatrix}"/></p>
</div><div class="math">
<p><img src="../_images/math/87b4091f386986591774f6117267cd7185658ac6.png" alt="B = \begin{bmatrix}
\textbf{Q}_{lab}^x \\
\textbf{Q}_{lab}^z
\end{bmatrix}"/></p>
</div><p>Then we need to solve <img class="math" src="../_images/math/a18dedd07eee85337c14a662de324a9a5d28fcc4.png" alt="A X = B" style="vertical-align: 0px"/> for <img class="math" src="../_images/math/6b20f2302d5e3b4b32a7cd8bfb55204e21b36aed.png" alt="X" style="vertical-align: 0px"/> where</p>
<div class="math">
<p><img src="../_images/math/30835eec3efa50f14d9268783f1e24cc7f0a9f78.png" alt="X = \begin{bmatrix}
\cos{\psi} \\
\sin{\psi}
\end{bmatrix} = A^{-1} B"/></p>
</div><p>then</p>
<div class="math">
<p><img src="../_images/math/015f7c734d59babc43e9a4ffd777dfa077141835.png" alt="\psi = \tan^{-1}\left(\frac{\sin{\psi}}{\cos{\psi}}\right)"/></p>
</div><p>Put <img class="math" src="../_images/math/1307919199d7c794988a56c76ab32300e1918a8b.png" alt="\psi" style="vertical-align: -4px"/> into (2) and you have the goniometer for that peak.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - IntegratePeaks:</strong></p>
<p>The code iteslef works but disabled from doc tests as takes too long to complete. User should provide its own
event nexus file instead of <strong>TOPAZ_3132_event.nxs</strong> used within this example. The original <strong>TOPAZ_3132_event.nxs</strong>
file is available in <a class="reference external" href="https://github.com/mantidproject/systemtests/tree/master/Data/TOPAZ_3132_event.nxs">Mantid system tests repository</a>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#.. testcode:: exFindPeaksMD</span>


<span class="k">def</span> <span class="nf">print_tableWS</span><span class="p">(</span><span class="n">pTWS</span><span class="p">,</span><span class="n">nRows</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Method to print part of the table workspace &#39;&#39;&#39;</span>
    <span class="n">tab_names</span><span class="o">=</span><span class="n">pTWS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">row</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tab_names</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">8</span><span class="p">:</span>
           <span class="n">name</span><span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">row</span> <span class="o">+=</span> <span class="s">&quot;| {:8} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRows</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tab_names</span><span class="p">:</span>
              <span class="n">col</span> <span class="o">=</span> <span class="n">pTWS</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
              <span class="n">data2pr</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
              <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data2pr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
                  <span class="n">row</span> <span class="o">+=</span> <span class="s">&quot;| {:8.1f} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data2pr</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">row</span> <span class="o">+=</span> <span class="s">&quot;| {:8} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data2pr</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">row</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span><span class="p">)</span>

<span class="c"># load test workspace</span>
<span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">r&#39;TOPAZ_3132_event.nxs&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;TOPAZ_3132_event&#39;</span><span class="p">,</span><span class="n">LoadMonitors</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">)</span>

<span class="c"># build peak workspace necessary for IntegrateEllipsoids algorithm to work</span>
<span class="n">ConvertToMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;TOPAZ_3132_event&#39;</span><span class="p">,</span><span class="n">QDimensions</span><span class="o">=</span><span class="s">&#39;Q3D&#39;</span><span class="p">,</span><span class="n">dEAnalysisMode</span><span class="o">=</span><span class="s">&#39;Elastic&#39;</span><span class="p">,</span><span class="n">Q3DFrames</span><span class="o">=</span><span class="s">&#39;Q_sample&#39;</span><span class="p">,</span><span class="n">LorentzCorrection</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;TOPAZ_3132_md&#39;</span><span class="p">,</span>\
<span class="n">MinValues</span><span class="o">=</span><span class="s">&#39;-25,-25,-25&#39;</span><span class="p">,</span><span class="n">MaxValues</span><span class="o">=</span><span class="s">&#39;25,25,25&#39;</span><span class="p">,</span><span class="n">SplitInto</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="n">SplitThreshold</span><span class="o">=</span><span class="s">&#39;50&#39;</span><span class="p">,</span><span class="n">MaxRecursionDepth</span><span class="o">=</span><span class="s">&#39;13&#39;</span><span class="p">,</span><span class="n">MinRecursionDepth</span><span class="o">=</span><span class="s">&#39;7&#39;</span><span class="p">)</span>
<span class="n">peaks</span><span class="o">=</span><span class="n">FindPeaksMD</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;TOPAZ_3132_md&#39;</span><span class="p">,</span><span class="n">PeakDistanceThreshold</span><span class="o">=</span><span class="s">&#39;0.37680&#39;</span><span class="p">,</span><span class="n">MaxPeaks</span><span class="o">=</span><span class="s">&#39;50&#39;</span><span class="p">,</span><span class="n">DensityThresholdFactor</span><span class="o">=</span><span class="s">&#39;100&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;TOPAZ_3132_peaks&#39;</span><span class="p">)</span>

<span class="c"># print 10 rows of table workspace</span>
<span class="n">print_tableWS</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p><strong>Output:</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#.. testoutput:: exFindPeaksMD</span>

<span class="o">|</span> <span class="n">RunNumbe</span> <span class="o">|</span> <span class="n">DetID</span>    <span class="o">|</span> <span class="n">h</span>        <span class="o">|</span> <span class="n">k</span>        <span class="o">|</span> <span class="n">l</span>        <span class="o">|</span> <span class="n">Waveleng</span> <span class="o">|</span> <span class="n">Energy</span>   <span class="o">|</span> <span class="n">TOF</span>      <span class="o">|</span> <span class="n">DSpacing</span> <span class="o">|</span> <span class="n">Intens</span>   <span class="o">|</span> <span class="n">SigInt</span>   <span class="o">|</span> <span class="n">BinCount</span> <span class="o">|</span> <span class="n">BankName</span> <span class="o">|</span> <span class="n">Row</span>      <span class="o">|</span> <span class="n">Col</span>      <span class="o">|</span> <span class="n">QLab</span>     <span class="o">|</span> <span class="n">QSample</span>  <span class="o">|</span> <span class="n">PeakNumb</span> <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1124984</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">3.1</span> <span class="o">|</span>      <span class="mf">8.5</span> <span class="o">|</span>  <span class="mf">14482.3</span> <span class="o">|</span>      <span class="mf">2.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>   <span class="mf">1668.0</span> <span class="o">|</span> <span class="n">bank17</span>   <span class="o">|</span>    <span class="mf">120.0</span> <span class="o">|</span>     <span class="mf">42.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">1.57771</span><span class="p">,</span><span class="mf">1.21779</span><span class="p">,</span><span class="mf">2.37854</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">2.99396</span><span class="p">,</span><span class="mf">0.815958</span><span class="p">,</span><span class="mf">0.00317344</span><span class="p">]</span> <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1156753</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">2.1</span> <span class="o">|</span>     <span class="mf">18.8</span> <span class="o">|</span>   <span class="mf">9725.7</span> <span class="o">|</span>      <span class="mf">1.3</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>   <span class="mf">1060.0</span> <span class="o">|</span> <span class="n">bank17</span>   <span class="o">|</span>    <span class="mf">145.0</span> <span class="o">|</span>    <span class="mf">166.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">2.48964</span><span class="p">,</span><span class="mf">1.45725</span><span class="p">,</span><span class="mf">3.88666</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">4.52618</span><span class="p">,</span><span class="mf">1.71025</span><span class="p">,</span><span class="mf">0.129461</span><span class="p">]</span> <span class="o">|</span> <span class="mi">2</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1141777</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.7</span> <span class="o">|</span>     <span class="mf">28.1</span> <span class="o">|</span>   <span class="mf">7963.2</span> <span class="o">|</span>      <span class="mf">1.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>     <span class="mf">96.0</span> <span class="o">|</span> <span class="n">bank17</span>   <span class="o">|</span>     <span class="mf">17.0</span> <span class="o">|</span>    <span class="mf">108.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">2.60836</span><span class="p">,</span><span class="mf">2.31423</span><span class="p">,</span><span class="mf">4.86391</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">5.69122</span><span class="p">,</span><span class="mf">1.79492</span><span class="p">,</span><span class="o">-</span><span class="mf">0.452799</span><span class="p">]</span> <span class="o">|</span> <span class="mi">3</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1125241</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.6</span> <span class="o">|</span>     <span class="mf">33.9</span> <span class="o">|</span>   <span class="mf">7252.2</span> <span class="o">|</span>      <span class="mf">1.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>     <span class="mf">83.0</span> <span class="o">|</span> <span class="n">bank17</span>   <span class="o">|</span>    <span class="mf">121.0</span> <span class="o">|</span>     <span class="mf">43.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">3.15504</span><span class="p">,</span><span class="mf">2.42573</span><span class="p">,</span><span class="mf">4.75121</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">5.97829</span><span class="p">,</span><span class="mf">1.63473</span><span class="p">,</span><span class="mf">0.0118744</span><span class="p">]</span> <span class="o">|</span> <span class="mi">4</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1170598</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.5</span> <span class="o">|</span>     <span class="mf">34.1</span> <span class="o">|</span>   <span class="mf">7224.6</span> <span class="o">|</span>      <span class="mf">0.9</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>     <span class="mf">73.0</span> <span class="o">|</span> <span class="n">bank17</span>   <span class="o">|</span>    <span class="mf">166.0</span> <span class="o">|</span>    <span class="mf">220.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">3.43363</span><span class="p">,</span><span class="mf">1.70178</span><span class="p">,</span><span class="mf">5.39301</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">6.07726</span><span class="p">,</span><span class="mf">2.59962</span><span class="p">,</span><span class="mf">0.281759</span><span class="p">]</span> <span class="o">|</span> <span class="mi">5</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1214951</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.9</span> <span class="o">|</span>     <span class="mf">22.8</span> <span class="o">|</span>   <span class="mf">8839.5</span> <span class="o">|</span>      <span class="mf">1.7</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>    <span class="mf">719.0</span> <span class="o">|</span> <span class="n">bank18</span>   <span class="o">|</span>    <span class="mf">231.0</span> <span class="o">|</span>    <span class="mf">137.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">2.73683</span><span class="p">,</span><span class="mf">1.43808</span><span class="p">,</span><span class="mf">2.11574</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">3.5786</span><span class="p">,</span><span class="mf">0.470838</span><span class="p">,</span><span class="mf">1.00329</span><span class="p">]</span> <span class="o">|</span> <span class="mi">6</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1207827</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.7</span> <span class="o">|</span>     <span class="mf">27.9</span> <span class="o">|</span>   <span class="mf">7991.7</span> <span class="o">|</span>      <span class="mf">1.3</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>    <span class="mf">447.0</span> <span class="o">|</span> <span class="n">bank18</span>   <span class="o">|</span>     <span class="mf">19.0</span> <span class="o">|</span>    <span class="mf">110.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">2.80324</span><span class="p">,</span><span class="mf">2.29519</span><span class="p">,</span><span class="mf">3.09134</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">4.71517</span><span class="p">,</span><span class="mf">0.554412</span><span class="p">,</span><span class="mf">0.37714</span><span class="p">]</span> <span class="o">|</span> <span class="mi">7</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1232949</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.2</span> <span class="o">|</span>     <span class="mf">53.3</span> <span class="o">|</span>   <span class="mf">5782.1</span> <span class="o">|</span>      <span class="mf">0.9</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>     <span class="mf">45.0</span> <span class="o">|</span> <span class="n">bank18</span>   <span class="o">|</span>     <span class="mf">53.0</span> <span class="o">|</span>    <span class="mf">208.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">4.29033</span><span class="p">,</span><span class="mf">2.63319</span><span class="p">,</span><span class="mf">4.46168</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">6.52658</span><span class="p">,</span><span class="mf">1.27985</span><span class="p">,</span><span class="mf">1.00646</span><span class="p">]</span> <span class="o">|</span> <span class="mi">8</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1189484</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.1</span> <span class="o">|</span>     <span class="mf">63.4</span> <span class="o">|</span>   <span class="mf">5299.3</span> <span class="o">|</span>      <span class="mf">1.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>     <span class="mf">31.0</span> <span class="o">|</span> <span class="n">bank18</span>   <span class="o">|</span>    <span class="mf">108.0</span> <span class="o">|</span>     <span class="mf">38.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">4.02414</span><span class="p">,</span><span class="mf">3.39659</span><span class="p">,</span><span class="mf">3.83664</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">6.4679</span><span class="p">,</span><span class="mf">0.298896</span><span class="p">,</span><span class="mf">0.726133</span><span class="p">]</span> <span class="o">|</span> <span class="mi">9</span>        <span class="o">|</span>
<span class="o">|</span> <span class="mi">3132</span>     <span class="o">|</span> <span class="mi">1218337</span>  <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">1.0</span> <span class="o">|</span>     <span class="mf">79.8</span> <span class="o">|</span>   <span class="mf">4724.1</span> <span class="o">|</span>      <span class="mf">0.8</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>      <span class="mf">0.0</span> <span class="o">|</span>     <span class="mf">15.0</span> <span class="o">|</span> <span class="n">bank18</span>   <span class="o">|</span>     <span class="mf">33.0</span> <span class="o">|</span>    <span class="mf">151.0</span> <span class="o">|</span> <span class="p">[</span><span class="mf">4.96622</span><span class="p">,</span><span class="mf">3.61607</span><span class="p">,</span><span class="mf">5.32554</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mf">7.99244</span><span class="p">,</span><span class="mf">1.19363</span><span class="p">,</span><span class="mf">0.892655</span><span class="p">]</span> <span class="o">|</span> <span class="mi">10</span>       <span class="o">|</span>
</pre></div>
</td></tr></table></div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Optimization/PeakFinding.html">Optimization\PeakFinding</a> | <a class="reference external" href="categories/MDAlgorithms/Peaks.html">MDAlgorithms\Peaks</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/242afc63eface10e47f5e9e6aeaed50e11e3eb4c/Framework/MDAlgorithms/src/FindPeaksMD.cpp">FindPeaksMD.cpp</a> <em>(last modified: 2019-07-17)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/242afc63eface10e47f5e9e6aeaed50e11e3eb4c/Framework/MDAlgorithms/inc/MantidMDAlgorithms/FindPeaksMD.h">FindPeaksMD.h</a> <em>(last modified: 2018-10-05)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="FindPeaksAutomatic-v1.html" title="Previous Chapter: FindPeaksAutomatic v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; FindPeaksAutomat...</span>
    </a>
  </li>
  <li>
    <a href="FindReflectometryLines-v2.html" title="Next Chapter: FindReflectometryLines v2"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">FindReflectometr... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-11-18.<br/>
    </p>
  </div>
</footer>
  </body>
</html>