<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Beam centre tab</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '4.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../../index.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.2</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="beam-centre-tab">
<span id="isis-sans-beam-centre-tab-ref"></span><h1>Beam centre tab<a class="headerlink" href="#beam-centre-tab" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="../../_images/beam_centre_page.png"><img alt="../../_images/beam_centre_page.png" class="align-right" src="../../_images/beam_centre_page.png" style="width: 800px;" /></a>
<p>The beam centre tab allows the position of the beam centre to be set either
manually by the user or by running the beam centre finder.</p>
<p>The beam centre finder iteratively locate estimates of the X &amp; Y coordinates
of the centre of a scattering pattern.</p>
<p>On LOQ, where the main detector never moves, the beam centre stays fairly
constant, typically only ever moving a fraction of a mm as the incident beam
size is changed.</p>
<p>On SANS2D, however, it is a completely different story; not only does the
detector move in Z but it will often also be offset in X. This means that the
beam centre coordinates can vary significantly (10&#8217;s of mm) between successive
Users and, thus, user files.</p>
</div>
<div class="section" id="using-the-beam-finder-on-loq">
<h1>Using the Beam Finder on LOQ<a class="headerlink" href="#using-the-beam-finder-on-loq" title="Permalink to this headline">¶</a></h1>
<ol class="arabic">
<li><p class="first">Load the previous user (mask) file (or a proto-user file for the new User).</p>
</li>
<li><p class="first">Load a suitable SANS pattern (eg, the scattering from a calibration standard
for the Main detector, or a Glassy Carbon for the HAB).</p>
</li>
<li><p class="first">Under the &#8216;Analysis details&#8217; tab, limit the wavelength range from 2.2 to 5.0
Angstroms for the Main detector, or 2.2 to 7.0 Angstroms for the HAB.
For the HAB, also limit the radius from 35 to 750 mm AND select the
HAB detector.</p>
</li>
<li><p class="first">For the Main detector, limit the Q range from 0.029 to 0.149 /Angstrom,
and bin it in logarithmic 0.08 steps. For the HAB limit the Q range from
0.22 to 0.8 /Angstrom, and bin it in linear 0.0125 steps.</p>
</li>
<li><p class="first">In the &#8216;Beam Centre&#8217; box under the &#8216;Geometry&#8217; tab, ensure the starting
position is &#8216;Current&#8217;, that the radius limits are 96 &amp; 216 for the Main
detector or 96 &amp; 750 for the HAB, and set the number of iterations for the
search algorithm to 20.</p>
<a class="reference internal image-reference" href="../../_images/beam_centre_page_search_example.png"><img alt="../../_images/beam_centre_page_search_example.png" class="align-center" src="../../_images/beam_centre_page_search_example.png" style="width: 300px;" /></a>
</li>
<li><p class="first">Run the beam centre finder. A good solution is one in which all 4 curves on
the plot overlap one another. Typically it will converge before the
iterations are exhausted.</p>
<a class="reference internal image-reference" href="../../_images/beam_centre_page_result_example.png"><img alt="../../_images/beam_centre_page_result_example.png" class="align-center" src="../../_images/beam_centre_page_result_example.png" style="width: 300px;" /></a>
</li>
<li><p class="first">Edit the final beam centre coordinates into the user file
SET CENTRE and SET CENTRE/HAB.</p>
</li>
</ol>
<p>Note: The Mantid routine particular seems to converge to what it considers an
acceptable result slightly too early (perhaps 0.5 mm different).</p>
<p>This is under investigation. In the meantime a good workaround is to examine
the X &amp; Y residual values and note down the X &amp; Y coordinates with the
lowest residuals (these will likely be on different iterations).
Edit these coordinates into the user file, reload it, and
re-run the beam centre finder (remembering that any changes you made in
Analysis Details will need to be reset).</p>
<p>Repeat this process a couple of times and you will get good beam centre
coordinates.</p>
</div>
<div class="section" id="using-the-beam-finder-on-sans2d">
<h1>Using the Beam Finder on SANS2D<a class="headerlink" href="#using-the-beam-finder-on-sans2d" title="Permalink to this headline">¶</a></h1>
<p>The search algorithm typically requires starting coordinates that are
within 20 mm of the final iterated best estimates in order to work properly.
This may sound generous, but on a detector 980 mm square this tolerance
actually translates to about 4%!</p>
<p>Obtaining reliable starting coordinates for the centre search is
therefore paramount.</p>
<p>The following procedure seems to work:</p>
<ol class="arabic simple">
<li>Load the most recent user (mask) file (or a proto-user file for
the new User).</li>
<li>Load a suitable SANS pattern (eg, the scattering from a calibration
standard).</li>
<li>&#8216;Show Instrument&#8217; on the SANS run.</li>
<li>In &#8216;Pick&#8217; mode, using the cursor and the physical coordinates of the
pixels displayed at the bottom of the screen, work out the X &amp; Y
displacements of the centre of the pattern from the origin of the display
(a small square overlaid on the detector pattern).
NB: If the Origin appears to have coordinates (0,0,Z) then the user file
may already have the correct - or an almost correct - beam centre.</li>
<li>The displacements will be in m, so multiply them by 1000 to convert to mm.
Subtract these values from the SET CENTRE X &amp; Y values in the user file and
save it. As a guide, the Y-centre will typically be about -170,
give or take a few mm.</li>
<li>Under the &#8216;Run Numbers&#8217; tab, reload the user file.</li>
<li>Under the &#8216;Analysis Details&#8217; tab, limit the Qx range to a maximum of
about 0.15 /Ang and increase the Q binning to improve the data quality,
say 12% log bins. It is also a good idea to push out the minimum Q.
At 4m, say, from 0.0035 to 0.01 /Angstron, for example.</li>
<li>In the &#8216;Beam Centre&#8217; box under the &#8216;Geometry&#8217; tab, ensure the starting
position is &#8216;Current&#8217;, that the radius limits are something like 60 &amp; 280,
and set the number of iterations for the search algorithm to 2.</li>
<li>Run the beam centre finder. If it looks as if it is starting to converge,
increase the number of iterations to between 10 and 20 and re-run it.
A good solution is one in which all 4 curves on the plot overlap one
another.</li>
<li>Edit the final beam centre coordinates into the user file SET CENTRE.</li>
</ol>
</div>
<div class="section" id="description-of-tab">
<h1>Description Of Tab<a class="headerlink" href="#description-of-tab" title="Permalink to this headline">¶</a></h1>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Centre Position LAB</strong></td>
<td>The centre position of the low angle bank. The first coordinate is horizontal
and the second vertical. These boxes are populated by the user file and the values here
are used by the reduction.</td>
</tr>
<tr class="row-even"><td><strong>Centre Position HAB</strong></td>
<td>The centre position of the high angle bank. The first coordinate is horizontal
and the second vertical. These boxes are populated by the user file and the values here
are used by the reduction.</td>
</tr>
<tr class="row-odd"><td><strong>Minimum radius limit</strong></td>
<td>The minimum radius of the region used to ascertain centre position.</td>
</tr>
<tr class="row-even"><td><strong>Maximum radius limit</strong></td>
<td>The maximum radius of the region used to ascertain centre position.</td>
</tr>
<tr class="row-odd"><td><strong>Minimum Q limit</strong></td>
<td>The minimum Q of the region used to ascertain centre position.</td>
</tr>
<tr class="row-even"><td><strong>Maximum Q limit</strong></td>
<td>The maximum Q of the region used to ascertain centre position.</td>
</tr>
<tr class="row-odd"><td><strong>Max iterations</strong></td>
<td>The maximum number of iterations the algorithm will perform before concluding its
search.</td>
</tr>
<tr class="row-even"><td><strong>Tolerance</strong></td>
<td>If the centre position moves by less than this in an iteration the algorithm will
conclude its search.</td>
</tr>
<tr class="row-odd"><td><strong>General Options</strong></td>
<td>The <strong>Verbose</strong> option will store the output workspaces from all iterations in memory.
The <strong>Initial COM</strong> option will if checked use a centre of mass estimate as the starting
point of the search rather than the user input value.</td>
</tr>
<tr class="row-even"><td><strong>Left/Right</strong></td>
<td>Controls whether the beam centre finder searches for the centre in the
left/right and up/down directions.</td>
</tr>
<tr class="row-odd"><td><strong>Run</strong></td>
<td>Runs the beam centre finder the boxes <strong>1</strong> and <strong>2</strong> are updated with new
values upon completion.</td>
</tr>
</tbody>
</table>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-11-18.<br/>
    </p>
  </div>
</footer>
  </body>
</html>