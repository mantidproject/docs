<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>UpdateInstrumentFromFile v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="UpdatePeakParameterTableValue v1" href="UpdatePeakParameterTableValue-v1.html" />
    <link rel="prev" title="UnwrapSNS v1" href="UnwrapSNS-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.7</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="updateinstrumentfromfile-v1">
<span id="algm-updateinstrumentfromfile"></span><span id="algm-updateinstrumentfromfile-v1"></span><h1>UpdateInstrumentFromFile v1<a class="headerlink" href="#updateinstrumentfromfile-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/UpdateInstrumentFromFile-v1_dlg.png"><img alt="../_images/UpdateInstrumentFromFile-v1_dlg.png" class="screenshot" src="../_images/UpdateInstrumentFromFile-v1_dlg.png" style="width: 296px;" /></a>
<p class="caption"><strong>UpdateInstrumentFromFile</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#alias" id="id2">Alias</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a><ul>
<li><a class="reference internal" href="#related-or-similar-algorithms" id="id5">Related or similar algorithms</a></li>
<li><a class="reference internal" href="#additional-detector-parameters-using-ascii-file" id="id6">Additional Detector Parameters Using ASCII File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Updates detector positions initially loaded in from the Instrument Definition File (IDF) with information from the provided file.</p>
</div>
<div class="section" id="alias">
<h2><a class="toc-backref" href="#id2">Alias</a><a class="headerlink" href="#alias" title="Permalink to this headline">¶</a></h2>
<p>This algorithm is also known as: <strong>UpdateInstrumentFromRaw</strong></p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="10%" />
<col width="3%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Workspace</td>
<td>InOut</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the workspace in which to store the imported instrument</td>
</tr>
<tr class="row-odd"><td>Filename</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>The filename of the input file. Currently supports RAW, ISIS NeXus, DAT &amp; multi-column (at least 2) ascii files. Allowed extensions: [&#8216;.raw&#8217;, &#8216;.nxs&#8217;, &#8216;.s*&#8217;]</td>
</tr>
<tr class="row-even"><td>MoveMonitors</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If true the positions of any detectors marked as monitors in the IDF will be moved also</td>
</tr>
<tr class="row-odd"><td>IgnorePhi</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If true the phi values form the file will be ignored</td>
</tr>
<tr class="row-even"><td>AsciiHeader</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>If the file is a simple text file, then this property is used todefine the values in each column of the file. For example: spectrum,theta,t0,-,RKeywords=spectrum,ID,R,theta,phi. A dash means skip column. Keywords are recognisedas identifying components to move to new positions. Any other names in the listare added as instrument parameters.</td>
</tr>
<tr class="row-odd"><td>SkipFirstNLines</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>If the file is ASCII, then skip this number of lines at the start of the file</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Some instrument definition file (<a class="reference internal" href="../concepts/InstrumentDefinitionFile.html#instrumentdefinitionfile"><em>IDF</em></a>)
positions are only approximately correct and the true positions are
located within data files. This algorithm reads the detector positioning
from the supplied file and updates the instrument accordingly. It
currently supports ISIS Raw, ISIS NeXus files and ASCII files.</p>
<p>It is assumed that the positions specified in the file are all with
respect to the a coordinate system defined with its origin at the sample
position. Note that this algorithm moves the detectors without
subsequent rotation, hence this means that detectors may not for example
face the sample perfectly after this algorithm has been applied.</p>
<div class="section" id="related-or-similar-algorithms">
<h3><a class="toc-backref" href="#id5">Related or similar algorithms</a><a class="headerlink" href="#related-or-similar-algorithms" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference internal" href="LoadDetectorInfo-v1.html#algm-loaddetectorinfo"><em>LoadDetectorInfo v1</em></a> which can do similar job modifying the detector parameters and positions and working with special format ASCII files or ISIS raw or special nexus files.</p>
</div>
<div class="section" id="additional-detector-parameters-using-ascii-file">
<h3><a class="toc-backref" href="#id6">Additional Detector Parameters Using ASCII File</a><a class="headerlink" href="#additional-detector-parameters-using-ascii-file" title="Permalink to this headline">¶</a></h3>
<p>The ASCII format allows a multi-column text file to provide new
positions along with additional parameters for each detector. If a text
file is used then the <tt class="docutils literal"><span class="pre">AsciiHeader</span></tt> parameter is required as it
identifies each column in the file as header information in the file is
always ignored. There is a minor restriction in that the first column is
expected to specify either a detector ID or a spectrum number and will
never be interpreted as anything else.</p>
<p>The keywords recognised by the algorithm to pick out detector position
values &amp; spectrum/ID values are: spectrum, ID, R,theta, phi. The
spectrum/ID keywords can only be used in the first column. A dash (-) is
used to ignore a column.</p>
<p>As an example the following header:</p>
<div class="highlight-python"><div class="highlight"><pre>spectrum,theta,-,-,R
</pre></div>
</div>
<p>and the following text file:</p>
<div class="highlight-python"><div class="highlight"><pre>1   0.0000  -4.2508  11.0550  -2.4594
2   0.0000   0.0000  11.0550   2.3800
3 130.4653  -0.4157  11.0050   0.6708
4 131.9319  -0.5338  11.0050   0.6545
5 133.0559  -0.3362  11.0050   0.6345
</pre></div>
</div>
<p>would tell the algorithm to interpret the columns as:</p>
<ol class="arabic simple">
<li>Spectrum number</li>
<li>Theta position value</li>
<li>Ignored: Detector&#8217;s electronics delay time &#8211; the difference of pulse synchronization signal time and the time DAE starts measuring frame time of given spectra.</li>
<li>Ignored: Sample to source distance for the particular detector</li>
<li>Sample-detector distance R.</li>
</ol>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Update Instrument:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c"># priting procedure</span>
<span class="k">def</span> <span class="nf">print_10_detectors</span><span class="p">(</span><span class="n">instr_type</span><span class="p">,</span><span class="n">instr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; print first 10 detectors from given instrument &#39;&#39;&#39;</span>
     <span class="c"># get first 10 detectors using detector ID</span>

    <span class="k">print</span> <span class="s">&quot;{0} {1} instrument&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instr_type</span><span class="p">,</span> <span class="n">instr</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
          <span class="n">detBase</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">detBase</span> <span class="o">=</span> <span class="mi">1101</span><span class="o">-</span><span class="mi">3</span>
      <span class="n">detID</span> <span class="o">=</span> <span class="n">detBase</span><span class="o">+</span><span class="n">i</span>
      <span class="n">det1</span> <span class="o">=</span> <span class="n">instr</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="n">detID</span><span class="p">);</span>
      <span class="n">pos</span> <span class="o">=</span> <span class="n">det1</span><span class="o">.</span><span class="n">getPos</span><span class="p">();</span>
      <span class="k">print</span> <span class="s">&#39;det with ID: {0:5} is monitor? {1:5}, polar angle: {2:10.3f}, position: | {3:&lt;10.3f} | {4:&lt;10.3f} | {5:&lt;10.3f}|</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>\
             <span class="n">detID</span><span class="p">,</span><span class="n">det1</span><span class="o">.</span><span class="n">isMonitor</span><span class="p">(),(</span><span class="n">det1</span><span class="o">.</span><span class="n">getPhi</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)),</span><span class="n">pos</span><span class="o">.</span><span class="n">X</span><span class="p">(),</span><span class="n">pos</span><span class="o">.</span><span class="n">Y</span><span class="p">(),</span><span class="n">pos</span><span class="o">.</span><span class="n">Z</span><span class="p">()),</span>
    <span class="k">print</span> <span class="s">&#39;*********************************************************************************&#39;</span>

<span class="c">#--------------------------------------------------------------------------------------</span>
<span class="c"># create sample workspace</span>
<span class="n">ws</span><span class="o">=</span><span class="n">CreateSampleWorkspace</span><span class="p">();</span>
<span class="c">#--------------------------------------------------------------------------------------</span>
<span class="c"># load MARI</span>
<span class="n">det</span><span class="o">=</span><span class="n">LoadInstrument</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;MARI&#39;</span><span class="p">,</span> <span class="n">RewriteSpectraMap</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">inst1</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">();</span>
<span class="c">#</span>
<span class="n">print_10_detectors</span><span class="p">(</span><span class="s">&#39;unCalibrated&#39;</span><span class="p">,</span><span class="n">inst1</span><span class="p">);</span>
<span class="c">#--------------------------------------------------------------------------------------</span>
<span class="c"># Prepare calibration file changing first 6 detectors &amp; monitors</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s">&quot;defaultsave.directory&quot;</span><span class="p">],</span> <span class="s">&quot;TestCalibration.dat&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">);</span>
<span class="c"># prepare through each spectra in the test workspace and change its detector calibration parameters</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; Test calibration file </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39; detID  theta  delay source_dist detector_dist</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
   <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{0}  {1}  {2}  {3}  {4}  {5}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">3.1415926</span><span class="o">/</span><span class="mi">200</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">100</span><span class="p">,(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">3.1415926</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
<span class="c">#--------------------------------------------------------------------------------------</span>
<span class="c"># CALIBRATE:</span>
<span class="n">UpdateInstrumentFromFile</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">Filename</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span><span class="n">AsciiHeader</span><span class="o">=</span><span class="s">&#39;spectrum,theta,-,-,phi,R&#39;</span><span class="p">,</span><span class="n">MoveMonitors</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">SkipFirstNLines</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">inst1</span><span class="o">=</span><span class="n">ws</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">();</span>
<span class="c">#--------------------------------------------------------------------------------------</span>
<span class="c"># look at the result:</span>
<span class="n">print_10_detectors</span><span class="p">(</span><span class="s">&#39;Calibrated&#39;</span><span class="p">,</span><span class="n">inst1</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none"><div class="highlight"><pre>unCalibrated MARI instrument
det with ID:     1 is monitor?     1, polar angle:      0.000, position: | 0.000      | 0.000      | -4.739    |
det with ID:     2 is monitor?     1, polar angle:      0.000, position: | 0.000      | 0.000      | -1.442    |
det with ID:     3 is monitor?     1, polar angle:      0.000, position: | 0.000      | 0.000      | 5.820     |
det with ID:  1101 is monitor?     0, polar angle:    -68.640, position: | 0.347      | -0.888     | 3.907     |
det with ID:  1102 is monitor?     0, polar angle:    -69.300, position: | 0.347      | -0.919     | 3.900     |
det with ID:  1103 is monitor?     0, polar angle:    -69.920, position: | 0.347      | -0.950     | 3.893     |
det with ID:  1104 is monitor?     0, polar angle:    -70.510, position: | 0.347      | -0.981     | 3.885     |
det with ID:  1105 is monitor?     0, polar angle:    -71.060, position: | 0.347      | -1.012     | 3.877     |
det with ID:  1106 is monitor?     0, polar angle:    -71.570, position: | 0.347      | -1.043     | 3.869     |
det with ID:  1107 is monitor?     0, polar angle:    -72.060, position: | 0.347      | -1.073     | 3.861     |
*********************************************************************************
Calibrated MARI instrument
det with ID:     1 is monitor?     1, polar angle:      0.628, position: | 0.003      | 0.000      | 10.000    |
det with ID:     2 is monitor?     1, polar angle:      1.257, position: | 0.005      | 0.000      | 10.000    |
det with ID:     3 is monitor?     1, polar angle:      1.885, position: | 0.008      | 0.000      | 10.000    |
det with ID:  1101 is monitor?     0, polar angle:      2.513, position: | 0.011      | 0.000      | 10.000    |
det with ID:  1102 is monitor?     0, polar angle:      3.142, position: | 0.014      | 0.001      | 10.000    |
det with ID:  1103 is monitor?     0, polar angle:      3.770, position: | 0.016      | 0.001      | 10.000    |
det with ID:  1104 is monitor?     0, polar angle:    -70.510, position: | 0.347      | -0.981     | 3.885     |
det with ID:  1105 is monitor?     0, polar angle:    -71.060, position: | 0.347      | -1.012     | 3.877     |
det with ID:  1106 is monitor?     0, polar angle:    -71.570, position: | 0.347      | -1.043     | 3.869     |
det with ID:  1107 is monitor?     0, polar angle:    -72.060, position: | 0.347      | -1.073     | 3.861     |
*********************************************************************************
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/DataHandling/Instrument.html">DataHandling\Instrument</a> | <a class="reference external" href="categories/DataHandling/Raw.html">DataHandling\Raw</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/fa5a1131e7c741eb04be0c8ff63502e3217916cb/Framework/DataHandling/src/UpdateInstrumentFromFile.cpp">UpdateInstrumentFromFile.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/fa5a1131e7c741eb04be0c8ff63502e3217916cb/Framework/DataHandling/inc/MantidDataHandling/UpdateInstrumentFromFile.h">UpdateInstrumentFromFile.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="UnwrapSNS-v1.html" title="Previous Chapter: UnwrapSNS v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; UnwrapSNS v1</span>
    </a>
  </li>
  <li>
    <a href="UpdatePeakParameterTableValue-v1.html" title="Next Chapter: UpdatePeakParameterTableValue v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">UpdatePeakParame... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>