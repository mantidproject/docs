<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>EnggCalibrate v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.10.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="EnggCalibrateFull v1" href="EnggCalibrateFull-v1.html" />
    <link rel="prev" title="EnergyWindowScan v1" href="EnergyWindowScan-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="enggcalibrate-v1">
<span id="algm-enggcalibrate"></span><span id="algm-enggcalibrate-v1"></span><h1>EnggCalibrate v1<a class="headerlink" href="#enggcalibrate-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/EnggCalibrate-v1_dlg.png"><img alt="../_images/EnggCalibrate-v1_dlg.png" class="screenshot" src="../_images/EnggCalibrate-v1_dlg.png" style="width: 224px;" /></a>
<p class="caption"><strong>EnggCalibrate</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#source" id="id4">Source</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calibrates one or more detector banks (or group(s) of detectors) by performing single peak fitting.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="7%" />
<col width="38%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Workspace with the calibration run to use.</td>
</tr>
<tr class="row-odd"><td>ExpectedPeaks</td>
<td>Input</td>
<td>dbl list</td>
<td>3.12428,2.7057,1.91322,1.6316,1.56214,1.35285,1.24146,1.21003,1.1046,1.04143,0.95661,0.914694,0.901901,0.855618,0.825232,0.8158,0.781069,0.757748,0.750427,0.72313,0.704505,0.676426,0.661108,0.656229,0.63774,0.624855,0.620731,0.605014</td>
<td>A list of dSpacing values where peaks are expected.</td>
</tr>
<tr class="row-even"><td>ExpectedPeaksFromFile</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Load from file a list of dSpacing values to be translated into TOF to find expected peaks. This takes precedence over &#8216;ExpectedPeaks&#8217; if both options are given. Allowed extensions: [&#8216;.csv&#8217;]</td>
</tr>
<tr class="row-odd"><td>VanadiumWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Workspace with the Vanadium (correction and calibration) run. Alternatively, when the Vanadium run has been already processed, the properties can be used</td>
</tr>
<tr class="row-even"><td>VanIntegrationWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Results of integrating the spectra of a Vanadium run, with one column (integration result) and one row per spectrum. This can be used in combination with OutVanadiumCurveFits from a previous execution and VanadiumWorkspace to provide pre-calculated values for Vanadium correction.</td>
</tr>
<tr class="row-odd"><td>VanCurvesWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A workspace2D with the fitting workspaces corresponding to the instrument banks. This workspace has three spectra per bank, as produced by the algorithm Fit. This is meant to be used as an alternative input VanadiumWorkspace for testing and performance reasons. If not given, no workspace is generated.</td>
</tr>
<tr class="row-even"><td>Bank</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Which bank to calibrate. It can be specified as 1 or 2, or equivalently, North or South. See also SpectrumNumbers for a more flexible alternative to select specific detectors. Allowed values: [&#8216;&#8217;, &#8216;North&#8217;, &#8216;South&#8217;, &#8216;Both: North, South&#8217;, &#8216;1&#8217;, &#8216;2&#8217;]</td>
</tr>
<tr class="row-odd"><td>SpectrumNumbers</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Sets the spectrum numbers for the detectors that should be considered in the calibration (all others will be ignored). This option cannot be used together with Bank, as they overlap. You can give multiple ranges, for example: &#8220;0-99&#8221;, or &#8220;0-9, 50-59, 100-109&#8221;.</td>
</tr>
<tr class="row-even"><td>DetectorPositions</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Calibrated detector positions. If not specified, default ones (from the current instrument definition) are used.</td>
</tr>
<tr class="row-odd"><td>OutputParametersTableName</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Name for a table workspace with the calibration parameters calculated from this algorithm: difc and zero parameters for GSAS. these two parameters are added as two columns in a single row. If not given, no table is generated.</td>
</tr>
<tr class="row-even"><td>DIFA</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Calibration parameter DIFA for the bank or range of pixels/detectors given</td>
</tr>
<tr class="row-odd"><td>DIFC</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Calibration parameter DIFC for the bank or range of pixels/detectors given</td>
</tr>
<tr class="row-even"><td>TZERO</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Calibration parameter TZERO for the bank or range of pixels/detectors given</td>
</tr>
<tr class="row-odd"><td>FittedPeaks</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Information on fitted peaks as produced by the (child) algorithm EnggFitPeaks.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It
might get changed or even removed without a notification, should
instrument scientists decide to do so.</p>
</div>
<p>Utilises <a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus v1</em></a> which performs a TOF to dSpacing
conversion using calibrated pixel positions, focuses the values in
dSpacing and then converts them back to TOF. <a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus v1</em></a>
also perform corrections with Vanadium data.</p>
<p>Then this algorithm calls <a class="reference internal" href="EnggFitPeaks-v1.html#algm-enggfitpeaks"><em>EnggFitPeaks v1</em></a> (as a child
algorithm) which through a sequence of peak fits determines a linear
relationship between dSpacing and measured TOF values in terms of
DIFA, DIFC and TZERO values and provides the these parameters to the
Calibrate algorithm.</p>
<p>This algorithm provides an indirect calibration of the sample
position, that is, a calibration returned in terms of DIFA, DIFC and
ZERO rather than an actual new sample position (hence the reason for
&#8216;indirect&#8217;).</p>
<p>The parameters DIFA, DIFC and ZERO are returned and can be retrieved
as output properties as well. If a name is given in
OutputParametersTableName the algorithm also produces a table
workspace with that name, containing the two output parameters.
Presently the DIFA parameter is always set to zero (see
<a class="reference internal" href="EnggFitDIFCFromPeaks-v1.html#algm-enggfitdifcfrompeaks"><em>EnggFitDIFCFromPeaks v1</em></a>).</p>
<p>The script EnggUtils included with Mantid can produce a GSAS
parameters file for the ENGIN-X instrument, given the DIFC and ZERO
parameters for the instrument banks as produced by EnggCalibrate. This
can be done with the write_ENGINX_GSAS_iparam_file() function as shown
in the usage example below.</p>
<p>See the algorithm <a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus v1</em></a> for details on the Vanadium
corrections.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id4">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ff859df4a5faa6fa5e3cecb8f2efeb4c4aa53864/Framework/PythonInterface/plugins/algorithms/EnggCalibrate.py">EnggCalibrate.py</a></p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Calculate Difc and Zero for EnginX:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">out_tbl_name</span> <span class="o">=</span> <span class="s">&#39;out_params&#39;</span>
<span class="n">ws_name</span> <span class="o">=</span> <span class="s">&#39;test_engg_data&#39;</span>
<span class="n">Load</span><span class="p">(</span><span class="s">&#39;ENGINX00213855.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">)</span>

<span class="c"># Using precalculated Vanadium corrections. To calculate from scrach see EnggVanadiumCorrections</span>
<span class="n">van_integ_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;</span><span class="p">)</span>
<span class="n">van_curves_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;</span><span class="p">)</span>

<span class="n">difa1</span><span class="p">,</span> <span class="n">difc1</span><span class="p">,</span> <span class="n">tzero1</span><span class="p">,</span> <span class="n">peaks1</span> <span class="o">=</span> <span class="n">EnggCalibrate</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">,</span>
                                             <span class="n">VanIntegrationWorkspace</span><span class="o">=</span><span class="n">van_integ_ws</span><span class="p">,</span>
                                             <span class="n">VanCurvesWorkspace</span><span class="o">=</span><span class="n">van_curves_ws</span><span class="p">,</span>
                                             <span class="n">ExpectedPeaks</span><span class="o">=</span><span class="p">[</span><span class="mf">1.28</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">],</span> <span class="n">Bank</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span>
                                             <span class="n">OutputParametersTableName</span><span class="o">=</span><span class="n">out_tbl_name</span><span class="p">)</span>

<span class="n">difa1</span><span class="p">,</span> <span class="n">difc2</span><span class="p">,</span> <span class="n">tzero2</span><span class="p">,</span> <span class="n">peaks2</span> <span class="o">=</span> <span class="n">EnggCalibrate</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">,</span>
                                             <span class="n">VanIntegrationWorkspace</span><span class="o">=</span><span class="n">van_integ_ws</span><span class="p">,</span>
                                             <span class="n">VanCurvesWorkspace</span><span class="o">=</span><span class="n">van_curves_ws</span><span class="p">,</span>
                                             <span class="n">ExpectedPeaks</span><span class="o">=</span><span class="p">[</span><span class="mf">1.28</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">],</span> <span class="n">Bank</span><span class="o">=</span><span class="s">&#39;2&#39;</span><span class="p">)</span>

<span class="c"># You can produce an instrument parameters (iparam) file for GSAS.</span>
<span class="c"># Note that this is very specific to ENGIN-X</span>
<span class="n">GSAS_iparm_fname</span> <span class="o">=</span> <span class="s">&#39;ENGIN_X_banks.prm&#39;</span>
<span class="kn">import</span> <span class="nn">EnggUtils</span>
<span class="n">EnggUtils</span><span class="o">.</span><span class="n">write_ENGINX_GSAS_iparam_file</span><span class="p">(</span><span class="n">GSAS_iparm_fname</span><span class="p">,</span> <span class="n">bank_names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;North&#39;</span><span class="p">,</span> <span class="s">&#39;South&#39;</span><span class="p">],</span>
                                        <span class="n">difc</span><span class="o">=</span><span class="p">[</span><span class="n">difc1</span><span class="p">,</span> <span class="n">difc2</span><span class="p">],</span> <span class="n">tzero</span><span class="o">=</span><span class="p">[</span><span class="n">tzero1</span><span class="p">,</span> <span class="n">tzero2</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="k">print</span> <span class="s">&quot;DIFA1: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">difa1</span><span class="p">)</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">approx_difc1</span> <span class="o">=</span> <span class="mi">18267</span>
<span class="n">difc1_ok</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">difc1</span> <span class="o">-</span> <span class="n">approx_difc1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">delta</span>
<span class="k">print</span> <span class="s">&quot;DIFC1 is approximately (+/- {0}) {1}: {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">approx_difc1</span><span class="p">,</span> <span class="n">difc1_ok</span><span class="p">)</span>
<span class="n">approx_tzero1</span> <span class="o">=</span> <span class="mi">277</span>
<span class="n">tzero1_ok</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">tzero1</span> <span class="o">-</span> <span class="n">approx_tzero1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">delta</span>
<span class="k">print</span> <span class="s">&quot;TZERO1 is approximately (+/- {0}) {1}: {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">approx_tzero1</span><span class="p">,</span> <span class="n">tzero1_ok</span><span class="p">)</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="n">out_tbl_name</span><span class="p">]</span>

<span class="n">tbl_values_ok</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">approx_difc1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">delta</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">approx_tzero1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">delta</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;The output table has {0} row(s) and its values are as expected: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span>
                                                                                   <span class="n">tbl_values_ok</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="k">print</span> <span class="s">&quot;Output GSAS iparam file was written? {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">GSAS_iparm_fname</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&quot;Number of lines of the GSAS iparam file: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">GSAS_iparm_fname</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>DIFA1: 0.0
DIFC1 is approximately (+/- 2) 18267: True
TZERO1 is approximately (+/- 2) 277: True
The output table has 1 row(s) and its values are as expected: True
Output GSAS iparam file was written? True
Number of lines of the GSAS iparam file: 36
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnergyWindowScan-v1.html" title="Previous Chapter: EnergyWindowScan v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; EnergyWindowScan...</span>
    </a>
  </li>
  <li>
    <a href="EnggCalibrateFull-v1.html" title="Next Chapter: EnggCalibrateFull v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">EnggCalibrateFul... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>