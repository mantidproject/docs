<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CountReflections v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.10.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="CreateCacheFilename v1" href="CreateCacheFilename-v1.html" />
    <link rel="prev" title="CorrectToFile v1" href="CorrectToFile-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.10</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="countreflections-v1">
<span id="algm-countreflections"></span><span id="algm-countreflections-v1"></span><h1>CountReflections v1<a class="headerlink" href="#countreflections-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/CountReflections-v1_dlg.png"><img alt="../_images/CountReflections-v1_dlg.png" class="screenshot" src="../_images/CountReflections-v1_dlg.png" style="width: 342px;" /></a>
<p class="caption"><strong>CountReflections</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculates statistics for a PeaksWorkspace based on symmetry and counting reflections.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="1%" />
<col width="3%" />
<col width="2%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>A workspace with peaks to calculate statistics for. Sample with valid UB-matrix is required.</td>
</tr>
<tr class="row-odd"><td>LatticeCentering</td>
<td>Input</td>
<td>string</td>
<td>P</td>
<td>Lattice centering of the cell. Allowed values: [&#8216;P&#8217;, &#8216;C&#8217;, &#8216;A&#8217;, &#8216;B&#8217;, &#8216;I&#8217;, &#8216;F&#8217;, &#8216;Robv&#8217;, &#8216;Rrev&#8217;, &#8216;H&#8217;]</td>
</tr>
<tr class="row-even"><td>PointGroup</td>
<td>Input</td>
<td>string</td>
<td>1</td>
<td>Point group symmetry for completeness and redundancy calculations. Allowed values: [&#8216;-1&#8217;, &#8216;-3&#8217;, &#8216;-3 r&#8217;, &#8216;-31m&#8217;, &#8216;-3m&#8217;, &#8216;-3m r&#8217;, &#8216;-3m1&#8217;, &#8216;-4&#8217;, &#8216;-42m&#8217;, &#8216;-43m&#8217;, &#8216;-4m2&#8217;, &#8216;-6&#8217;, &#8216;-62m&#8217;, &#8216;-6m2&#8217;, &#8216;1&#8217;, &#8216;112&#8217;, &#8216;112/m&#8217;, &#8216;11m&#8217;, &#8216;2&#8217;, &#8216;2/m&#8217;, &#8216;222&#8217;, &#8216;23&#8217;, &#8216;2mm&#8217;, &#8216;3&#8217;, &#8216;3 r&#8217;, &#8216;312&#8217;, &#8216;31m&#8217;, &#8216;32&#8217;, &#8216;32 r&#8217;, &#8216;321&#8217;, &#8216;3m&#8217;, &#8216;3m r&#8217;, &#8216;3m1&#8217;, &#8216;4&#8217;, &#8216;4/m&#8217;, &#8216;4/mmm&#8217;, &#8216;422&#8217;, &#8216;432&#8217;, &#8216;4mm&#8217;, &#8216;6&#8217;, &#8216;6/m&#8217;, &#8216;6/mmm&#8217;, &#8216;622&#8217;, &#8216;6mm&#8217;, &#8216;m&#8217;, &#8216;m-3&#8217;, &#8216;m-3m&#8217;, &#8216;m2m&#8217;, &#8216;mm2&#8217;, &#8216;mmm&#8217;]</td>
</tr>
<tr class="row-odd"><td>MinDSpacing</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>Minimum d-spacing for completeness calculation.</td>
</tr>
<tr class="row-even"><td>MaxDSpacing</td>
<td>Input</td>
<td>number</td>
<td>100</td>
<td>Maximum d-spacing for completeness calculation.</td>
</tr>
<tr class="row-odd"><td>UniqueReflections</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Number of unique reflections in data set.</td>
</tr>
<tr class="row-even"><td>Completeness</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Completeness of the data set as a fraction between 0 and 1.</td>
</tr>
<tr class="row-odd"><td>Redundancy</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Average redundancy in data set, depending on point group.</td>
</tr>
<tr class="row-even"><td>MultiplyObserved</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Fraction of reflections with more than one observation.</td>
</tr>
<tr class="row-odd"><td>MissingReflectionsWorkspace</td>
<td>Output</td>
<td>IPeaksWorkspace</td>
<td>&nbsp;</td>
<td>Reflections in specified d-range that are missing in input workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm computes some crystallographic data set quality indicators that are based
on counting reflections according to their Miller indices HKL. Intensity information is not
required for these indicators, so that the algorithm can also be used with predicted data
(for example generated by <a class="reference internal" href="PredictPeaks-v1.html#algm-predictpeaks"><em>PredictPeaks v1</em></a>).</p>
<p>According to the specified lattice centering and the resolution boundaries, a set of
theoretically measurable reflections is generated. How the reflections are mapped to
a set of <img class="math" src="../_images/math/a416fcba4cda7f6175a69ffb91b596becc706433.png" alt="N_{theor.}" style="vertical-align: -3px"/> unique reflections depends on the supplied point group. Then the
<img class="math" src="../_images/math/d42cdc2a6e57cb9eba2b1cbaef30b4191d30b3a9.png" alt="N_{observed}" style="vertical-align: -3px"/> actually observed peaks from the input workspace are assigned to their
respective unique reflection, yielding <img class="math" src="../_images/math/1e73483e4b1246fe9b03fc115e80f62a8ed31914.png" alt="N_{unique}" style="vertical-align: -6px"/> observed unique reflections.</p>
<p>From this assignment it is possible to calculate the following indicators:</p>
<blockquote>
<div><ul class="simple">
<li>Unique reflections: <img class="math" src="../_images/math/1e73483e4b1246fe9b03fc115e80f62a8ed31914.png" alt="N_{unique}" style="vertical-align: -6px"/></li>
<li>Completeness: <img class="math" src="../_images/math/6077f12d1dc1754ed2ae943849f4d9316163fc7a.png" alt="\frac{N_{unique}}{N_{theor.}}" style="vertical-align: -8px"/></li>
<li>Redundancy: <img class="math" src="../_images/math/96a4756323013033583dc54148e307b71e0d4f3b.png" alt="\frac{N_{observed}}{N_{unique}}" style="vertical-align: -10px"/></li>
<li>Multiply observed reflections: <img class="math" src="../_images/math/ab95a133dc1b308a474c50c019fc88cc6bc03848.png" alt="\frac{N_{unique} | N^{hkl}_{observed} &gt; 1}{N_{unique}}" style="vertical-align: -10px"/></li>
</ul>
</div></blockquote>
<p>Furthermore, the algorithm optionally produces a list of missing reflections. In this list,
each missing unique reflection is expanded to all symmetry equivalents according to the point
group. For example, if the reflection family <img class="math" src="../_images/math/04b3008f87a370e3800268e1fe4a4d4a5df4ba11.png" alt="\{001\}" style="vertical-align: -5px"/> was missing
with point group <img class="math" src="../_images/math/8c0c988be768599604564bb7b52de494eabbbb78.png" alt="\bar{1}" style="vertical-align: -1px"/>, the list would contain <img class="math" src="../_images/math/872027d59e53aedf3f6af5ef2c5ed9437d514a79.png" alt="(001)" style="vertical-align: -4px"/> and <img class="math" src="../_images/math/b7d5a7a9389e3306c48d18b11d91759e4d0cdaf3.png" alt="(00\bar{1})" style="vertical-align: -4px"/>.</p>
<p>The reason for expanding the unique reflections is to make the list more useful as an input
to <a class="reference internal" href="PredictPeaks-v1.html#algm-predictpeaks"><em>PredictPeaks v1</em></a> again.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This algorithm has some overlap with <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><em>SortHKL v1</em></a>, which computes some of the indicators this
algorithm calculates, but in addition also evaluates intensity information. SortHKL only works with
peaks that carry intensity data while this algorithm also works without intensities.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The usage example uses the same data as the usage test in <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><em>SortHKL v1</em></a>, but produces slightly different
data, because some intensities in the input file are 0, so these reflections are ignored by <a class="reference internal" href="SortHKL-v1.html#algm-sorthkl"><em>SortHKL v1</em></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Load example peak data and find cell</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s">r&#39;Peaks5637.integrate&#39;</span><span class="p">)</span>

<span class="n">FindUBUsingFFT</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">MinD</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">MaxD</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">SelectCellWithForm</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">FormNumber</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">OptimizeLatticeForCellType</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">CellType</span><span class="o">=</span><span class="s">&#39;Hexagonal&#39;</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c"># Run the SortHKL algorithm</span>
<span class="n">unique</span><span class="p">,</span> <span class="n">completeness</span><span class="p">,</span> <span class="n">redundancy</span><span class="p">,</span> <span class="n">multiple</span> <span class="o">=</span> <span class="n">CountReflections</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">PointGroup</span><span class="o">=</span><span class="s">&#39;-3m1&#39;</span><span class="p">,</span>
                                                              <span class="n">LatticeCentering</span><span class="o">=</span><span class="s">&#39;Robv&#39;</span><span class="p">,</span> <span class="n">MinDSpacing</span><span class="o">=</span><span class="mf">0.205</span><span class="p">,</span>
                                                              <span class="n">MaxDSpacing</span><span class="o">=</span><span class="mf">2.08</span><span class="p">,</span> <span class="n">MissingReflectionsWorkspace</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Data set statistics:&#39;</span>
<span class="k">print</span> <span class="s">&#39;             Peaks: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&#39;            Unique: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;      Completeness: {0}%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">completeness</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;        Redundancy: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">redundancy</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39; Multiply observed: {0}%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">multiple</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Data set statistics:
             Peaks: 434
            Unique: 358
      Completeness: 9.57%
        Redundancy: 1.21
 Multiply observed: 20.67%
</pre></div>
</div>
<p>The resulting completeness is slightly higher than in the SortHKL case, but for actual statistics it might be
better to remove the zero intensity peaks from the workspace prior to running the algorithm.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Crystal/Peaks.html">Crystal\Peaks</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ff859df4a5faa6fa5e3cecb8f2efeb4c4aa53864/Framework/Crystal/src/CountReflections.cpp">CountReflections.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/ff859df4a5faa6fa5e3cecb8f2efeb4c4aa53864/Framework/Crystal/inc/MantidCrystal/CountReflections.h">CountReflections.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CorrectToFile-v1.html" title="Previous Chapter: CorrectToFile v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; CorrectToFile v1</span>
    </a>
  </li>
  <li>
    <a href="CreateCacheFilename-v1.html" title="Next Chapter: CreateCacheFilename v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">CreateCacheFilen... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>