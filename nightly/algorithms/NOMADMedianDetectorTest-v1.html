<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>NOMADMedianDetectorTest v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.20220909.1939',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NRCalculateSlitResolution v1" href="NRCalculateSlitResolution-v1.html" />
    <link rel="prev" title="NMoldyn4Interpolation v1" href="NMoldyn4Interpolation-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.4</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">NOMADMedianDetectorTest v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="nomadmediandetectortest-v1">
<span id="algm-nomadmediandetectortest"></span><span id="algm-nomadmediandetectortest-v1"></span><h1>NOMADMedianDetectorTest v1<a class="headerlink" href="#nomadmediandetectortest-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/NOMADMedianDetectorTest-v1_dlg.png"><img alt="../_images/NOMADMedianDetectorTest-v1_dlg.png" class="screenshot" src="../_images/NOMADMedianDetectorTest-v1_dlg.png" style="width: 364px;" /></a>
<p class="caption"><span class="caption-text"><strong>NOMADMedianDetectorTest</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Identifies detector pixels and whole tubes having total numbers of counts over a user defined maximum or less than a user define minimum.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><span class="std std-ref">MedianDetectorTest</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="4%" />
<col width="18%" />
<col width="8%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Workspace containing reference pixel intensities</td>
</tr>
<tr class="row-odd"><td>ConfigurationFile</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>YML file specifying collimation states and unused eight-packs. Allowed extensions: [‘.yml’]</td>
</tr>
<tr class="row-even"><td>SolidAngleNorm</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Normalize each pixel by its solid angle?</td>
</tr>
<tr class="row-odd"><td>OutputMaskXML</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>Output masked pixels in XML format. Allowed extensions: [‘.xml’]</td>
</tr>
<tr class="row-even"><td>OutputMaskASCII</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>Output masked pixels in single-column ASCII file. Allowed extensions: [‘.txt’]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Algorithm to mask detector pixels showing deficient or excessive neutron counts. The deficit and excess is
referenced to the median calculated over intensities in a single tube, an eight-pack, or a panel of eight-packs.
The prescription for the median calculation depends on the collimation level of the eigh-pack to which a
particular detector belongs to.</p>
<p>The full-collimated and half-collimated eight-packs are presented in picture below, respectively.
Those grey-colored tubes are full-collimated (in the first picture) or half-collimated (in the second picture).</p>
<div class="figure">
<img alt="ClusterImage.png" src="../_images/NOMADMedianDetectorTest_1.png" />
</div>
<div class="figure">
<img alt="ClusterImage.png" src="../_images/NOMADMedianDetectorTest_2.png" />
</div>
<p>The following workflow presents the prescription to mask a detector pixel according to the median taken
over the pixel intensity in a tube. For tubes in eight-packs with a Half-collimation level, the median
is taken over the first half of the tube to test the pixels in this half. Analogously, the median is
taken over the second half of the tube to test the pixels in the second half.</p>
<div class="figure">
<img alt="ClusterImage.png" src="../_images/NOMADMedianDetectorTest_3.png" />
</div>
<p>In the inequalities below, <span class="math">\(I\)</span> is the pixel intensity, <span class="math">\(m\)</span> is the  median over the tube,
and <span class="math">\(f_{lp} &lt; 1\)</span> and <span class="math">\(f_{up} &gt; 1\)</span> are multiplicative factors to set the minimum and maximum
intensity thresholds.</p>
<p>Condition [2] <span class="math">\(I &lt; f_{lp} \cdot m\)</span> or <span class="math">\(I &gt; f_{up} \cdot m\)</span></p>
<p>Condition [3] <span class="math">\(I &lt; (1 + 3(f_{lp} - 1)) m\)</span> or <span class="math">\(I &gt; (1 + 3(f_{up} - 1)) m\)</span></p>
<p>In the inequalities below, <span class="math">\(m_1\)</span> and <span class="math">\(m_1\)</span> are the median taken over the first and second half
of the tube.</p>
<p>Condition [4] <span class="math">\(I &lt; (1 + 3(f_{lp} - 1)) m_1\)</span> or <span class="math">\(I &gt; (1 + 3(f_{up} - 1)) m_1\)</span></p>
<p>Condition [5] <span class="math">\(I &lt; (1 + 3(f_{lp} - 1)) m_2\)</span> or <span class="math">\(I &gt; (1 + 3(f_{up} - 1)) m_2\)</span></p>
<p>Pixels can also be masked if they fail the median test where the median is calculated from the intensities of
their corresponding eight-pack (if the eight-pack is fully collimated) or the median of their corresponding
panel (if the eight-pack is not fully collimated).</p>
<p>the following workflow prescribes the calculation of the median for each of the instrument panels (termed
as “banks” in the workflow picture)</p>
<div class="figure">
<img alt="ClusterImage.png" src="../_images/NOMADMedianDetectorTest_4.png" />
</div>
<p>Finally, the following workflow prescribes the test using the eight-pack mediam or the panel median criterium</p>
<div class="figure">
<img alt="ClusterImage.png" src="../_images/NOMADMedianDetectorTest_5.png" />
</div>
<p>Reference [6] The first four Panels (a.k.a Banks) are “non-flat”, and the last two are “flat”.</p>
<p>In the inequalities below, <span class="math">\(I\)</span> is the pixel intensity and <span class="math">\(m_B\)</span> is the  median over the Panel
(a.k.a “Bank”), <span class="math">\(m_{8P}\)</span> is the  median over the eight-pack. Multiplicative factors <span class="math">\(f_{lb} &lt; 1\)</span> and
<span class="math">\(f_{ub} &gt; 1\)</span> set the minimum and maximum intensity thresholds.</p>
<p>Condition [7]  <span class="math">\(I &lt; f_{lB} \cdot m_B\)</span> or <span class="math">\(I &gt; f_{pB} \cdot m_B\)</span></p>
<p>Condition [8] <span class="math">\(I &lt; f_{lB} \cdot m_{8P}\)</span> or <span class="math">\(I &gt; f_{pB} \cdot m_{8P}\)</span></p>
<p>Condition [9] <span class="math">\(I &lt; 0.1 \cdot m_B\)</span></p>
<p>Eight-Packs in use, their collimation level, as well as multiplicative factors  <span class="math">\(f_{lp}\)</span> (“low_pixel”),
<span class="math">\(f_{up}\)</span> (“high_pixel”), <span class="math">\(f_{lb}\)</span> (“low_tube”), and <span class="math">\(f_{ub}\)</span> (“high_tube”) are specified
in a configuration file in YML format. Here’s the relevant portion of one such file:</p>
<blockquote>
<div><p>#</p>
<p># This block specifies the threshold (relative to median integrated</p>
<p># intensity of either pixel or tube) for masking out pixels.</p>
<p>#</p>
<p>threshold:</p>
<p>low_pixel: 0.9</p>
<p>high_pixel: 1.2</p>
<p>low_tube: 0.7</p>
<p>high_tube: 1.3</p>
<p>#</p>
<p># Indexes of eight-packs in use.</p>
<p>#
eight_packs: [3,7,8,9,10,11,19,20,26,28,30,34,38,39,40,41,44,45,46,47,48,49,50,54,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,89,90,93,94,95]</p>
<p>#</p>
<p># This block specifies the full and half collimated eight-packs.</p>
<p># Notice: Indexes represent indexes of the “eight_packs” list</p>
<p>#</p>
<p>collimation:</p>
<p>full_col: [1, 8, 16, 25, 27, 28, 29]</p>
<p>half_col: [30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 45, 46]</p>
</div></blockquote>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">LoadNexusProcessed</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;NOM_144974_SingleBin.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;NOM_144974&#39;</span><span class="p">)</span>
<span class="n">NOMADMedianDetectorTest</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;NOM_144974&#39;</span><span class="p">,</span>
                        <span class="n">ConfigurationFile</span><span class="o">=</span><span class="s1">&#39;NOMAD_mask_gen_config.yml&#39;</span><span class="p">,</span>
                        <span class="n">SolidAngleNorm</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">OutputMaskXML</span><span class="o">=</span><span class="s1">&#39;NOM_144974_mask.xml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="NMoldyn4Interpolation-v1.html" title="Previous Chapter: NMoldyn4Interpolation v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; NMoldyn4Inter...</span>
    </a>
  </li>
  <li>
    <a href="NRCalculateSlitResolution-v1.html" title="Next Chapter: NRCalculateSlitResolution v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">NRCalculateSl... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>