<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ConvertToReflectometryQ v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.4.20220909.1939',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ConvertToReflectometryQ v2" href="ConvertToReflectometryQ-v2.html" />
    <link rel="prev" title="ConvertToPointData v1" href="ConvertToPointData-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.4</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
    <p>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../index.html">Documentation</a> &#187;</li>
        
            <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Algorithms</a> &#187;</li>
          
        
        
          
            <li class="nav-item nav-item-this"><a href="">ConvertToReflectometryQ v1</a></li>
          
        
      </ul>
    </div> </p>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="converttoreflectometryq-v1">
<span id="algm-converttoreflectometryq-v1"></span><h1>ConvertToReflectometryQ v1<a class="headerlink" href="#converttoreflectometryq-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ConvertToReflectometryQ-v1_dlg.png"><img alt="../_images/ConvertToReflectometryQ-v1_dlg.png" class="screenshot" src="../_images/ConvertToReflectometryQ-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>ConvertToReflectometryQ</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a><ul>
<li><a class="reference internal" href="#prerequisites" id="id6">Prerequisites</a></li>
<li><a class="reference internal" href="#transformations" id="id7">Transformations</a></li>
<li><a class="reference internal" href="#after-transformation" id="id8">After Transformation</a></li>
<li><a class="reference internal" href="#binning-methods" id="id9">Binning Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id10">Usage</a><ul>
<li><a class="reference internal" href="#normalised-polygon-transformation" id="id11">Normalised Polygon Transformation</a><ul>
<li><a class="reference internal" href="#plot-of-the-signedtheta-vs-wavelength-workspace" id="id12">Plot of the SignedTheta vs Wavelength workspace:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patch-plot-with-dumped-vertexes" id="id13">Patch Plot with Dumped Vertexes</a></li>
<li><a class="reference internal" href="#patch-plots-from-other-transformations" id="id14">Patch plots from other transformations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source" id="id15">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Transforms from real-space to Q or momentum space for reflectometry workspaces</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><span class="std std-ref">ConvertUnits</span></a>, <a class="reference internal" href="ReflectometryMomentumTransfer-v1.html#algm-reflectometrymomentumtransfer"><span class="std std-ref">ReflectometryMomentumTransfer</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="2%" />
<col width="11%" />
<col width="4%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>An input workspace in wavelength</td>
</tr>
<tr class="row-odd"><td>OutputDimensions</td>
<td>Input</td>
<td>string</td>
<td>Q (lab frame)</td>
<td>What will be the dimensions of the output workspace?   Q (lab frame): Wave-vector change of the lattice in the lab frame.   P (lab frame): Momentum in the sample frame.   K initial and final vectors in the z plane. Allowed values: [‘Q (lab frame)’, ‘P (lab frame)’, ‘K (incident, final)’]</td>
</tr>
<tr class="row-even"><td>Method</td>
<td>Input</td>
<td>string</td>
<td>Centre</td>
<td>What method should be used for the axis transformation?   Centre: Use center point rebinning.   NormalisedPolygon: Use normalised polygon rebinning. Allowed values: [‘Centre’, ‘NormalisedPolygon’]</td>
</tr>
<tr class="row-odd"><td>OverrideIncidentTheta</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Use the provided incident theta value.</td>
</tr>
<tr class="row-even"><td>IncidentTheta</td>
<td>Input</td>
<td>number</td>
<td>-1</td>
<td>An input incident theta value specified in degrees.Optional input value for the incident theta specified in degrees.</td>
</tr>
<tr class="row-odd"><td>Extents</td>
<td>Input</td>
<td>dbl list</td>
<td>-50,50,-50,50</td>
<td>A comma separated list of min, max for each dimension. Takes four values in the form dim_0_min, dim_0_max, dim_1_min, dim_1_max, specifying the extents of each dimension. Optional, default +-50 in each dimension.</td>
</tr>
<tr class="row-even"><td>OutputAsMDWorkspace</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Generate the output as a MDWorkspace, otherwise a Workspace2D is returned.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td>IMDWorkspace</td>
<td><em>Mandatory</em></td>
<td>Output 2D Workspace.</td>
</tr>
<tr class="row-even"><td>OutputVertexes</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Output TableWorkspace with vertex information. See DumpVertexes property.</td>
</tr>
<tr class="row-odd"><td>NumberBinsQx</td>
<td>Input</td>
<td>number</td>
<td>100</td>
<td>The number of bins along the qx axis. Optional and only applies to 2D workspaces. Defaults to 100.</td>
</tr>
<tr class="row-even"><td>NumberBinsQz</td>
<td>Input</td>
<td>number</td>
<td>100</td>
<td>The number of bins along the qx axis. Optional and only applies to 2D workspaces. Defaults to 100.</td>
</tr>
<tr class="row-odd"><td>DumpVertexes</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If set, with 2D rebinning, the intermediate vertexes for each polygon will be written out for debugging purposes. Creates a second output table workspace.</td>
</tr>
<tr class="row-even"><td>SplitInto</td>
<td>Input</td>
<td>int list</td>
<td>2,2</td>
<td>A comma separated list of into how many sub-grid elements each dimension should split; or just one to split into the same number for all dimensions. Default 2,2.</td>
</tr>
<tr class="row-odd"><td>SplitThreshold</td>
<td>Input</td>
<td>number</td>
<td>50</td>
<td>How many events in a box before it should be split. Default 50.</td>
</tr>
<tr class="row-even"><td>MaxRecursionDepth</td>
<td>Input</td>
<td>number</td>
<td>10</td>
<td>How many levels of box splitting recursion are allowed. The smallest box will have each side length <span class="math">\(l = (extents) / (SplitInto^{MaxRecursionDepth}).\)</span> Default 10.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm transforms an input workspace in wavelength to <span class="math">\(Q_{x}, Q_{z}\)</span>
or momentum space for reflectometry workspaces. Prior to the transformation, the
algorithm corrects the detector position to an angle <span class="math">\(\theta_f\)</span>, where
<span class="math">\(\theta_f\)</span> is extracted from the log value <code class="docutils literal"><span class="pre">stheta</span></code>, if it exists;
otherwise, no correction is done, and detectors are assumed to be at <span class="math">\(\theta_f\)</span>.</p>
<p>For conversion of single histogram workspaces to <span class="math">\(Q_{z}\)</span>, see
<a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><span class="std std-ref">ConvertUnits</span></a> or
<a class="reference internal" href="ReflectometryMomentumTransfer-v1.html#algm-reflectometrymomentumtransfer"><span class="std std-ref">ReflectometryMomentumTransfer</span></a>.</p>
<p>This version of the algorithm takes <span class="math">\(\theta_f\)</span> from the detector <span class="math">\(2\theta\)</span>,
whereas version 2 takes <span class="math">\(\theta_f\)</span> from <span class="math">\(2\theta - \theta_i\)</span>.</p>
<div class="section" id="prerequisites">
<h3><a class="toc-backref" href="#id6">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>The workspace spectrum axis should be converted to signed_theta using
<a class="reference internal" href="ConvertSpectrumAxis-v2.html#algm-convertspectrumaxis"><span class="std std-ref">ConvertSpectrumAxis v2</span></a> and the x axis should be
converted to Wavelength using <a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><span class="std std-ref">ConvertUnits v1</span></a> before
running this algorithm. Histogram input workspaces are expected.</p>
<p>The algorithm will look for a specific log value called <code class="docutils literal"><span class="pre">stheta</span></code>, which
contains the incident theta angle <span class="math">\(\theta_i\)</span>. If the input
workspace does not contain this value, or if you wish to override this
value you can do so by providing your own <code class="docutils literal"><span class="pre">IncidentTheta</span></code> property and
enabling <code class="docutils literal"><span class="pre">OverrideIncidentTheta</span></code>.</p>
<p>The algorithm also has the ability to produce additional debugging information from the Tableworkspace
that can be used to create a patch plot of results before any 2D fractional rebinning has happened.</p>
<p>To create this table there are certain properties that must be present in the algorithm:</p>
<ul class="simple">
<li>The transform method must be NormalisedPolygon</li>
<li>The option to Output as MD workspace must not be selected</li>
<li>The option to DumpVertexes must be selected</li>
</ul>
</div>
<div class="section" id="transformations">
<h3><a class="toc-backref" href="#id7">Transformations</a><a class="headerlink" href="#transformations" title="Permalink to this headline">¶</a></h3>
<p>Output workspaces are always 2D MD Histogram workspaces, but the
algorithm will perform one of three possible transformations.</p>
<ul class="simple">
<li>Convert to <span class="math">\(Q_x\)</span>, <span class="math">\(Q_z\)</span></li>
<li>Convert to <span class="math">\(K_i\)</span>, <span class="math">\(K_f\)</span></li>
<li>Convert to <span class="math">\(P_i-P_f\)</span>, <span class="math">\(P_i+P_f\)</span>. Note that P and K are
interchangeable.</li>
</ul>
<p>where</p>
<p><span class="math">\(Q_x = \frac{2\pi}{\lambda}(cos\theta_f - cos\theta_i)\)</span></p>
<p><span class="math">\(Q_z = \frac{2\pi}{\lambda}(sin\theta_f + sin\theta_i)\)</span></p>
<p><span class="math">\(K_i = \frac{2\pi}{\lambda}sin\theta_i\)</span></p>
<p><span class="math">\(K_f = \frac{2\pi}{\lambda}sin\theta_f\)</span></p>
</div>
<div class="section" id="after-transformation">
<h3><a class="toc-backref" href="#id8">After Transformation</a><a class="headerlink" href="#after-transformation" title="Permalink to this headline">¶</a></h3>
<p>You will usually want to rebin using <a class="reference internal" href="BinMD-v1.html#algm-binmd"><span class="std std-ref">BinMD v1</span></a> or
<a class="reference internal" href="SliceMD-v1.html#algm-slicemd"><span class="std std-ref">SliceMD v1</span></a> after transformation because the output workspaces
are not regularly binned.</p>
</div>
<div class="section" id="binning-methods">
<h3><a class="toc-backref" href="#id9">Binning Methods</a><a class="headerlink" href="#binning-methods" title="Permalink to this headline">¶</a></h3>
<p>The <em>Method</em> property allows the binning method used when applying the
coordinate transformations to be selected. The default method,
<em>Centre</em>, takes center point of each input bin, and locates the
corresponding output bin, adding the input bins value to it. Centre point rebinning is faster.</p>
<p><em>NormalisedPolygon</em> is a more sophisticated approach. It constructs
a polygon using the boundaries of the input bin, then transforms that polygon
into the output coordinates, and then searches for intersections with the
output bins. The value added to each output bin is proportional to size of the
overlap with the input bin. The normalised polygon approach gives better accuracy.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id10">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="normalised-polygon-transformation">
<h3><a class="toc-backref" href="#id11">Normalised Polygon Transformation</a><a class="headerlink" href="#normalised-polygon-transformation" title="Permalink to this headline">¶</a></h3>
<p><strong>Example - Normalised Polygon transformation</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">workspace_name</span> <span class="o">=</span> <span class="s2">&quot;POLREF4699&quot;</span>
<span class="n">workspace_nexus_file</span> <span class="o">=</span> <span class="n">workspace_name</span> <span class="o">+</span> <span class="s2">&quot;.nxs&quot;</span>

<span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="n">workspace_nexus_file</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">workspace_name</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="n">workspace_name</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">ConvertUnits</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">Target</span><span class="o">=</span><span class="s2">&quot;Wavelength&quot;</span><span class="p">,</span><span class="n">AlignBins</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="c1"># Reference intensity to normalise by</span>
<span class="n">CropWorkspace</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;Io&#39;</span><span class="p">,</span><span class="n">XMin</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">XMax</span><span class="o">=</span><span class="mf">14.5</span><span class="p">,</span><span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">EndWorkspaceIndex</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Crop out transmission and noisy data</span>
<span class="n">CropWorkspace</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">X</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">XMin</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">XMax</span><span class="o">=</span><span class="mf">14.5</span><span class="p">,</span><span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Io</span><span class="o">=</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;Io&#39;</span><span class="p">]</span>
<span class="n">D</span><span class="o">=</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span>

<span class="c1"># Perform the normalisation step</span>
<span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">D</span><span class="p">,</span><span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">Io</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">AllowDifferentNumberSpectra</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">ClearRHSWorkspace</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">I</span><span class="o">=</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Move the detector so that the detector channel matching the reflected beam is at 0,0</span>
<span class="n">PIX</span> <span class="o">=</span> <span class="mf">1.1E-3</span> <span class="c1">#m</span>
<span class="n">SC</span> <span class="o">=</span> <span class="mi">75</span>
<span class="n">avgDB</span> <span class="o">=</span> <span class="mi">29</span>
<span class="n">zOffset</span> <span class="o">=</span> <span class="o">-</span><span class="n">PIX</span> <span class="o">*</span> <span class="p">((</span><span class="n">SC</span> <span class="o">-</span> <span class="n">avgDB</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">avgDB</span><span class="p">)</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span><span class="n">Workspace</span> <span class="o">=</span> <span class="n">I</span><span class="p">,</span> <span class="n">ComponentName</span> <span class="o">=</span> <span class="s2">&quot;lineardetector&quot;</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">zOffset</span><span class="p">)</span>

<span class="c1"># Should now have signed theta vs Lambda</span>
<span class="n">ConvertSpectrumAxis</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">I</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;SignedTheta_vs_Wavelength&#39;</span><span class="p">,</span><span class="n">Target</span><span class="o">=</span><span class="s1">&#39;signed_theta&#39;</span><span class="p">)</span>

<span class="n">qxqy</span><span class="p">,</span> <span class="n">vertexes_qxqy</span> <span class="o">=</span> <span class="n">ConvertToReflectometryQ</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;SignedTheta_vs_Wavelength&#39;</span><span class="p">,</span> <span class="n">OutputDimensions</span><span class="o">=</span><span class="s1">&#39;Q (lab frame)&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-0.0005,0.0005,0,0.12&#39;</span><span class="p">,</span> <span class="n">OutputAsMDWorkspace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Method</span><span class="o">=</span><span class="s1">&#39;NormalisedPolygon&#39;</span><span class="p">)</span>

<span class="n">kikf</span><span class="p">,</span> <span class="n">vertexes_kikf</span> <span class="o">=</span> <span class="n">ConvertToReflectometryQ</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;SignedTheta_vs_Wavelength&#39;</span><span class="p">,</span> <span class="n">OutputDimensions</span><span class="o">=</span><span class="s1">&#39;K (incident, final)&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;0,0.05,0,0.05&#39;</span><span class="p">,</span> <span class="n">OutputAsMDWorkspace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Method</span><span class="o">=</span><span class="s1">&#39;NormalisedPolygon&#39;</span><span class="p">)</span>

<span class="n">pipf</span><span class="p">,</span> <span class="n">vertexes_pipf</span> <span class="o">=</span> <span class="n">ConvertToReflectometryQ</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;SignedTheta_vs_Wavelength&#39;</span><span class="p">,</span> <span class="n">OutputDimensions</span><span class="o">=</span><span class="s1">&#39;P (lab frame)&#39;</span><span class="p">,</span> <span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;0,0.1,-0.02,0.15&#39;</span><span class="p">,</span> <span class="n">OutputAsMDWorkspace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Method</span><span class="o">=</span><span class="s1">&#39;NormalisedPolygon&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qxqy</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">qxqy</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kikf</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">kikf</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pipf</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pipf</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Qx Qz
Ki Kf
Pz_i + Pz_f Pz_i - Pz_f
</pre></div>
</div>
<div class="section" id="plot-of-the-signedtheta-vs-wavelength-workspace">
<h4><a class="toc-backref" href="#id12">Plot of the SignedTheta vs Wavelength workspace:</a><a class="headerlink" href="#plot-of-the-signedtheta-vs-wavelength-workspace" title="Permalink to this headline">¶</a></h4>
<p>Before the ConvertToReflectometryQ algorithm is executed in the usage example above, the plot of the ‘SignedTheta_vs_Wavelength’ workspace should resemble this plot:</p>
<div class="figure">
<img alt="plot of Signed theta vs lambda." src="../_images/SignedThetaVSlam_plot.png" />
</div>
</div>
</div>
<div class="section" id="patch-plot-with-dumped-vertexes">
<h3><a class="toc-backref" href="#id13">Patch Plot with Dumped Vertexes</a><a class="headerlink" href="#patch-plot-with-dumped-vertexes" title="Permalink to this headline">¶</a></h3>
<p>ConvertToReflectometryQ has the functionality to produce a table of vertexes before they are
fitted to a normalised polygon. The plotting of these vertexes results in a patch plot that can be
achieved by running the algorithm below.</p>
<p><strong>Example - Patch Plot using the Dumped vertexes from QxQy Transformation</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>

<span class="c1"># full reduction on workspace</span>
<span class="n">Load</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="s1">&#39;data_th_lam.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;data_th_lam&#39;</span><span class="p">)</span>
<span class="n">CropWorkspace</span><span class="p">(</span><span class="s1">&#39;data_th_lam&#39;</span><span class="p">,</span> <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">124</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;data_th_lam&#39;</span><span class="p">)</span>
<span class="n">data_th_lam</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="s1">&#39;data_th_lam&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e-2</span><span class="p">])</span>

<span class="n">out_ws</span><span class="p">,</span> <span class="n">dump_vertexes</span> <span class="o">=</span> <span class="n">ConvertToReflectometryQ</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;data_th_lam&#39;</span><span class="p">,</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;QxQy_poly&#39;</span><span class="p">,</span> <span class="n">OutputDimensions</span><span class="o">=</span><span class="s1">&#39;Q (lab frame)&#39;</span><span class="p">,</span>
<span class="n">Extents</span><span class="o">=</span><span class="s1">&#39;-0.0005,0.0005,-0,0.2&#39;</span><span class="p">,</span> <span class="n">OutputAsMDWorkspace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">Method</span><span class="o">=</span><span class="s1">&#39;NormalisedPolygon&#39;</span><span class="p">,</span>  <span class="n">IncidentTheta</span><span class="o">=</span><span class="mf">0.44</span><span class="p">,</span> <span class="n">OverrideIncidentTheta</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">NumberBinsQx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">NumberBinsQz</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">DumpVertexes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">OutputVertexes</span><span class="o">=</span><span class="s1">&#39;dump_vertexes&#39;</span><span class="p">)</span>

<span class="c1">#plot the conversion</span>
<span class="n">plotSlice</span><span class="p">(</span><span class="n">out_ws</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">patch_plot</span><span class="p">(</span><span class="n">vertex_table</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">patches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">polygon_vertexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertex_table</span><span class="p">:</span>
        <span class="c1">#Column of vertex i.e &#39;Qx&#39; in this case, is dependent on the type of transform.</span>
        <span class="c1">#&#39;Ki&#39; and &#39;Kf&#39; are used for the K transformation.</span>
        <span class="c1">#&#39;Pi+Pf&#39; and &#39;Pi-Pf&#39; are used for the P transformation.</span>
        <span class="n">polygon_vertexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;Qx&#39;</span><span class="p">],</span> <span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;Qy&#39;</span><span class="p">]</span> <span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon_vertexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">polygon_vertexes</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="s1">&#39;CellSignal&#39;</span><span class="p">])</span>
            <span class="n">polygon_vertexes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1e5</span><span class="p">),</span><span class="n">linewidths</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0004</span><span class="p">,</span><span class="mf">0.0004</span><span class="p">])</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">threadsafe_call</span><span class="p">(</span><span class="n">patch_plot</span><span class="p">,</span> <span class="n">dump_vertexes</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<p>Patch plot for QxQy Transformation:</p>
<div class="figure">
<img alt="patch plot of dumped vertexes using Q transformation" src="../_images/ConvertToReflectometryQ_PatchPlotQ.png" />
</div>
</div>
<div class="section" id="patch-plots-from-other-transformations">
<h3><a class="toc-backref" href="#id14">Patch plots from other transformations</a><a class="headerlink" href="#patch-plots-from-other-transformations" title="Permalink to this headline">¶</a></h3>
<p>Patch plots can also be produced using the other Transformations <span class="math">\(K_i, K_f\)</span> and <span class="math">\(P_i-P_f, P_i+P_f\)</span></p>
<p><strong>Patch plot for KiKf Transformation:</strong></p>
<div class="figure">
<img alt="patch plot of dumped vertexes using K transformation" src="../_images/ConvertToReflectometryQ_PatchPlotK.PNG" />
</div>
<p><strong>Patch plot for P Transformation:</strong></p>
<div class="figure">
<img alt="patch plot of dumped vertexes using P transformation" src="../_images/ConvertToReflectometryQ_PatchPlotP.PNG" />
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Reflectometry.html">Reflectometry</a></p>
</div>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id15">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/34d8076c38ee24128cff66d5dfa6be380c8f35dc/Framework/Reflectometry/inc/MantidReflectometry/ConvertToReflectometryQ.h">ConvertToReflectometryQ.h</a></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/34d8076c38ee24128cff66d5dfa6be380c8f35dc/Framework/Reflectometry/src/ConvertToReflectometryQ.cpp">ConvertToReflectometryQ.cpp</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ConvertToPointData-v1.html" title="Previous Chapter: ConvertToPointData v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ConvertToPointData v1</span>
    </a>
  </li>
  <li>
    <a href="ConvertToReflectometryQ-v2.html" title="Next Chapter: ConvertToReflectometryQ v2"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">ConvertToRefl... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>