<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>EnggCalibrateFull v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EnggEstimateFocussedBackground v1" href="EnggEstimateFocussedBackground-v1.html" />
    <link rel="prev" title="EnggCalibrate v1" href="EnggCalibrate-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>5.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="enggcalibratefull-v1">
<span id="algm-enggcalibratefull"></span><span id="algm-enggcalibratefull-v1"></span><h1>EnggCalibrateFull v1<a class="headerlink" href="#enggcalibratefull-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/EnggCalibrateFull-v1_dlg.png"><img alt="../_images/EnggCalibrateFull-v1_dlg.png" class="screenshot" src="../_images/EnggCalibrateFull-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><span class="caption-text"><strong>EnggCalibrateFull</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calibrates every detector/pixel position by performing single peak fitting.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="EnggCalibrate-v1.html#algm-enggcalibrate"><span class="std std-ref">EnggCalibrate</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="6%" />
<col width="35%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Workspace</td>
<td>InOut</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Workspace with the calibration run to use. The calibration will be applied on it.</td>
</tr>
<tr class="row-odd"><td>VanadiumWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>Workspace with the Vanadium (correction and calibration) run.</td>
</tr>
<tr class="row-even"><td>VanIntegrationWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td>&#160;</td>
<td>Results of integrating the spectra of a Vanadium run, with one column (integration result) and one row per spectrum. This can be used in combination with OutVanadiumCurveFits from a previous execution and VanadiumWorkspace to provide pre-calculated values for Vanadium correction.</td>
</tr>
<tr class="row-odd"><td>VanCurvesWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>A workspace2D with the fitting workspaces corresponding to the instrument banks. This workspace has three spectra per bank, as produced by the algorithm Fit. This is meant to be used as an alternative input VanadiumWorkspace for testing and performance reasons. If not given, no workspace is generated.</td>
</tr>
<tr class="row-even"><td>OutDetPosTable</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>A table with the detector IDs and calibrated detector positions and additional calibration information. The table includes: the old positions in V3D format (3D vector with x, y, z values), the new positions in V3D, the new positions in spherical coordinates, the change in L2, and the DIFA, DIFC and TZERO calibration parameters.</td>
</tr>
<tr class="row-odd"><td>FittedPeaks</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Information on fitted peaks. The table has one row per calibrated detector contains. In each row, the parameters of all the peaks fitted are specified together with the the expected peak value (in d-spacing). The expected values are given in the field labelled ‘dSpacing’. When fitting back-to-back exponential functions, the ‘X0’ column has the fitted peak center.</td>
</tr>
<tr class="row-even"><td>Bank</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Which bank to calibrate: It can be specified as 1 or 2, or equivalently, North or South. See also SpectrumNumbers for a more flexible alternative to select specific detectors. Allowed values: [‘’, ‘North’, ‘South’, ‘Both: North, South’, ‘1’, ‘2’]</td>
</tr>
<tr class="row-odd"><td>SpectrumNumbers</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Sets the spectrum numbers for the detectors that should be considered in the calibration (all others will be ignored). This option cannot be used together with Bank, as they overlap. You can give multiple ranges, for example: “0-99”, or “0-9, 50-59, 100-109”.</td>
</tr>
<tr class="row-even"><td>OutDetPosFilename</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Name of the file to save the pre-/post-calibrated detector positions - this saves the same information that is provided in the output table workspace (OutDetPosTable). Allowed extensions: [‘.csv’]</td>
</tr>
<tr class="row-odd"><td>RebinBinWidth</td>
<td>Input</td>
<td>string</td>
<td>-0.0005</td>
<td>Before calculating the calibrated positions (fitting peaks) this algorithms re-bins the input sample data using a single bin width parameter. This option isto change the default bin width which is set to the value traditionally used for the Engin-X instrument</td>
</tr>
<tr class="row-even"><td>ExpectedPeaks</td>
<td>Input</td>
<td>dbl list</td>
<td>3.12428,2.7057,1.91322,1.6316,1.56214,1.35285,1.24146,1.21003,1.1046,1.04143,0.95661,0.914694,0.901901,0.855618,0.825232,0.8158,0.781069,0.757748,0.750427,0.72313,0.704505,0.676426,0.661108,0.656229,0.63774,0.624855,0.620731,0.605014</td>
<td>A list of dSpacing values where peaks are expected.</td>
</tr>
<tr class="row-odd"><td>ExpectedPeaksFromFile</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Load from file a list of dSpacing values to be translated into TOF to find expected peaks. This takes precedence over ‘ExpectedPeaks’ if both options are given. Allowed extensions: [‘.csv’]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It
might get changed or even removed without a notification, should
instrument scientists decide to do so.</p>
</div>
<p>Allows to calibrate or correct for variations in detector position
parameters. It does this by fitting the peaks for each of the selected
bank’s detector indices, (using <a class="reference internal" href="EnggFitPeaks-v1.html#algm-enggfitpeaks"><span class="std std-ref">EnggFitPeaks v1</span></a> as a child
algorithm) and using the resulting DIFC (GSAS calibration parameter)
values to calibrate the detector positions.</p>
<p>This algorithm produces a table with calibration information,
including calibrated or corrected positions and parameters. This
calibration information that can be inspected and can also be used in
other algorithms. The algorithm also applies the calibration on the
input workspace. After running this algorithm the resulting
calibration can be checked by visualizing the input workspace
instrument in the instrument viewer and/or inspecting the output table
values.</p>
<p>The output table has one row per detector where each row gives the
original position before calibration (as a V3D point, x-y-z values),
the new calibrated position (as V3D) and the calibrated spherical
co-ordinates (L2, <img class="math" src="../_images/math/504b0e6af53e29a0871abe88050d1fd72f5c833e.png" alt="2 \theta" style="vertical-align: 0px"/>, <img class="math" src="../_images/math/31474b06c59f21db91bcb3c8a425561a2e44a583.png" alt="\phi" style="vertical-align: -4px"/>). It also gives the
variation in the L2 position, and the ‘DIFA’, ‘DIFC’ and ‘TZERO’
calibration parameters as used in GSAS and other Mantid algorithms.</p>
<p>The result of the calibration (the output table given in
OutDetPosTable) is accepted by both <a class="reference internal" href="EnggCalibrate-v1.html#algm-enggcalibrate"><span class="std std-ref">EnggCalibrate v1</span></a> and
<a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><span class="std std-ref">EnggFocus v1</span></a> which use the columns ‘Detector ID’ and
‘Detector Position’ of the table to correct the detector positions
before focussing. The OutDetPosTable output table can also be used
to apply the calibration calculated by this algorithm on any other
workspace by using the algorithm <a class="reference internal" href="ApplyCalibration-v1.html#algm-applycalibration"><span class="std std-ref">ApplyCalibration v1</span></a>.</p>
<p>In the output table the calibrated positions for every detector are
found by calculating the <em>L2</em> values from the <em>DIFC</em> values as
follows:</p>
<div class="math">
<p><img src="../_images/math/c2073345e4aae4138d2344dbd00f3bdacb9546ef.png" alt="L2 = \left(\frac{DIFC} { 252.816 * 2 * sin \left(\frac{2\theta} {2.0}\right)}\right) - 50"/></p>
</div><p>where the <em>DIFC</em> values are obtained from the fitting of expected
peaks. See the algorithm <a class="reference internal" href="EnggFitPeaks-v1.html#algm-enggfitpeaks"><span class="std std-ref">EnggFitPeaks v1</span></a> for details on how
<em>DIFC</em> and other calibration parameters are calculated.</p>
<p>This algorithm expects as input/output workspace the <em>long</em>
calibration run, which provides a decent pattern for every detector or
pixel. The spectra of the workspace are corrected using data from a
Vanadium run (passed in the VanadiumWorkspace property). These
corrections include two steps: detector sensitivity correction and
pixel-by-pixel correction on a per-bank basis. See also
<a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><span class="std std-ref">EnggFocus v1</span></a> where the same correction is applied. Similarly
as in <a class="reference internal" href="EnggFocus-v1.html#algm-enggfocus"><span class="std std-ref">EnggFocus v1</span></a>, it is possible to retrieve the curves
fitted to the Vanadium run data for every bank by using the
OutVanadiumCurveFits property.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Diffraction/Engineering.html">Diffraction\Engineering</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/98431db1d0022558632d1e088c9c4b21d35b9356/Framework/PythonInterface/plugins/algorithms/EnggCalibrateFull.py">EnggCalibrateFull.py</a> <em>(last modified: 2020-03-27)</em></p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Calculate corrected positions, using the DIFC parameter, for the EnginX instrument:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Using a workspace with only one spectrum to keep this test small and fast.</span>
<span class="c1"># Normally you would use a long Ceria run file or similar</span>
<span class="n">ws_name</span> <span class="o">=</span> <span class="s1">&#39;ws_focussed&#39;</span>
<span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX00213855focussed.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">)</span>

<span class="c1"># Using precalculated Vanadium corrections. To calculate from scratch see EnggVanadiumCorrections</span>
<span class="n">van_integ_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;</span><span class="p">)</span>
<span class="n">van_curves_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;</span><span class="p">)</span>

<span class="n">pos_table</span><span class="p">,</span> <span class="n">peaks_info</span> <span class="o">=</span> <span class="n">EnggCalibrateFull</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">,</span>
                                          <span class="n">VanIntegrationWorkspace</span><span class="o">=</span><span class="n">van_integ_ws</span><span class="p">,</span>
                                          <span class="n">VanCurvesWorkspace</span><span class="o">=</span><span class="n">van_curves_ws</span><span class="p">,</span>
                                          <span class="n">ExpectedPeaks</span><span class="o">=</span><span class="p">[</span><span class="mf">1.097</span><span class="p">,</span> <span class="mf">1.28</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">],</span> <span class="n">Bank</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

<span class="n">det_id</span> <span class="o">=</span> <span class="n">pos_table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cal_pos</span> <span class="o">=</span>  <span class="n">pos_table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Det ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_id</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibrated position: (</span><span class="si">%.3f</span><span class="s2">,</span><span class="si">%.3f</span><span class="s2">,</span><span class="si">%.3f</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cal_pos</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span> <span class="n">cal_pos</span><span class="o">.</span><span class="n">getY</span><span class="p">(),</span> <span class="n">cal_pos</span><span class="o">.</span><span class="n">getZ</span><span class="p">()))</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="n">ws_name</span><span class="p">]</span>
<span class="n">posInWSInst</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="n">det_id</span><span class="p">)</span><span class="o">.</span><span class="n">getPos</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is the detector position calibrated now in the original workspace instrument? </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cal_pos</span> <span class="o">==</span> <span class="n">posInWSInst</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Det ID: 100001
Calibrated position: ...
Is the detector position calibrated now in the original workspace instrument? True
</pre></div>
</div>
<p><strong>Example - Calculate corrected positions for EngingX, saving in a file:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">csv</span>

<span class="n">ws_name</span> <span class="o">=</span> <span class="s1">&#39;ws_focussed&#39;</span>
<span class="n">pos_filename</span> <span class="o">=</span> <span class="s1">&#39;detectors_pos.csv&#39;</span>
<span class="c1"># Note that this is a small file which is not very meaningful but simple enough for</span>
<span class="c1"># this test to run fast. Please user your (proper) run file.</span>
<span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX00213855focussed.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">)</span>

<span class="c1"># Using precalculated Vanadium corrections. To calculate from scratch see EnggVanadiumCorrections</span>
<span class="n">van_integ_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_integration.nxs&#39;</span><span class="p">)</span>
<span class="n">van_curves_ws</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s1">&#39;ENGINX_precalculated_vanadium_run000236516_bank_curves.nxs&#39;</span><span class="p">)</span>

<span class="n">pos_table</span><span class="p">,</span> <span class="n">peaks_info</span> <span class="o">=</span> <span class="n">EnggCalibrateFull</span><span class="p">(</span><span class="n">Workspace</span><span class="o">=</span><span class="n">ws_name</span><span class="p">,</span>
                                          <span class="n">VanIntegrationWorkspace</span><span class="o">=</span><span class="n">van_integ_ws</span><span class="p">,</span>
                                          <span class="n">VanCurvesWorkspace</span><span class="o">=</span><span class="n">van_curves_ws</span><span class="p">,</span>
                                          <span class="n">ExpectedPeaks</span><span class="o">=</span><span class="p">[</span><span class="mf">1.097</span><span class="p">,</span> <span class="mf">1.28</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">],</span> <span class="n">Bank</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                                          <span class="n">OutDetPosFilename</span><span class="o">=</span><span class="n">pos_filename</span><span class="p">)</span>

<span class="n">det_id</span> <span class="o">=</span> <span class="n">pos_table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pos</span> <span class="o">=</span>  <span class="n">pos_table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Det ID: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_id</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibrated position: (</span><span class="si">{0:.3f}</span><span class="s2">,</span><span class="si">{1:.3f}</span><span class="s2">,</span><span class="si">{2:.3f}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">getX</span><span class="p">(),</span><span class="n">pos</span><span class="o">.</span><span class="n">getY</span><span class="p">(),</span><span class="n">pos</span><span class="o">.</span><span class="n">getZ</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got details on the peaks fitted for </span><span class="si">{0:d}</span><span class="s2"> detector(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peaks_info</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Was the file created? </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pos_filename</span><span class="p">)))</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pos_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvf</span><span class="p">:</span>
   <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvf</span><span class="p">,</span> <span class="n">dialect</span><span class="o">=</span><span class="s1">&#39;excel&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>  <span class="c1"># Skip the two metadata lines</span>
   <span class="nb">next</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
   <span class="n">calibOK</span> <span class="o">=</span> <span class="kc">True</span>
   <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
      <span class="n">cal_pos</span> <span class="o">=</span> <span class="n">pos_table</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">detector_pos_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
      <span class="n">calibOK</span> <span class="o">=</span> <span class="n">calibOK</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">detector_pos_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">cal_pos</span><span class="o">.</span><span class="n">getX</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">1e-5</span> <span class="ow">and</span>\
                            <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">detector_pos_list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">cal_pos</span><span class="o">.</span><span class="n">getY</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">1e-5</span> <span class="ow">and</span>\
                            <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">detector_pos_list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">cal_pos</span><span class="o">.</span><span class="n">getZ</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mf">1e-5</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">calibOK</span><span class="p">:</span> <span class="k">break</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Does the calibration file have the expected values? </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calibOK</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Det ID: 100001
Calibrated position: ...
Got details on the peaks fitted for 1 detector(s)
Was the file created? True
Does the calibration file have the expected values? True
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="EnggCalibrate-v1.html" title="Previous Chapter: EnggCalibrate v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; EnggCalibrate v1</span>
    </a>
  </li>
  <li>
    <a href="EnggEstimateFocussedBackground-v1.html" title="Next Chapter: EnggEstimateFocussedBackground v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">EnggEstimateF... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2020-10-23.<br/>
    </p>
  </div>
</footer>
  </body>
</html>