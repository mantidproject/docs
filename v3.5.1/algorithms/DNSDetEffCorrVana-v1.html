<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DNSDetEffCorrVana v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DNSFlippingRatioCorr v1" href="DNSFlippingRatioCorr-v1.html" />
    <link rel="prev" title="CylinderPaalmanPingsCorrection v2" href="CylinderPaalmanPingsCorrection-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="dnsdeteffcorrvana-v1">
<span id="algm-dnsdeteffcorrvana"></span><span id="algm-dnsdeteffcorrvana-v1"></span><h1>DNSDetEffCorrVana v1<a class="headerlink" href="#dnsdeteffcorrvana-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DNSDetEffCorrVana-v1_dlg.png"><img alt="../_images/DNSDetEffCorrVana-v1_dlg.png" class="screenshot" src="../_images/DNSDetEffCorrVana-v1_dlg.png" style="width: 339px;" /></a>
<p class="caption"><strong>DNSDetEffCorrVana</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#valid-input-workspaces" id="id4">Valid input workspaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Peforms detector efficiency correction                 on a given data workspace using the Vanadium data.</div></blockquote>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="5%" />
<col width="30%" />
<col width="9%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with experimental data from sample.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace to save the corrected data.</td>
</tr>
<tr class="row-even"><td>VanaWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with Vanadium data.</td>
</tr>
<tr class="row-odd"><td>BkgWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A workspace with background for Vanadium data.</td>
</tr>
<tr class="row-even"><td>VanadiumMean</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>A 2x1 matrix workspace with mean Vanadium counts (optional).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This algorithm is being developed for a specific instrument. It might get changed or even
removed without a notification, should instrument scientists decide to do so.</p>
</div>
<p>This algorithm applies detector efficiency correction to a given data <a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><em>Workspace2D</em></a>. As a result, two workspaces will be created:</p>
<ul class="simple">
<li>output workspace with corrected data. Sample logs will be copied from the data workspace.</li>
<li>if <strong>InputWorkspace</strong> has the normalization workspace (which contains monitor counts or experiment duration by user&#8217;s choice), the copy of it will be created with name <strong>OutputWorkspace_NORM</strong>.</li>
</ul>
<p>Detector efficiency correction is performed using the measurements of vanadium standard sample (hereafter Vanadium). Background for Vanadium must be also measured and provided to the algorithm as an input <strong>BkgWorkspace</strong>. Vanadium and its background can be measured at several detector bank positions.  This algorithm does the detector efficiency for a particular run in following steps:</p>
<ol class="arabic">
<li><p class="first">Normalize Vanadium workspace to a chosen normalization:</p>
<p><img class="math" src="../_images/math/9552f5d24f0d7636e04cedaeb05ab3a97734c42e.png" alt="(V_i)_{Norm} = \frac{(V_i)_{Raw}}{(C_i)_V}" style="vertical-align: -9px"/></p>
<p>where <img class="math" src="../_images/math/884cb80fcc34f3f9ed477fa40a10e7b93dd042f9.png" alt="(V_i)_{Raw}" style="vertical-align: -4px"/> is the signal from the <img class="math" src="../_images/math/4cc7324e0d6c8c591e4d865a21144bda81fd3011.png" alt="i" style="vertical-align: 0px"/> th detector in the Vanadium workspace and <img class="math" src="../_images/math/d622c32a37163cb7f2aeb0eec43b168e79f2cfbb.png" alt="(C_i)_V" style="vertical-align: -4px"/> is the number in the corresponding bin of the normalization workspace. The <a class="reference internal" href="Divide-v1.html#algm-divide"><em>Divide v1</em></a> algorithm is used for this step.</p>
</li>
<li><p class="first">Normalize Background workspace to a chosen normalization:</p>
<p><img class="math" src="../_images/math/7df3e7d473c3a4ba899c2f1b4988d14069af06ed.png" alt="(B_i)_{Norm} = \frac{(B_i)_{Raw}}{(C_i)_B}" style="vertical-align: -9px"/></p>
<p>where <img class="math" src="../_images/math/c8246c0186ec1da45c33522cbde2af4e2bfff1d9.png" alt="(B_i)_{Raw}" style="vertical-align: -4px"/> is the signal from the <img class="math" src="../_images/math/4cc7324e0d6c8c591e4d865a21144bda81fd3011.png" alt="i" style="vertical-align: 0px"/> th detector in the Background workspace and <img class="math" src="../_images/math/8fc15cf5796673cd2b383e1dfd2405e0adbc8eaf.png" alt="(C_i)_B" style="vertical-align: -4px"/> is the number in the corresponding bin of the normalization workspace. The <a class="reference internal" href="Divide-v1.html#algm-divide"><em>Divide v1</em></a> algorithm is used for this step.</p>
</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Normalization workspaces are created by the <a class="reference internal" href="LoadDNSLegacy-v1.html#algm-loaddnslegacy"><em>LoadDNSLegacy v1</em></a> algorithm.
It is responsibility of the user to take care about the same type of normalization (monitor counts or run duration) for Vanadium and Background.</p>
</div>
<ol class="arabic" start="3">
<li><p class="first">Subtract Background from Vanadium:</p>
<p><img class="math" src="../_images/math/7c1aaa913c2f5d3690e6567855686035b2d069f7.png" alt="V_i = (V_i)_{Norm} - (B_i)_{Norm}" style="vertical-align: -4px"/></p>
<p>The <a class="reference internal" href="Minus-v1.html#algm-minus"><em>Minus v1</em></a> algorithm is used for this step. In the case of negative result, the error message will be produced and the algorithm terminates.</p>
</li>
<li><p class="first">Calculate the correction coefficients:</p>
<p><img class="math" src="../_images/math/fd8495b765a2529fe0c08e73a38e73135c0275a8.png" alt="k_i = \frac{&lt;V&gt;}{V_i}" style="vertical-align: -8px"/></p>
<p>where <img class="math" src="../_images/math/9255bc47923ed2fac6e2dad9260a92ef209037ec.png" alt="&lt;V&gt;" style="vertical-align: 0px"/> is a mean value of Vanadium counts. The <a class="reference internal" href="Divide-v1.html#algm-divide"><em>Divide v1</em></a> algorithm is used for this step.</p>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If no <strong>VanadiumMean</strong> workspace is given as an input, the <img class="math" src="../_images/math/9255bc47923ed2fac6e2dad9260a92ef209037ec.png" alt="&lt;V&gt;" style="vertical-align: 0px"/> will be calculated as <img class="math" src="../_images/math/375ba91c4722699fa4c1a3315979b5e0ebc98f62.png" alt="&lt;V&gt; = \frac{1}{n}\sum V_i" style="vertical-align: -6px"/>. However, in the case if correction is applied to a group of runs, <img class="math" src="../_images/math/9255bc47923ed2fac6e2dad9260a92ef209037ec.png" alt="&lt;V&gt;" style="vertical-align: 0px"/> must be calculated as for the whole group, saved to <strong>VanadiumMean</strong> workspace and provided to this algorithm as an input.</p>
</div>
<ol class="arabic" start="5">
<li><p class="first">Apply correction to the data:</p>
<p><img class="math" src="../_images/math/cae8414d603ecc74c4841cb8c3718479343c0459.png" alt="(I_i)_{corr} = k_i\times I_i" style="vertical-align: -4px"/></p>
<p>where <img class="math" src="../_images/math/2f7d8606f8268045fcbdccb990703f9f7ad4ed0c.png" alt="I_i" style="vertical-align: -3px"/> are the neutron counts in the <strong>InputWorkspace</strong>.</p>
</li>
</ol>
<div class="section" id="valid-input-workspaces">
<h3><a class="toc-backref" href="#id4">Valid input workspaces</a><a class="headerlink" href="#valid-input-workspaces" title="Permalink to this headline">¶</a></h3>
<p>The input workspaces (<strong>InputWorkspace</strong>, <strong>VanaWorkspace</strong>, <strong>BkgWorkspace</strong>) have to have the following in order to be valid inputs for this algorithm.</p>
<ul class="simple">
<li>The same number of dimensions</li>
<li>The same number of spectra</li>
<li>The same number of bins</li>
<li><strong>VanaWorkspace</strong> and <strong>BkgWorkspace</strong> must have the corresponding normalization workspaces</li>
</ul>
<p>For the physically meaningful correction it is also important that these workspaces have the same slits size, polarisation, detector bank rotation angle, flipper status and the neutron wavelength. If some of these parameters are different, algorithm produces warning. If these properties are not specified in the workspace sample logs, no comparison is performed.</p>
<p>The workspace <strong>VanadiumMean</strong> is an optional parameter. However, if it is specified, it must be a <a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><em>Workspace2D</em></a> with 2 dimensions, 1 histogram and 1 bin.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Apply correction to a single run:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># data, vanadium and background files.</span>
<span class="n">datafile</span> <span class="o">=</span> <span class="s">&#39;oi196012pbi.d_dat&#39;</span>
<span class="n">vanafile</span> <span class="o">=</span> <span class="s">&#39;dn134011vana.d_dat&#39;</span>
<span class="n">bkgrfile</span> <span class="o">=</span> <span class="s">&#39;dn134031leer.d_dat&#39;</span>

<span class="c"># Load datasets, loader will create an additional normalization workspace</span>
<span class="n">data_ws</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="n">Polarisation</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;monitor&#39;</span><span class="p">)</span>
<span class="n">vana_ws</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">vanafile</span><span class="p">,</span> <span class="n">Polarisation</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;monitor&#39;</span><span class="p">)</span>
<span class="n">bkgr_ws</span> <span class="o">=</span> <span class="n">LoadDNSLegacy</span><span class="p">(</span><span class="n">bkgrfile</span><span class="p">,</span> <span class="n">Polarisation</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="n">Normalization</span><span class="o">=</span><span class="s">&#39;monitor&#39;</span><span class="p">)</span>

<span class="n">corrected</span> <span class="o">=</span> <span class="n">DNSDetEffCorrVana</span><span class="p">(</span><span class="n">data_ws</span><span class="p">,</span> <span class="n">vana_ws</span><span class="p">,</span> <span class="n">bkgr_ws</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
 <span class="k">print</span> <span class="nb">round</span><span class="p">(</span><span class="n">corrected</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Output:</p>
<blockquote>
<div><p>99180.91</p>
<p>77190.96</p>
<p>77265.61</p>
</div></blockquote>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/PythonAlgorithms.html">PythonAlgorithms</a> | <a class="reference external" href="categories/MLZ.html">MLZ</a> | <a class="reference external" href="categories/DNS.html">DNS</a> | <a class="reference external" href="categories/CorrectionFunctions.html">CorrectionFunctions</a> | <a class="reference external" href="categories/EfficiencyCorrections.html">EfficiencyCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/940f1ec8a966df9d8a015c4c28a17c27d88e0d63/Code/Mantid/Framework/PythonInterface/plugins/algorithms/DNSDetEffCorrVana.py">DNSDetEffCorrVana.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CylinderPaalmanPingsCorrection-v2.html" title="Previous Chapter: CylinderPaalmanPingsCorrection v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; CylinderPaalmanP...</span>
    </a>
  </li>
  <li>
    <a href="DNSFlippingRatioCorr-v1.html" title="Next Chapter: DNSFlippingRatioCorr v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">DNSFlippingRatio... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>