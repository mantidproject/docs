<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ConvertToDiffractionMDWorkspace v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="ConvertToDiffractionMDWorkspace v2" href="ConvertToDiffractionMDWorkspace-v2.html" />
    <link rel="prev" title="ConvertToDetectorFaceMD v1" href="ConvertToDetectorFaceMD-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="converttodiffractionmdworkspace-v1">
<span id="algm-converttodiffractionmdworkspace-v1"></span><h1>ConvertToDiffractionMDWorkspace v1<a class="headerlink" href="#converttodiffractionmdworkspace-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/ConvertToDiffractionMDWorkspace-v1_dlg.png"><img alt="../_images/ConvertToDiffractionMDWorkspace-v1_dlg.png" class="screenshot" src="../_images/ConvertToDiffractionMDWorkspace-v1_dlg.png" style="width: 208px;" /></a>
<p class="caption"><strong>ConvertToDiffractionMDWorkspace</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#types-of-conversion" id="id4">Types of Conversion</a></li>
<li><a class="reference internal" href="#lorentz-correction" id="id5">Lorentz Correction</a></li>
<li><a class="reference internal" href="#oneeventperbin-option" id="id6">OneEventPerBin option</a></li>
<li><a class="reference internal" href="#performance-notes" id="id7">Performance Notes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Create a MDEventWorkspace with events in reciprocal space (Qx, Qy, Qz) for an elastic diffraction experiment.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="1%" />
<col width="8%" />
<col width="3%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>An input workspace in time-of-flight. If you specify a Workspace2D, it gets converted to an EventWorkspace using ConvertToEventWorkspace.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MDWorkspace.html#mdworkspace"><em>MDEventWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Name of the output MDEventWorkspace. If the workspace already exists, then the events will be added to it.</td>
</tr>
<tr class="row-even"><td>Append</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Append events to the output workspace. The workspace is replaced if unchecked.</td>
</tr>
<tr class="row-odd"><td>ClearInputWorkspace</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Clear the events from the input workspace during conversion, to save memory.</td>
</tr>
<tr class="row-even"><td>OneEventPerBin</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Use the histogram representation (event for event workspaces). One MDEvent will be created for each histogram bin (even empty ones). Warning! This can use signficantly more memory!</td>
</tr>
<tr class="row-odd"><td>OutputDimensions</td>
<td>Input</td>
<td>string</td>
<td>Q (lab frame)</td>
<td>What will be the dimensions of the output workspace?   Q (lab frame): Wave-vector change of the lattice in the lab frame.   Q (sample frame): Wave-vector change of the lattice in the frame of the sample (taking out goniometer rotation).   HKL: Use the sample&#8217;s UB matrix to convert to crystal&#8217;s HKL indices. Allowed values: [&#8216;Q (lab frame)&#8217;, &#8216;Q (sample frame)&#8217;, &#8216;HKL&#8217;]</td>
</tr>
<tr class="row-even"><td>LorentzCorrection</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Correct the weights of events with by multiplying by the Lorentz formula: sin(theta)^2 / lambda^4</td>
</tr>
<tr class="row-odd"><td>SplitInto</td>
<td>Input</td>
<td>int list</td>
<td>2</td>
<td>A comma separated list of into how many sub-grid elements each dimension should split; or just one to split into the same number for all dimensions. Default 2.</td>
</tr>
<tr class="row-even"><td>SplitThreshold</td>
<td>Input</td>
<td>number</td>
<td>1500</td>
<td>How many events in a box before it should be split. Default 1500.</td>
</tr>
<tr class="row-odd"><td>MaxRecursionDepth</td>
<td>Input</td>
<td>number</td>
<td>20</td>
<td>How many levels of box splitting recursion are allowed. The smallest box will have each side length <img class="math" src="../_images/math/06a14defbd5d0fe6b910e9966e754c4b75f25bee.png" alt="l = (extents) / (SplitInto^{MaxRecursionDepth})." style="vertical-align: -5px"/> Default 20.</td>
</tr>
<tr class="row-even"><td>MinRecursionDepth</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Optional. If specified, then all the boxes will be split to this minimum recursion depth. 1 = one level of splitting, etc. Be careful using this since it can quickly create a huge number of boxes = (SplitInto ^ (MinRercursionDepth x NumDimensions)). But setting this property equal to MaxRecursionDepth property is necessary if one wants to generate multiple file based workspaces in order to merge them later</td>
</tr>
<tr class="row-odd"><td>Extents</td>
<td>Input</td>
<td>dbl list</td>
<td>-50,50</td>
<td>A comma separated list of min, max for each dimension, specifying the extents of each dimension. Optional, default +-50 in each dimension.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm converts from a <a class="reference external" href="http://www.mantidproject.org/MatrixWorkspace">MatrixWorkspace</a> (in
detector/time-of-flight space) to a
<a class="reference external" href="http://www.mantidproject.org/MDWorkspace">MDEventWorkspace</a> containing events in reciprocal
space.</p>
<p>The calculations apply only to elastic diffraction experiments. The
conversion can be done either to Q-space in the lab or sample frame, or
to HKL of the crystal.</p>
<p>If the OutputWorkspace does NOT already exist, a default one is created.
In order to define more precisely the parameters of the
<a class="reference external" href="http://www.mantidproject.org/MDWorkspace">MDEventWorkspace</a>, use the
<a class="reference internal" href="CreateMDWorkspace-v1.html#algm-createmdworkspace"><em>CreateMDWorkspace v1</em></a> algorithm first.</p>
<div class="section" id="types-of-conversion">
<h3><a class="toc-backref" href="#id4">Types of Conversion</a><a class="headerlink" href="#types-of-conversion" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Q (lab frame)</strong>: this calculates the momentum transfer (ki-kf) for
each event is calculated in the experimental lab frame.</li>
<li><strong>Q (sample frame)</strong>: the goniometer rotation of the sample is taken
out, to give Q in the frame of the sample. See
<a class="reference internal" href="SetGoniometer-v1.html#algm-setgoniometer"><em>SetGoniometer v1</em></a> to specify the goniometer used in
the experiment.</li>
<li><strong>HKL</strong>: uses the UB matrix (see <a class="reference internal" href="SetUB-v1.html#algm-setub"><em>SetUB v1</em></a>,
<a class="reference internal" href="FindUBUsingFFT-v1.html#algm-findubusingfft"><em>FindUBUsingFFT v1</em></a> and others) to calculate the HKL
Miller indices of each event.</li>
</ul>
</div>
<div class="section" id="lorentz-correction">
<h3><a class="toc-backref" href="#id5">Lorentz Correction</a><a class="headerlink" href="#lorentz-correction" title="Permalink to this headline">¶</a></h3>
<p>If selected, the following Lorentz correction factor is applied on each
event by multiplying its weight by L:</p>
<p><img class="math" src="../_images/math/34dfb3940ab85cb31e95d65d027a695f83a7cdbd.png" alt="L = \frac{ sin(\theta)^2 } { \lambda^{4} }" style="vertical-align: -6px"/></p>
<p>Where <img class="math" src="../_images/math/1a9b85a9218a3358278a57e3f68189b5176af0fc.png" alt="\theta" style="vertical-align: 0px"/> is <em>half</em> of the neutron scattering angle
(conventionally called <img class="math" src="../_images/math/8e9bb7fd3766daf063d69d9836ac5185a40a45a7.png" alt="2\theta" style="vertical-align: 0px"/>). <img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/> is the neutron
wavelength in <em>Angstroms</em>.</p>
<p>This correction is also done by the
<a class="reference internal" href="AnvredCorrection-v1.html#algm-anvredcorrection"><em>AnvredCorrection v1</em></a> algorithm, and will be set to
false if that algorithm has been run on the input workspace.</p>
</div>
<div class="section" id="oneeventperbin-option">
<h3><a class="toc-backref" href="#id6">OneEventPerBin option</a><a class="headerlink" href="#oneeventperbin-option" title="Permalink to this headline">¶</a></h3>
<p>If you specify <em>OneEventPerBin</em>, then the <strong>histogram</strong> representation
of the input workspace is used, with one MDEvent generated for each bin
of the workspace, <strong>including zeros</strong>.</p>
<p>This can be useful in cases where the experimental coverage needs to be
tracked. With one MDEvent for each bin, you can count which regions in
Q-space have been measured. The <a class="reference external" href="http://www.mantidproject.org/SliceViewer">SliceViewer</a> has an
option to view normalized by number of events. This means that, for
example, areas with overlap from two runs will appear scaled down.</p>
<p>A significant drawback to this is that the output MDEventWorkspace will
be <em>significantly</em> larger than the events alone would be. It currently
must be created in physical memory (it cannot yet be cached to disk).
One way to limit the memory used is to limit the OutputExtents to a
smaller region and only convert part of the space.</p>
<p>Also, the <a class="reference internal" href="FindPeaksMD-v1.html#algm-findpeaksmd"><em>FindPeaksMD v1</em></a> algorithm may not work optimally
because it depends partly on higher density of events causing more
finely split boxes.</p>
<p>If your input is a <a class="reference external" href="http://www.mantidproject.org/Workspace2D">Workspace2D</a> and you do NOT check
<em>OneEventPerBin</em>, then the workspace is converted to an
<a class="reference external" href="http://www.mantidproject.org/EventWorkspace">EventWorkspace</a> but with no events for empty bins.</p>
</div>
<div class="section" id="performance-notes">
<h3><a class="toc-backref" href="#id7">Performance Notes</a><a class="headerlink" href="#performance-notes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>8-core Intel Xeon 3.2 GHz computer: measured between 4 and 5.5
million events per second (100-200 million event workspace).</li>
<li>32-core AMD Opteron 2.7 GHz computer: measured between 8 and 9
million events per second (400-1000 million event workspaces).</li>
</ul>
<p>Usage</p>
<p><strong>Example - Convert re-binned MARI 2D workspace to 3D MD workspace for further analysis/merging with data at different temperatures :</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># create or load event workspace</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;events&#39;</span><span class="p">,</span> <span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&#39;Event&#39;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&#39;Multiple Peaks&#39;</span><span class="p">)</span>
<span class="c"># convert to  MD workspace</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">ConvertToDiffractionMDWorkspace</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">events</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;md&#39;</span><span class="p">,</span> <span class="n">OneEventPerBin</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">LorentzCorrection</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">SplitThreshold</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">Version</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># A way to look at these results as a text:</span>
<span class="k">print</span> <span class="s">&quot;Resulting MD workspace has {0} events and {1} dimensions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">getNEvents</span><span class="p">(),</span><span class="n">md</span><span class="o">.</span><span class="n">getNumDims</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&quot;Workspace Type is: &quot;</span><span class="p">,</span><span class="n">md</span><span class="o">.</span><span class="n">id</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none"><div class="highlight"><pre>Resulting MD workspace has 520128 events and 3 dimensions
Workspace Type is:  MDEventWorkspace&lt;MDLeanEvent,3&gt;
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/MDAlgorithms.html">MDAlgorithms</a></p>
</div>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/940f1ec8a966df9d8a015c4c28a17c27d88e0d63/Code/Mantid/Framework/MDAlgorithms/src/ConvertToDiffractionMDWorkspace.cpp">ConvertToDiffractionMDWorkspace.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/940f1ec8a966df9d8a015c4c28a17c27d88e0d63/Code/Mantid/Framework/MDAlgorithms/inc/MantidMDAlgorithms/ConvertToDiffractionMDWorkspace.h">ConvertToDiffractionMDWorkspace.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ConvertToDetectorFaceMD-v1.html" title="Previous Chapter: ConvertToDetectorFaceMD v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; ConvertToDetecto...</span>
    </a>
  </li>
  <li>
    <a href="ConvertToDiffractionMDWorkspace-v2.html" title="Next Chapter: ConvertToDiffractionMDWorkspace v2"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">ConvertToDiffrac... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>