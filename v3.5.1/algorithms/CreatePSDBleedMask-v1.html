<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CreatePSDBleedMask v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="CreatePeaksWorkspace v1" href="CreatePeaksWorkspace-v1.html" />
    <link rel="prev" title="CreateModeratorModel v1" href="CreateModeratorModel-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.5</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="createpsdbleedmask-v1">
<span id="algm-createpsdbleedmask"></span><span id="algm-createpsdbleedmask-v1"></span><h1>CreatePSDBleedMask v1<a class="headerlink" href="#createpsdbleedmask-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/CreatePSDBleedMask-v1_dlg.png"><img alt="../_images/CreatePSDBleedMask-v1_dlg.png" class="screenshot" src="../_images/CreatePSDBleedMask-v1_dlg.png" style="width: 361px;" /></a>
<p class="caption"><strong>CreatePSDBleedMask</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#restrictions-and-requirements-to-the-input-workspace" id="id4">Restrictions and requirements to the input workspace</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Runs a diagnostic test for saturation of PSD tubes and creates a MaskWorkspace marking the failed tube spectra.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="4%" />
<col width="26%" />
<col width="8%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the input workspace.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the output MaskWorkspace which will contain the result masks.</td>
</tr>
<tr class="row-even"><td>MaxTubeFramerate</td>
<td>Input</td>
<td>number</td>
<td><em>Mandatory</em></td>
<td>The maximum rate allowed for a tube in counts/us/frame.</td>
</tr>
<tr class="row-odd"><td>NIgnoredCentralPixels</td>
<td>Input</td>
<td>number</td>
<td>80</td>
<td>The number of pixels about the centre to ignore.</td>
</tr>
<tr class="row-even"><td>NumberOfFailures</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>An output property containing the number of masked tubes</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The algorithm identifies tubes, which become saturated due to high
neutron flux from intense Bragg peaks affecting these tubes,
so these tubes are not counting neutrons but show constant high
counts over the tube in the elastic line(s) energy region(s).
After that, the algorithm generates masking workspace to
eliminate such tubes from the final results.</p>
<p>The bleeding effect occurs due to some old data acquisition electronics and
observed as homogeneous high counts reading, symmetric over the whole
tube length. The bleeding occurs at or close to incident energy or
specific energies in multirep mode, where bright Bragg reflections
hit the tube in positions, symmetric with respect to the tube centre.</p>
<p>The example of the workspace, affected by the bleed current and requesting
bleeding corrections is presented on the following picture:</p>
<img alt="../_images/BleedingSignal.png" src="../_images/BleedingSignal.png" />
<p>First of all, the algorithm attempts to find all tubes
within the instrument attached to the workspace. If successful,
each tube is tested for saturation above the level defined by the
production of <em>MaxTubeFramerate</em> property by the <em>goodfrm</em> log value,
retrieved from the workspace.</p>
<p>If the total signal, summed over all tubes pixels, excluding the number
of central pixels specified by the <em>NIgnoredCentralPixels</em> property,
exceeds the threshold, specified by the <em>MaxTubeFramerate</em> multiplied
by the <em>goodfrm</em> value, the tube becomes masked.</p>
<p>The following image shows two instrument views obtained for two
converted to energy transfer workspaces, recorded for two incident
energies in multirep mode. Second energy range suffers from
bleeding signal as on the picture above, so proper
bleeding corrections are calculated. First energy range does not
show bleeding signal, so no bleeding corrections applied to it.</p>
<img alt="../_images/BleedingCorrections.png" src="../_images/BleedingCorrections.png" />
<div class="section" id="restrictions-and-requirements-to-the-input-workspace">
<h3><a class="toc-backref" href="#id4">Restrictions and requirements to the input workspace</a><a class="headerlink" href="#restrictions-and-requirements-to-the-input-workspace" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The workspace must contain <em>goodfrm</em> log with value specifying the number of good frames recorded by the instrument.</li>
<li>The workspace should not be normalized as <em>goodfrm</em> is proportional to neutron flux over workspace so the <em>MaxTubeFramerate</em> have the meaning of the frame rate only for non-normalized workspaces. To obtain consistent results in a case when a workspace is normalized, user should divide <em>MaxTubeFramerate</em> by the normalization factor.</li>
</ul>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">ws</span><span class="o">=</span><span class="n">CreateSampleWorkspace</span><span class="p">()</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="s">&quot;goodfrm&quot;</span><span class="p">,</span><span class="s">&quot;10&quot;</span><span class="p">,</span><span class="s">&quot;Number&quot;</span><span class="p">)</span>
<span class="n">noisyY</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">noisyY</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">1e20</span>
<span class="n">ws</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="n">noisyY</span><span class="p">)</span>
<span class="p">(</span><span class="n">wsOut</span><span class="p">,</span> <span class="n">numFailures</span><span class="p">)</span> <span class="o">=</span> <span class="n">CreatePSDBleedMask</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span><span class="n">MaxTubeFramerate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">NIgnoredCentralPixels</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="si">%i</span><span class="s"> spectra have been masked in wsOut&quot;</span> <span class="o">%</span> <span class="n">numFailures</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>10 spectra have been masked in wsOut
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Diagnostics.html">Diagnostics</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/940f1ec8a966df9d8a015c4c28a17c27d88e0d63/Code/Mantid/Framework/Algorithms/src/CreatePSDBleedMask.cpp">CreatePSDBleedMask.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/940f1ec8a966df9d8a015c4c28a17c27d88e0d63/Code/Mantid/Framework/Algorithms/inc/MantidAlgorithms/CreatePSDBleedMask.h">CreatePSDBleedMask.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CreateModeratorModel-v1.html" title="Previous Chapter: CreateModeratorModel v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; CreateModeratorM...</span>
    </a>
  </li>
  <li>
    <a href="CreatePeaksWorkspace-v1.html" title="Next Chapter: CreatePeaksWorkspace v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">CreatePeaksWorks... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>