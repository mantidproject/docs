<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>DPDFreduction v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Description" href="DSFinterp-v1.html" />
    <link rel="prev" title="DNSMergeRuns v1" href="DNSMergeRuns-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="dpdfreduction-v1">
<span id="algm-dpdfreduction"></span><span id="algm-dpdfreduction-v1"></span><h1>DPDFreduction v1<a class="headerlink" href="#dpdfreduction-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/DPDFreduction-v1_dlg.png"><img alt="../_images/DPDFreduction-v1_dlg.png" class="screenshot" src="../_images/DPDFreduction-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>DPDFreduction</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a><ul>
<li><a class="reference internal" href="#detailed-parameters-description" id="id5">Detailed Parameters description</a></li>
<li><a class="reference internal" href="#interpolation" id="id6">Interpolation</a></li>
<li><a class="reference internal" href="#normalization-by-number-of-events" id="id7">Normalization by number of events</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculate S(Q,E) from powder or isotropic data</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="5%" />
<col width="27%" />
<col width="9%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>RunNumbers</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Sample run numbers</td>
</tr>
<tr class="row-odd"><td>Vanadium</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Preprocessed white-beam vanadium file. Allowed extensions: [‘.nxs’]</td>
</tr>
<tr class="row-even"><td>EmptyCanRunNumbers</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Empty can run numbers</td>
</tr>
<tr class="row-odd"><td>EnergyBins</td>
<td>Input</td>
<td>dbl list</td>
<td>1.5</td>
<td>Energy transfer binning scheme (in meV)</td>
</tr>
<tr class="row-even"><td>MomentumTransferBins</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>Momentum transfer binning scheme (in inverse Angstroms)</td>
</tr>
<tr class="row-odd"><td>NormalizeSlices</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Do we normalize each slice?</td>
</tr>
<tr class="row-even"><td>CleanWorkspaces</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Do we clean intermediate steps?</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>S_Q_E_sliced</td>
<td>Output workspace</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Reduction algorithm for powder or isotropic data taken at the SNS/ARCS beamline.
Its purpose is to yield a <span class="math">\(S(Q,E)\)</span> structure factor from which a dynamic pair
distribution function <span class="math">\(G(r,E)\)</span> can be obtained via the
<a class="reference internal" href="../interfaces/Dynamic PDF Background Remover.html#dynamic-pdf"><span class="std std-ref">Dynamic PDF</span></a> interface.</p>
<div class="section" id="detailed-parameters-description">
<h3><a class="toc-backref" href="#id5">Detailed Parameters description</a><a class="headerlink" href="#detailed-parameters-description" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Vanadium</strong>: a preprocessed white-beam vanadium file, meaning that
all events within a particular wide wavelength range have been rebinned
into a single histogram, this for every detector.</li>
<li><strong>EnergyBins</strong>: user can input a triad <span class="math">\([E_{min}, E_{bin}, E_{max}]\)</span>
or only the energy binning <span class="math">\(E_{bin}\)</span>. If this is the case,
<span class="math">\(E_{min}\)</span> and <span class="math">\(E_{max}\)</span> are estimated: <span class="math">\(E_{min}=-0.5E_i\)</span>
and <span class="math">\(E_{max} = 0.95E_i\)</span> where <span class="math">\(E_i\)</span> is the incident energy.</li>
<li><strong>MomentumTransferBins</strong>: user has three options. User can input a triad
<span class="math">\([Q_{min}, Q_{bin}, Q_{max}]\)</span>, just <span class="math">\(Q_{bin}\)</span>,
or leave this parameter empty. If left empty, <span class="math">\(Q_{bin}\)</span>
is estimated as the momentum gained when the neutron gained an
amount of energy equal to <span class="math">\(E_{bin}\)</span>. If only <span class="math">\(Q_{bin}\)</span> is at hand,
<span class="math">\(Q_{min}\)</span> and <span class="math">\(Q_{max}\)</span>
are estimated with algorithm
<a class="reference internal" href="ConvertToMDMinMaxLocal-v1.html#algm-converttomdminmaxlocal"><span class="std std-ref">ConvertToMDMinMaxLocal</span></a>.</li>
<li><strong>NormalizeSlices</strong>: This option will normalize the final <span class="math">\(S(Q,E)\)</span>
for each energy bin, independent of each other.</li>
<li><strong>CleanWorkspaces</strong>: a series of intermediate workspaces are generated during the
reduction process. If this option is set to False, the user may want to inspect these
(listed in the order they are produced):<ul>
<li><cite>vanadium</cite>: vanadium events workspace</li>
<li><cite>reduced</cite>: sample runs after DgsReduction algorithm</li>
<li><cite>ec_reduced</cite>: empty can after <a class="reference internal" href="DgsReduction-v1.html#algm-dgsreduction"><span class="std std-ref">DgsReduction</span></a> algorithm</li>
<li><cite>vanadium_S_theta</cite>: vanadium after <a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><span class="std std-ref">GroupDetectors</span></a> algorithm.</li>
<li><cite>ec_S_theta_E</cite>: reduced empty can after <a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><span class="std std-ref">GroupDetectors</span></a>
algorithm.</li>
<li><cite>S_theta_E</cite>: reduced sample runs after <a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><span class="std std-ref">GroupDetectors</span></a>
algorithm and after subtraction of empty can <cite>ec_S_theta_E</cite>.</li>
<li><cite>S_theta_E_normalized</cite>: <cite>S_theta_E</cite> divided by vanadium vanadium_S_theta</li>
<li><cite>S_theta_E_normalized_interp</cite>: <cite>S_theta_E_normalized</cite> with interpolation over the
detector gaps.</li>
<li><cite>S_Q_E</cite>: <cite>S_theta_E_normalized_interp</cite> converted to an events MDWorkspace
with momentum transfer instead of angles.</li>
<li><cite>S_Q_E_binned</cite>: Histogram MDWorkspace after application of
<a class="reference internal" href="BinMD-v1.html#algm-binmd"><span class="std std-ref">BinMD</span></a> algorithm to <cite>S_Q_E</cite>.</li>
<li><cite>S_Q_E_sliced</cite>: conversion of <cite>S_Q_E_binned</cite> to a MatrixWorkspace with
<a class="reference internal" href="ConvertMDHistoToMatrixWorkspace-v1.html#algm-convertmdhistotomatrixworkspace"><span class="std std-ref">ConvertMDHistoToMatrixWorkspace</span></a> algorithm.</li>
<li><cite>S_Q_E_sliced_norm</cite>: <cite>S_Q_E_sliced</cite> where each E-bin has been normalized.</li>
</ul>
</li>
<li><strong>OutputWorkspace</strong>: The final <span class="math">\(S(Q,E)\)</span> which can serve as
input for the <a class="reference internal" href="../interfaces/Dynamic PDF Background Remover.html#dynamic-pdf"><span class="std std-ref">Dynamic PDF</span></a> interface.</li>
</ul>
</div>
<div class="section" id="interpolation">
<h3><a class="toc-backref" href="#id6">Interpolation</a><a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h3>
<p>The ARCS instrument has two gaps at particular <span class="math">\(\theta\)</span> angles due to arrangement
of the banks</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/DPDFreduction_fig1.png"><img alt="../_images/DPDFreduction_fig1.png" src="../_images/DPDFreduction_fig1.png" style="width: 266.0px; height: 285.5px;" /></a>
</div>
<p>The gaps lead to empty bins in the <span class="math">\(S(\theta,E)\)</span> histogram which in turn generate
significant errors in the final <span class="math">\(S(Q,E)\)</span> for certain values of <span class="math">\(Q\)</span>.
To prevent this we carry out a linear interpolation in <span class="math">\(S(\theta,E)\)</span>
at the blind-strip <span class="math">\(\theta\)</span> angles.</p>
</div>
<div class="section" id="normalization-by-number-of-events">
<h3><a class="toc-backref" href="#id7">Normalization by number of events</a><a class="headerlink" href="#normalization-by-number-of-events" title="Permalink to this headline">¶</a></h3>
<p>If user desires to plot the OutputWorkspace with Mantid’s slice viewer, user
should choose the “# Events Normalization” view. The last step in the reduction
is performed by executing
<a class="reference internal" href="ConvertMDHistoToMatrixWorkspace-v1.html#algm-convertmdhistotomatrixworkspace"><span class="std std-ref">ConvertMDHistoToMatrixWorkspace</span></a>,
which requires <em>NumEventsNormalization</em>. Our input workspace has as many spectra
as instrument detectors. Each detector has a 2D binning in
<span class="math">\(Q\)</span> and <span class="math">\(E\)</span>.
Each detector is at a particular <span class="math">\(\theta\)</span> angle, thus
<span class="math">\(E\)</span> and <span class="math">\(Q\)</span> are related by:</p>
<p><span class="math">\(E(Q) \rightarrow \frac{\hbar Q^2}{2m} =  2E_i + E -2\sqrt{(E_i+E)E_i} \ \ \cos\theta\)</span></p>
<p>That means that only <span class="math">\((Q,E)\)</span> bins satisfying the above condition have counts.
Thus for detector <span class="math">\(i\)</span> we have number of counts
<span class="math">\(N_i(Q_j,E_k) \neq 0\)</span> if the <span class="math">\((Q_j, E_k)\)</span> pair satisfy
the above condition. This represents a trajectory in <span class="math">\(Q-E\)</span> space.</p>
<p>When we execute
<a class="reference internal" href="ConvertMDHistoToMatrixWorkspace-v1.html#algm-convertmdhistotomatrixworkspace"><span class="std std-ref">ConvertMDHistoToMatrixWorkspace</span></a>
with <span class="math">\(Q\)</span> binning <span class="math">\(\Delta Q\)</span> and E binning <span class="math">\(\Delta E\)</span>,
we go detector by detectory and we look at the fragment of the
<span class="math">\(Q(E)\)</span> trajectory enclosed in the cell of Q-E phase space
denoted by the corners <span class="math">\((Q,E)\)</span>, <span class="math">\((Q+\Delta Q,E)\)</span>,
<span class="math">\((Q,E+\Delta E)\)</span> and <span class="math">\((Q+\Delta Q,E+\Delta E)\)</span>.
Thus we have for detector <span class="math">\(i\)</span> to look at the <span class="math">\((Q_j, E_k)\)</span> pairs
within this cell for detector <span class="math">\(i\)</span>, with associated
<span class="math">\(N_i(Q_j,E_k)\)</span> counts and associated scattering cross-section:</p>
<p><span class="math">\((\frac{d\sigma^2}{dE d\Omega})_{i,j,k} \ \ (Q_j,E_k) = \frac{N_i(Q_j,E_k)}{d\Omega \delta E}\)</span></p>
<p>The scattering cross-section in the aforementioned cell of dimensions
<span class="math">\(\Delta Q\)</span> x <span class="math">\(\Delta E\)</span> is the <em>average</em> of all
the scattering cross sections:</p>
<p><span class="math">\(\frac{d\sigma^2}{\Delta E d\Omega}(Q,E) = \sum\limits_{i,j,k}(\frac{d\sigma^2}{\delta E d\Omega})_{i,j,k} \ \ (Q_j,E_k) \cdot \Pi_{Q,Q+\Delta Q} \ \ \ (Q_j) \cdot \Pi_{E,E+\Delta E} \ \ \ (E_k) / \sum\limits_{i,j,k} \Pi_{Q,Q+\Delta Q} \ \ \ (Q_j) \cdot \Pi_{E,E+\Delta E} \ \ \ (E_k)\)</span></p>
<p>where <span class="math">\(\Pi_{a,b} \ (x)\)</span> is the
<a class="reference external" href="http://mathworld.wolfram.com/BoxcarFunction.html">boxcar function</a></p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Inelastic/Reduction.html">Inelastic\Reduction</a></p>
</div>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/be3e0b0ee38557d9593e311f5a2f06503b508191/Framework/PythonInterface/plugins/algorithms/DPDFreduction.py">DPDFreduction.py</a> <em>(last modified: 2020-03-27)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DNSMergeRuns-v1.html" title="Previous Chapter: DNSMergeRuns v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DNSMergeRuns v1</span>
    </a>
  </li>
  <li>
    <a href="DSFinterp-v1.html" title="Next Chapter: Description"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Description &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-02-09.<br/>
    </p>
  </div>
</footer>
  </body>
</html>