<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PoldiIndexKnownCompounds v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PoldiLoadRuns v1" href="PoldiLoadRuns-v1.html" />
    <link rel="prev" title="PoldiFitPeaks2D v1" href="PoldiFitPeaks2D-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="poldiindexknowncompounds-v1">
<span id="algm-poldiindexknowncompounds"></span><span id="algm-poldiindexknowncompounds-v1"></span><h1>PoldiIndexKnownCompounds v1<a class="headerlink" href="#poldiindexknowncompounds-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/PoldiIndexKnownCompounds-v1_dlg.png"><img alt="../_images/PoldiIndexKnownCompounds-v1_dlg.png" class="screenshot" src="../_images/PoldiIndexKnownCompounds-v1_dlg.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text"><strong>PoldiIndexKnownCompounds</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Index POLDI peaks using known compounds.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="3%" />
<col width="20%" />
<col width="6%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Workspace that contains unindexed peaks.</td>
</tr>
<tr class="row-odd"><td>CompoundWorkspaces</td>
<td>Input</td>
<td>str list</td>
<td>&#160;</td>
<td>A comma-separated list of workspace names or a workspace group. Each workspace must contain a list of indexed reflections.</td>
</tr>
<tr class="row-even"><td>Tolerances</td>
<td>Input</td>
<td>dbl list</td>
<td>0.01</td>
<td>Maximum relative tolerance delta(d)/d for lines to be indexed. Either one value or one for each compound.</td>
</tr>
<tr class="row-odd"><td>ScatteringContributions</td>
<td>Input</td>
<td>dbl list</td>
<td>1</td>
<td>Approximate scattering contribution ratio of the compounds. If omitted, all are assumed to contribute to scattering equally.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td>WorkspaceGroup</td>
<td><em>Mandatory</em></td>
<td>A workspace group that contains workspaces with indexed and unindexed reflections from the input workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>In many experiments at POLDI it is well known which compounds are present in a sample, as well as their unit cells. For some algorithms it is necessary to index the peaks found in the correlation spectrum obtained by <a class="reference internal" href="PoldiAutoCorrelation-v5.html#algm-poldiautocorrelation"><span class="std std-ref">PoldiAutoCorrelation v5</span></a>. This algorithm tries to index those peaks using lists of calculated reflections of one or more compounds (created with <a class="reference internal" href="PoldiCreatePeaksFromCell-v1.html#algm-poldicreatepeaksfromcell"><span class="std std-ref">PoldiCreatePeaksFromCell v1</span></a>). This technique is sometimes referred to as “pattern matching”. This implementation allows for a certain tolerance by allowing the user to specify an expected relative deviation of the lattice parameters, <span class="math">\(\delta\)</span>.</p>
<p>The major difficulty arises from the fact that typical POLDI experiments involve lattice deformations, which causes a shift in peak positions. For a single phase material with few peaks, this can be handled by making the tolerance larger - but only to a certain degree. If cell parameters are too large and consequently lattice plane spacings at low d-values too narrow, the indexing becomes ambiguous. Of course, introducing additional phases makes this situation even worse, leading to even more ambiguity.</p>
<p>To resolve these ambiguities, this algorithm assumes that a peak must occur somewhere in the vicinity of the theoretical position. As the distance between measured and calculated position grows, it becomes less and less likely that the measured peak corresponds to the theoretical one. By assuming a normal distribution centered at 0 and a standard deviation corresponding to an acceptable tolerance, the probability of finding the peak within this distance can be calculated.</p>
<p>The standard deviation <span class="math">\(\sigma\)</span> of the distribution is simply <span class="math">\(\delta\cdot d_0\)</span>. To determine whether a peak can be indexed by a reflection, the algorithm checks if observed and calculated position are closer than <span class="math">\(3\sigma\)</span>. If <span class="math">\(n\)</span> reflections are closer to an observed peak at position <span class="math">\(d\)</span>, all are considered a candidate for correct assignment. In order to decide which reflection is most likely to be correct, the probability is calculated for each combination of measured and calculated position and the candidate with highest value is used to indexed the measured peak.</p>
<p>In the previous example, all calculated reflections get the same weight, that’s why the closest peak is always selected. This works for a single phase material, but it becomes error prone when more phases are present. A common example is the presence of a minority phase which makes up only a few percent of the sample, so that only very strong reflections of that compound can be detected. In that case a reflection of the minority compound may be very close the measured peak position, but in fact it may not even be detectable because of the low scattering contribution.</p>
<p>For that reason it’s possible to provide estimates for scattering contributions of each phase, which are used to calculate <span class="math">\(I\)</span>. Picking up the numbers from above, <span class="math">\(I_{major}\)</span> would be 0.95 and <span class="math">\(I_{minor}\)</span> 0.05. This means that reflections of the majority phase are assigned with higher priority, because it is much more likely to detect them. Since <span class="math">\(I\)</span> is proportional to <span class="math">\(F^2\)</span>, the structure factors are also taken into account (including multiplicity related to the Laue class).</p>
<p>The output of the algorithm is a WorkspaceGroup, with one TableWorkspace for each input component containing the indexed peaks for that compound. Additionally there is a TableWorkspace with peaks that could not be indexed.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p>The following example extracts peaks from the correlation spectrum of a Silicon standard measurement and indexes the observed peaks with Silicon reflections. One peak can not be indexed, but closer inspection of the correlation spectrum reveals that there is indeed no peak at this position (<span class="math">\(Q \approx 1.54\)</span>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Load data file and instrument, perform correlation analysis</span>
<span class="n">raw_6904</span> <span class="o">=</span> <span class="n">LoadSINQFile</span><span class="p">(</span><span class="n">Filename</span> <span class="o">=</span> <span class="s2">&quot;poldi2013n006904.hdf&quot;</span><span class="p">,</span> <span class="n">Instrument</span> <span class="o">=</span> <span class="s2">&quot;POLDI&quot;</span><span class="p">)</span>
<span class="n">LoadInstrument</span><span class="p">(</span><span class="n">raw_6904</span><span class="p">,</span> <span class="n">InstrumentName</span> <span class="o">=</span> <span class="s2">&quot;POLDI&quot;</span><span class="p">,</span> <span class="n">RewriteSpectraMap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">correlated_6904</span> <span class="o">=</span> <span class="n">PoldiAutoCorrelation</span><span class="p">(</span><span class="n">raw_6904</span><span class="p">)</span>
<span class="n">peaks_6904</span> <span class="o">=</span> <span class="n">PoldiPeakSearch</span><span class="p">(</span><span class="n">correlated_6904</span><span class="p">)</span>

<span class="n">PoldiFitPeaks1D</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">correlated_6904</span><span class="p">,</span> <span class="n">FwhmMultiples</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="n">PeakFunction</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="n">PoldiPeakTable</span> <span class="o">=</span> <span class="n">peaks_6904</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                <span class="n">FitPlotsWorkspace</span> <span class="o">=</span> <span class="s2">&quot;fit_plots_6904&quot;</span><span class="p">)</span>

<span class="c1"># Create theoretical reflections for Silicon</span>
<span class="n">Si</span> <span class="o">=</span> <span class="n">PoldiCreatePeaksFromCell</span><span class="p">(</span><span class="n">SpaceGroup</span><span class="o">=</span><span class="s2">&quot;F d -3 m&quot;</span><span class="p">,</span>
                                <span class="n">Atoms</span><span class="o">=</span><span class="s2">&quot;Si 0.0 0.0 0.0 1.0 0.005&quot;</span><span class="p">,</span>
                                <span class="n">a</span><span class="o">=</span><span class="mf">5.43071</span><span class="p">,</span>
                                <span class="n">LatticeSpacingMin</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">LatticeSpacingMax</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># Index reflections</span>
<span class="n">PoldiIndexKnownCompounds</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                                <span class="n">CompoundWorkspaces</span><span class="o">=</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span>
                                <span class="n">Tolerances</span><span class="o">=</span><span class="s2">&quot;0.005&quot;</span><span class="p">,</span>
                                <span class="n">ScatteringContributions</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
                                <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;Indexed&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Indexed_Si contains </span><span class="si">{}</span><span class="s2"> indexed peaks.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;peaks_refined_6904_indexed_Si&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of unindexed peaks: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;peaks_refined_6904_unindexed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Indexed_Si contains 13 indexed peaks.
Number of unindexed peaks: 0
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SINQ/Poldi.html">SINQ\Poldi</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/be3e0b0ee38557d9593e311f5a2f06503b508191/Framework/SINQ/inc/MantidSINQ/PoldiIndexKnownCompounds.h">PoldiIndexKnownCompounds.h</a> <em>(last modified: 2020-03-20)</em></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/be3e0b0ee38557d9593e311f5a2f06503b508191/Framework/SINQ/src/PoldiIndexKnownCompounds.cpp">PoldiIndexKnownCompounds.cpp</a> <em>(last modified: 2020-04-07)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PoldiFitPeaks2D-v1.html" title="Previous Chapter: PoldiFitPeaks2D v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PoldiFitPeaks2D v1</span>
    </a>
  </li>
  <li>
    <a href="PoldiLoadRuns-v1.html" title="Next Chapter: PoldiLoadRuns v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PoldiLoadRuns v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-02-09.<br/>
    </p>
  </div>
</footer>
  </body>
</html>