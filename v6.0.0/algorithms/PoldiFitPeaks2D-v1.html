<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PoldiFitPeaks2D v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PoldiIndexKnownCompounds v1" href="PoldiIndexKnownCompounds-v1.html" />
    <link rel="prev" title="PoldiFitPeaks1D v2" href="PoldiFitPeaks1D-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="poldifitpeaks2d-v1">
<span id="algm-poldifitpeaks2d"></span><span id="algm-poldifitpeaks2d-v1"></span><h1>PoldiFitPeaks2D v1<a class="headerlink" href="#poldifitpeaks2d-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/PoldiFitPeaks2D-v1_dlg.png"><img alt="../_images/PoldiFitPeaks2D-v1_dlg.png" class="screenshot" src="../_images/PoldiFitPeaks2D-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>PoldiFitPeaks2D</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id5">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id6">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id7">Properties</a></li>
<li><a class="reference internal" href="#description" id="id8">Description</a></li>
<li><a class="reference internal" href="#usage" id="id9">Usage</a></li>
<li><a class="reference internal" href="#source" id="id10">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id5">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculates a POLDI 2D-spectrum.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id6">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="PoldiFitPeaks1D-v2.html#algm-poldifitpeaks1d"><span class="std std-ref">PoldiFitPeaks1D</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id7">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="2%" />
<col width="10%" />
<col width="3%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Measured POLDI 2D-spectrum.</td>
</tr>
<tr class="row-odd"><td>PoldiPeakWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Table workspace with peak information.</td>
</tr>
<tr class="row-even"><td>PeakProfileFunction</td>
<td>Input</td>
<td>string</td>
<td>Gaussian</td>
<td>Profile function to use for integrating the peak profiles before calculating the spectrum. Allowed values: [‘BackToBackExponential’, ‘Bk2BkExpConvPV’, ‘DeltaFunction’, ‘ElasticDiffRotDiscreteCircle’, ‘ElasticDiffSphere’, ‘ElasticIsoRotDiff’, ‘ExamplePeakFunction’, ‘Gaussian’, ‘IkedaCarpenterPV’, ‘Lorentzian’, ‘PseudoVoigt’, ‘Voigt’]</td>
</tr>
<tr class="row-odd"><td>GlobalParameters</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Comma-separated list of parameter names that are identical for all peaks, is ignored when PawleyFit is selected.</td>
</tr>
<tr class="row-even"><td>PawleyFit</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Instead of refining individual peaks, refine a unit cell. Peaks must be indexed using PoldiIndexKnownCompounds.</td>
</tr>
<tr class="row-odd"><td>FitConstantBackground</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Add a constant background term to the fit.</td>
</tr>
<tr class="row-even"><td>ConstantBackgroundParameter</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Initial value of constant background.</td>
</tr>
<tr class="row-odd"><td>FitLinearBackground</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Add a background term linear in 2theta to the fit.</td>
</tr>
<tr class="row-even"><td>LinearBackgroundParameter</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Initial value of linear background.</td>
</tr>
<tr class="row-odd"><td>MaximumIterations</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Maximum number of iterations for the fit. Use 0 to calculate 2D-spectrum without fitting.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Calculated POLDI 2D-spectrum</td>
</tr>
<tr class="row-odd"><td>Calculated1DSpectrum</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Calculated POLDI 1D-spectrum.</td>
</tr>
<tr class="row-even"><td>LambdaMin</td>
<td>Input</td>
<td>number</td>
<td>1.1</td>
<td>Minimum wavelength for 1D spectrum calculation</td>
</tr>
<tr class="row-odd"><td>LambdaMax</td>
<td>Input</td>
<td>number</td>
<td>5</td>
<td>Maximum wavelength for 1D spectrum calculation</td>
</tr>
<tr class="row-even"><td>RefinedPoldiPeakWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Table workspace with fitted peaks.</td>
</tr>
<tr class="row-odd"><td>OutputIntegratedIntensities</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If this option is checked, the peaks in the algorithm’s output will have integrated intensities instead of the maximum.</td>
</tr>
<tr class="row-even"><td>RefinedCellParameters</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>RawFitParameters</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><span class="std std-ref">Workspace</span></a></td>
<td>&#160;</td>
<td>Table workspace that contains all raw fit parameters.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id8">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>PoldiFitPeaks2D is an algorithm that can be used to fit a set of individual peaks to 2D POLDI-data. These must come in a table of special format, which may be generated for example by <a class="reference internal" href="PoldiFitPeaks1D-v2.html#algm-poldifitpeaks1d"><span class="std std-ref">PoldiFitPeaks1D v2</span></a>. Furthermore, the algorithm needs a MatrixWorkspace containing raw POLDI data with correct dimensions and a proper instrument definition.</p>
<p>The 1D-peak intensities need to be integral intensities, so the peaks are integrated if necessary. If there is no profile information supplied in the peak table (<a class="reference internal" href="PoldiFitPeaks1D-v2.html#algm-poldifitpeaks1d"><span class="std std-ref">PoldiFitPeaks1D v2</span></a> adds this automatically), it’s possible to supply a profile function as parameter to this algorithm. If a profile function name is present in the peak table, the one supplied in the parameters has priority.</p>
<p>There are two modes for performing the fit. In the default mode, all peak profiles are fitted independently using the same function that is used for integration. For profile functions other than Gaussian or Lorentzian it can be necessary to tie the additional profile parameters (for example the “Mixing” parameter of PseudoVoigt) so that they are the same for all peaks in order to get a reasonable fit. This can be achieved by specifying the names of these parameters in a comma separated list to the “GlobalParameters” property.</p>
<p>The other possibility is to perform a Pawley-type fit, where peak positions are calculated using lattice parameters and Miller indices (see <a class="reference internal" href="PawleyFit-v1.html#algm-pawleyfit"><span class="std std-ref">PawleyFit v1</span></a> for a more general explanation of the method). This mode is controlled by the PawleyFit parameter. For these fits, an additional table will be created which contains the refined lattice parameters. Please note that the peaks need to be indexed to use this mode (using <a class="reference internal" href="PoldiCreatePeaksFromCell-v1.html#algm-poldicreatepeaksfromcell"><span class="std std-ref">PoldiCreatePeaksFromCell v1</span></a> and <a class="reference internal" href="PoldiIndexKnownCompounds-v1.html#algm-poldiindexknowncompounds"><span class="std std-ref">PoldiIndexKnownCompounds v1</span></a>).</p>
<p>Alternatively, if the peaks have been indexed using a different method, the log values <cite>UnitCell</cite> and <cite>CrystalSystem</cite> must be set on the table workspace using <a class="reference internal" href="AddSampleLog-v1.html#algm-addsamplelog"><span class="std std-ref">AddSampleLog v1</span></a>. <cite>UnitCell</cite> must contain a string with 6 numbers that define a unit cell, with lengths in <span class="math">\(\mathrm{\AA{}}\)</span> and angles in degree (for example <cite>5.4 5.4 5.4 90 90 90</cite>), whereas <cite>CrystalSystem</cite> must be one of the seven crystal systems (for example <cite>Cubic</cite>).</p>
<p>PoldiFitPeaks2D can also be used to calculate a theoretical 2D pattern from a set of peaks by limiting the iterations to 0.</p>
<p>In addition to performing the 2D-fit, a theoretical 1D-diffractogram of the fit-function is calculated as well, which can be used in conjunction with <a class="reference internal" href="PoldiAnalyseResiduals-v1.html#algm-poldianalyseresiduals"><span class="std std-ref">PoldiAnalyseResiduals v1</span></a> to assess the quality of a fit. Depending on the value of the <cite>OutputIntegratedIntensity</cite>-option, the output peaks intensities are either integrated or describe the maximum.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id9">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Individual peak profiles</strong></p>
<p>PoldiFitPeaks2D operates on a MatrixWorkspace with a valid POLDI instrument definition. The following short example demonstrates how to use the algorithm, processing data obtained from recording the spectrum of a Silicon standard material (powder) and calculating a theoretical 2D-spectrum.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Load data file with Si spectrum and instrument definition</span>
<span class="n">truncated</span> <span class="o">=</span> <span class="n">PoldiLoadRuns</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6904</span><span class="p">)</span>

<span class="c1"># Perform correlation, peak search and fit</span>
<span class="n">correlated_6904</span> <span class="o">=</span> <span class="n">PoldiAutoCorrelation</span><span class="p">(</span><span class="s2">&quot;truncated_data_6904&quot;</span><span class="p">)</span>
<span class="n">peaks_6904</span> <span class="o">=</span> <span class="n">PoldiPeakSearch</span><span class="p">(</span><span class="n">correlated_6904</span><span class="p">)</span>

<span class="n">PoldiFitPeaks1D</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">correlated_6904</span><span class="p">,</span> <span class="n">FwhmMultiples</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="n">PeakFunction</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="n">PoldiPeakTable</span> <span class="o">=</span> <span class="n">peaks_6904</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                <span class="n">FitPlotsWorkspace</span> <span class="o">=</span> <span class="s2">&quot;fit_plots_6904&quot;</span><span class="p">)</span>

<span class="c1"># Calculate a 2D spectrum using the refined peaks</span>
<span class="n">PoldiFitPeaks2D</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;truncated_data_6904&quot;</span><span class="p">,</span>
                            <span class="n">PoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                            <span class="n">RefinedPoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_fit_2d_6904&quot;</span><span class="p">,</span>
                            <span class="n">Calculated1DSpectrum</span><span class="o">=</span><span class="s2">&quot;simulated_1d_6904&quot;</span><span class="p">,</span>
                            <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;simulated_6904&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After this step, there is a new workspace containing the simulated spectrum. It should look similar to the one in the following figure:</p>
<div class="figure align-center" id="id2" style="width: 15cm">
<img alt="Raw POLDI data for Silicon powder standard (simulated)." src="../_images/PoldiAutoCorrelation_Si_2D.png" />
<p class="caption"><span class="caption-text">Simulated 2D-spectrum of silicon powder.</span></p>
</div>
<p>In general, there is a background in POLDI data that depends on <span class="math">\(2\theta\)</span>. The following script, which is almost identical to the above one introduces this parameter.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Load data file with Si spectrum and instrument definition</span>
<span class="n">truncated</span> <span class="o">=</span> <span class="n">PoldiLoadRuns</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6904</span><span class="p">)</span>

<span class="c1"># Perform correlation, peak search and fit</span>
<span class="n">correlated_6904</span> <span class="o">=</span> <span class="n">PoldiAutoCorrelation</span><span class="p">(</span><span class="s2">&quot;truncated_data_6904&quot;</span><span class="p">)</span>
<span class="n">peaks_6904</span> <span class="o">=</span> <span class="n">PoldiPeakSearch</span><span class="p">(</span><span class="n">correlated_6904</span><span class="p">)</span>

<span class="n">PoldiFitPeaks1D</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">correlated_6904</span><span class="p">,</span> <span class="n">FwhmMultiples</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="n">PeakFunction</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="n">PoldiPeakTable</span> <span class="o">=</span> <span class="n">peaks_6904</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                <span class="n">FitPlotsWorkspace</span> <span class="o">=</span> <span class="s2">&quot;fit_plots_6904&quot;</span><span class="p">)</span>

<span class="c1"># Calculate a 2D spectrum using the refined peaks - with background linear in 2theta</span>
<span class="n">PoldiFitPeaks2D</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;truncated_data_6904&quot;</span><span class="p">,</span>
                         <span class="n">PoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                         <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;simulated_6904&quot;</span><span class="p">,</span>
                         <span class="n">RefinedPoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_fit_2d_6904&quot;</span><span class="p">,</span>
                         <span class="n">Calculated1DSpectrum</span><span class="o">=</span><span class="s2">&quot;simulated_1d_6904&quot;</span><span class="p">,</span>
                         <span class="n">LinearBackgroundParameter</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the spectrum looks different, like in the example below.</p>
<div class="figure align-center" id="id3" style="width: 15cm">
<img alt="Raw POLDI data for Silicon powder standard with background (simulated)." src="../_images/PoldiAutoCorrelation_Si_2D_bg.png" />
<p class="caption"><span class="caption-text">Simulated 2D-spectrum of silicon powder with background.</span></p>
</div>
<p>Furthermore, a 1D diffractogram is also calculated, which shows all peaks that were used to calculate the 2D spectrum as well.</p>
<div class="figure align-center" id="id4" style="width: 15cm">
<img alt="Calculated diffractogram for Silicon powder standard." src="../_images/PoldiFitPeaks2D_Si_1D.png" />
<p class="caption"><span class="caption-text">Calculated diffractogram for Silicon powder standard.</span></p>
</div>
<p><strong>Pawley-type fit</strong></p>
<p>The following example shows an example for refinement of lattice parameters using the PawleyFit-option.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Load and merge 2 data files for better statistics.</span>
<span class="n">truncated</span> <span class="o">=</span> <span class="n">PoldiLoadRuns</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">6903</span><span class="p">,</span> <span class="mi">6904</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Perform correlation, peak search and fit</span>
<span class="n">correlated_6904</span> <span class="o">=</span> <span class="n">PoldiAutoCorrelation</span><span class="p">(</span><span class="s2">&quot;truncated_data_6904&quot;</span><span class="p">)</span>
<span class="n">peaks_6904</span> <span class="o">=</span> <span class="n">PoldiPeakSearch</span><span class="p">(</span><span class="n">correlated_6904</span><span class="p">)</span>

<span class="n">PoldiFitPeaks1D</span><span class="p">(</span><span class="n">InputWorkspace</span> <span class="o">=</span> <span class="n">correlated_6904</span><span class="p">,</span> <span class="n">FwhmMultiples</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
                <span class="n">PeakFunction</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span><span class="p">,</span> <span class="n">PoldiPeakTable</span> <span class="o">=</span> <span class="n">peaks_6904</span><span class="p">,</span>
                <span class="n">OutputWorkspace</span> <span class="o">=</span> <span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                <span class="n">FitPlotsWorkspace</span> <span class="o">=</span> <span class="s2">&quot;fit_plots_6904&quot;</span><span class="p">)</span>

<span class="c1"># Generate reflections for Silicon</span>
<span class="n">si_peaks</span> <span class="o">=</span> <span class="n">PoldiCreatePeaksFromCell</span><span class="p">(</span><span class="n">SpaceGroup</span> <span class="o">=</span> <span class="s2">&quot;F d -3 m&quot;</span><span class="p">,</span>
                                    <span class="n">Atoms</span> <span class="o">=</span> <span class="s2">&quot;Si 0.0 0.0 0.0&quot;</span><span class="p">,</span>
                                    <span class="n">a</span> <span class="o">=</span> <span class="mf">5.431</span><span class="p">,</span>
                                    <span class="n">LatticeSpacingMin</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span>
<span class="c1"># Index the refined peaks</span>
<span class="n">indexed</span> <span class="o">=</span> <span class="n">PoldiIndexKnownCompounds</span><span class="p">(</span><span class="s2">&quot;peaks_refined_6904&quot;</span><span class="p">,</span>
                                   <span class="n">CompoundWorkspaces</span> <span class="o">=</span> <span class="s2">&quot;si_peaks&quot;</span><span class="p">)</span>

<span class="c1"># Only consider the first 8 peaks</span>
<span class="n">DeleteTableRows</span><span class="p">(</span><span class="s2">&quot;peaks_refined_6904_indexed_si_peaks&quot;</span><span class="p">,</span> <span class="s2">&quot;8-30&quot;</span><span class="p">)</span>

<span class="c1"># Fit a unit cell.</span>
<span class="n">PoldiFitPeaks2D</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s2">&quot;truncated_data_6904&quot;</span><span class="p">,</span>
                         <span class="n">PoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_refined_6904_indexed_si_peaks&quot;</span><span class="p">,</span>
                         <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;fitted_6904&quot;</span><span class="p">,</span>
                         <span class="n">PawleyFit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                         <span class="n">MaximumIterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                         <span class="n">RefinedPoldiPeakWorkspace</span><span class="o">=</span><span class="s2">&quot;peaks_fit_2d_6904&quot;</span><span class="p">,</span>
                         <span class="n">Calculated1DSpectrum</span><span class="o">=</span><span class="s2">&quot;simulated_1d_6904&quot;</span><span class="p">,</span>
                         <span class="n">RefinedCellParameters</span><span class="o">=</span><span class="s2">&quot;refined_cell_6904&quot;</span><span class="p">)</span>


<span class="n">lattice_parameters</span> <span class="o">=</span> <span class="n">AnalysisDataService</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="s2">&quot;refined_cell_6904&quot;</span><span class="p">)</span>

<span class="n">cell_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lattice_parameters</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">cell_a_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lattice_parameters</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refined lattice parameter a = </span><span class="si">{:.5f}</span><span class="s2"> +/- </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_a</span><span class="p">,</span> <span class="n">cell_a_error</span><span class="p">))</span>
</pre></div>
</div>
<p>The refined lattice parameter is printed at the end:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Refined lattice parameter a = 5.43126 +/- 4e-05
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SINQ/Poldi.html">SINQ\Poldi</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id10">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/be3e0b0ee38557d9593e311f5a2f06503b508191/Framework/SINQ/inc/MantidSINQ/PoldiFitPeaks2D.h">PoldiFitPeaks2D.h</a> <em>(last modified: 2020-04-07)</em></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/be3e0b0ee38557d9593e311f5a2f06503b508191/Framework/SINQ/src/PoldiFitPeaks2D.cpp">PoldiFitPeaks2D.cpp</a> <em>(last modified: 2020-04-07)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PoldiFitPeaks1D-v2.html" title="Previous Chapter: PoldiFitPeaks1D v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PoldiFitPeaks1D v2</span>
    </a>
  </li>
  <li>
    <a href="PoldiIndexKnownCompounds-v1.html" title="Next Chapter: PoldiIndexKnownCompounds v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PoldiIndexKno... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-02-09.<br/>
    </p>
  </div>
</footer>
  </body>
</html>