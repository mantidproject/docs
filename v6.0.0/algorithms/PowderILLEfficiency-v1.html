<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PowderILLEfficiency v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PowderILLParameterScan v1" href="PowderILLParameterScan-v1.html" />
    <link rel="prev" title="PowderILLDetectorScan v1" href="PowderILLDetectorScan-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.0</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="powderillefficiency-v1">
<span id="algm-powderillefficiency"></span><span id="algm-powderillefficiency-v1"></span><h1>PowderILLEfficiency v1<a class="headerlink" href="#powderillefficiency-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/PowderILLEfficiency-v1_dlg.png"><img alt="../_images/PowderILLEfficiency-v1_dlg.png" class="screenshot" src="../_images/PowderILLEfficiency-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>PowderILLEfficiency</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#derivationmethod" id="id6">DerivationMethod</a></li>
<li><a class="reference internal" href="#calibrationmethod" id="id7">CalibrationMethod</a></li>
<li><a class="reference internal" href="#calibrationrun" id="id8">CalibrationRun</a></li>
<li><a class="reference internal" href="#calibrationfile" id="id9">CalibrationFile</a></li>
<li><a class="reference internal" href="#excludedrange" id="id10">ExcludedRange</a></li>
<li><a class="reference internal" href="#pixelrange" id="id11">PixelRange</a></li>
<li><a class="reference internal" href="#normaliseto" id="id12">NormaliseTo</a></li>
<li><a class="reference internal" href="#roi" id="id13">ROI</a></li>
<li><a class="reference internal" href="#outputworkspace" id="id14">OutputWorkspace</a></li>
<li><a class="reference internal" href="#outputresponseworkspace" id="id15">OutputResponseWorkspace</a></li>
<li><a class="reference internal" href="#numberofiterations" id="id16">NumberOfIterations</a></li>
<li><a class="reference internal" href="#maskcriterion" id="id17">MaskCriterion</a></li>
<li><a class="reference internal" href="#limitations" id="id18">Limitations</a></li>
<li><a class="reference internal" href="#d20-workflow" id="id19">D20 Workflow</a></li>
<li><a class="reference internal" href="#d2b-workflow" id="id20">D2B Workflow</a></li>
<li><a class="reference internal" href="#related-algorithms" id="id21">Related Algorithms</a></li>
<li><a class="reference internal" href="#source" id="id22">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Performs detector efficiency correction calculation for scanning monochromatic powder diffraction instruments D20 and D2B at ILL.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="PowderILLDetectorScan-v1.html#algm-powderilldetectorscan"><span class="std std-ref">PowderILLDetectorScan</span></a>, <a class="reference internal" href="PowderILLParameterScan-v1.html#algm-powderillparameterscan"><span class="std std-ref">PowderILLParameterScan</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="3%" />
<col width="16%" />
<col width="11%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CalibrationRun</td>
<td>Input</td>
<td>list of str lists</td>
<td><em>Mandatory</em></td>
<td>File path of calibration runs (numors). Must be detector scans. Allowed values: [‘nxs’]</td>
</tr>
<tr class="row-odd"><td>CalibrationFile</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>Optional file containing previous calibration constants. Allowed values: [‘nxs’]</td>
</tr>
<tr class="row-even"><td>CalibrationMethod</td>
<td>Input</td>
<td>string</td>
<td>Median</td>
<td>The method of how the calibration constant of a pixel is derived from the distribution of ratios. Allowed values: [‘Median’, ‘Mean’, ‘MostLikelyMean’]</td>
</tr>
<tr class="row-odd"><td>DerivationMethod</td>
<td>Input</td>
<td>string</td>
<td>SequentialSummedReference1D</td>
<td>Choose sequential for D20 (1D detector), global for D2B (2D detector). Allowed values: [‘SequentialSummedReference1D’, ‘GlobalSummedReference2D’]</td>
</tr>
<tr class="row-even"><td>InterpolateOverlappingAngles</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Whether to interpolate scattering angle values in overlapping regions (D20 only).</td>
</tr>
<tr class="row-odd"><td>NormaliseTo</td>
<td>Input</td>
<td>string</td>
<td>None</td>
<td>Normalise to monitor or ROI counts before deriving the calibration. Allowed values: [‘None’, ‘Monitor’, ‘ROI’]</td>
</tr>
<tr class="row-even"><td>ROI</td>
<td>Input</td>
<td>dbl list</td>
<td>0,100</td>
<td>Scattering angle regions of interest for normalisation [degrees].</td>
</tr>
<tr class="row-odd"><td>ExcludedRange</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>Scattering angle regions to exclude from the computation of relative calibration constants; for example, the beam stop [degrees].</td>
</tr>
<tr class="row-even"><td>PixelRange</td>
<td>Input</td>
<td>long list</td>
<td>1,3072</td>
<td>Range of the pixel numbers to compute the calibration factors for (D20 only); for the other pixels outside the range, the factor will be set to 1.</td>
</tr>
<tr class="row-odd"><td>OutputResponseWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>Output workspace containing the summed diffraction patterns of all the overlapping pixels.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>Output workspace containing the calibration constants (inverse of efficiency) for each pixel.</td>
</tr>
<tr class="row-odd"><td>NumberOfIterations</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>Number of iterations to perform (D2B only): 0 means auto; that is, the iterations will terminate after reaching some Chi2/NdoF.</td>
</tr>
<tr class="row-even"><td>MaskCriterion</td>
<td>Input</td>
<td>dbl list</td>
<td>&#160;</td>
<td>Efficiency constants outside this range will be set to zero.</td>
</tr>
<tr class="row-odd"><td>UseCalibratedData</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Whether or not to use the calibrated data in the NeXus files (D2B only).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm calculates the detector efficiency corrections for scanning monochromatic powder diffractometers D20 and D2B at ILL.
Detector scan in this context stands for a set of discrete rotations of the detector around the sample in the horizontal (scattering) plane.
The general philosophy is based on the fact that different detector cells pass through the same spatial coordinates during the scan.
Under the assumption that at a certain coordinate all the detectors should measure the same counts, one could derive relative inter-calibration between the cells.
The input to the algorithm is a set of detector scan acquisitions recorded for vanadium sample.
However, <strong>no assumption</strong> that vanadium response has to be flat and isotropic, is made.
That is, the geometrical effects, off-plane self-attenuation effects, and the small Bragg peaks in the vanadium data are well taken into account.
The output is a map of calibration constants that have to be applied multiplicatively to the sample data; that is, the calibration constant is the inverse of the relative detector efficiency.</p>
</div>
<div class="section" id="derivationmethod">
<h2><a class="toc-backref" href="#id6">DerivationMethod</a><a class="headerlink" href="#derivationmethod" title="Permalink to this headline">¶</a></h2>
<p>There are two strategies to derive the efficiencies, as follows:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>SequentialSummedReference1D</strong> (referred hereafter as the <strong>D20</strong> method) must be used for D20, which is a 1D detector with solid rectangular panels.</p>
<ol class="arabic simple">
<li>Takes the first cell response as a function of scattering angle (during the scan) as a reference</li>
<li>Takes the second cell and divides the reference to the second cell response in the overlapping region in terms of scattering angle. This results in an array of relative response ratios.</li>
<li>Uses one of the 3 calibration methods (see below) to compute the relative calibration factor from the array of relative response ratios. This factor is saved in the output as the calibration factor for the second cell.</li>
<li>The response of the second cell is scaled up with that factor, and then merged (in the overlapping region) with the reference using <a class="reference internal" href="WeightedMean-v1.html#algm-weightedmean"><span class="std std-ref">WeightedMean</span></a>. This results in a new reference.</li>
<li>Repeat from Step 2 for the next cell using the updated reference and so on until the last cell.</li>
</ol>
<p>For the zero-counting cells, the calibration factor cannot be computed, hence they will be set to 1. Cells are treated as zero-counting if they count zero more than 80% of time.</p>
<p>After the calibration factors are computed for all the cells, they are divided by the median of all the factors (excluding the zero-counting cells),
in order to absolutely normalize the calibration curve.</p>
</li>
<li><p class="first"><strong>GlobalSummedReference2D</strong> (referred hereafter as the <strong>D2B</strong> method) must be used for D2B, which is a 2D detector composed of PSD tubes that are placed at some distance from each other, hence the detector has gaps between the tubes.</p>
<ol class="arabic simple">
<li>Averages the responses of all the pixels at a certain height level using <a class="reference internal" href="SumOverlappingTubes-v1.html#algm-sumoverlappingtubes"><span class="std std-ref">SumOverlappingTubes</span></a>. This results in a global reference, which is a 2D matrix of averaged counts.</li>
<li>For each tube, constructs the ratio of the global reference wrt the tube response in the overlapping region; this results in arrays of relative response ratios for each pixel in that tube.</li>
<li>Takes the median of the response ratios as calibration constant for the given pixel in the given tube.</li>
<li>Optionally, if iterations are requested (see below), it applies the calibration of the first run to the input, and repeats from Step 1.</li>
</ol>
<p>As mentioned, the calibration constants are computed pixel by pixel; no grouping of pixels inside the tubes is done.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="calibrationmethod">
<h2><a class="toc-backref" href="#id7">CalibrationMethod</a><a class="headerlink" href="#calibrationmethod" title="Permalink to this headline">¶</a></h2>
<p>When relative response ratios are constructed for a given pixel, the algorithm offers 3 ways to get the calibration factor out: median (default), mean and <a class="reference internal" href="MostLikelyMean-v1.html#algm-mostlikelymean"><span class="std std-ref">MostLikelyMean</span></a>.
For the <strong>D2B</strong> case, for the moment only median is supported, as the convergence of the other methods through the iterations is currently under investigation.</p>
</div>
<div class="section" id="calibrationrun">
<h2><a class="toc-backref" href="#id8">CalibrationRun</a><a class="headerlink" href="#calibrationrun" title="Permalink to this headline">¶</a></h2>
<p>The input must be a set of <strong>detector-scan</strong> numors in <strong>.nxs</strong> format produced for vanadium.</p>
</div>
<div class="section" id="calibrationfile">
<h2><a class="toc-backref" href="#id9">CalibrationFile</a><a class="headerlink" href="#calibrationfile" title="Permalink to this headline">¶</a></h2>
<p>Optionally a previously derived calibration file (e.g. the output of this algorithm saved with <a class="reference internal" href="SaveNexusProcessed-v1.html#algm-savenexusprocessed"><span class="std std-ref">SaveNexusProcessed</span></a>) can be provided.
In this case this calibration will be applied first, and then the algorithm will compute residual calibration factors on top of that.</p>
</div>
<div class="section" id="excludedrange">
<h2><a class="toc-backref" href="#id10">ExcludedRange</a><a class="headerlink" href="#excludedrange" title="Permalink to this headline">¶</a></h2>
<p>Provide ranges in scattering angle in degrees (in equatorial plane) to exclude non-desired regions, e.g. the beam stop.
In principle, multiple regions can be set, <strong>-20,0,10,20</strong> will exclude <strong>[-20,0]</strong> and <strong>[10,20]</strong>.
The exclusion happens at Step 3 for both of the derivation methods, before computing the calibration factor out of the relative response ratios.</p>
</div>
<div class="section" id="pixelrange">
<h2><a class="toc-backref" href="#id11">PixelRange</a><a class="headerlink" href="#pixelrange" title="Permalink to this headline">¶</a></h2>
<p>Provide the range of detector cells to compute the calibration factors for.
For the rest of the cells, the factor will be set to 1.
This is used for <strong>D20</strong> only, and by default the factors will be computed for all the cells.</p>
</div>
<div class="section" id="normaliseto">
<h2><a class="toc-backref" href="#id12">NormaliseTo</a><a class="headerlink" href="#normaliseto" title="Permalink to this headline">¶</a></h2>
<p>The input data can be optionally normalised to monitor counts or region-of-interest (ROI, for <strong>D20</strong> only) counts.</p>
</div>
<div class="section" id="roi">
<h2><a class="toc-backref" href="#id13">ROI</a><a class="headerlink" href="#roi" title="Permalink to this headline">¶</a></h2>
<p>Regions of scattering angle in degrees (in equatorial plane), where the counts are summed, and the data is normalised to the sum. Relevant only for <strong>D20</strong>.</p>
</div>
<div class="section" id="outputworkspace">
<h2><a class="toc-backref" href="#id14">OutputWorkspace</a><a class="headerlink" href="#outputworkspace" title="Permalink to this headline">¶</a></h2>
<p>For <strong>D20</strong>, the output is a single-column workspace containing the calibration factors for each cell.
For <strong>D2B</strong>, it is a 2D workspace (x axis is the tube index, spectrum axis is the pixel index in the tube).
The output should be normally saved with
<a class="reference internal" href="SaveNexusProcessed-v1.html#algm-savenexusprocessed"><span class="std std-ref">SaveNexusProcessed</span></a> to be later used in <a class="reference internal" href="PowderILLParameterScan-v1.html#algm-powderillparameterscan"><span class="std std-ref">PowderILLParameterScan</span></a> and <a class="reference internal" href="PowderILLDetectorScan-v1.html#algm-powderilldetectorscan"><span class="std std-ref">PowderILLDetectorScan</span></a>.</p>
</div>
<div class="section" id="outputresponseworkspace">
<h2><a class="toc-backref" href="#id15">OutputResponseWorkspace</a><a class="headerlink" href="#outputresponseworkspace" title="Permalink to this headline">¶</a></h2>
<p>Optionally, the merged response of the cells taking into account the newly derived calibration can be output. This is a 1D spectrum for <strong>D20</strong> and 2D workspace for <strong>D2B</strong>.</p>
</div>
<div class="section" id="numberofiterations">
<h2><a class="toc-backref" href="#id16">NumberOfIterations</a><a class="headerlink" href="#numberofiterations" title="Permalink to this headline">¶</a></h2>
<p>This is used for <strong>D2B</strong> only.
For <strong>D20</strong> there is no need for iterations, since a single shot derivation is already convergent; that is, the residual calibration factors are identical to unity.</p>
<p>This specifies how many times the calibration has to be derived (see Step 4 above for <strong>D2B</strong> method):</p>
<blockquote>
<div><ul>
<li><p class="first">1 by default: The calibration will be derived only once (single-shot) and no iteration will be performed. Typically this gives reasonably good result already.</p>
</li>
<li><p class="first">User specified positive integer: Iterations will be performed as many times as requested. It is not advised to iterate too much, since after local convergence it may start to diverge again; hence there is a hard limit of 10.</p>
</li>
<li><p class="first">0 stands for auto: Iterations will be run automatically until the termination criteria is satisfied. Termination criteria is:</p>
<blockquote>
<div><div class="math">
\[\frac{\chi^{2}}{NdoF} = \frac{\sum_{i,j}(c_{ij} - 1)^{2}}{N_{\mathrm{tubes}} * N_{\mathrm{pixels\_per\_tube}}} &lt; t\]</div>
<p>where <span class="math">\(c_{ij}\)</span> is the residual calibration factor for tube <em>i</em> and pixel <em>j</em>, <span class="math">\(t\)</span> is the threshold defined in <a class="reference internal" href="../concepts/InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">Instrument Parameter File (IPF)</span></a> as <em>chi2_ndof</em>.</p>
<p>The top and bottom parts of the tubes are excluded from this calculation. How many pixels exactly are excluded is again defined in <a class="reference internal" href="../concepts/InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">IPF</span></a> as <em>pixels_to_trim</em>.</p>
<p>Currently, for <strong>D2B</strong>, <em>pixels_to_trim=28</em> and <em>t=1%</em>. With this settings iterations typically terminate after the first one, i. e. one run and one iteration give results already convergent within 1%.</p>
<p>This has to be interpreted as: the residual calibration is close enough to unity, so further iterations will not change the calibration much.</p>
<p>However, this criterion does not prevent from divergence in all the cases.
It can happen that for a given pixel the residual calibration factor (albeit close to unity) is always on the same side (i.e. always above 1 or below 1); this will cause the absolute calibration to gradually diverge with iterations.
Anyways, the method implemented does not provide enough precision to resolve residual calibration better than in the percent range.
Hence, care must be taken when using the iterations.
It is not recommended to use more than 2 iterations.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="maskcriterion">
<h2><a class="toc-backref" href="#id17">MaskCriterion</a><a class="headerlink" href="#maskcriterion" title="Permalink to this headline">¶</a></h2>
<p>Provide a range, out of which the calibration constants will be set to zero. This effectively masks the pixels after applying the calibration multiplicatively.</p>
</div>
<div class="section" id="limitations">
<h2><a class="toc-backref" href="#id18">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>For <strong>D2B</strong> it is assumed that the tubes and pixels pass through the exact same positions during the scan.
That is, the tubes have to be aligned vertically and horizontally and the gap between each pair of neighboring tubes must be integer multiple of the scan step.
If some of the input files will have 26 scan points instead of 25, the last scan point data will be ignored.</p>
</div>
<div class="section" id="d20-workflow">
<h2><a class="toc-backref" href="#id19">D20 Workflow</a><a class="headerlink" href="#d20-workflow" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/PowderILLEfficiency-v1_D20_wkflw.png" src="../_images/PowderILLEfficiency-v1_D20_wkflw.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - D20</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mantid</span> <span class="kn">import</span> <span class="n">plots</span>
<span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="n">PowderILLEfficiency</span>
<span class="n">PowderILLEfficiency</span><span class="p">(</span><span class="n">CalibrationRun</span><span class="o">=</span><span class="s1">&#39;967076.nxs&#39;</span><span class="p">,</span> <span class="n">DerivationMethod</span><span class="o">=</span><span class="s1">&#39;SequentialSummedReference1D&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;calib&#39;</span><span class="p">)</span>
<span class="n">Transpose</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;calib&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;calib&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="s1">&#39;mantid&#39;</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;calib&#39;</span><span class="p">],</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel #&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Calibration constant&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/D20_calib.png"><img alt="../_images/D20_calib.png" src="../_images/D20_calib.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="d2b-workflow">
<h2><a class="toc-backref" href="#id20">D2B Workflow</a><a class="headerlink" href="#d2b-workflow" title="Permalink to this headline">¶</a></h2>
<img alt="../_images/PowderILLEfficiency-v1_D2B_wkflw.png" src="../_images/PowderILLEfficiency-v1_D2B_wkflw.png" />
<p><strong>Example - D2B</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mantid</span> <span class="kn">import</span> <span class="n">plots</span>
<span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="n">PowderILLEfficiency</span>
<span class="n">PowderILLEfficiency</span><span class="p">(</span><span class="n">CalibrationRun</span><span class="o">=</span><span class="s1">&#39;532008,532009&#39;</span><span class="p">,</span> <span class="n">DerivationMethod</span><span class="o">=</span><span class="s1">&#39;GlobalSummedReference2D&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;calib&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="s1">&#39;mantid&#39;</span><span class="p">})</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;calib&#39;</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tube #&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel #&#39;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Calibration constant&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/D2B_calib.png"><img alt="../_images/D2B_calib.png" src="../_images/D2B_calib.png" style="width: 600px;" /></a>
</div>
</div>
<div class="section" id="related-algorithms">
<h2><a class="toc-backref" href="#id21">Related Algorithms</a><a class="headerlink" href="#related-algorithms" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="PowderILLParameterScan-v1.html#algm-powderillparameterscan"><span class="std std-ref">PowderILLParameterScan</span></a> performs the data reduction.
<a class="reference internal" href="PowderILLDetectorScan-v1.html#algm-powderilldetectorscan"><span class="std std-ref">PowderILLDetectorScan</span></a> performs the data reduction for detector scans.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Diffraction.html">ILL\Diffraction</a> | <a class="reference external" href="categories/Diffraction/Reduction.html">Diffraction\Reduction</a> | <a class="reference external" href="categories/Diffraction/Calibration.html">Diffraction\Calibration</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id22">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/be3e0b0ee38557d9593e311f5a2f06503b508191/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/PowderILLEfficiency.py">PowderILLEfficiency.py</a> <em>(last modified: 2020-10-22)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="PowderILLDetectorScan-v1.html" title="Previous Chapter: PowderILLDetectorScan v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; PowderILLDete...</span>
    </a>
  </li>
  <li>
    <a href="PowderILLParameterScan-v1.html" title="Next Chapter: PowderILLParameterScan v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">PowderILLPara... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-02-09.<br/>
    </p>
  </div>
</footer>
  </body>
</html>