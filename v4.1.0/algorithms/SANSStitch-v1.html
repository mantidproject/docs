<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SANSStitch v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="SANSSubtract v1" href="SANSSubtract-v1.html" />
    <link rel="prev" title="SANSSolidAngleCorrection v1" href="SANSSolidAngleCorrection-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="sansstitch-v1">
<span id="algm-sansstitch"></span><span id="algm-sansstitch-v1"></span><h1>SANSStitch v1<a class="headerlink" href="#sansstitch-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/SANSStitch-v1_dlg.png"><img alt="../_images/SANSStitch-v1_dlg.png" class="screenshot" src="../_images/SANSStitch-v1_dlg.png" style="width: 330px;" /></a>
<p class="caption"><strong>SANSStitch</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#fit-modes" id="id4">Fit Modes</a></li>
<li><a class="reference internal" href="#can-runs" id="id5">Can Runs</a></li>
<li><a class="reference internal" href="#workflow" id="id6">Workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id7">Usage</a></li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Stitch the high angle and low angle banks of a workspace together</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="4%" />
<col width="25%" />
<col width="7%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>HABCountsSample</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>High angle bank sample workspace in Q</td>
</tr>
<tr class="row-odd"><td>HABNormSample</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>High angle bank normalization workspace in Q</td>
</tr>
<tr class="row-even"><td>LABCountsSample</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Low angle bank sample workspace in Q</td>
</tr>
<tr class="row-odd"><td>LABNormSample</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Low angle bank normalization workspace in Q</td>
</tr>
<tr class="row-even"><td>ProcessCan</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Process the can</td>
</tr>
<tr class="row-odd"><td>HABCountsCan</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>High angle bank sample workspace in Q</td>
</tr>
<tr class="row-even"><td>HABNormCan</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>High angle bank normalization workspace in Q</td>
</tr>
<tr class="row-odd"><td>LABCountsCan</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Low angle bank sample workspace in Q</td>
</tr>
<tr class="row-even"><td>LABNormCan</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Low angle bank normalization workspace in Q</td>
</tr>
<tr class="row-odd"><td>Mode</td>
<td>Input</td>
<td>string</td>
<td>None</td>
<td>What to fit. Free parameter(s). Allowed values: [&#8216;Both&#8217;, &#8216;None&#8217;, &#8216;ShiftOnly&#8217;, &#8216;ScaleOnly&#8217;]</td>
</tr>
<tr class="row-even"><td>ScaleFactor</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Optional scaling factor</td>
</tr>
<tr class="row-odd"><td>ShiftFactor</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Optional shift factor</td>
</tr>
<tr class="row-even"><td>FitMin</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Optional minimum q for fit</td>
</tr>
<tr class="row-odd"><td>FitMax</td>
<td>Input</td>
<td>number</td>
<td>1000</td>
<td>Optional maximum q for fit</td>
</tr>
<tr class="row-even"><td>MergeMask</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Controls whether the user has manually specified the merge region</td>
</tr>
<tr class="row-odd"><td>MergeMin</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>The minimum of the merge region in q</td>
</tr>
<tr class="row-even"><td>MergeMax</td>
<td>Input</td>
<td>number</td>
<td>1000</td>
<td>The maximum of the merge region in q</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Stitched high and low Q 1-D data</td>
</tr>
<tr class="row-even"><td>OutScaleFactor</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Applied scale factor</td>
</tr>
<tr class="row-odd"><td>OutShiftFactor</td>
<td>Output</td>
<td>number</td>
<td>&nbsp;</td>
<td>Applied shift factor</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm is used to stitch together reduced data typically provided by <a class="reference internal" href="Q1D-v2.html#algm-q1d"><em>Q1D v2</em></a>. Data from high-angle and low-angle banks in a SANS experiment can be stitched together using this algorithm.</p>
<p>Merging of inputs is achieved using the following foruma, where <em>C</em> denotes counts, <em>N</em> denotes normalization and <em>f</em> and <em>r</em> relate to forward (high-angle) and rear (low-angle) respectively:</p>
<div class="math">
<p><img src="../_images/math/df0d8f1075aecf8882f46f931deea802957f4651.png" alt="\frac{C_f(Q)+(shift\cdot N_f(Q))+C_r(Q)}{\frac{N_f(Q)}{scale} + N_r(Q)}"/></p>
</div><div class="section" id="fit-modes">
<h3><a class="toc-backref" href="#id4">Fit Modes</a><a class="headerlink" href="#fit-modes" title="Permalink to this headline">¶</a></h3>
<p>There are 4 available fit modes used to scale and shift the high angle bank data so that it can be stitched together with the low angle bank data. Where fitting is required <a class="reference internal" href="Fit-v1.html#algm-fit"><em>Fit v1</em></a> is used with a composite function comprised of a <em>FlatBackground</em> and <em>TabulatedFunction</em>. In all cases the shift and scale are used to alter the counts and errors for the high angle bank.</p>
<p><em>None</em> is the mode for no fit determined scaling or shifting. In this case the <em>ScaleFactor</em> and <em>ShiftFactor</em> properties must both be provided. With <em>Both</em>, fitting is used to establish optimum parameters for both the scaling and shifting of the high angle bank data. <em>ScaleOnly</em> mode ties the shift, so <em>ShiftFactor</em> must be provided. <em>ShiftOnly</em> mode ties the scale so <em>ScaleFactor</em> must be provided.</p>
</div>
<div class="section" id="can-runs">
<h3><a class="toc-backref" href="#id5">Can Runs</a><a class="headerlink" href="#can-runs" title="Permalink to this headline">¶</a></h3>
<p>When can runs are provided they are processed separately using the same merge formula above, and then subtracted from the processed sample run. If can runs are provided as inputs then the scale and shift factors are determined as part of fitting by operating on a workspace calculated from:</p>
<div class="math">
<p><img src="../_images/math/83fa08efec8ad5e51b49f17b2154922be9929227.png" alt="\frac{C_{sample}(Q)}{N_{sample}(Q)} - \frac{C_{can}(Q)}{N_{can}(Q)}"/></p>
</div><p>This is analogous to how <a class="reference internal" href="Q1D-v2.html#algm-q1d"><em>Q1D v2</em></a> operates on input workspaces.</p>
<p>Merging of front and rear banks for the can is achieved using a different form from that above.</p>
<div class="math">
<p><img src="../_images/math/039bee023bf69f20ac3d809e57c5a7731f1c70e7.png" alt="\frac{C_f(Q)+C_r(Q)}{\frac{N_f(Q)}{scale} + N_r(Q)}"/></p>
</div><p>where <em>C</em> denotes counts, <em>N</em> denotes normalization and <em>f</em> and <em>r</em> relate to forward (high-angle) and rear (low-angle) respectively. The can workspace is subtracted from the merged sample workspace to generate the output.</p>
</div>
<div class="section" id="workflow">
<h3><a class="toc-backref" href="#id6">Workflow</a><a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/SANSStitch-v1_wkflw.png" src="../_images/SANSStitch-v1_wkflw.png" />
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id7">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Simple shift:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">hab_counts</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;MomentumTransfer&#39;</span><span class="p">)</span>
<span class="n">hab_norm</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;MomentumTransfer&#39;</span><span class="p">)</span>
<span class="n">lab_counts</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;MomentumTransfer&#39;</span><span class="p">)</span>
<span class="n">lab_norm</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">DataX</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;MomentumTransfer&#39;</span><span class="p">)</span>

<span class="n">uniform_binning</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="n">hab_counts</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">hab_counts</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>
<span class="n">hab_norm</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">hab_norm</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>
<span class="n">lab_counts</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">lab_counts</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>
<span class="n">lab_norm</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">lab_norm</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">uniform_binning</span><span class="p">)</span>

<span class="n">stitched</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">SANSStitch</span><span class="p">(</span><span class="n">HABCountsSample</span><span class="o">=</span><span class="n">hab_counts</span><span class="p">,</span>
    <span class="n">HABNormSample</span><span class="o">=</span><span class="n">hab_norm</span><span class="p">,</span>
    <span class="n">LABCountsSample</span><span class="o">=</span><span class="n">lab_counts</span><span class="p">,</span>
    <span class="n">LABNormSample</span><span class="o">=</span><span class="n">lab_norm</span><span class="p">,</span>
    <span class="n">Mode</span><span class="o">=</span><span class="s">&#39;ShiftOnly&#39;</span><span class="p">,</span> <span class="n">ScaleFactor</span><span class="o">=</span><span class="mf">1.0</span> <span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.1f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;{:.1f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shift</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>1.0
6.0
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/SANS.html">SANS</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/SANSStitch.py">SANSStitch.py</a> <em>(last modified: 2019-02-26)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SANSSolidAngleCorrection-v1.html" title="Previous Chapter: SANSSolidAngleCorrection v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SANSSolidAngleCo...</span>
    </a>
  </li>
  <li>
    <a href="SANSSubtract-v1.html" title="Next Chapter: SANSSubtract v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SANSSubtract v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>