<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DetectorEfficiencyCor v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DetectorEfficiencyCorUser v1" href="DetectorEfficiencyCorUser-v1.html" />
    <link rel="prev" title="DetectorDiagnostic v1" href="DetectorDiagnostic-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="detectorefficiencycor-v1">
<span id="algm-detectorefficiencycor"></span><span id="algm-detectorefficiencycor-v1"></span><h1>DetectorEfficiencyCor v1<a class="headerlink" href="#detectorefficiencycor-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DetectorEfficiencyCor-v1_dlg.png"><img alt="../_images/DetectorEfficiencyCor-v1_dlg.png" class="screenshot" src="../_images/DetectorEfficiencyCor-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><strong>DetectorEfficiencyCor</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This algorithm adjusts the binned data in a workspace for detector efficiency, calculated from the neutrons&#8217; kinetic energy, the gas filled detector&#8217;s geometry and gas pressure. The data are then multiplied by <img class="math" src="../_images/math/4737eea85ea927266ba23d664c382620e85eb1bf.png" alt="k_i/k_f" style="vertical-align: -6px"/></p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="He3TubeEfficiency-v1.html#algm-he3tubeefficiency"><em>He3TubeEfficiency</em></a>, <a class="reference internal" href="DetectorEfficiencyCorUser-v1.html#algm-detectorefficiencycoruser"><em>DetectorEfficiencyCorUser</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="3%" />
<col width="15%" />
<col width="4%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The workspace to correct for detector efficiency</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The name of the workspace in which to store the result. Each histogram from the input workspace maps to a histogram in this workspace that has just one value which indicates if there was a bad detector.</td>
</tr>
<tr class="row-even"><td>IncidentEnergy</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>The energy of neutrons leaving the source as can be calculated by <a class="reference internal" href="GetEi-v2.html#algm-getei"><em>GetEi v2</em></a>. If this value is provided, uses property value, if it is not present, needs Ei log value set on the workspace.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The probability of neutron detection by each detector in the
<a class="reference internal" href="../concepts/Workspace.html#workspace"><em>workspace</em></a> is calculated from the neutrons&#8217; kinetic
energy, angle between their path and the detector axis, detector gas
pressure, radius and wall thickness. The detectors must be cylindrical
and their <sup>3</sup>He partial pressure, wall thickness and radius
are attached to the instrument stored in the input workspace,
The first parameter is in atmospheres and the last two in metres.
That workspace then needs to be converted so that its
X-values are in <a class="reference internal" href="../concepts/UnitFactory.html#unit-factory"><em>units</em></a> of energy transfer, e.g. using
the <a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><em>ConvertUnits v1</em></a> algorithm.</p>
<p>To estimate the true number of neutrons that entered the detector the
counts in each bin are divided by the detector efficiency of that
detector at that energy. The efficiency iteslef is calculated from
the formula, tabulated within the algorithm.</p>
<p>The numbers of counts are then multiplied by the value of
<img class="math" src="../_images/math/4737eea85ea927266ba23d664c382620e85eb1bf.png" alt="k_i/k_f" style="vertical-align: -6px"/> for each bin. In that formula <img class="math" src="../_images/math/f6e496297758681ea972ae4c97277526b19a11d8.png" alt="k_i" style="vertical-align: -3px"/> is the
wavenumber a neutron leaving the source (the same for all neutrons) and
<img class="math" src="../_images/math/41b62620d459361ddd500c6c117a1bf22ff3b3f0.png" alt="k_f" style="vertical-align: -6px"/> is the wavenumber on hitting the detector (dependent on the
detector and energy bin). They&#8217;re calculated, in angstrom<sup>-1</sup>, as</p>
<div class="line-block">
<div class="line"><img class="math" src="../_images/math/138cc0f20d040adc4bac1bd816d9e8019fccdfeb.png" alt="k_i = \sqrt{\frac{E_i}{2.07212466}}" style="vertical-align: -12px"/></div>
<div class="line"><img class="math" src="../_images/math/9704ab5e9a1c6f1859b969a8282a2d684e1597e4.png" alt="k_f = \sqrt{\frac{E_i - \Delta E}{2.07212466}}" style="vertical-align: -12px"/></div>
</div>
<p>where <img class="math" src="../_images/math/67a0b078f2a23c2a112fa770355a05c391d59569.png" alt="E_i" style="vertical-align: -3px"/> and <img class="math" src="../_images/math/e7f3976c8fc98924a2661d692ffbe4a2f6b7e4d8.png" alt="\Delta E" style="vertical-align: 0px"/> are energies in meV, the initial
neutron kinetic energy and the energy lost to the sample respectively.</p>
<p>Note: it is not possible to use this <a class="reference internal" href="../concepts/Algorithm.html#algorithm"><em>algorithm</em></a> to
correct for the detector efficiency alone. One solution to this is to
divide the output of the algorithm by <img class="math" src="../_images/math/4737eea85ea927266ba23d664c382620e85eb1bf.png" alt="k_i/k_f" style="vertical-align: -6px"/> calculated as above.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="DetectorEfficiencyCorUser-v1.html#algm-detectorefficiencycoruser"><em>DetectorEfficiencyCorUser v1</em></a> algorithm, which may provide
more instrument specific efficiency corrections.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Correct detectors efficiency:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Simulates Load of a workspace with all necessary parameters #################</span>
<span class="n">detWS</span> <span class="o">=</span> <span class="n">CreateSimulationWorkspace</span><span class="p">(</span><span class="n">Instrument</span><span class="o">=</span><span class="s">&#39;MAR&#39;</span><span class="p">,</span><span class="n">BinParams</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span><span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;DeltaE&#39;</span><span class="p">)</span>
<span class="n">detWS</span><span class="o">.</span><span class="n">dataE</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">)]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">AddSampleLog</span><span class="p">(</span><span class="n">detWS</span><span class="p">,</span><span class="n">LogName</span><span class="o">=</span><span class="s">&#39;Ei&#39;</span><span class="p">,</span><span class="n">LogText</span><span class="o">=</span><span class="s">&#39;52.&#39;</span><span class="p">,</span><span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">);</span>

<span class="c"># Correct detectors efficiency</span>
<span class="n">corWS</span> <span class="o">=</span> <span class="n">DetectorEfficiencyCor</span><span class="p">(</span><span class="n">detWS</span><span class="p">)</span>
<span class="n">corWS</span> <span class="o">=</span> <span class="n">CorrectKiKf</span><span class="p">(</span><span class="n">corWS</span><span class="p">,</span><span class="n">EMode</span><span class="o">=</span><span class="s">&#39;Direct&#39;</span><span class="p">)</span>

<span class="c">#</span>
<span class="c"># Look at sample results:</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;part of the corrected workspace:&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
   <span class="k">print</span><span class="p">(</span><span class="s">&#39;{} {} {:.11f} {} {:.11f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">detWS</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="n">detWS</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="n">corWS</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="n">detWS</span><span class="o">.</span><span class="n">readE</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span><span class="n">corWS</span><span class="o">.</span><span class="n">readE</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
<p><strong>Output:</strong></p>
<div class="highlight-none"><div class="highlight"><pre>part of the corrected workspace:
-20.0 1.0 1.11489184233 1.0 1.11489184233
-18.0 1.0 1.12451654494 1.0 1.12451654494
-16.0 1.0 1.13460358926 1.0 1.13460358926
-14.0 1.0 1.14519004998 1.0 1.14519004998
-12.0 1.0 1.15631723061 1.0 1.15631723061
-10.0 1.0 1.16803129778 1.0 1.16803129778
-8.0 1.0 1.18038403500 1.0 1.18038403500
-6.0 1.0 1.19343374325 1.0 1.19343374325
-4.0 1.0 1.20724632323 1.0 1.20724632323
-2.0 1.0 1.22189658402 1.0 1.22189658402
0.0 1.0 1.23746983599 1.0 1.23746983599
2.0 1.0 1.25406384358 1.0 1.25406384358
4.0 1.0 1.27179123770 1.0 1.27179123770
6.0 1.0 1.29078252032 1.0 1.29078252032
8.0 1.0 1.31118984059 1.0 1.31118984059
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a> | <a class="reference external" href="categories/Inelastic/Corrections.html">Inelastic\Corrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/Algorithms/src/DetectorEfficiencyCor.cpp">DetectorEfficiencyCor.cpp</a> <em>(last modified: 2019-06-05)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/Algorithms/inc/MantidAlgorithms/DetectorEfficiencyCor.h">DetectorEfficiencyCor.h</a> <em>(last modified: 2018-10-05)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DetectorDiagnostic-v1.html" title="Previous Chapter: DetectorDiagnostic v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DetectorDiagnost...</span>
    </a>
  </li>
  <li>
    <a href="DetectorEfficiencyCorUser-v1.html" title="Next Chapter: DetectorEfficiencyCorUser v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DetectorEfficien... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>