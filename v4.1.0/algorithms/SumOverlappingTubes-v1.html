<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SumOverlappingTubes v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="SumRowColumn v1" href="SumRowColumn-v1.html" />
    <link rel="prev" title="SumNeighbours v1" href="SumNeighbours-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="sumoverlappingtubes-v1">
<span id="algm-sumoverlappingtubes"></span><span id="algm-sumoverlappingtubes-v1"></span><h1>SumOverlappingTubes v1<a class="headerlink" href="#sumoverlappingtubes-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/SumOverlappingTubes-v1_dlg.png"><img alt="../_images/SumOverlappingTubes-v1_dlg.png" class="screenshot" src="../_images/SumOverlappingTubes-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><strong>SumOverlappingTubes</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a><ul>
<li><a class="reference internal" href="#general-behavior" id="id6">General Behavior</a><ul>
<li><a class="reference internal" href="#dtubes-option" id="id7">2DTubes Option</a></li>
<li><a class="reference internal" href="#d-option" id="id8">2D Option</a></li>
<li><a class="reference internal" href="#id1" id="id9">1D Option</a></li>
<li><a class="reference internal" href="#instrument-parameters" id="id10">Instrument Parameters</a></li>
<li><a class="reference internal" href="#splitcounts" id="id11">SplitCounts</a></li>
<li><a class="reference internal" href="#cropnegativescatteringangles" id="id12">CropNegativeScatteringAngles</a></li>
<li><a class="reference internal" href="#scatteringanglebinning" id="id13">ScatteringAngleBinning</a></li>
<li><a class="reference internal" href="#outputworkspace" id="id14">OutputWorkspace</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id15">Usage</a></li>
<li><a class="reference internal" href="#source" id="id16">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Takes workspaces containing an instrument with PSD and tubes, and converts to a workspace with counts as a function of height and scattering angle. Detector scans with overlapping tubes are supported.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="SumSpectra-v1.html#algm-sumspectra"><em>SumSpectra</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="2%" />
<col width="10%" />
<col width="3%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspaces</td>
<td>Input</td>
<td>str list</td>
<td><em>Mandatory</em></td>
<td>The names of the input workspaces as a list. You may also group workspaces using the GUI or [[GroupWorkspaces]], and specify the name of the group instead.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Name of the output workspace.</td>
</tr>
<tr class="row-even"><td>OutputType</td>
<td>Input</td>
<td>string</td>
<td>2D</td>
<td>Whether to have the output in raw 2D, with no Debye-Scherrer cone correction, 2D or 1D. Allowed values: [&#8216;2DTubes&#8217;, &#8216;2D&#8217;, &#8216;1D&#8217;]</td>
</tr>
<tr class="row-odd"><td>ScatteringAngleBinning</td>
<td>Input</td>
<td>dbl list</td>
<td>0.05</td>
<td>A comma separated list of the first scattering angle, the scattering angle step size and the final scattering angle. Optionally this can also be a single number, which is the angle step size. In this case, the boundary of binning will be determined by minimum and maximum scattering angle present in the workspaces.</td>
</tr>
<tr class="row-even"><td>CropNegativeScatteringAngles</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If true the negative scattering angles are cropped (ignored).</td>
</tr>
<tr class="row-odd"><td>HeightAxis</td>
<td>Input</td>
<td>dbl list</td>
<td>&nbsp;</td>
<td>A comma separated list of the first y value, the y value step size and the final y value. This can also be a single number, which is the y value step size. In this case, the boundary of binning will be determined by minimum and maximum y values present in the workspaces. This can also be two numbers to give the range desired.</td>
</tr>
<tr class="row-even"><td>Normalise</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>If true normalise to the number of entries added for a particular scattering angle.</td>
</tr>
<tr class="row-odd"><td>MirrorScatteringAngles</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>A flag to mirror the signed 2thetas.</td>
</tr>
<tr class="row-even"><td>SplitCounts</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>A flag to split the counts between adjacent bins</td>
</tr>
<tr class="row-odd"><td>ScatteringAngleTolerance</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>The relative tolerance for the scattering angles before the counts are split.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm takes an input workspace, a group workspace or a selection of workspaces, with a PSD tube instrument, and converts the workspace to a one or two-dimensional workspace of counts as a function of height and scattering angle. There are options to either see the data as it is, or apply a correction to straighten the Debye-Scherrer cones.</p>
<p>This algorithm is written for the geometry of D2B, where the detector tubes have the same radial distance from the sample, and rotate around the sample in the horizontal plane during a detector scan. This algorithm could be generalised to support other instrument geometries in the future.</p>
<div class="section" id="general-behavior">
<h3><a class="toc-backref" href="#id6">General Behavior</a><a class="headerlink" href="#general-behavior" title="Permalink to this headline">¶</a></h3>
<p>For the output workspace a grid is made, the x-axis is the scattering angle and the y-axis is vertical distance from the centre of the tube (referred to as the tube height). Counts from the input workspaces are then put onto this grid. Where one of the entries in the scattering angle is between two angles the count are split between the two, unless the ScatteringAngleTolerance option is set.</p>
<p>If the Normalise option is set then the counts for each point in the OutputWorkspace are divided by the number of contributing points to that pixel. The scaling goes as</p>
<div class="math">
<p><img src="../_images/math/1e39d00316cf788c75f33c50b3eaccaccdad23d7.png" alt="C_{scaled, i} = \frac{C_i}{N_{i}}"/></p>
</div><p>where <img class="math" src="../_images/math/03e70b0e5504c4a107620538b2a0884801bb5e69.png" alt="C_{scaled, i}" style="vertical-align: -6px"/> is the scaled counts, <img class="math" src="../_images/math/9454726fb4304aba31c8af0f71903451758cab8d.png" alt="C_i" style="vertical-align: -3px"/> the raw counts, and <img class="math" src="../_images/math/6ee0a766b0c0ba029be6ee4d54385c94e6b64ba8.png" alt="N_{i}" style="vertical-align: -3px"/> is the number of tube pixels contributing to the point being scaled. Note that pixels counting zero do enter the normalisation, however the masked pixels do not.</p>
<div class="section" id="dtubes-option">
<h4><a class="toc-backref" href="#id7">2DTubes Option</a><a class="headerlink" href="#dtubes-option" title="Permalink to this headline">¶</a></h4>
<p>In this case the x-axis, the scattering angle, is the scattering angle of the tube centre. The height is the pixel height in the tube.</p>
</div>
<div class="section" id="d-option">
<h4><a class="toc-backref" href="#id8">2D Option</a><a class="headerlink" href="#d-option" title="Permalink to this headline">¶</a></h4>
<p>In this case the x-axis is the true scattering angle of a pixel, so the Debye-Scherrer cones are effectively straightened. The x-axis is strictly positive in this case, the negative angles from the 2D case are put in the same bins as the equivalent positive angles. The height is the pixel height in the tube as for the 2D Option.</p>
</div>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id9">1D Option</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>This is the same as the 2D option, with a single bin in the y-axis.</p>
</div>
<div class="section" id="instrument-parameters">
<h4><a class="toc-backref" href="#id10">Instrument Parameters</a><a class="headerlink" href="#instrument-parameters" title="Permalink to this headline">¶</a></h4>
<p>If the instrument parameter <tt class="docutils literal"><span class="pre">mirror_detector_angles</span></tt> is set to true, then output scattering angles are effectively multiplied by <img class="math" src="../_images/math/3745a269b5b6487950eb7dd6ece15d785cb91620.png" alt="-1" style="vertical-align: -1px"/>. This is used for D2B where the instrument is mirrored compared with other Powder Diffraction instruments at the ILL.</p>
</div>
<div class="section" id="splitcounts">
<h4><a class="toc-backref" href="#id11">SplitCounts</a><a class="headerlink" href="#splitcounts" title="Permalink to this headline">¶</a></h4>
<p>The counts are split between bins, if the difference between two angles is larger than the scattering angle step multiplied by the <tt class="docutils literal"><span class="pre">ScatteringAngleTolerance</span></tt>.
By default there is no splitting.</p>
</div>
<div class="section" id="cropnegativescatteringangles">
<h4><a class="toc-backref" href="#id12">CropNegativeScatteringAngles</a><a class="headerlink" href="#cropnegativescatteringangles" title="Permalink to this headline">¶</a></h4>
<p>When cropping is requested the bins that are fully on the negative side, will be dropped. However if there is a bin with one edge negative, the other positive, this bin will be preserved.</p>
</div>
<div class="section" id="scatteringanglebinning">
<h4><a class="toc-backref" href="#id13">ScatteringAngleBinning</a><a class="headerlink" href="#scatteringanglebinning" title="Permalink to this headline">¶</a></h4>
<p>This can be a comma separated list of start, step, end. Alternatively, if single number is given, it will be taken as the step.
The start and end will be computed from the input workspaces, such that the first bin center is the minimum, and the last bin center is the maximum scattering angle in the equatorial plane in the list of input workspaces.</p>
</div>
<div class="section" id="outputworkspace">
<h4><a class="toc-backref" href="#id14">OutputWorkspace</a><a class="headerlink" href="#outputworkspace" title="Permalink to this headline">¶</a></h4>
<p>Output is a histogram workspace containing the summed/averaged counts.</p>
</div>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id15">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - an example of running SumOverlappingTubes in the 2DTubes case.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ws_508093</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;ILL/D2B/508093.nxs&#39;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">SumOverlappingTubes</span><span class="p">(</span><span class="n">InputWorkspaces</span><span class="o">=</span><span class="n">ws_508093</span><span class="p">,</span> <span class="n">OutputType</span><span class="o">=</span><span class="s">&#39;2DTubes&#39;</span><span class="p">,</span> <span class="n">MirrorScatteringAngles</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;X Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">blocksize</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39;, Y Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>X Size: 3200, Y Size: 128
</pre></div>
</div>
<p><strong>Example - an example of running SumOverlappingTubes in the 1D case.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ws_508093</span> <span class="o">=</span> <span class="n">Load</span><span class="p">(</span><span class="s">&#39;ILL/D2B/508093.nxs&#39;</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">SumOverlappingTubes</span><span class="p">(</span><span class="n">InputWorkspaces</span><span class="o">=</span><span class="n">ws_508093</span><span class="p">,</span> <span class="n">OutputType</span><span class="o">=</span><span class="s">&#39;1D&#39;</span><span class="p">,</span> <span class="n">CropNegativeScatteringAngles</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">HeightAxis</span><span class="o">=</span><span class="s">&#39;-0.05,0.05&#39;</span><span class="p">,</span> <span class="n">MirrorScatteringAngles</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;X Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">blocksize</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39;, Y Size: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>X Size: 2975, Y Size: 1
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/ILL/Diffraction.html">ILL\Diffraction</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id16">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/Algorithms/src/SumOverlappingTubes.cpp">SumOverlappingTubes.cpp</a> <em>(last modified: 2019-07-04)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/Algorithms/inc/MantidAlgorithms/SumOverlappingTubes.h">SumOverlappingTubes.h</a> <em>(last modified: 2018-10-05)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SumNeighbours-v1.html" title="Previous Chapter: SumNeighbours v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SumNeighbours v1</span>
    </a>
  </li>
  <li>
    <a href="SumRowColumn-v1.html" title="Next Chapter: SumRowColumn v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SumRowColumn v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>