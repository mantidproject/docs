<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LoadWANDSCD v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="Logarithm v1" href="Logarithm-v1.html" />
    <link rel="prev" title="LoadWAND v1" href="LoadWAND-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="loadwandscd-v1">
<span id="algm-loadwandscd"></span><span id="algm-loadwandscd-v1"></span><h1>LoadWANDSCD v1<a class="headerlink" href="#loadwandscd-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/LoadWANDSCD-v1_dlg.png"><img alt="../_images/LoadWANDSCD-v1_dlg.png" class="screenshot" src="../_images/LoadWANDSCD-v1_dlg.png" style="width: 361px;" /></a>
<p class="caption"><strong>LoadWANDSCD</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Load WAND single crystal data into a detector space vs rotation MDHisto</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="ConvertWANDSCDtoQ-v1.html#algm-convertwandscdtoq"><em>ConvertWANDSCDtoQ</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="6%" />
<col width="25%" />
<col width="10%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Filename</td>
<td>Input</td>
<td>list of str lists</td>
<td>&nbsp;</td>
<td>Files to load. Allowed extensions: [&#8216;.nxs.h5&#8217;]</td>
</tr>
<tr class="row-odd"><td>IPTS</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>IPTS number to load from</td>
</tr>
<tr class="row-even"><td>RunNumbers</td>
<td>Input</td>
<td>int list</td>
<td>&nbsp;</td>
<td>Run numbers to load</td>
</tr>
<tr class="row-odd"><td>Grouping</td>
<td>Input</td>
<td>string</td>
<td>None</td>
<td>Group pixels. Allowed values: [&#8216;None&#8217;, &#8216;2x2&#8217;, &#8216;4x4&#8217;]</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Output Workspace</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm will load a series of run into a MDHistoWorkspace that
has dimensions x and y detector pixels vs scanIndex. The scanIndex is
the omega rotation of the sample. The instrument from the first run
only will be copied to the OutputWorkspace. In addition the s1 (omega
rotation), duration, run_number and monitor count is read from every
file and included in the logs of the OutputWorkspace.</p>
<p>If the &#8220;HB2C:CS:CrystalAlign:UBMatrix&#8221; property exist it will be
converted into the OrientedLattice on the OutputWorkspace. The
goniometer tilts (sgu and sgl) are combined into the UB Matrix so that
only omega (s1) needs to be taken into account during rotation.</p>
<p>This algorithm doesn&#8217;t use Mantid loaders but instead h5py and numpy
to load and integrate the events.</p>
<p>There is a grouping option to group pixels by either 2x2 or 4x4 which
will help in reducing memory usage and speed up the later reduction
steps. In most cases you will not see a difference in reduced data
with 4x4 pixel grouping.</p>
<p>The loaded workspace is designed to be the input to
<a class="reference internal" href="ConvertWANDSCDtoQ-v1.html#algm-convertwandscdtoq"><em>ConvertWANDSCDtoQ v1</em></a>.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Load one file, Vanadium for normalisation</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">norm</span> <span class="o">=</span> <span class="n">LoadWANDSCD</span><span class="p">(</span><span class="n">IPTS</span><span class="o">=</span><span class="mi">7776</span><span class="p">,</span> <span class="n">RunNumbers</span><span class="o">=</span><span class="mi">26509</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">norm</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>MDHistoWorkspace
Title:
Dim 0: (y) 0.5 to 512.5 in 512 bins
Dim 1: (x) 0.5 to 3840.5 in 3840 bins
Dim 2: (scanIndex) 0.5 to 1.5 in 1 bins

Inelastic: ki-kf
Instrument: ...

Run start: 2018-Mar-12 17:10:59
Run end:  not available
Sample: a 1.0, b 1.0, c 1.0; alpha 90, beta 90, gamma 90
</pre></div>
</div>
<p><strong>Load multiple data file</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">LoadWANDSCD</span><span class="p">(</span><span class="n">IPTS</span><span class="o">=</span><span class="mi">7776</span><span class="p">,</span> <span class="n">RunNumbers</span><span class="o">=</span><span class="s">&#39;26640-27944&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Memory used: {}GiB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getMemorySize</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;s1 = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getExperimentInfo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&#39;s1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;monitor_counts = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getExperimentInfo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&#39;monitor_counts&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;duration = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getExperimentInfo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&#39;duration&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;run_number = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">getExperimentInfo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&#39;run_number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Memory used: 59GB

MDHistoWorkspace
Title:
Dim 0: (y) 0.5 to 512.5 in 512 bins
Dim 1: (x) 0.5 to 3840.5 in 3840 bins
Dim 2: (scanIndex) 0.5 to 1305.5 in 1305 bins
Inelastic: ki-kf
Instrument: ...
Run start: 2018-May-02 13:34:10
Run end:  not available
Sample: a 5.7, b 5.7, c 5.6; alpha 93, beta 90, gamma 98

s2 = [-180,-179.9,-179.8,-179.7,-179.6,-179.5,-179.4,-179.3,-179.2,-179.1]
monitor_count = [44571,44598,44567,44869,44453,44238,44611,44120,44762,44658]
duration = [2.05,2.05,2.03333,2.05,2.03333,2.03333,2.05,2.01667,2.05,2.05]
run_number = [26640,26641,26642,26643,26644,26645,26646,26647,26648,26649]
</pre></div>
</div>
<p><strong>Load with different grouping comparing memory usage</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">LoadWANDSCD</span><span class="p">(</span><span class="n">IPTS</span><span class="o">=</span><span class="mi">7776</span><span class="p">,</span> <span class="n">RunNumbers</span><span class="o">=</span><span class="s">&#39;26640-27944&#39;</span><span class="p">)</span>
<span class="n">data_2x2</span> <span class="o">=</span> <span class="n">LoadWANDSCD</span><span class="p">(</span><span class="n">IPTS</span><span class="o">=</span><span class="mi">7776</span><span class="p">,</span> <span class="n">RunNumbers</span><span class="o">=</span><span class="s">&#39;26640-27944&#39;</span><span class="p">,</span> <span class="n">Grouping</span><span class="o">=</span><span class="s">&#39;2x2&#39;</span><span class="p">)</span>
<span class="n">data_4x4</span> <span class="o">=</span> <span class="n">LoadWANDSCD</span><span class="p">(</span><span class="n">IPTS</span><span class="o">=</span><span class="mi">7776</span><span class="p">,</span> <span class="n">RunNumbers</span><span class="o">=</span><span class="s">&#39;26640-27944&#39;</span><span class="p">,</span> <span class="n">Grouping</span><span class="o">=</span><span class="s">&#39;4x4&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Memory used by {}: {}GiB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">getMemorySize</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Memory used by {}: {}GiB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_2x2</span><span class="p">,</span><span class="n">data_2x2</span><span class="o">.</span><span class="n">getMemorySize</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Memory used by {}: {}GiB&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_4x4</span><span class="p">,</span><span class="n">data_4x4</span><span class="o">.</span><span class="n">getMemorySize</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mi">30</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">data_4x4</span><span class="p">))</span>

<span class="c"># Integrate y and plot</span>
<span class="n">data_integrated</span> <span class="o">=</span> <span class="n">IntegrateMDHistoWorkspace</span><span class="p">(</span><span class="s">&#39;data_4x4&#39;</span><span class="p">,</span> <span class="n">P1Bin</span><span class="o">=</span><span class="s">&#39;0,129&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mantid</span> <span class="kn">import</span> <span class="n">plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;projection&#39;</span><span class="p">:</span><span class="s">&#39;mantid&#39;</span><span class="p">})</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">data_integrated</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Intensity (arb. units)&#39;</span><span class="p">)</span>
<span class="c">#fig.savefig(&#39;LoadWANDSCD.png&#39;)</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Memory used by data: 59GiB
Memory used by data_2x2: 14GiB
Memory used by data_4x4: 3GiB

MDHistoWorkspace
Title:
Dim 0: (y) 0.5 to 128.5 in 128 bins
Dim 1: (x) 0.5 to 960.5 in 960 bins
Dim 2: (scanIndex) 0.5 to 1305.5 in 1305 bins
Inelastic: ki-kf
Instrument: ...
Run start: 2018-May-02 13:34:10
Run end:  not available
Sample: a 5.7, b 5.7, c 5.6; alpha 93, beta 90, gamma 98
</pre></div>
</div>
<div class="figure">
<img alt="../_images/LoadWANDSCD.png" src="../_images/LoadWANDSCD.png" />
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/DataHandling/Nexus.html">DataHandling\Nexus</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/PythonInterface/plugins/algorithms/LoadWANDSCD.py">LoadWANDSCD.py</a> <em>(last modified: 2018-10-05)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="LoadWAND-v1.html" title="Previous Chapter: LoadWAND v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; LoadWAND v1</span>
    </a>
  </li>
  <li>
    <a href="Logarithm-v1.html" title="Next Chapter: Logarithm v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Logarithm v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>