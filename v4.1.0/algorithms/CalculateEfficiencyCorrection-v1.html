<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CalculateEfficiencyCorrection v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="CalculateFlatBackground v1" href="CalculateFlatBackground-v1.html" />
    <link rel="prev" title="CalculateEfficiency v2" href="CalculateEfficiency-v2.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="calculateefficiencycorrection-v1">
<span id="algm-calculateefficiencycorrection"></span><span id="algm-calculateefficiencycorrection-v1"></span><h1>CalculateEfficiencyCorrection v1<a class="headerlink" href="#calculateefficiencycorrection-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/CalculateEfficiencyCorrection-v1_dlg.png"><img alt="../_images/CalculateEfficiencyCorrection-v1_dlg.png" class="screenshot" src="../_images/CalculateEfficiencyCorrection-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><strong>CalculateEfficiencyCorrection</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id12">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id13">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id14">Properties</a></li>
<li><a class="reference internal" href="#description" id="id15">Description</a></li>
<li><a class="reference internal" href="#usage" id="id16">Usage</a></li>
<li><a class="reference internal" href="#references" id="id17">References</a></li>
<li><a class="reference internal" href="#source" id="id18">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id12">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculate an efficiency correction using various inputs. Can be used to determine                 an incident spectrum after correcting a measured spectrum from beam monitors                 or vanadium measurements.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id13">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="He3TubeEfficiency-v1.html#algm-he3tubeefficiency"><em>He3TubeEfficiency</em></a>, <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission"><em>CalculateSampleTransmission</em></a>, <a class="reference internal" href="DetectorEfficiencyCor-v1.html#algm-detectorefficiencycor"><em>DetectorEfficiencyCor</em></a>, <a class="reference internal" href="DetectorEfficiencyCorUser-v1.html#algm-detectorefficiencycoruser"><em>DetectorEfficiencyCorUser</em></a>, <a class="reference internal" href="CalculateEfficiency-v2.html#algm-calculateefficiency"><em>CalculateEfficiency</em></a>, <a class="reference internal" href="ComputeCalibrationCoefVan-v1.html#algm-computecalibrationcoefvan"><em>ComputeCalibrationCoefVan</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id14">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="2%" />
<col width="11%" />
<col width="5%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Input workspace with wavelength range to calculate for the correction.</td>
</tr>
<tr class="row-odd"><td>WavelengthRange</td>
<td>Input</td>
<td>string</td>
<td>&nbsp;</td>
<td>Wavelength range to calculate efficiency for.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Output workspace for the efficiency correction.                  This can be applied by multiplying the OutputWorkspace                  to the workspace that requires the correction.</td>
</tr>
<tr class="row-odd"><td>ChemicalFormula</td>
<td>Input</td>
<td>string</td>
<td>None</td>
<td>Sample chemical formula used to determine cross-section term.</td>
</tr>
<tr class="row-even"><td>DensityType</td>
<td>Input</td>
<td>string</td>
<td>Mass Density</td>
<td>Use of Mass density (g/cm^3) or Number density (atoms/Angstrom^3). Allowed values: [&#8216;Mass Density&#8217;, &#8216;Number Density&#8217;]</td>
</tr>
<tr class="row-odd"><td>Density</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Mass density (g/cm^3) or Number density (atoms/Angstrom^3).</td>
</tr>
<tr class="row-even"><td>Thickness</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>Sample thickness (cm).</td>
</tr>
<tr class="row-odd"><td>MeasuredEfficiency</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Directly input the efficiency measured at MeasuredEfficiencyWavelength.                  This is used to determine a Density*Thickness term.</td>
</tr>
<tr class="row-even"><td>MeasuredEfficiencyWavelength</td>
<td>Input</td>
<td>number</td>
<td>1.7982</td>
<td>The wavelength at which the MeasuredEfficiency was measured.</td>
</tr>
<tr class="row-odd"><td>Alpha</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Directly input the alpha term in exponential to multiply by the wavelength.                  XSectionType has no effect if this is used.</td>
</tr>
<tr class="row-even"><td>XSectionType</td>
<td>Input</td>
<td>string</td>
<td>AttenuationXSection</td>
<td>Use either the absorption  or total cross section in exponential term.                    The absorption cross section is for monitor-type corrections and                    the total cross section is for transmission-type corrections. Allowed values: [&#8216;AttenuationXSection&#8217;, &#8216;TotalXSection&#8217;]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id15">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm calculates the detection efficiency correction, <img class="math" src="../_images/math/1c67e848e51a0f11ff730889cbd43af9034630a0.png" alt="\epsilon" style="vertical-align: 0px"/>, defined by:</p>
<div class="math" id="equation-efficiency">
<p><span class="eqno">(1)</span><img src="../_images/math/444ad37b450e0e11f23e289ee98c3a10858b597d.png" alt="\epsilon &amp;= 1-e^{-\rho T \sigma (\lambda)} \\
         &amp;= 1-e^{-\rho_{A} \sigma (\lambda)} \\
         &amp;= 1-e^{-\alpha \lambda}"/></p>
</div><p>and output correction is given as:</p>
<div class="math" id="equation-efficiency_correction">
<p><span class="eqno">(2)</span><img src="../_images/math/ec0942560af38372c73d05afaf0c95a8e9a6c5f5.png" alt="\frac{1}{\epsilon} = \frac{1}{1-e^{-\alpha \lambda}}"/></p>
</div><p>where</p>
<ul>
<li><p class="first"><img class="math" src="../_images/math/817f1f11a271a306890d322b311ff30209cc5209.png" alt="\rho" style="vertical-align: -4px"/> is the number density in atoms/<img class="math" src="../_images/math/da8e2e2ec0cb5b61cdfed57c03a9802458da98ef.png" alt="\AA^3" style="vertical-align: 0px"/></p>
</li>
<li><p class="first"><img class="math" src="../_images/math/5830b1441ec19bff0c7f338ee28ccd12654c1f69.png" alt="T" style="vertical-align: 0px"/> is a sample thickness given in cm</p>
</li>
<li><p class="first"><img class="math" src="../_images/math/804ccc8fa6f2f90a9682209dc798974f176b098e.png" alt="\lambda_{ref}" style="vertical-align: -6px"/> = 1.7982 <img class="math" src="../_images/math/bf8cf685e595fbdbe1f136abfcbac026bcc7b1f2.png" alt="\AA" style="vertical-align: 0px"/>,</p>
</li>
<li><p class="first"><img class="math" src="../_images/math/41c4394535966eae4b3396b41103a0e414795ddd.png" alt="\sigma (\lambda)" style="vertical-align: -4px"/> is the wavelength-dependent cross-section which is either:</p>
<blockquote>
<div><ul class="simple">
<li><img class="math" src="../_images/math/0d48d12e57551bed96736ab46f8e645736418e48.png" alt="\sigma (\lambda) = \sigma_a (\lambda_{ref}) \left( \frac{\lambda}{\lambda_{ref}} \right)" style="vertical-align: -13px"/> for <tt class="docutils literal"><span class="pre">XSectionType</span></tt> == <tt class="docutils literal"><span class="pre">AttenuationXSection</span></tt> where <img class="math" src="../_images/math/e38bd544bfe25c0ec9aa684d91227f06ba3bc2ee.png" alt="\sigma_a" style="vertical-align: -3px"/> is the absorption cross-section in units of barns</li>
<li>or <img class="math" src="../_images/math/43d0cdcc0f6024e1f13bbf89e35c1b3d21e1dace.png" alt="\sigma (\lambda) = \sigma_s + \sigma_a (\lambda_{ref}) \left( \frac{\lambda}{\lambda_{ref}} \right)" style="vertical-align: -13px"/> for <tt class="docutils literal"><span class="pre">XSectionType</span></tt> == <tt class="docutils literal"><span class="pre">TotalXSection</span></tt> where <img class="math" src="../_images/math/49c6e36228b830e4d11d1caa2a8c8751a95dd018.png" alt="\sigma_s" style="vertical-align: -3px"/> is the total scattering cross-section in units of barns</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><img class="math" src="../_images/math/0dd95cac0e72837d7f73dd8929803b530f2ecf87.png" alt="\rho_{A}" style="vertical-align: -4px"/> is the area density (<img class="math" src="../_images/math/02f9b1699a3a1ea33c185e5d8dc7fb668cb9243a.png" alt="\rho_{A}=\rho * T" style="vertical-align: -4px"/>) in units of atoms*cm/<img class="math" src="../_images/math/da8e2e2ec0cb5b61cdfed57c03a9802458da98ef.png" alt="\AA^3" style="vertical-align: 0px"/>,</p>
</li>
<li><p class="first"><img class="math" src="../_images/math/0b26bc6c09bb3adf518c77f73f1530c9e2bbdfee.png" alt="\alpha = \rho_{A} * \frac{\sigma (\lambda_{ref})}{\lambda_{ref}} = \rho * T * \frac{\sigma (\lambda_{ref})}{\lambda_{ref}}" style="vertical-align: -10px"/> in units of 1/<img class="math" src="../_images/math/bf8cf685e595fbdbe1f136abfcbac026bcc7b1f2.png" alt="\AA" style="vertical-align: 0px"/>.</p>
</li>
<li><p class="first"><img class="math" src="../_images/math/412c0294db757d8807fe8fc2975ab586bb9042d8.png" alt="\lambda" style="vertical-align: 0px"/> is in units of <img class="math" src="../_images/math/bf8cf685e595fbdbe1f136abfcbac026bcc7b1f2.png" alt="\AA" style="vertical-align: 0px"/>.</p>
</li>
</ul>
<p>NOTE: <img class="math" src="../_images/math/d446719703e2b0be12b587de90f79eb4685db438.png" alt="1 \AA^2 = 10^{8}" style="vertical-align: -1px"/> barns and <img class="math" src="../_images/math/b2b3c4db2c9ce06cc1f1cc5a95153a236e89581c.png" alt="1 \AA = 10^{-8}" style="vertical-align: -1px"/> cm.</p>
<dl class="docutils">
<dt>The optional inputs into the algorithm are to input either:</dt>
<dd><ol class="first last arabic simple">
<li>The <tt class="docutils literal"><span class="pre">Alpha</span></tt> parameter</li>
<li>The <tt class="docutils literal"><span class="pre">Density</span></tt> and <tt class="docutils literal"><span class="pre">ChemicalFormula</span></tt> to calculate the <img class="math" src="../_images/math/d575805dcc6d07888ddeb642ea70c6e488e5c582.png" alt="\sigma(\lambda_{ref})" style="vertical-align: -6px"/> term.</li>
<li>The <tt class="docutils literal"><span class="pre">MeasuredEfficiency</span></tt>, an optional <tt class="docutils literal"><span class="pre">MeasuredEfficiencyWavelength</span></tt>, and <tt class="docutils literal"><span class="pre">ChemicalFormula</span></tt> to calculate the <img class="math" src="../_images/math/d575805dcc6d07888ddeb642ea70c6e488e5c582.png" alt="\sigma(\lambda_{ref})" style="vertical-align: -6px"/> term.</li>
</ol>
</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">MeasuredEfficiency</span></tt> is the <img class="math" src="../_images/math/1c67e848e51a0f11ff730889cbd43af9034630a0.png" alt="\epsilon" style="vertical-align: 0px"/> term measured at a specific wavelength, <img class="math" src="../_images/math/c554c57668748e52ff38e978bd6b7bb584aa8687.png" alt="\lambda_{\epsilon}" style="vertical-align: -3px"/>, which is specified by <tt class="docutils literal"><span class="pre">MeasuredEfficiencyWavelength</span></tt>. This helps
if the efficiency has been directly measured experimentally at a given wavelength. This will calculate the
<img class="math" src="../_images/math/64d9d3497aec69e99775f8734fb24789bc1a2efd.png" alt="\rho * T" style="vertical-align: -4px"/> term, where it will be either:</p>
<ul class="simple">
<li><img class="math" src="../_images/math/2402a718f17d82b715857992f784543d69c88d13.png" alt="\rho * T = - ln(1-\epsilon) \frac{1}{ \frac{\lambda_{\epsilon} \sigma (\lambda_{ref})}{\lambda_{ref}}}" style="vertical-align: -22px"/> for <tt class="docutils literal"><span class="pre">XSectionType</span></tt> == <tt class="docutils literal"><span class="pre">AttenuationXSection</span></tt></li>
<li><img class="math" src="../_images/math/124b56137f51ab7dd02c5efd86dc9b631e2228c9.png" alt="\rho * T = - ln(1-\epsilon) \frac{1}{ \sigma_s + \frac{\lambda_{\epsilon} \sigma (\lambda_{ref})}{\lambda_{ref}}}" style="vertical-align: -22px"/> for <tt class="docutils literal"><span class="pre">XSectionType</span></tt> == <tt class="docutils literal"><span class="pre">TotalXSection</span></tt></li>
</ul>
<p>For the <tt class="docutils literal"><span class="pre">XSectionType</span></tt>, if the efficiency correction is applied to a beam monitor to determine the incident spectrum, then the <tt class="docutils literal"><span class="pre">AttenuationXSection</span></tt> option should be used. This is due to the fact that scatter events do not lead to neutrons that will be in the incident beam. If the efficiency correction is to be used similar to a transmission measurement for an actual sample measurement, such as in <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission-v1"><em>CalculateSampleTransmission v1</em></a>, then the <tt class="docutils literal"><span class="pre">TotalXSection</span></tt> should be used to include both types of events.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id16">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with Alpha.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Input workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Correction workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace using WavelengthRange: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none"><div class="highlight"><pre>Input workspace: [ 38.  38.  38.  38.  38.]
Correction workspace: [ 10.26463773   9.81128219   9.39826191   9.02042771   8.67347109]
Output workspace: [ 390.05623383  372.82872321  357.13395265  342.77625306  329.59190131]
Output workspace using WavelengthRange: [ 390.05623383  372.82872321  357.13395265  342.77625306  329.59190131]
</pre></div>
</div>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with Density and ChemicalFormula.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span>
                                          <span class="n">Density</span><span class="o">=</span><span class="mf">6.11</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;V&quot;</span><span class="p">)</span>
<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span>
                                                          <span class="n">Density</span><span class="o">=</span><span class="mf">6.11</span><span class="p">,</span>
                                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;V&quot;</span><span class="p">)</span>

<span class="c"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Input workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Correction workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace using WavelengthRange: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none"><div class="highlight"><pre>Input workspace: [ 38.  38.  38.  38.  38.]
Correction workspace: [ 24.40910309  23.29738394  22.28449939  21.35783225  20.50682528]
Output workspace: [ 927.54591732  885.30058981  846.81097679  811.59762534  779.25936055]
Output workspace using WavelengthRange: [ 927.54591732  885.30058981  846.81097679  811.59762534  779.25936055]
</pre></div>
</div>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with MeasuredEfficiency and ChemicalFormula.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span>
                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;(He3)&quot;</span><span class="p">)</span>

<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span>
                                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;(He3)&quot;</span><span class="p">)</span>


<span class="c"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Input workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Correction workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace using WavelengthRange: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none"><div class="highlight"><pre>Input workspace: [ 38.  38.  38.  38.  38.]
Correction workspace: [ 873.27762699  832.68332786  795.69741128  761.85923269  730.78335476]
Output workspace: [ 33184.54982567  31641.9664586   30236.50162877  28950.65084207
  27769.76748099]
Output workspace using WavelengthRange: [ 33184.54982567  31641.9664586   30236.50162877  28950.65084207
  27769.76748099]
</pre></div>
</div>
<p><strong>Example - Basics of running CalculateEfficiencyCorrection with MeasuredEfficiency and ChemicalFormula using the total cross section.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create an exponentially decaying function in wavelength to simulate measured sample</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&quot;Event&quot;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&quot;User Defined&quot;</span><span class="p">,</span>
                                   <span class="n">UserDefinedFunction</span><span class="o">=</span><span class="s">&quot;name=ExpDecay, Height=100, Lifetime=4&quot;</span><span class="p">,</span>
                                   <span class="n">Xmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">Xmax</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">BinWidth</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">XUnit</span><span class="o">=</span><span class="s">&quot;Wavelength&quot;</span><span class="p">,</span>
                                   <span class="n">NumEvents</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">NumBanks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">BankPixelWidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Calculate the efficiency correction</span>
<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span>
                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;(He3)&quot;</span><span class="p">,</span>
                                          <span class="n">XSectionType</span><span class="o">=</span><span class="s">&quot;TotalXSection&quot;</span><span class="p">)</span>

<span class="n">corr_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s">&quot;0.2,0.01,4.0&quot;</span><span class="p">,</span>
                                                          <span class="n">MeasuredEfficiency</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span>
                                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;(He3)&quot;</span><span class="p">,</span>
                                                          <span class="n">XSectionType</span><span class="o">=</span><span class="s">&quot;TotalXSection&quot;</span><span class="p">)</span>


<span class="c"># Apply the efficiency correction to the measured spectrum</span>
<span class="n">input_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">)</span>
<span class="n">output_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span>
<span class="n">output_wksp_with_wave_range</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">input_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp_with_wave_range</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Input workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">input_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Correction workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Output workspace using WavelengthRange: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_wksp_with_wave_range</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Ouptut:</p>
<div class="highlight-none"><div class="highlight"><pre>Input workspace: [ 38.  38.  38.  38.  38.]
Correction workspace: [ 865.7208838   825.85320701  789.49774383  756.20995361  725.61727932]
Output workspace: [ 32897.39358441  31382.42186624  30000.91426562  28735.97823706
  27573.45661411]
Output workspace using WavelengthRange: [ 32897.39358441  31382.42186624  30000.91426562  28735.97823706
  27573.45661411]
</pre></div>
</div>
<p>The transmission of a sample can be measured as <img class="math" src="../_images/math/28e2028273eac7eae8ca68745d14812af65576ae.png" alt="e^{-\rho T \sigma_t (\lambda)}" style="vertical-align: 0px"/> where <img class="math" src="../_images/math/aa272f0a584bab69e07fa92685cb8b838d25bc09.png" alt="\sigma_t (\lambda) = \sigma_s + \sigma_a (\lambda)" style="vertical-align: -4px"/> is the total cross-section. This can be calculatd directly by the <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission-v1"><em>CalculateSampleTransmission v1</em></a> algorithm. Yet, we can also back out the transmission with the <tt class="docutils literal"><span class="pre">CalculateEfficiencyCorrection</span></tt> algorithm. The example below shows how:</p>
<p><strong>Example - Transmission using the CalculateEfficiencyCorrection and CalculateSampleTransmission comparison.</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ws</span> <span class="o">=</span> <span class="n">CalculateSampleTransmission</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s">&#39;2.0, 0.1, 10.0&#39;</span><span class="p">,</span>
                                 <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&#39;H2-O&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Transmission: {} ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]))</span>

<span class="n">corr_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">WavelengthRange</span><span class="o">=</span><span class="s">&quot;2.0, 0.1, 10.0&quot;</span><span class="p">,</span>
                                          <span class="n">Density</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                          <span class="n">Thickness</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                                          <span class="n">ChemicalFormula</span><span class="o">=</span><span class="s">&quot;H2-O&quot;</span><span class="p">,</span>
                                          <span class="n">XSectionType</span><span class="o">=</span><span class="s">&quot;TotalXSection&quot;</span><span class="p">)</span>
<span class="n">dataX</span> <span class="o">=</span> <span class="n">corr_wksp</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dataY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">corr_wksp</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">ones</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span><span class="p">,</span> <span class="n">UnitX</span><span class="o">=</span><span class="s">&quot;Wavelength&quot;</span><span class="p">)</span>
<span class="n">efficiency</span> <span class="o">=</span> <span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">ones</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">corr_wksp</span><span class="p">)</span> <span class="c"># 1 + -1 * transmission</span>
<span class="n">negative_trans</span> <span class="o">=</span> <span class="n">Minus</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">efficiency</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">ones</span><span class="p">)</span> <span class="c"># -1 * transmission</span>
<span class="n">transmission</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWOrkspace</span><span class="o">=</span><span class="n">negative_trans</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=-</span><span class="mf">1.</span><span class="o">*</span><span class="n">ones</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Transmission using efficiency correction: {} ...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">transmission</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Transmission: [ 0.94506317  0.94505148  0.94503979] ...
Transmission using efficiency correction: [ 0.9450632   0.94505151  0.94503982] ...
</pre></div>
</div>
<p>The discrepancies are due to the differenc in <img class="math" src="../_images/math/804ccc8fa6f2f90a9682209dc798974f176b098e.png" alt="\lambda_{ref}" style="vertical-align: -6px"/> = 1.7982 <img class="math" src="../_images/math/bf8cf685e595fbdbe1f136abfcbac026bcc7b1f2.png" alt="\AA" style="vertical-align: 0px"/> in <tt class="docutils literal"><span class="pre">CalculateEfficiencyCorrection</span></tt>, consistent with <a class="reference external" href="https://github.com/mantidproject/mantid/blob/32ed0b2cbbe4fbfb230570d5a53032f6101743de/Framework/Kernel/src/NeutronAtom.cpp#L23">ReferenceLambda</a> where <a class="reference internal" href="CalculateSampleTransmission-v1.html#algm-calculatesampletransmission-v1"><em>CalculateSampleTransmission v1</em></a>  uses <img class="math" src="../_images/math/804ccc8fa6f2f90a9682209dc798974f176b098e.png" alt="\lambda_{ref}" style="vertical-align: -6px"/> = 1.798 <img class="math" src="../_images/math/bf8cf685e595fbdbe1f136abfcbac026bcc7b1f2.png" alt="\AA" style="vertical-align: 0px"/>.</p>
<p><strong>Example - Running CalculateEfficiencyCorrection for incident spectrum.</strong></p>
<p>To model the incident spectrum of polyethylene moderators, the following function is used to
join the exponential decay of the epithermal flux  to the Maxwellian distribution of the thermal flux <a class="footnote-reference" href="#id8" id="id1">[1]</a>:</p>
<div class="math" id="equation-incident_spectrum">
<p><span class="eqno">(3)</span><img src="../_images/math/f93e7f8c927a191a16c285a62cdc47cf268024b2.png" alt="\phi(\lambda) = \phi_{max} \frac{\lambda_T^4}{\lambda^5} \mathrm{e}^{-(\lambda_T / \lambda)^2} + \phi_{epi} \frac{\Delta(\lambda_T / \lambda)}{\lambda^{1+2\alpha}}"/></p>
</div><p>To determine this incident spectrum experimentally, one must make a measurement either via using a sample measurement such as vanadium <a class="footnote-reference" href="#id8" id="id2">[1]</a> or using beam monitors. <a class="footnote-reference" href="#id9" id="id3">[2]</a> <a class="footnote-reference" href="#id10" id="id4">[3]</a> In either case, an efficiency correction must be applied to the measured spectrum to obtain the actual incident spectrum. This incident spectrum is a crucial part of calculating Placzek recoil sample corrections. <a class="footnote-reference" href="#id11" id="id5">[4]</a></p>
<p>From Eq. <a href="#equation-incident_spectrum">(3)</a>, the parameters vary based on the moderator material. For a polyethlyene moderator at a temperature of 300K, the following parameters have been used to accurately model the incident spectrum. <a class="footnote-reference" href="#id8" id="id6">[1]</a> The parameter labels, variables used in the following code example, and values for the parameters are given in the table below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="21%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Variables</th>
<th class="head">Polyethlyene 300K (ambient)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><img class="math" src="../_images/math/3632963d029a6907250e2b6d964bc59eebb90156.png" alt="\phi_{max}" style="vertical-align: -4px"/></td>
<td><tt class="docutils literal"><span class="pre">phiMax</span></tt></td>
<td>6324</td>
</tr>
<tr class="row-odd"><td><img class="math" src="../_images/math/9284ec85dd3cf40b7b456c328385cc5e18915c34.png" alt="\phi_{epi}" style="vertical-align: -6px"/></td>
<td><tt class="docutils literal"><span class="pre">phiEpi</span></tt></td>
<td>786</td>
</tr>
<tr class="row-even"><td><img class="math" src="../_images/math/23bf3bdd8ce99fdb75f17e8b49934c62e9cf0841.png" alt="\alpha" style="vertical-align: 0px"/></td>
<td><tt class="docutils literal"><span class="pre">alpha</span></tt></td>
<td>0.099</td>
</tr>
<tr class="row-odd"><td><img class="math" src="../_images/math/0c7a67f42e1cb5205592401ecd6ed3757c91fb0c.png" alt="\lambda_1" style="vertical-align: -4px"/></td>
<td><tt class="docutils literal"><span class="pre">lambda1</span></tt></td>
<td>0.67143</td>
</tr>
<tr class="row-even"><td><img class="math" src="../_images/math/dfc8036c551ec4ca1f19f3d6d63502a1001fbb4a.png" alt="\lambda_2" style="vertical-align: -3px"/></td>
<td><tt class="docutils literal"><span class="pre">lambda2</span></tt></td>
<td>0.06075</td>
</tr>
<tr class="row-odd"><td><img class="math" src="../_images/math/66816273dbd1ebafc981ac2f8d650995f56a59e4.png" alt="\lambda_T" style="vertical-align: -3px"/></td>
<td><tt class="docutils literal"><span class="pre">lambdaT</span></tt></td>
<td>1.58 <img class="math" src="../_images/math/bf8cf685e595fbdbe1f136abfcbac026bcc7b1f2.png" alt="\AA" style="vertical-align: 0px"/></td>
</tr>
</tbody>
</table>
<p>To first back out the measured spectrum of Milder et al. <a class="footnote-reference" href="#id8" id="id7">[1]</a>, the incident spectrum for polyethylene at 300K using Eq. <a href="#equation-incident_spectrum">(3)</a> is obtained, then the efficiency correction is calculated, and then the incident spectrum is divided by this correction to back out what was originally measured. Then, the correction is applied by multiplying it by the measured spectrum to get back to the corrected incident spectrum to demonstrate how this is regularly apply this to a measured spectrum:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create the workspace to hold the already corrected incident spectrum</span>
<span class="n">incident_wksp_name</span> <span class="o">=</span> <span class="s">&#39;incident_spectrum_wksp&#39;</span>
<span class="n">binning</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">4.0</span><span class="p">)</span>
<span class="n">incident_wksp</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="n">incident_wksp_name</span><span class="p">,</span>
                                <span class="n">NSpec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">DataX</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DataY</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;Wavelength&#39;</span><span class="p">,</span>
                                <span class="n">VerticalAxisUnit</span><span class="o">=</span><span class="s">&#39;Text&#39;</span><span class="p">,</span>
                                <span class="n">VerticalAxisValues</span><span class="o">=</span><span class="s">&#39;IncidentSpectrum&#39;</span><span class="p">)</span>
<span class="n">incident_wksp</span> <span class="o">=</span> <span class="n">Rebin</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">,</span> <span class="n">Params</span><span class="o">=</span><span class="n">binning</span><span class="p">)</span>
<span class="n">incident_wksp</span> <span class="o">=</span> <span class="n">ConvertToPointData</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">)</span>

<span class="c"># Spectrum function given in Milder et al. Eq (5)</span>
<span class="k">def</span> <span class="nf">incidentSpectrum</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">phiMax</span><span class="p">,</span> <span class="n">phiEpi</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lamdaT</span><span class="p">):</span>
    <span class="n">deltaTerm</span> <span class="o">=</span>  <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">wavelengths</span> <span class="o">-</span> <span class="n">lambda1</span><span class="p">)</span> <span class="o">/</span> <span class="n">lambda2</span><span class="p">))</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="n">phiMax</span> <span class="o">*</span> <span class="p">(</span><span class="n">lambdaT</span><span class="o">**</span><span class="mf">4.</span> <span class="o">/</span> <span class="n">wavelengths</span><span class="o">**</span><span class="mf">5.</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">lambdaT</span> <span class="o">/</span> <span class="n">wavelengths</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">phiEpi</span> <span class="o">*</span> <span class="n">deltaTerm</span> <span class="o">/</span> <span class="p">(</span><span class="n">wavelengths</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span>

<span class="c"># Variables for polyethlyene moderator at 300K</span>
<span class="n">phiMax</span>  <span class="o">=</span> <span class="mi">6324</span>
<span class="n">phiEpi</span>  <span class="o">=</span> <span class="mi">786</span>
<span class="n">alpha</span>   <span class="o">=</span> <span class="mf">0.099</span>
<span class="n">lambda1</span> <span class="o">=</span> <span class="mf">0.67143</span>
<span class="n">lambda2</span> <span class="o">=</span> <span class="mf">0.06075</span>
<span class="n">lambdaT</span> <span class="o">=</span> <span class="mf">1.58</span>

<span class="c"># Add the incident spectrum to the workspace</span>
<span class="n">corrected_spectrum</span> <span class="o">=</span> <span class="n">incidentSpectrum</span><span class="p">(</span><span class="n">incident_wksp</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                      <span class="n">phiMax</span><span class="p">,</span> <span class="n">phiEpi</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span>
                                      <span class="n">lambda1</span><span class="p">,</span> <span class="n">lambda2</span><span class="p">,</span> <span class="n">lambdaT</span><span class="p">)</span>
<span class="n">incident_wksp</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">corrected_spectrum</span><span class="p">)</span>

<span class="c"># Calculate the efficiency correction for Alpha=0.693 and back calculate measured spectrum</span>
<span class="n">eff_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.693</span><span class="p">)</span>
<span class="n">measured_wksp</span> <span class="o">=</span> <span class="n">Divide</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">incident_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">eff_wksp</span><span class="p">)</span>

<span class="c"># Re-applying the correction to the measured data (how to normally use it)</span>
<span class="n">eff2_wksp</span> <span class="o">=</span> <span class="n">CalculateEfficiencyCorrection</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="n">measured_wksp</span><span class="p">,</span> <span class="n">Alpha</span><span class="o">=</span><span class="mf">0.693</span><span class="p">)</span>
<span class="n">recorrected_wksp</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">(</span><span class="n">LHSWorkspace</span><span class="o">=</span><span class="n">measured_wksp</span><span class="p">,</span> <span class="n">RHSWorkspace</span><span class="o">=</span><span class="n">eff2_wksp</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Measured incident spectrum: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measured_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Corrected incident spectrum: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">incident_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Re-corrected incident spectrum: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">recorrected_wksp</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Measured incident spectrum: [ 694.61415533  685.71520053  677.21326605  669.0696332   661.25022644]
Corrected incident spectrum: [ 5244.9385468   4953.63834159  4690.60136547  4451.98728342  4234.6092648 ]
Re-corrected incident spectrum: [ 5244.9385468   4953.63834159  4690.60136547  4451.98728342  4234.6092648 ]
</pre></div>
</div>
</div>
<div class="section" id="references">
<h2><a class="toc-backref" href="#id17">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>, <a class="fn-backref" href="#id6">3</a>, <a class="fn-backref" href="#id7">4</a>)</em> <ol class="last upperalpha simple" start="4">
<li><ol class="first upperalpha" start="6">
<li><ol class="first upperalpha" start="18">
<li>Mildner, B. C. Boland, R. N. Sinclair, C. G. Windsor, L. J. Bunce, and J. H. Clarke (1977) <em>A Cooled Polyethylene Moderator on a Pulsed Neutron Source</em>, Nuclear Instruments and Methods 152 437-446 <a class="reference external" href="https://doi.org/10.1016/0029-554X(78)90043-5">doi: 10.1016/0029-554X(78)90043-5</a></li>
</ol>
</li>
</ol>
</li>
</ol>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td><ol class="first last upperalpha simple" start="10">
<li><ol class="first upperalpha" start="16">
<li>Hodges, J. D. Jorgensen, S. Short, D. N. Argyiou, and J. W. Richardson, Jr.  <em>Incident Spectrum Determination for Time-of-Flight Neutron Powder Diffraction Data Analysis</em> ICANS 14th Meeting of the International Collaboration on Advanced Neutron Sources 813-822 <a class="reference external" href="http://www.neutronresearch.com/parch/1998/01/199801008130.pdf">link to paper</a></li>
</ol>
</li>
</ol>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td><ol class="first last upperalpha simple" start="6">
<li>Issa, A. Khaplanov, R. Hall-Wilton, I. Llamas, M. Dalseth Ricktor, S. R. Brattheim, and H. Perrey (2017) <em>Characterization of Thermal Neutron Beam Monitors</em> Physical Review Accelerators and Beams 20 092801 <a class="reference external" href="https://doi.org/10.1103/PhysRevAccelBeams.20.092801">doi: 10.1103/PhysRevAccelBeams.20.092801</a></li>
</ol>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[4]</a></td><td><ol class="first last upperalpha simple" start="23">
<li><ol class="first upperalpha" start="19">
<li>Howells (1983) <em>On the Choice of Moderator for Liquids Diffractometer on a Pulsed Neutron Source</em>, Nuclear Instruments and Methods in Physics Research 223 141-146 <a class="reference external" href="https://doi.org/10.1016/0167-5087(84)90256-4">doi: 10.1016/0167-5087(84)90256-4</a></li>
</ol>
</li>
</ol>
</td></tr>
</tbody>
</table>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/CorrectionFunctions/EfficiencyCorrections.html">CorrectionFunctions\EfficiencyCorrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id18">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/PythonInterface/plugins/algorithms/CalculateEfficiencyCorrection.py">CalculateEfficiencyCorrection.py</a> <em>(last modified: 2019-01-16)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CalculateEfficiency-v2.html" title="Previous Chapter: CalculateEfficiency v2"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CalculateEfficie...</span>
    </a>
  </li>
  <li>
    <a href="CalculateFlatBackground-v1.html" title="Next Chapter: CalculateFlatBackground v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CalculateFlatBac... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>