<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LoadILLReflectometry v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="LoadILLSANS v1" href="LoadILLSANS-v1.html" />
    <link rel="prev" title="LoadILLPolarizationFactors v1" href="LoadILLPolarizationFactors-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="loadillreflectometry-v1">
<span id="algm-loadillreflectometry"></span><span id="algm-loadillreflectometry-v1"></span><h1>LoadILLReflectometry v1<a class="headerlink" href="#loadillreflectometry-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/LoadILLReflectometry-v1_dlg.png"><img alt="../_images/LoadILLReflectometry-v1_dlg.png" class="screenshot" src="../_images/LoadILLReflectometry-v1_dlg.png" style="width: 332px;" /></a>
<p class="caption"><strong>LoadILLReflectometry</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id2">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#time-of-flight-axis" id="id5">Time of flight axis</a></li>
<li><a class="reference internal" href="#detector-position" id="id6">Detector position</a><ul>
<li><a class="reference internal" href="#direct-beam-calibration" id="id7">Direct beam calibration</a></li>
<li><a class="reference internal" href="#user-angle" id="id8">User angle</a></li>
<li><a class="reference internal" href="#beam-position-offset" id="id9">Beam position offset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#source-position" id="id10">Source position</a></li>
<li><a class="reference internal" href="#usage" id="id11">Usage</a></li>
<li><a class="reference internal" href="#source" id="id12">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Loads an ILL reflectometry Nexus file (instrument D17 or FIGARO).</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id2">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="LoadNexus-v1.html#algm-loadnexus"><em>LoadNexus</em></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="4%" />
<col width="26%" />
<col width="8%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Filename</td>
<td>Input</td>
<td>string</td>
<td><em>Mandatory</em></td>
<td>Name of the Nexus file to load. Allowed extensions: [&#8216;.nxs&#8217;]</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Name of the output workspace</td>
</tr>
<tr class="row-even"><td>BeamCentre</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Beam position in workspace indices (disables peak finding).</td>
</tr>
<tr class="row-odd"><td>OutputBeamPosition</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Name of the fitted beam position output workspace</td>
</tr>
<tr class="row-even"><td>DirectBeamPosition</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A workspace defining the beam position; used to calculate the Bragg angle</td>
</tr>
<tr class="row-odd"><td>BraggAngle</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>User defined Bragg angle in degrees</td>
</tr>
<tr class="row-even"><td>XUnit</td>
<td>Input</td>
<td>string</td>
<td>Wavelength</td>
<td>X unit of the OutputWorkspace. Allowed values: [&#8216;Wavelength&#8217;, &#8216;TimeOfFlight&#8217;]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Loads data of a Nexus file obtained from an ILL reflectometry instrument <a class="reference external" href="https://www.ill.eu/instruments-support/instruments-groups/instruments/d17/description/instrument-layout/">D17</a> or <a class="reference external" href="https://www.ill.eu/instruments-support/instruments-groups/instruments/figaro/description/instrument-layout/">FIGARO</a> into a <a class="reference external" href="http://www.mantidproject.org/Workspace2D">Workspace2D</a>. Both time-of-flight and monochromatic instrument configurations are supported. In general, this loader reads detector and monitor counts and adds x-axis and error values. The output workspace contains histogram data. The x-axis can have units in time-of-flight or wavelength with non-varying and varying bins, respectively. The conversion to wavelength uses the algorithm <a class="reference internal" href="ConvertUnits-v1.html#algm-convertunits"><em>ConvertUnits v1</em></a>.
The sample logs associated to the output workspace contain two additional entries, <tt class="docutils literal"><span class="pre">Facility</span></tt>, set to <tt class="docutils literal"><span class="pre">ILL</span></tt>, and <tt class="docutils literal"><span class="pre">loader.two_theta</span></tt> which writes the angle used to rotate the detector.
Detector indices and spectrum numbers start with zero like workspace indices.</p>
</div>
<div class="section" id="time-of-flight-axis">
<h2><a class="toc-backref" href="#id5">Time of flight axis</a><a class="headerlink" href="#time-of-flight-axis" title="Permalink to this headline">¶</a></h2>
<p>The chopper values are used for computing the time-of-flight values for the bin edges <img class="math" src="../_images/math/c2f01810eef41c68678f5efa3d9ca634ff6785da.png" alt="x_i" style="vertical-align: -3px"/> by the following equation:</p>
<div class="math">
<p><img src="../_images/math/5d071190392570539d69b907c26f45eca69be675.png" alt="x_{i} = \left( i + 0.5 \right) w_{\mathrm{channel}} + \Delta_{t, \mathrm{tof}} -  60^{\circ} \cdot \frac{ p_{\mathrm{off}} - 45^{\circ} + \Omega_{c2} - \Omega_{c1} + \Delta_{\mathrm{open}} }{ 2 \cdot 360^{\circ} \cdot v_{c1} } \cdot 10^{6},"/></p>
</div><p>with the following variables: channel width <img class="math" src="../_images/math/81607fa58e8c52f8cb645b37d26436c1ad78e867.png" alt="w_{\mathrm{channel}}" style="vertical-align: -4px"/>, time-of-flight delay <img class="math" src="../_images/math/2b3ae7cc9d6b8fda645afa71a1f23c57b3860b26.png" alt="\Delta_{t, \mathrm{tof}}" style="vertical-align: -6px"/>, offset <img class="math" src="../_images/math/0786332075672b815072940746f37437422c62bb.png" alt="p_{\mathrm{off}}" style="vertical-align: -4px"/>, phase of second chopper <img class="math" src="../_images/math/7f8b2012eebf6e5d56c278c4bbcd5457db8240d7.png" alt="\Omega_{c2}" style="vertical-align: -3px"/>, phase of first chopper <img class="math" src="../_images/math/9736da405fac291e793f287eb55af9b176c90108.png" alt="\Omega_{c1}" style="vertical-align: -4px"/>, open offset <img class="math" src="../_images/math/67e9fd54514c4b05a241261cb6aec28100f87f73.png" alt="\Delta_{\mathrm{open}}" style="vertical-align: -6px"/> and velocity of first chopper <img class="math" src="../_images/math/c7db1b84cfaf36cf208ef7f32e81ca113a8eff66.png" alt="v_{c1}" style="vertical-align: -4px"/>.</p>
</div>
<div class="section" id="detector-position">
<h2><a class="toc-backref" href="#id6">Detector position</a><a class="headerlink" href="#detector-position" title="Permalink to this headline">¶</a></h2>
<p>This loader will update the detector position from what is defined in the instrument definition files. The detector will be moved to the current distance from origin and rotated around it either on the horizontal or vertical plane.</p>
<p>The rotation angle can be one of the following:</p>
<ul class="simple">
<li>The detector angle in the sample logs. For FIGARO this will be calculated from the motor positions. This is the default behavior if neither <tt class="docutils literal"><span class="pre">BraggAngle</span></tt> nor <tt class="docutils literal"><span class="pre">DirectBeamPosition</span></tt> is given.</li>
<li>The detector angle calibrated by the direct beam measurement. This behavior is triggered when <tt class="docutils literal"><span class="pre">DirectBeamPosition</span></tt> is given.</li>
<li>An angle based on a user-specified angle given by the <tt class="docutils literal"><span class="pre">BraggAngle</span></tt> input property. This overrides all other angles.</li>
</ul>
<div class="section" id="direct-beam-calibration">
<h3><a class="toc-backref" href="#id7">Direct beam calibration</a><a class="headerlink" href="#direct-beam-calibration" title="Permalink to this headline">¶</a></h3>
<p>Calibration using a direct beam measurement is triggered when the <tt class="docutils literal"><span class="pre">DirectBeamPosition</span></tt> property is specified. In this mode, a direct beam file should be loaded separately and the <tt class="docutils literal"><span class="pre">OutputBeamPosition</span></tt> output property used to obtain a special <a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a> containing information on the direct beam position. This workspace can be further given as the <tt class="docutils literal"><span class="pre">DirectBeamPosition</span></tt> input to proceeding loads as exemplified in the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;directbeam.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;direct_beam_ws&#39;</span><span class="p">,</span> <span class="n">OutputBeamPosition</span><span class="o">=</span><span class="s">&#39;beam_position_ws&#39;</span><span class="p">)</span>
<span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;sample1.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;sample1_ws&#39;</span><span class="p">,</span> <span class="n">DirectBeamPosition</span><span class="o">=</span><span class="s">&#39;beam_position_ws&#39;</span><span class="p">)</span>
<span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;sample2.nxs&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;sample2_ws&#39;</span><span class="p">,</span> <span class="n">DirectBeamPosition</span><span class="o">=</span><span class="s">&#39;beam_position_ws&#39;</span><span class="p">)</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>The detector is rotated around angle <img class="math" src="../_images/math/23bf3bdd8ce99fdb75f17e8b49934c62e9cf0841.png" alt="\alpha" style="vertical-align: 0px"/>, given by</p>
<div class="math">
<p><img src="../_images/math/d9b21fa95ccf46ba97986814517baf46fba5f081.png" alt="\alpha = \alpha_{R} - \alpha_{D} - \Delta_{D}"/></p>
</div><p>where <img class="math" src="../_images/math/23bf3bdd8ce99fdb75f17e8b49934c62e9cf0841.png" alt="\alpha" style="vertical-align: 0px"/> is the nominal detector angle, <img class="math" src="../_images/math/23bf3bdd8ce99fdb75f17e8b49934c62e9cf0841.png" alt="\alpha" style="vertical-align: 0px"/> the detector angle of the direct beam reference and <img class="math" src="../_images/math/e20c3bbfb5154304ef9e0ab7e2eb460668d4c094.png" alt="\Delta_{D}" style="vertical-align: -3px"/> the beam position offset (see below) of the reference.</p>
</div>
<div class="section" id="user-angle">
<h3><a class="toc-backref" href="#id8">User angle</a><a class="headerlink" href="#user-angle" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">BraggAngle</span></tt> option rotates the detector by an angle <img class="math" src="../_images/math/23bf3bdd8ce99fdb75f17e8b49934c62e9cf0841.png" alt="\alpha" style="vertical-align: 0px"/> such that the angle between the direct beam axis and the reflected peak centre on the detector is twice <tt class="docutils literal"><span class="pre">BraggAngle</span></tt></p>
<div class="math">
<p><img src="../_images/math/ea12e99722e710986545aae4356ad6c06aa5522d.png" alt="\alpha = 2 \theta_{user} - \Delta_{R}"/></p>
</div><p>where <img class="math" src="../_images/math/f531a0e3afd92aff6c075f40f02d25c33d1c4683.png" alt="\Delta_{R}" style="vertical-align: -3px"/> the beam position offset angle (see below). The angle <img class="math" src="../_images/math/871b813f541116b4e084832d958d203a6f0a8070.png" alt="\theta_{user}" style="vertical-align: -3px"/> is <tt class="docutils literal"><span class="pre">BraggAngle</span></tt> in the simple case that the sample is in the origin. If a horizontal sample shift is present (FIGARO), the <img class="math" src="../_images/math/871b813f541116b4e084832d958d203a6f0a8070.png" alt="\theta_{user}" style="vertical-align: -3px"/> angle is calculated so that the angle to the reflected peak on the detector seen from the shifted sample position is the requested <cite>BraggAngle</cite>.</p>
</div>
<div class="section" id="beam-position-offset">
<h3><a class="toc-backref" href="#id9">Beam position offset</a><a class="headerlink" href="#beam-position-offset" title="Permalink to this headline">¶</a></h3>
<p>To calculate the angle between the detector centre and the beam, the reflectometry data is integrated using <a class="reference internal" href="Integration-v1.html#algm-integration"><em>Integration v1</em></a>, transposed using <a class="reference internal" href="Transpose-v1.html#algm-transpose"><em>Transpose v1</em></a> and finally fitted by a <a class="reference internal" href="../fitting/fitfunctions/Gaussian.html#func-gaussian"><em>Gaussian</em></a> using <a class="reference internal" href="Fit-v1.html#algm-fit"><em>Fit v1</em></a>. The offset angle <img class="math" src="../_images/math/d682e66b656d96f8941516a7ad2b2f64331a1c93.png" alt="\Delta" style="vertical-align: 0px"/> can then be calculated by</p>
<div class="math">
<p><img src="../_images/math/e03fc22457c217f680359200697b8da4a0c87d6c.png" alt="\Delta = \tan^{-1} \frac{(i_{centre} - i_{fit}) d_{pix}}{l_{2}},"/></p>
</div><p>where <img class="math" src="../_images/math/03a4339a359530ab9248a7898f96a8e196dd91bc.png" alt="i_{centre}" style="vertical-align: -3px"/> is the workspace index of the detector centre (127.5 for D17 and FIGARO), <img class="math" src="../_images/math/3dd192ea7c9aa419849dda6ad070aee84a574604.png" alt="i_{fit}" style="vertical-align: -6px"/> the fitted peak position, <img class="math" src="../_images/math/1bd1af42091f6127795933ffb35e4314983e62af.png" alt="d_{pix}" style="vertical-align: -6px"/> the physical pixel width and <img class="math" src="../_images/math/8f721a03fd0b7f6e47c57c503c157a9802d9c94b.png" alt="l_{2}" style="vertical-align: -3px"/> the sample to detector centre distance.</p>
<p>The value of <img class="math" src="../_images/math/3dd192ea7c9aa419849dda6ad070aee84a574604.png" alt="i_{fit}" style="vertical-align: -6px"/> can be overridden by the <tt class="docutils literal"><span class="pre">BeamCentre</span></tt> property. This effectively disables the fitting procedure.</p>
</div>
</div>
<div class="section" id="source-position">
<h2><a class="toc-backref" href="#id10">Source position</a><a class="headerlink" href="#source-position" title="Permalink to this headline">¶</a></h2>
<p>In the case of D17, this loader will move the source position (&#8216;chopper1&#8217; in the instrument definition file) on the z-axis to the position</p>
<div class="math">
<p><img src="../_images/math/51a6afacccc31a4ed8d03b2a4506aa7e3cd648a2.png" alt="z_{source} = -d_{ch} + \frac{1}{2} \delta_{ch},"/></p>
</div><p>where <img class="math" src="../_images/math/0153fe15b797b19c8df100640fb608ba1d0d2d44.png" alt="d_{ch}" style="vertical-align: -3px"/> is the <tt class="docutils literal"><span class="pre">VirtualChopper.dist_chop_samp</span></tt> sample log entry and <img class="math" src="../_images/math/29830999c8804b4adb7dc389f430ad1e8fb9b0b9.png" alt="\delta_{ch}" style="vertical-align: -3px"/> the <tt class="docutils literal"><span class="pre">Distance.ChopperGap</span></tt> entry.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id11">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In MantidPlot this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Load ILL D17 Nexus file:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Optional: set facility and default instrument</span>
<span class="n">config</span><span class="p">[</span><span class="s">&#39;default.facility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;ILL&#39;</span>
<span class="n">config</span><span class="p">[</span><span class="s">&#39;default.instrument&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;D17&#39;</span>

<span class="c"># Load ILL D17 data file (TOF mode) into a workspace 2D using default input options:</span>
<span class="n">ws1</span> <span class="o">=</span> <span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;ILL/D17/317370.nxs&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Workspace {} has {} dimensions and {} histograms.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws1</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">ws1</span><span class="o">.</span><span class="n">getNumDims</span><span class="p">(),</span> <span class="n">ws1</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Workspace ws1 has 2 dimensions and 258 histograms.
</pre></div>
</div>
<p><strong>Example - Specify user angle:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>

<span class="c"># Load ILL d17 data file (TOF mode) into a workspace 2D using a user-defined angle of 30 degrees:</span>
<span class="n">ws2</span> <span class="o">=</span> <span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;ILL/D17/317370.nxs&#39;</span><span class="p">,</span> <span class="n">BraggAngle</span><span class="o">=</span><span class="mf">5.5</span><span class="p">)</span>

<span class="c"># The original detector angle can be found in the sample logs:</span>
<span class="n">angleOrig</span> <span class="o">=</span> <span class="n">ws2</span><span class="o">.</span><span class="n">getRun</span><span class="p">()</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&quot;dan.value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="c"># The reflected beam center is around pixel 202.</span>
<span class="n">detId</span> <span class="o">=</span> <span class="mi">202</span>
<span class="n">det</span> <span class="o">=</span> <span class="n">ws2</span><span class="o">.</span><span class="n">getInstrument</span><span class="p">()</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="n">detId</span><span class="p">)</span>
<span class="n">angleDet</span> <span class="o">=</span> <span class="n">ws2</span><span class="o">.</span><span class="n">detectorTwoTheta</span><span class="p">(</span><span class="n">det</span><span class="p">)</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">180</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;The nominal angle in the NeXus file was {:.2} degrees.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">angleOrig</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Pixel at detector ID {} was rotated to {:.1f} degrees.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">detId</span><span class="p">,</span> <span class="n">angleDet</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>The nominal angle in the NeXus file was 3.2 degrees.
Pixel at detector ID 202 was rotated to 11.0 degrees.
</pre></div>
</div>
<p><strong>Example - Calibration of detector angle by direct beam:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">directBeamWS</span> <span class="o">=</span> <span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;ILL/D17/317369.nxs&#39;</span><span class="p">,</span> <span class="n">OutputBeamPosition</span><span class="o">=</span><span class="s">&#39;beamPositionWS&#39;</span><span class="p">)</span>

<span class="n">beamPosWS</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;beamPositionWS&#39;</span><span class="p">]</span>
<span class="n">peakCentre</span> <span class="o">=</span> <span class="n">beamPosWS</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s">&#39;PeakCentre&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Fitted direct beam maximum (in workspace indices): {:.5}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peakCentre</span><span class="p">))</span>

<span class="n">reflectedBeamWS</span> <span class="o">=</span> <span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;ILL/D17/317370.nxs&#39;</span><span class="p">,</span> <span class="n">DirectBeamPosition</span><span class="o">=</span><span class="n">beamPosWS</span><span class="p">)</span>

<span class="c"># Lets load the data without detector angle calibration just for reference</span>

<span class="n">refWS</span> <span class="o">=</span> <span class="n">LoadILLReflectometry</span><span class="p">(</span><span class="s">&#39;ILL/D17/317370.nxs&#39;</span><span class="p">)</span>

<span class="n">det</span> <span class="o">=</span> <span class="n">reflectedBeamWS</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">peakCentre</span><span class="p">))</span>
<span class="n">detAngle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">reflectedBeamWS</span><span class="o">.</span><span class="n">detectorTwoTheta</span><span class="p">(</span><span class="n">det</span><span class="p">))</span>
<span class="n">det</span> <span class="o">=</span> <span class="n">refWS</span><span class="o">.</span><span class="n">getDetector</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">peakCentre</span><span class="p">))</span>
<span class="n">refAngle</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">refWS</span><span class="o">.</span><span class="n">detectorTwoTheta</span><span class="p">(</span><span class="n">det</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;Uncalibrated detector angle: {:.4} degrees.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">refAngle</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Detector angle after calibration using direct beam: {:.4} degrees.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">detAngle</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Fitted direct beam maximum (in workspace indices): 202.18
Uncalibrated detector angle: 1.537 degrees.
Detector angle after calibration using direct beam: 1.598 degrees.
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/DataHandling/Nexus.html">DataHandling\Nexus</a> | <a class="reference external" href="categories/ILL/Reflectometry.html">ILL\Reflectometry</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id12">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/DataHandling/src/LoadILLReflectometry.cpp">LoadILLReflectometry.cpp</a> <em>(last modified: 2019-06-26)</em></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/4f102e5150ac52e22844cc01d797043938307727/Framework/DataHandling/inc/MantidDataHandling/LoadILLReflectometry.h">LoadILLReflectometry.h</a> <em>(last modified: 2019-02-19)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="LoadILLPolarizationFactors-v1.html" title="Previous Chapter: LoadILLPolarizationFactors v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; LoadILLPolarizat...</span>
    </a>
  </li>
  <li>
    <a href="LoadILLSANS-v1.html" title="Next Chapter: LoadILLSANS v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">LoadILLSANS v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>