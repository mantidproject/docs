<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Engineering Diffraction</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="up" title="Interfaces" href="index.html" />
    <link rel="next" title="Engineering Diffraction Testing" href="Engineering Diffraction Test Guide.html" />
    <link rel="prev" title="Dynamic PDF" href="Dynamic PDF Background Remover.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>4.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="engineering-diffraction">
<span id="engineering-diffraction-ref"></span><h1>Engineering Diffraction<a class="headerlink" href="#engineering-diffraction" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id3">Overview</a><ul>
<li><a class="reference internal" href="#general-options" id="id4">General options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calibration" id="id5">Calibration</a><ul>
<li><a class="reference internal" href="#parameters" id="id6">Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#focus" id="id7">Focus</a><ul>
<li><a class="reference internal" href="#run-number" id="id8">Run Number</a></li>
<li><a class="reference internal" href="#output" id="id9">Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pre-processing" id="id10">Pre-processing</a></li>
<li><a class="reference internal" href="#fitting" id="id11">Fitting</a><ul>
<li><a class="reference internal" href="#expectedpeaks-engineering-diffraction-ref" id="id12">Parameters</a></li>
<li><a class="reference internal" href="#id2" id="id13">Output</a></li>
<li><a class="reference internal" href="#preview" id="id14">Preview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gsas-fitting" id="id15">GSAS Fitting</a></li>
<li><a class="reference internal" href="#settings" id="id16">Settings</a><ul>
<li><a class="reference internal" href="#calibration-parameters" id="id17">Calibration Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#algorithms" id="id18">Algorithms</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id3">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This custom interface integrates several tasks related to engineering
diffraction. It provides functionality for calibration, focusing, and
pre-processing of event mode data. Further extensions can be expected
for future releases as it is under active development. Feedback is very
much welcome. The following sections describe the different tabs or
functionality areas of the interface.</p>
<div class="figure align-center">
<a class="screenshot reference internal image-reference" href="../_images/Engineering_Diffraction_interface.png"><img alt="../_images/Engineering_Diffraction_interface.png" class="screenshot" src="../_images/Engineering_Diffraction_interface.png" style="width: 400px;" /></a>
</div>
<div class="section" id="general-options">
<h3><a class="toc-backref" href="#id4">General options</a><a class="headerlink" href="#general-options" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>RB Number</dt>
<dd>To enable the GUI specify a RB Number (where &#8220;RB Number&#8221; usually
denotes the experiment reference number at ISIS). This reference
will be used for the output paths, so that files from different
users and/or experiments can be kept separate.</dd>
<dt>Instrument</dt>
<dd>Select the instrument. Only ENGIN-X (ISIS) is supported in this version.</dd>
</dl>
<dl class="docutils">
<dt>?</dt>
<dd>Shows this documentation page.</dd>
<dt>Close</dt>
<dd>Close the interface</dd>
<dt>Status at the bottom of the interface</dt>
<dd>A short message will be displayed which indicates whether the last
important calculations finished successfully, and when the interface
is busy calculating (calibrating, focusing, fitting, etc.).</dd>
</dl>
<ul class="simple">
<li>Red Star Sign
If a red star sign is displayed next to the Browse Button, it is mostly
likely because the file specified has not been found. Error message
can be viewed by hovering over the red star sign.</li>
</ul>
</div>
</div>
<div class="section" id="calibration">
<span id="ui-engineering-calibration"></span><h2><a class="toc-backref" href="#id5">Calibration</a><a class="headerlink" href="#calibration" title="Permalink to this headline">¶</a></h2>
<p>This tab provides a graphical interface to calculate calibrations and
visualize them.</p>
<p>It is possible to:</p>
<ul class="simple">
<li>Generate a new calibration file (which becomes the new current
calibration)</li>
<li>Load an existing calibration from a GSAS instrument
parameters file previously generated</li>
</ul>
<p>For the current calibration, the following parameters are displayed:</p>
<ul class="simple">
<li>The vanadium run number</li>
<li>The calibration sample run number</li>
<li>The path to the output calibration file.</li>
</ul>
<p>This calibration file output is a GSAS instrument parameters file (IPARM/PAR/PRM). The interface
produces a calibration file containing all banks and in addition a calibration
file for every individual bank. All the calibration files are written
in the same directory.</p>
<p>With the help of Cropped Calibration user can also calibrate according
to specific banks or by setting the Spectrum Numbers once the Cropped Calibration group
box has been enabled.</p>
<p>The plot Calibrated Workspace check-box will enable user to plot
vanadium curves and Ceria peaks. For Ceria peaks there will be two
workspaces generated and plotted, one for each bank, whereas for a
cropped calibration there will only be one workspace generated
and plotted, depending on the selected bank or provided Spectrum
IDs. The workspace contains difc and tzero data which is then
utilised to plot the Ceria peaks per bank, the graph will plot Peaks
Fitted and Difc/TZero Straight Line for comparison. More information
regarding the fit peaks can be found on the
<a class="reference internal" href="../algorithms/EnggFitPeaks-v1.html#algm-enggfitpeaks"><em>EnggFitPeaks</em></a> documentation.</p>
<p>The calibration files are written into two different output
directories. First, they are written to a user specific directory
which for the ENGIN-X instrument on Windows systems is:</p>
<p><cite>C:\EnginX_Mantid\&lt;Username&gt;\&lt;RBNumber&gt;\Calibration</cite></p>
<p>On UNIX based platforms this path is:</p>
<p><cite>~/EnginX_Mantid/&lt;Username&gt;/&lt;RBNumber&gt;/Calibration</cite></p>
<p>They are also copied into a general (all) output directory:</p>
<p><cite>C:\EnginX_Mantid\Calibration</cite> on Windows or</p>
<p><cite>~/EnginX_Mantid/Calibration</cite> on UNIX platforms.</p>
<p>The calibration parameters for each bank are made available for user
inspection in a workspace named
<strong>engggui_calibration_banks_parameters</strong> which is updated when new
calibrations are loaded or calculated.</p>
<div class="section" id="parameters">
<h3><a class="toc-backref" href="#id6">Parameters</a><a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>These parameters are required to generate new calibrations:</p>
<dl class="docutils">
<dt>Vanadium #</dt>
<dd>Number of the vanadium run used to correct calibration and experiment
runs.</dd>
<dt>Calibration sample #</dt>
<dd>Number of the calibration sample run (for example Ceria run) used to
calibrate experiment runs.</dd>
<dt>Bank Name:</dt>
<dd>This parameter is only required when Cropped Calibration is being
carried out. The bank name can be selected from a drop down list with
option of &#8220;North&#8221; and &#8220;South&#8221;, which are equivalent to 1 and 2
respectively.
Custom bank mappings can be created by setting the Bank Name option
to <cite>Use spectrum numbers</cite>. When the option <em>Use Spectrum Numbers</em> is
set a bank name must be specified in <em>Customise Bank Name</em>.</dd>
<dt>Spectrum Numbers:</dt>
<dd>This parameter is only required when Cropped Calibration is being
carried out, the parameter will set the spectrum numbers of the
detectors, that should be considered in the calibration while all
others will be ignored. This option cannot be used together with
Bank Name, as they overlap. You may also give multiple ranges, for
example: &#8220;0-100&#8221;, or &#8220;0-9&#8221;, &#8220;150-750&#8221;.</dd>
<dt>Customise Bank Name:</dt>
<dd>This parameter is only required when Cropped Calibration is being
carried out with Spectrum Numbers, the parameter will set the workspace
and <cite>.his</cite> file name according to this Bank Name provided by the user.
However if the user does not provide a personalised name, the
interface will use &#8220;cropped&#8221; as a default bank name.</dd>
</dl>
<p>The calibration process depends on several additional parameters and
settings which can be modified in the <em>Settings</em> tab, see <a class="reference internal" href="#setting-engineering-diffraction-ref"><em>Settings</em></a> for details.</p>
</div>
</div>
<div class="section" id="focus">
<span id="focus-engineering-diffraction-ref"></span><h2><a class="toc-backref" href="#id7">Focus</a><a class="headerlink" href="#focus" title="Permalink to this headline">¶</a></h2>
<p>Here it is possible to focus run files, by providing a run number or a
range of run number to enable multi-run focusing, along with that the
user may also select the files with the help of Browse button.</p>
<p>The focusing process uses the algorithm <a class="reference internal" href="../algorithms/EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus</em></a>. In the documentation of the algorithm you can find
the details on how the input runs are focused.</p>
<p>The interface will also create workspaces that can be inspected in the
workspaces window:</p>
<ol class="arabic simple">
<li>The <em>engggui_focusing_input_ws workspace</em> for the data being focused</li>
<li>The <em>engggui_focusing_output_ws... workspace</em> for the corresponding
focused data (where the ... denotes a suffix explained below).</li>
</ol>
<p>Three focusing alternatives are provided:</p>
<ol class="arabic simple">
<li>Normal focusing, which includes all the spectra from the input run.</li>
<li>Cropped focusing, where several spectra or ranges of spectra can
be specified, as a list separated by commas.</li>
<li>Texture focusing, where the <em>texture</em> group of detectors is given
in a Detector Grouping File.</li>
</ol>
<p>Depending on the alternative chosen, the focusing operation will
include different banks and/or combinations of spectra (detectors).
The behavior for each option is as follows:</p>
<p>1. <em>Normal focusing</em> - All the selected banks and spectra present
in the input runs are considered. The output focused workspace will
be named with suffixes such as <em>_bank_1, _bank_2</em>, and so on</p>
<p>2. <em>Cropped Focusing</em> - All the banks are considered in
principle but only a list of spectra provided manually are
processed. The output focused workspace will be named with
the suffix <em>_cropped</em>.</p>
<p>3. <em>Texture Focusing</em> - The banks are selected by a user-defined
list of banks and corresponding spectrum numbers provided in a file.
The output workspaces will be named with suffixes such as <em>_texture_bank_1,
_texture_bank_2</em>, and so on. These suffixes are determined by the
bank IDs given in the detector grouping file.</p>
<p>Cropped focusing and Texture focusing have been disabled by default to
declutter the interface, but each section can be enabled simply by
ticking the check-box next to Focus Cropped and Focus Texture.</p>
<p>For texture focusing, the detector grouping file is a text (csv) file
with one line per bank. Each line must contain at least two numeric
fields, where the first one specifies the bank ID, and the second and
subsequent ones different spectrum numbers or ranges of spectrum
numbers. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Bank ID, spectrum numbers</span>
<span class="mi">1</span><span class="p">,</span> <span class="mi">205</span><span class="o">-</span><span class="mi">210</span>
<span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">107</span>
<span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">320</span><span class="o">-</span><span class="mi">329</span><span class="p">,</span> <span class="mi">350</span><span class="o">-</span><span class="mi">370</span>
</pre></div>
</div>
<p>When a focus run process is being carried out, Focus Stop button will
be enabled. Focus Stop button will allow the user to abort once the
current focus run process has been completed. Inside the <em>Result Log</em>
a warning message will be displayed with last successful run and total
number of focus runs that could not be processed.</p>
<p>The focused data files are saved in NeXus format into the user
specific and general directories (as with the calibration output
files). That is the files are written into
<cite>C:\EnginX_Mantid\User\&lt;RBNumber&gt;\Calibration</cite> and
<cite>C:\EnginX_Mantid\Calibration</cite> on Windows, or
<cite>~/EnginX_Mantid/User/&lt;RBNumber&gt;/Calibration</cite> and
<cite>~/EnginX_Mantid/Calibration</cite> on UNIX platforms.  See below for
additional, optional outputs.</p>
<div class="section" id="run-number">
<h3><a class="toc-backref" href="#id8">Run Number</a><a class="headerlink" href="#run-number" title="Permalink to this headline">¶</a></h3>
<p>The run provided to focus can be for example 228061-228063, this will
run all the files within the given range as long as the file
directories are included in the
<a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">User Directories</a>.
The user may also provide an input of 228061-3 or 228061, 228062,
2280623 which should work the same way.</p>
<p>If a red star sign is displayed next to the Browse Button, it is mostly
likely because the file specified has not been found. Error message
can be viewed by hovering over the red star sign.</p>
<p>Checking the availability of all the files can take some time, for this
reason it is also possible that a file may not have been found but the
red star sign has not been displayed. If you manage to click Focus
before red sign is displayed, the interface will process the last valid
focus run instead.</p>
</div>
<div class="section" id="output">
<h3><a class="toc-backref" href="#id9">Output</a><a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<p>Under the output section, the user is provided with an option of
plotting data in three different formats.</p>
<ul class="simple">
<li>One Window - Replacing Plots: will replace the previous graph and plot a new graph on top.</li>
<li>One Window - Waterfall: will plot all the generated focused workspace graphs in one window
which can be useful while comparing various graphs.</li>
<li>Multiple Windows - will plot graph in separate windows.</li>
</ul>
<p>However, user may also change the Plot Data representation drop-down box while a run is being carried out. This
will update the interface and plot workspace according to the new given input.
For example, if a user has selected <em>One Window - Replacing Plots</em> and then decides to change it to <em>One Window -
Waterfall</em> during a run, the interface will carry on by plotting
Waterfall within the same window.</p>
<p>The user also has an option of saving GSS, XYE and OpenGenie formatted
files by clicking the Output Files checkbox. This will generate three
different files for each focused output workspace in Mantid. These
files can be found with appropriate name within:</p>
<p><cite>C:\EnginX_Mantid\&lt;User&gt;\&lt;RBNumber&gt;\Focus</cite> on Windows or</p>
<p><cite>~/EnginX_Mantid/Foxus</cite> on UNIX systems.</p>
<p>The files are also copied to the general (all) output directory which is</p>
<p><cite>C:\EnginX_Mantid\Focus</cite> on Windows</p>
<p><cite>~/EnginX_Mantid/Focus</cite> under on UNIX systems</p>
<p><cite>The Multiple Runs Focus Mode</cite> combo-box enables two alternative
focus modes. <cite>Focus Individual Run Files Separately</cite> is the default
option set, which allows user to run focus with multi-run files.
Whereas the <cite>Focus Sum Of Files</cite> option merges all the multi-run
number files together and applies the Focus Process to the merged
file.</p>
</div>
</div>
<div class="section" id="pre-processing">
<h2><a class="toc-backref" href="#id10">Pre-processing</a><a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a new capability that is currently in a very
early stage of definition and implementation. Not all
options may be supported and/or consistent at the moment.</p>
</div>
<p>The focusing options can be applied directly to histogram data. For
event mode experiments, the event data (which would be loaded as event
workspaces in Mantid) need to be pre-processed.</p>
<p>The simplest pre-processing option is &#8220;regular time binning&#8221; which
will produce a histogram data workspace (as a <a class="reference internal" href="../concepts/Workspace2D.html#workspace2d"><em>Workspace2D</em></a>). The only parameter required is the bin width. The
workspace will be named with the following convention:</p>
<ul class="simple">
<li><em>engggui_preproc_time_ws</em></li>
</ul>
<p>When the input run file contains multiple workspaces (it would be
loaded by <a class="reference internal" href="../algorithms/Load-v1.html#algm-load"><em>Load</em></a> as multiple <a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><em>EventWorkspace</em></a> workspaces) the output workspace will be a group
with the corresponding number of histogram workspaces, binned
separately. This is the case when the input run file comes from a
multi-period experiment. Note that the time bin can be a multiple of
the pulse time.</p>
<p>A different way of pre-processing event data is by rebinning
multi-period data by pulse times. In this case the input required is
the time step for the binning (the x axis of the output will be time
instead of time-of-flight). It is also possible to specify the number
of periods that will be processed (starting from the first one). This
type of pre-processing produces workspaces with the following naming
convention:</p>
<ul class="simple">
<li><em>engggui_preproc_by_pulse_time_ws</em></li>
</ul>
<p>Focussing uses the algorithms <a class="reference internal" href="../algorithms/Rebin-v1.html#algm-rebin"><em>Rebin</em></a> and <a class="reference internal" href="../algorithms/RebinByPulseTimes-v1.html#algm-rebinbypulsetimes"><em>RebinByPulseTimes</em></a> to bin the data in different ways when
converting event data into histogram data.</p>
</div>
<div class="section" id="fitting">
<h2><a class="toc-backref" href="#id11">Fitting</a><a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a new capability that is currently in a very
early stage of definition and implementation. Not all
options may be supported and/or consistent at the moment.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The input workspace must be converted into a focused file
first. The steps to complete this are found here: <a class="reference internal" href="#focus-engineering-diffraction-ref"><em>Focus</em></a></p>
</div>
<p>The Fitting tab provides a graphical interface which fits an expected
diffraction pattern and visualises them. The pattern is specified by
providing a list of peak centre values where Bragg peaks are expected.
These values can have units of either TOF of dSpacing but <strong>not</strong> both.
The algorithm <a class="reference internal" href="../algorithms/EnggFitPeaks-v1.html#algm-enggfitpeaks"><em>EnggFitPeaks</em></a> is used to
background fit peaks in those areas using a peak fitting function.</p>
<p>To use the Fitting tab, user is required to follow these steps:</p>
<ol class="arabic simple">
<li>Load run(s) to perform fitting on by browsing for focused nexus
files <em>User may click Load button to load the focused file to the
canvas</em></li>
<li>List of expected peaks which can be either by browsing a (<em>CSV</em>) file,
manually selecting peaks from the canvas using peak picker tool and the &#8220;Add Peak to List&#8221; button after
loading the focused file or by entering the peaks list within the text-field</li>
<li>Next click on the <em>Fit</em> button if you would like to fit single focused
file or you can click <em>Fit All</em> button which will enable user to
batch-process all the runs and banks when several files are loaded.
<em>Fit All</em> process may also be used when a single run number is given
or a file is browsed</li>
</ol>
<div class="section" id="expectedpeaks-engineering-diffraction-ref">
<span id="id1"></span><h3><a class="toc-backref" href="#id12">Parameters</a><a class="headerlink" href="#expectedpeaks-engineering-diffraction-ref" title="Permalink to this headline">¶</a></h3>
<p>These parameters are required to process Fitting successfully:</p>
<dl class="docutils">
<dt>Focused Run files:</dt>
<dd>.nxs files containing focused diffraction data. These should be the result
of focusing data with the <a class="reference internal" href="#focus-engineering-diffraction-ref"><em>Focus</em></a> tab.</dd>
<dt>Peaks:</dt>
<dd>A list of dSpacing values to be translated into TOF to find expected
peaks. These peaks can be manually written or imported by selecting a
(<em>CSV</em>) file.</dd>
</dl>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id13">Output</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Once the Fit button has been clicked Mantid will process the data. Please wait
until the Fitting process has completed. Upon completion you should be able to
view the Fitting tab which will contain:</p>
<ul class="simple">
<li>The focused workspace plotted in the background in gray crosses.</li>
<li>The expected peaks plotted in various colours overlapping the
focused workspace peaks.</li>
</ul>
<p>Within the <a class="reference internal" href="#preview-engineering-diffraction-ref"><em>Preview</em></a> section a user is
able to zoom-in or zoom-out as well as select, add and save peaks.</p>
<p>The interface will also generate workspaces that can be inspected in the
workspaces window:</p>
<ol class="arabic simple">
<li>The <em>engggui_fitting_fitpeaks_param</em> Table workspace
with the parameters of the peaks found and fitted.</li>
<li>The <em>engggui_fitting_focused_ws</em> Focused workspace also loaded
so the fitted data can be compared with focused data</li>
<li>The <em>engggui_fitting_single_peaks</em> workspace with each workspace
index representing individual expected peak.</li>
</ol>
<p>During the Fit process, <a class="reference internal" href="../algorithms/EnggSaveSinglePeakFitResultsToHDF5-v1.html#algm-enggsavesinglepeakfitresultstohdf5"><em>EnggSaveSinglePeakFitResultsToHDF5</em></a> algorithm will be utilised
to save <em>engggui_fitting_fitpeaks_param</em> TableWorkspace as a <cite>hdf5</cite>
file. There will one file per run, indexed by bank ID, and the file
will be found in the <strong>Runs</strong> directory of the user&#8217;s output
directory. If <strong>Fit All</strong> was run on multiple runs, then an additional
file for all runs will be output, which is indexed first by run number
and then by bank ID.</p>
<p>In the plots, the x or abscissa axis is in d-spacing units, which are
more convenient for peak fitting than time-of-flight. However the run
files and the focus files are normally stored as time-of-flight
data. For this reason a conversion from the time-of-flight data to
d-spacing is required. The conversion is performed using the current
calibration of banks. The interface handles this internally and adds
special sample logs to the fitting workspaces
(<em>engggui_fitting_single_peaks</em> and <em>engggui_fitting_focused_ws</em>). By
inspecting the sample logs of these workspaces. The conversion is
performed using the <a class="reference external" href="https://subversion.xray.aps.anl.gov/trac/pyGSAS">GSAS</a> equations, as
calculated by the algorithm <a class="reference internal" href="../algorithms/AlignDetectors-v1.html#algm-aligndetectors"><em>AlignDetectors</em></a></p>
</div>
<div class="section" id="preview">
<span id="preview-engineering-diffraction-ref"></span><h3><a class="toc-backref" href="#id14">Preview</a><a class="headerlink" href="#preview" title="Permalink to this headline">¶</a></h3>
<p>Once the fitting process has completed and you are able to view a
focused workspace with listed expected peaks on the data plot, the <em>Select
Peak</em> button should also be enabled. If the user choose to load the focus
workspace or if fitting fails with the given peaks then the focused
workspace will be plotted so that the user can select the peaks manually.</p>
<p>If you&#8217;ve run a fit but you can&#8217;t see the reconstructed peaks, make sure
the checkbox <strong>Plot fitted peaks</strong> is checked - if the fit was successful,
then clicking this should show the results. Equally, if you want to hide
fitted peaks, just uncheck this box and they will disappear.</p>
<p>By clicking Select Peak button the peak picker tool can be activated.
To select a peak simply hold <em>Shift</em> key and left-click on the graph
near the peak&#8217;s center.</p>
<p>To get help selecting the center of the peak, you may set the peak
width by left-click and drag horizontally, while holding <em>Ctrl</em> key
as well. Users may also zoom-in to the graph by holding left-click
and dragging a box on the plot, and zoom-out by left-clicking on
the plot.</p>
<p>When user is happy with the center position of the peak, you may
add the selected peak to <a class="reference internal" href="#expectedpeaks-engineering-diffraction-ref"><em>Parameters</em></a>
list by clicking Add Peak button. User may rerun Fit process by
clearing peaks list using Clear button and manually selecting peaking
using Select Peak button or instead Save the peaks list in <em>CSV</em> file
by clicking Save button.</p>
<p>User may plot single peak fitting workspace in separate window by using
Plot To Separate Window button, if the <em>engggui_fitting_single_peaks</em>
is available.</p>
</div>
</div>
<div class="section" id="gsas-fitting">
<span id="gsas-engineering-diffraction-ref"></span><h2><a class="toc-backref" href="#id15">GSAS Fitting</a><a class="headerlink" href="#gsas-fitting" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is a new capability that is currently in a very
early stage of definition and implementation. Not all
options may be supported and/or consistent at the moment.</p>
</div>
<p>The GSAS tab provides a graphical interface to the Mantid algorithm
<a class="reference internal" href="../algorithms/GSASIIRefineFitPeaks-v1.html#algm-gsasiirefinefitpeaks"><em>GSASIIRefineFitPeaks</em></a>. This allows
users to perform GSAS-style fitting on their data from Mantid.</p>
<p>The user must input the following files:</p>
<ul class="simple">
<li><strong>Focused run file(s)</strong> - these must have been generated either by
the <strong>Fitting</strong> tab or <a class="reference internal" href="../algorithms/EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus</em></a>.</li>
<li><strong>Instrument Parameter File</strong> - contains DIFA and DIFC GSAS
constants, will probably be of <tt class="docutils literal"><span class="pre">.prm</span></tt> format</li>
<li><strong>Phase file(s)</strong> - contain crystallographic information about the
sample in question. Currently only <tt class="docutils literal"><span class="pre">.cif</span></tt> files are supported</li>
</ul>
<p>The following parameters are also required:</p>
<ul class="simple">
<li><strong>New GSAS-II Project</strong> - GSASIIRefineFitPeaks creates a new
<tt class="docutils literal"><span class="pre">.gpx</span></tt> project here, which can be opened and inspected from the
GSAS-II GUI<ul>
<li>Note, if running <strong>Refine All</strong> on more than one run, the run
number and bank ID will be appended to the filename</li>
</ul>
</li>
<li><strong>GSAS-II Installation Directory</strong><ul>
<li>This is the directory containing the GSAS-II executables and
Python libraries. In particular, it must contain
<tt class="docutils literal"><span class="pre">GSASIIscriptable.py</span></tt>. This directory will normally be called
<cite>GSASII</cite>, if GSAS-II was installed normally</li>
<li>You must have a version of GSAS-II from at least <strong>February 2018</strong>
to use the GUI. See <a class="reference internal" href="../algorithms/GSASIIRefineFitPeaks-v1.html#installing-gsasii"><em>Installing GSAS-II</em></a> for how to install a
compatible version</li>
</ul>
</li>
<li><strong>Refinement method</strong> - can either be <strong>Pawley</strong> or
<strong>Rietveld</strong>. Pawley refinement is currently under development, so
Rietveld is recommended.</li>
</ul>
<p>Optionally, you may also supply:</p>
<ul class="simple">
<li><strong>XMin</strong> and <strong>XMax</strong> - the limits (in TOF) to perform fitting
within</li>
<li><strong>DMin</strong> - the minimum dSpacing to use for refinement when
performing Pawley refinement</li>
<li><strong>Negative weight</strong> - The weight for a penalty function applied
during a Pawley refinement on resulting negative intensities.</li>
</ul>
<p>To do a refinement, take the following steps:</p>
<ol class="arabic simple">
<li>Load a run by selecting the focused NeXuS file using the
corresponding <strong>Browse</strong> button, then clicking <strong>Load</strong>. The run
number and bank ID (for example <tt class="docutils literal"><span class="pre">123456_1</span></tt>) should appear in the
<strong>Run Number</strong> list in the <strong>Preview</strong> section. Click the label,
and the run will be plotted</li>
<li>Select your input files, and input any additional parameters in the
<strong>GSASIIRefineFitPeaks Controls</strong> section</li>
<li>Click <strong>Run Refinement</strong>. Once complete, fitted peaks for the run
should be overplotted in the fitting area. In addition, Rwp
(goodness of fit index), Sigma and Gamma (peak broadening
coefficients) and lattice parameters should be displayed in the
<strong>Fit Results</strong> section.<ul>
<li>You can also click <strong>Refine All</strong> to run refinement on all runs
loaded into GSAS tab</li>
</ul>
</li>
</ol>
<p>During the Fit process, <a class="reference internal" href="../algorithms/EnggSaveGSASIIFitResultsToHDF5-v1.html#algm-enggsavegsasiifitresultstohdf5"><em>EnggSaveGSASIIFitResultsToHDF5</em></a> algorithm will be utilised to
save the fit results, and also the parameters used, as a <cite>hdf5</cite>
file. There will be one file per run, indexed by bank ID, and the file
will be found in the <strong>Runs</strong> directory of the user&#8217;s output
directory.</p>
<p>You can toggle the fitted peaks on and off with the <strong>Plot Fitted
Peaks</strong> checkbox, remove runs from the list with the <strong>Remove Run</strong>
button, and plot the run and fitted peaks to a larger, separate plot
using <strong>Plot to separate window</strong>.</p>
</div>
<div class="section" id="settings">
<span id="setting-engineering-diffraction-ref"></span><h2><a class="toc-backref" href="#id16">Settings</a><a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h2>
<p>Controls several settings, including the input folders where the
instrument run files can be found. Other advanced options can also be
controlled to customize the way the underlying calculations are
performed.</p>
<div class="section" id="calibration-parameters">
<h3><a class="toc-backref" href="#id17">Calibration Parameters</a><a class="headerlink" href="#calibration-parameters" title="Permalink to this headline">¶</a></h3>
<p>The calibration settings are organized in three blocks:</p>
<ol class="arabic simple">
<li>Input directories</li>
<li>Pixel (full) calibration</li>
<li>Advanced settings</li>
</ol>
<p>The input directories will be used when looking for run files
(Vanadium and Ceria). They effectively become part of the search path
of Mantid when using this interface.</p>
<p>The pixel (full) calibration file contains the calibration details of
every pixel of all banks, as produced by the algorithm
<a class="reference internal" href="../algorithms/EnggCalibrateFull-v1.html#algm-enggcalibratefull"><em>EnggCalibrateFull</em></a>. A default pixel
calibration file is provided with Mantid packages. This calibration
has been produced for the Vanadium and calibration sample (Ceria) runs
indicated in the name of the calibration file. Note that this
calibration is currently subject to changes, as the fitting of peaks
is being refined.</p>
<p>The Following advanced settings are available to customize the
behavior of this interface:</p>
<dl class="docutils">
<dt>Force recalculate all existing Vanadium files</dt>
<dd>If this is enabled, Vanadium corrections will be recalculated even
if previous correction results are available for the current Vanadium
run number. This is not required unless a modification is done to the
original Vanadium run file, or there is a change in the algorithms
that calculate the corrections</dd>
<dt>Template .prm file</dt>
<dd>By changing this option you can Use a different template file for
the output GSAS IPAR/PAR/PRM that is generated in the Calibration
tab.</dd>
<dt>Rebin for Calibrate</dt>
<dd>This sets a rebin width parameter that can be used by underlying
algorithms such as <a class="reference internal" href="../algorithms/EnggCalibrate-v1.html#algm-enggcalibrate"><em>EnggCalibrate</em></a> and
<a class="reference internal" href="../algorithms/EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus</em></a></dd>
</dl>
</div>
</div>
<div class="section" id="algorithms">
<h2><a class="toc-backref" href="#id18">Algorithms</a><a class="headerlink" href="#algorithms" title="Permalink to this headline">¶</a></h2>
<p>Most of the functionality provided by this interface is based on the
engineering diffraction Mantid algorithms (which are named with the
prefix <em>Engg</em>). This includes <a class="reference internal" href="../algorithms/EnggCalibrate-v1.html#algm-enggcalibrate"><em>EnggCalibrate</em></a>, <a class="reference internal" href="../algorithms/EnggCalibrateFull-v1.html#algm-enggcalibratefull"><em>EnggCalibrateFull</em></a>, <a class="reference internal" href="../algorithms/EnggVanadiumCorrections-v1.html#algm-enggvanadiumcorrections"><em>EnggVanadiumCorrections</em></a>, <a class="reference internal" href="../algorithms/EnggFocus-v1.html#algm-enggfocus"><em>EnggFocus</em></a>,
<a class="reference internal" href="../algorithms/EnggFitPeaks-v1.html#algm-enggfitpeaks"><em>EnggFitPeaks</em></a>
and several other algorithms, explained in detail in the following Mantid
algorithms documentation pages.</p>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Interfaces.html">Interfaces</a> | <a class="reference external" href="../algorithms/categories/Diffraction.html">Diffraction</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="Dynamic PDF Background Remover.html" title="Previous Chapter: Dynamic PDF"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Dynamic PDF</span>
    </a>
  </li>
  <li>
    <a href="Engineering Diffraction Test Guide.html" title="Next Chapter: Engineering Diffraction Testing"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Engineering Diff... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2019-07-22.<br/>
    </p>
  </div>
</footer>
  </body>
</html>