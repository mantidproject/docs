<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SortHKL v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SortPeaksWorkspace v1" href="SortPeaksWorkspace-v1.html" />
    <link rel="prev" title="SortEvents v1" href="SortEvents-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="sorthkl-v1">
<span id="algm-sorthkl"></span><span id="algm-sorthkl-v1"></span><h1>SortHKL v1<a class="headerlink" href="#sorthkl-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/SortHKL-v1_dlg.png"><img alt="../_images/SortHKL-v1_dlg.png" class="screenshot" src="../_images/SortHKL-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>SortHKL</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#source" id="id7">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Sorts a PeaksWorkspace by HKL. Averages intensities using point group.</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="TransformHKL-v1.html#algm-transformhkl"><span class="std std-ref">TransformHKL</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="1%" />
<col width="0%" />
<col width="2%" />
<col width="1%" />
<col width="95%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>An input PeaksWorkspace with an instrument.</td>
</tr>
<tr class="row-odd"><td>PointGroup</td>
<td>Input</td>
<td>string</td>
<td>-1</td>
<td>Which point group applies to this crystal? Allowed values: [‘-1’, ‘-3’, ‘-3 r’, ‘-31m’, ‘-3m’, ‘-3m r’, ‘-3m1’, ‘-4’, ‘-42m’, ‘-43m’, ‘-4m2’, ‘-6’, ‘-62m’, ‘-6m2’, ‘1’, ‘112’, ‘112/m’, ‘11m’, ‘2’, ‘2/m’, ‘222’, ‘23’, ‘2mm’, ‘3’, ‘3 r’, ‘312’, ‘31m’, ‘32’, ‘32 r’, ‘321’, ‘3m’, ‘3m r’, ‘3m1’, ‘4’, ‘4/m’, ‘4/mmm’, ‘422’, ‘432’, ‘4mm’, ‘6’, ‘6/m’, ‘6/mmm’, ‘622’, ‘6mm’, ‘m’, ‘m-3’, ‘m-3m’, ‘m2m’, ‘mm2’, ‘mmm’, ‘-1 (Triclinic)’, ‘-3 (Trigonal - Hexagonal)’, ‘-3 r (Trigonal - Rhombohedral)’, ‘-31m (Trigonal - Hexagonal)’, ‘-3m (Trigonal - Hexagonal)’, ‘-3m r (Trigonal - Rhombohedral)’, ‘-3m1 (Trigonal - Hexagonal)’, ‘-4 (Tetragonal)’, ‘-42m (Tetragonal)’, ‘-43m (Cubic)’, ‘-4m2 (Tetragonal)’, ‘-6 (Hexagonal)’, ‘-62m (Hexagonal)’, ‘-6m2 (Hexagonal)’, ‘1 (Triclinic)’, ‘112 (Monoclinic, unique axis c)’, ‘112/m (Monoclinic, unique axis c)’, ‘11m (Monoclinic, unique axis c)’, ‘2 (Monoclinic, unique axis b)’, ‘2/m (Monoclinic, unique axis b)’, ‘222 (Orthorhombic)’, ‘23 (Cubic)’, ‘2mm (Orthorhombic)’, ‘3 (Trigonal - Hexagonal)’, ‘3 r (Trigonal - Rhombohedral)’, ‘312 (Trigonal - Hexagonal)’, ‘31m (Trigonal - Hexagonal)’, ‘32 (Trigonal - Hexagonal)’, ‘32 r (Trigonal - Rhombohedral)’, ‘321 (Trigonal - Hexagonal)’, ‘3m (Trigonal - Hexagonal)’, ‘3m r (Trigonal - Rhombohedral)’, ‘3m1 (Trigonal - Hexagonal)’, ‘4 (Tetragonal)’, ‘4/m (Tetragonal)’, ‘4/mmm (Tetragonal)’, ‘422 (Tetragonal)’, ‘432 (Cubic)’, ‘4mm (Tetragonal)’, ‘6 (Hexagonal)’, ‘6/m (Hexagonal)’, ‘6/mmm (Hexagonal)’, ‘622 (Hexagonal)’, ‘6mm (Hexagonal)’, ‘m (Monoclinic, unique axis b)’, ‘m-3 (Cubic)’, ‘m-3m (Cubic)’, ‘m2m (Orthorhombic)’, ‘mm2 (Orthorhombic)’, ‘mmm (Orthorhombic)’, ‘222 (Orthorombic)’, ‘mm2 (Orthorombic)’, ‘2mm (Orthorombic)’, ‘m2m (Orthorombic)’, ‘mmm (Orthorombic)’]</td>
</tr>
<tr class="row-even"><td>LatticeCentering</td>
<td>Input</td>
<td>string</td>
<td>P</td>
<td>Appropriate lattice centering for the peaks. Allowed values: [‘P’, ‘C’, ‘A’, ‘B’, ‘I’, ‘F’, ‘Robv’, ‘Rrev’, ‘H’, ‘Primitive’, ‘C-face centred’, ‘A-face centred’, ‘B-face centred’, ‘Body centred’, ‘All-face centred’, ‘Rhombohedrally centred, obverse’, ‘Rhombohedrally centred, reverse’, ‘Hexagonally centred, reverse’]</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td>PeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>Output PeaksWorkspace</td>
</tr>
<tr class="row-even"><td>OutputChi2</td>
<td>Output</td>
<td>number</td>
<td>&#160;</td>
<td>Chi-square is available as output</td>
</tr>
<tr class="row-odd"><td>StatisticsTable</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td>StatisticsTable</td>
<td>An output table workspace for the statistics of the peaks.</td>
</tr>
<tr class="row-even"><td>RowName</td>
<td>Input</td>
<td>string</td>
<td>Overall</td>
<td>name of row</td>
</tr>
<tr class="row-odd"><td>Append</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Append to output table workspace if true. If false, new output table workspace (default).</td>
</tr>
<tr class="row-even"><td>EquivalentIntensities</td>
<td>Input</td>
<td>string</td>
<td>Mean</td>
<td>Replace intensities by mean(default), or median. Allowed values: [‘Mean’, ‘Median’]</td>
</tr>
<tr class="row-odd"><td>SigmaCritical</td>
<td>Input</td>
<td>number</td>
<td>3</td>
<td>Removes peaks whose intensity deviates more than SigmaCritical from the mean (or median).</td>
</tr>
<tr class="row-even"><td>EquivalentsWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>EquivalentIntensities</td>
<td>Output Equivalent Intensities</td>
</tr>
<tr class="row-odd"><td>WeightedZScore</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Use weighted ZScore if true. If false, standard ZScore (default).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>SortHKL calculates some data set statistics using the intensities of the peaks in the
supplied input workspace, such as <span class="math">\(R_{merge}\)</span> and <span class="math">\(R_{p.i.m.}\)</span>, (formulas
and references for example <a class="reference external" href="http://strucbio.biologie.uni-konstanz.de/ccp4wiki/index.php/R-factors">here</a>)
but also redundancy and completeness.</p>
<p>At first, the algorithm determines the minimum and maximum <span class="math">\(d\)</span>-value from the
input peaks. Using these limits, the unit cell, centering and point group all possible
unique reflections are calculated, the number of which is <span class="math">\(N_{theor.}\)</span>.</p>
<p>After removing invalid peaks with <span class="math">\(I \leq 0\)</span>, <span class="math">\(\sigma \leq 0\)</span> and <span class="math">\(h=k=l=0\)</span>,
the peaks are assigned to their respective unique reflection so that each theoretically present
reflection may have <span class="math">\(n\)</span> observations (<span class="math">\(n\)</span> can be zero). The number of unique reflections
which have at least one observation can be labeled <span class="math">\(N_{unique}\)</span>. The completeness
is defined as the fraction <span class="math">\(\frac{N_{unique}}{N_{theor.}}\)</span> and ranges between 0 and 1.
The total number of observations <span class="math">\(N_{observed}\)</span> and <span class="math">\(N_{unique}\)</span> determine the average
redundancy <span class="math">\(\frac{N_{observed}}{N_{unique}}\)</span> in the data set, which is the average number of
observations for each unique reflection.</p>
<p>The intensities of peaks in each reflection are checked for outliers, which are removed. Outliers
in this context are peaks with an intensity that deviates more than <span class="math">\(3\sigma_{hkl}\)</span> from the
mean of the reflection, where <span class="math">\(\sigma_{hkl}\)</span> is the standard deviation of the peak intensities.</p>
<p>The intensities and errors of each peak is set to the mean intensity and sigma of the unique reflection
it belongs to, so that equivalent reflections have the same intensity and error in the output workspace.</p>
<p>Finally, the peaks in the output workspace are sorted by H, K and L.</p>
<p>The EquivalentsWorkspace contains specta that can be plotted for each set of
equivalent intensities.  The X axis is the wavelength and the Y axis is the corrected intensity of the
peaks.  The error is the difference in the intensity of that peak and the average for all equivalent
peaks.  For example, see the 424 equivalent intensities in plot below.  The intensity of the peak at
wavelength 0.5 is marked as an outlier by setting the error to the same value as the intensity.
The average intensity is 21903.</p>
<div class="figure">
<img alt="../_images/EquivalentIntensities.png" src="../_images/EquivalentIntensities.png" />
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The following usage example uses data obtained from a trigonal structure. The peaks are loaded and a <a class="reference internal" href="../concepts/Lattice.html#lattice"><span class="std std-ref">UB matrix</span></a>
is determined. The peaks are transformed to conform with a conventional cell, which has hexagonal metric
and rhombohedral centering:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Load example peak data and find cell</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">LoadIsawPeaks</span><span class="p">(</span><span class="n">Filename</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Peaks5637.integrate&#39;</span><span class="p">)</span>

<span class="n">FindUBUsingFFT</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">MinD</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">MaxD</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">SelectCellWithForm</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">FormNumber</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">OptimizeLatticeForCellType</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span>
                           <span class="n">CellType</span><span class="o">=</span><span class="s1">&#39;Hexagonal&#39;</span><span class="p">,</span> <span class="n">Apply</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">Tolerance</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Run the SortHKL algorithm</span>
<span class="nb">sorted</span><span class="p">,</span> <span class="n">chi2</span><span class="p">,</span> <span class="n">statistics_table</span><span class="p">,</span> <span class="n">equivI</span> <span class="o">=</span> <span class="n">SortHKL</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span> <span class="n">PointGroup</span><span class="o">=</span><span class="s1">&#39;-3m1 (Trigonal - Hexagonal)&#39;</span><span class="p">,</span>
                                         <span class="n">LatticeCentering</span><span class="o">=</span><span class="s1">&#39;Rhombohedrally centred, obverse&#39;</span><span class="p">)</span>

<span class="n">statistics</span> <span class="o">=</span> <span class="n">statistics_table</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data set statistics:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;        Peaks: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sorted</span><span class="o">.</span><span class="n">getNumberPeaks</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;       Unique: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;No. of Unique Reflections&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Completeness: </span><span class="si">{0}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;Data Completeness&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Redundancy: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;Multiplicity&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Data set statistics:
        Peaks: 408
       Unique: 337
 Completeness: 9.11%
   Redundancy: 1.21
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/Peaks.html">Crystal\Peaks</a> | <a class="reference external" href="categories/DataHandling/Text.html">DataHandling\Text</a> | <a class="reference external" href="categories/Utility/Sorting.html">Utility\Sorting</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id7">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5498c57ddbfd1fd2cfdfe331c04b104ba5040e83/Framework/Crystal/inc/MantidCrystal/SortHKL.h">SortHKL.h</a> <em>(last modified: 2021-03-31)</em></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5498c57ddbfd1fd2cfdfe331c04b104ba5040e83/Framework/Crystal/src/SortHKL.cpp">SortHKL.cpp</a> <em>(last modified: 2021-03-31)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SortEvents-v1.html" title="Previous Chapter: SortEvents v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SortEvents v1</span>
    </a>
  </li>
  <li>
    <a href="SortPeaksWorkspace-v1.html" title="Next Chapter: SortPeaksWorkspace v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SortPeaksWorkspace v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-06-03.<br/>
    </p>
  </div>
</footer>
  </body>
</html>