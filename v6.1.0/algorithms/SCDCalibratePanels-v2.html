<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>SCDCalibratePanels v2</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SNAPReduce v1" href="SNAPReduce-v1.html" />
    <link rel="prev" title="SCDCalibratePanels v1" href="SCDCalibratePanels-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="scdcalibratepanels-v2">
<span id="algm-scdcalibratepanels"></span><span id="algm-scdcalibratepanels-v2"></span><h1>SCDCalibratePanels v2<a class="headerlink" href="#scdcalibratepanels-v2" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/SCDCalibratePanels-v2_dlg.png"><img alt="../_images/SCDCalibratePanels-v2_dlg.png" class="screenshot" src="../_images/SCDCalibratePanels-v2_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>SCDCalibratePanels</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a><ul>
<li><a class="reference internal" href="#see-also" id="id3">See Also</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties" id="id4">Properties</a></li>
<li><a class="reference internal" href="#description" id="id5">Description</a></li>
<li><a class="reference internal" href="#usage" id="id6">Usage</a></li>
<li><a class="reference internal" href="#future-development" id="id7">Future Development</a></li>
<li><a class="reference internal" href="#source" id="id8">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Panel parameters and L1 are optimized to minimize errors between theoretical and actual q values for the peaks</p>
<div class="section" id="see-also">
<h3><a class="toc-backref" href="#id3">See Also</a><a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="CalculateUMatrix-v1.html#algm-calculateumatrix"><span class="std std-ref">CalculateUMatrix</span></a></p>
</div>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id4">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="2%" />
<col width="14%" />
<col width="7%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>PeakWorkspace</td>
<td>Input</td>
<td>IPeaksWorkspace</td>
<td><em>Mandatory</em></td>
<td>Workspace of Indexed Peaks</td>
</tr>
<tr class="row-odd"><td>RecalculateUB</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Recalculate UB matrix using given lattice constants</td>
</tr>
<tr class="row-even"><td>a</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Lattice Parameter a (Leave empty to use lattice constants in peaks workspace)</td>
</tr>
<tr class="row-odd"><td>b</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Lattice Parameter b (Leave empty to use lattice constants in peaks workspace)</td>
</tr>
<tr class="row-even"><td>c</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Lattice Parameter c (Leave empty to use lattice constants in peaks workspace)</td>
</tr>
<tr class="row-odd"><td>alpha</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Lattice Parameter alpha in degrees (Leave empty to use lattice constants in peaks workspace)</td>
</tr>
<tr class="row-even"><td>beta</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Lattice Parameter beta in degrees (Leave empty to use lattice constants in peaks workspace)</td>
</tr>
<tr class="row-odd"><td>gamma</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Lattice Parameter gamma in degrees (Leave empty to use lattice constants in peaks workspace)</td>
</tr>
<tr class="row-even"><td>CalibrateT0</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Calibrate the T0 (initial TOF)</td>
</tr>
<tr class="row-odd"><td>CalibrateL1</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Change the L1(source to sample) distance</td>
</tr>
<tr class="row-even"><td>CalibrateBanks</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Calibrate position and orientation of each bank.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><span class="std std-ref">TableWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>The workspace containing the calibration table.</td>
</tr>
<tr class="row-even"><td>DetCalFilename</td>
<td>Input</td>
<td>string</td>
<td>SCDCalibrate2.DetCal</td>
<td>Path to an ISAW-style .detcal file to save. Allowed extensions: [‘.detcal’, ‘.det_cal’]</td>
</tr>
<tr class="row-odd"><td>XmlFilename</td>
<td>Input</td>
<td>string</td>
<td>SCDCalibrate2.xml</td>
<td>Path to an Mantid .xml description(for LoadParameterFile) file to save. Allowed extensions: [‘.xml’]</td>
</tr>
<tr class="row-even"><td>CSVFilename</td>
<td>Input</td>
<td>string</td>
<td>SCDCalibrate2.csv</td>
<td>Path to an .csv file which contains the Calibration Table. Allowed extensions: [‘.csv’]</td>
</tr>
<tr class="row-odd"><td>ToleranceOfTranslation</td>
<td>Input</td>
<td>number</td>
<td>0.0005</td>
<td>Translations in meters found below this value will be set to 0</td>
</tr>
<tr class="row-even"><td>ToleranceOfReorientation</td>
<td>Input</td>
<td>number</td>
<td>0.05</td>
<td>Reorientation (rotation) angles in degree found below this value will be set to 0</td>
</tr>
<tr class="row-odd"><td>TranslationSearchRadius</td>
<td>Input</td>
<td>number</td>
<td>0.05</td>
<td>This is the search radius when calibrating component translations using optimization. For CORELLI instrument, most panels will shift within 5cm, therefore the search radius is set to 5e-2.</td>
</tr>
<tr class="row-even"><td>RotationSearchRadius</td>
<td>Input</td>
<td>number</td>
<td>5</td>
<td>This is the search radius when calibrating component orientations using optimization.  For CORELLI instrument, most panels will wobble within 5 degrees, therefore the default values is set to 5 here.</td>
</tr>
<tr class="row-odd"><td>SourceShiftSearchRadius</td>
<td>Input</td>
<td>number</td>
<td>0.1</td>
<td>This is the search radius when calibrating source shift, L1, using optimization.  For CORELLI instrument, the source shift is often within 10 cm, therefore the default value is set to 0.1.</td>
</tr>
<tr class="row-even"><td>VerboseOutput</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>Toggle of child algorithm console output.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id5">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This calibration algorithm is developed for CORELLI type instrument (pack of tubes).
The calibration targets includes <cite>L_1</cite> (source to sample distance in meters), panel
position (in meters) and orientation (as angle-axis pairs, in degrees), as well as
initial TOF offset (not fully implemented yet).
The underlining mechanism of this calibration is to match the measured Q vectors
(<cite>Q_{sample}</cite>) with the those generated from tweaked instrument position and orientation,
i.e.</p>
<div class="math">
\[\begin{split}\left\vert 2\pi \rm U \rm B \left(
                            \begin{array}{c}
                              NINT(h_i) \\
                              NINT(k_i) \\
                              NINT(l_i) \\
                            \end{array}
                          \right) - \rm Q_{sample,i}(p) \right\vert ^2\end{split}\]</div>
<p>where NINT is the nearest integer function.
To improve the speed of calibration of the whole instrument, openMP was used for calibration
of banks (panels), which can unfortunately leads to out-of-order console logs.
By default, the initial TOF (time of flight) is optimized if the corresponding option
is set to true, followed by the calibration of <cite>L1</cite> as well as all Panels if requested.
If the users are not familiar with the instrument, the options in the advanced control
group should be left untouched as tweaking these paramters can drastically affect the
constrained optimization used under-the-hood.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id6">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># necessary import</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mantid.geometry</span> <span class="kn">import</span> <span class="n">CrystalStructure</span>

<span class="c1"># generate synthetic testing data</span>
<span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;GenericDict&#39;</span><span class="p">,</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())(</span><span class="o">**</span><span class="n">dictionary</span><span class="p">)</span>

<span class="c1"># lattice constant for Si</span>
<span class="c1"># data from Mantid web documentation</span>
<span class="n">lc_silicon</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mf">5.431</span><span class="p">,</span>  <span class="c1"># A</span>
    <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="mf">5.431</span><span class="p">,</span>  <span class="c1"># A</span>
    <span class="s2">&quot;c&quot;</span><span class="p">:</span> <span class="mf">5.431</span><span class="p">,</span>  <span class="c1"># A</span>
    <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>  <span class="c1"># deg</span>
    <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>  <span class="c1"># deg</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>  <span class="c1"># deg</span>
<span class="p">}</span>
<span class="n">silicon</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">lc_silicon</span><span class="p">)</span>
<span class="n">cs_silicon</span> <span class="o">=</span> <span class="n">CrystalStructure</span><span class="p">(</span>
    <span class="n">f</span><span class="s2">&quot;{silicon.a} {silicon.b} {silicon.c}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;F d -3 m&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Si 0 0 0 1.0 0.05&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Generate simulated workspace for CORELLI</span>
<span class="n">CreateSimulationWorkspace</span><span class="p">(</span>
    <span class="n">Instrument</span><span class="o">=</span><span class="s1">&#39;CORELLI&#39;</span><span class="p">,</span>
    <span class="n">BinParams</span><span class="o">=</span><span class="s1">&#39;1,100,10000&#39;</span><span class="p">,</span>
    <span class="n">UnitX</span><span class="o">=</span><span class="s1">&#39;TOF&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cws&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">cws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;cws&#39;</span><span class="p">]</span>

<span class="c1"># Set the UB matrix for the sample</span>
<span class="c1"># u, v is the critical part, we can start with the</span>
<span class="c1"># ideal position</span>
<span class="n">SetUB</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="s2">&quot;cws&quot;</span><span class="p">,</span>
    <span class="n">u</span><span class="o">=</span><span class="s1">&#39;1,0,0&#39;</span><span class="p">,</span>  <span class="c1"># vector along k_i, when goniometer is at 0</span>
    <span class="n">v</span><span class="o">=</span><span class="s1">&#39;0,1,0&#39;</span><span class="p">,</span>  <span class="c1"># in-plane vector normal to k_i, when goniometer is at 0</span>
    <span class="o">**</span><span class="n">lc_silicon</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># set the crystal structure for virtual workspace</span>
<span class="n">cws</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">setCrystalStructure</span><span class="p">(</span><span class="n">cs_silicon</span><span class="p">)</span>

<span class="c1"># tweak L1</span>
<span class="n">dL1</span> <span class="o">=</span> <span class="mf">1.414e-2</span>  <span class="c1"># 1.414cm</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;cws&#39;</span><span class="p">,</span>
    <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;moderator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;X&#39;</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="o">=</span><span class="n">dL1</span><span class="p">,</span>
    <span class="n">RelativePosition</span><span class="o">=</span><span class="n">true</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Generate predicted peak workspace</span>
<span class="n">dspacings</span> <span class="o">=</span> <span class="n">convert</span><span class="p">({</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">})</span>
<span class="n">wavelengths</span> <span class="o">=</span> <span class="n">convert</span><span class="p">({</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">2.9</span><span class="p">})</span>

<span class="c1"># Collect peaks over a range of omegas</span>
<span class="n">CreatePeaksWorkspace</span><span class="p">(</span><span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;pws&#39;</span><span class="p">)</span>
<span class="n">omegas</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">omega</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">omegas</span><span class="p">):</span>
    <span class="n">SetGoniometer</span><span class="p">(</span>
        <span class="n">Workspace</span><span class="o">=</span><span class="s2">&quot;cws&quot;</span><span class="p">,</span>
        <span class="n">Axis0</span><span class="o">=</span><span class="n">f</span><span class="s2">&quot;{omega},0,1,0,1&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">PredictPeaks</span><span class="p">(</span>
        <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;cws&#39;</span><span class="p">,</span>
        <span class="n">WavelengthMin</span><span class="o">=</span><span class="n">wavelengths</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
        <span class="n">wavelengthMax</span><span class="o">=</span><span class="n">wavelengths</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
        <span class="n">MinDSpacing</span><span class="o">=</span><span class="n">dspacings</span><span class="o">.</span><span class="n">min</span><span class="p">,</span>
        <span class="n">MaxDSpacing</span><span class="o">=</span><span class="n">dspacings</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
        <span class="n">ReflectionCondition</span><span class="o">=</span><span class="s1">&#39;All-face centred&#39;</span><span class="p">,</span>
        <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;_pws&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">CombinePeaksWorkspaces</span><span class="p">(</span>
        <span class="n">LHSWorkspace</span><span class="o">=</span><span class="s2">&quot;_pws&quot;</span><span class="p">,</span>
        <span class="n">RHSWorkspace</span><span class="o">=</span><span class="s2">&quot;pws&quot;</span><span class="p">,</span>
        <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;pws&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">pws</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;pws&#39;</span><span class="p">]</span>

<span class="c1"># move the source back to make PWS forget the answer</span>
<span class="n">MoveInstrumentComponent</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="s1">&#39;pws&#39;</span><span class="p">,</span>
    <span class="n">ComponentName</span><span class="o">=</span><span class="s1">&#39;moderator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;X&#39;</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="o">=-</span><span class="n">dL1</span><span class="p">,</span>
    <span class="n">RelativePosition</span><span class="o">=</span><span class="n">true</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># run the calibration on pws</span>
<span class="c1"># similar to actual calibration, where</span>
<span class="c1">#   1. the peaks in side pws knows the correct L1, but info is embeded in Qsamples</span>
<span class="c1">#   2. the recored L1 in instrument Info is the default engineering value</span>
<span class="n">SCDCalibratePanels</span><span class="p">(</span>
    <span class="n">PeakWorkspace</span><span class="o">=</span><span class="s2">&quot;pws&quot;</span><span class="p">,</span>
    <span class="n">a</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
    <span class="n">beta</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">silicon</span><span class="o">.</span><span class="n">gamma</span><span class="p">,</span>
    <span class="n">CalibrateT0</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">CalibrateL1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">CalibrateBanks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s2">&quot;testCaliTable&quot;</span><span class="p">,</span>
    <span class="n">XmlFilename</span><span class="o">=</span><span class="s2">&quot;test.xml&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This calibration should be able to correct the <cite>L1</cite> recorded in the instrument info using
the information embeded in all peaks.</p>
</div>
<div class="section" id="future-development">
<h2><a class="toc-backref" href="#id7">Future Development</a><a class="headerlink" href="#future-development" title="Permalink to this headline">¶</a></h2>
<p>This algorithm is a work-in-progress as the development team as well as the instrument
scientists are working on the following targets:</p>
<ol class="arabic simple">
<li>Fix the current T0 (initial TOF offset) calibration issue for synthetic data where a
constant zero offset was found regardless of the actual prescirbed T0.</li>
<li>The original (version 1) SCDCalibratePanels can also support TOPAZ, which consists of
multi-panels banks.
It is imporant for the new version of SCDCalibratePanels to provide similar support.</li>
<li>In the current implementation, the calibration results are recorded as the absolute
position and orientation of each component, which does not provide an intuitive
representation of the calibration outcome.
Per instrument scientists’ request, a debug-type output where additional information
will be provided in a CSV file, including but not limited to<ol class="loweralpha">
<li>Relative translation and rotation with respect to the engineering position of each
component.</li>
<li>The optimization benchmark and ChiSquare for each component.</li>
<li>The original ISAW app also provide some plots that assist the visualization of calibration
results, which could be useful as part of the debug output.</li>
</ol>
</li>
</ol>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Crystal/Corrections.html">Crystal\Corrections</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id8">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5498c57ddbfd1fd2cfdfe331c04b104ba5040e83/Framework/Crystal/inc/MantidCrystal/SCDCalibratePanels2.h">SCDCalibratePanels2.h</a> <em>(last modified: 2021-03-31)</em></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5498c57ddbfd1fd2cfdfe331c04b104ba5040e83/Framework/Crystal/src/SCDCalibratePanels2.cpp">SCDCalibratePanels2.cpp</a> <em>(last modified: 2021-04-01)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="SCDCalibratePanels-v1.html" title="Previous Chapter: SCDCalibratePanels v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; SCDCalibratePanels v1</span>
    </a>
  </li>
  <li>
    <a href="SNAPReduce-v1.html" title="Next Chapter: SNAPReduce v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SNAPReduce v1 &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-06-03.<br/>
    </p>
  </div>
</footer>
  </body>
</html>