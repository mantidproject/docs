<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ReflectometryBackgroundSubtraction v1</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ReflectometryBeamStatistics v1" href="ReflectometryBeamStatistics-v1.html" />
    <link rel="prev" title="RefinePowderInstrumentParameters v3" href="RefinePowderInstrumentParameters-v3.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="reflectometrybackgroundsubtraction-v1">
<span id="algm-reflectometrybackgroundsubtraction"></span><span id="algm-reflectometrybackgroundsubtraction-v1"></span><h1>ReflectometryBackgroundSubtraction v1<a class="headerlink" href="#reflectometrybackgroundsubtraction-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="id1">
<span id="index-0"></span><a class="screenshot reference internal image-reference" href="../_images/ReflectometryBackgroundSubtraction-v1_dlg.png"><img alt="../_images/ReflectometryBackgroundSubtraction-v1_dlg.png" class="screenshot" src="../_images/ReflectometryBackgroundSubtraction-v1_dlg.png" style="width: 349px;" /></a>
<p class="caption"><span class="caption-text"><strong>ReflectometryBackgroundSubtraction</strong> dialog.</span></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id2">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id3">Properties</a></li>
<li><a class="reference internal" href="#description" id="id4">Description</a></li>
<li><a class="reference internal" href="#usage" id="id5">Usage</a></li>
<li><a class="reference internal" href="#source" id="id6">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id2">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculates and subtracts the background from a given workspace.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id3">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="2%" />
<col width="11%" />
<col width="5%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td><em>Mandatory</em></td>
<td>An input workspace.</td>
</tr>
<tr class="row-odd"><td>InputWorkspaceIndexType</td>
<td>Input</td>
<td>string</td>
<td>&#160;</td>
<td>The type of indices in the optional index set; For optimal performance WorkspaceIndex should be preferred;. Allowed values: [‘WorkspaceIndex’, ‘SpectrumNumber’]</td>
</tr>
<tr class="row-even"><td>ProcessingInstructions</td>
<td>Input</td>
<td>long list</td>
<td>&#160;</td>
<td>An optional set of spectra containing the background. If not set all spectra will be processed. The indices in this list can be workspace indices or spectrum numbers, depending on the selection made for the index type; Indices are entered as a comma-separated list of values, and/or ranges.</td>
</tr>
<tr class="row-odd"><td>BackgroundCalculationMethod</td>
<td>Input</td>
<td>string</td>
<td>PerDetectorAverage</td>
<td>The type of background reduction to perform. Allowed values: [‘PerDetectorAverage’, ‘Polynomial’, ‘AveragePixelFit’]</td>
</tr>
<tr class="row-even"><td>DegreeOfPolynomial</td>
<td>Input</td>
<td>number</td>
<td>0</td>
<td>Degree of the fitted polynomial.</td>
</tr>
<tr class="row-odd"><td>CostFunction</td>
<td>Input</td>
<td>string</td>
<td>Least squares</td>
<td>The cost function to be passed to the Fit algorithm. Allowed values: [‘Least squares’, ‘Unweighted least squares’]</td>
</tr>
<tr class="row-even"><td>PeakRange</td>
<td>Input</td>
<td>long list</td>
<td>&#160;</td>
<td>A set of spectra defining the reflectivity peak. If not set all spectra will be processed. The indices in this list can be workspace indices or spectrum numbers, depending on the InputWorkspaceIndexType</td>
</tr>
<tr class="row-odd"><td>SumPeak</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If True, the resulting peak will be summed</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><span class="std std-ref">MatrixWorkspace</span></a></td>
<td>&#160;</td>
<td>The output workspace containing the InputWorkspace with the background removed.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id4">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm calculates and subtracts the background from a given workspace using the spectrum ranges in <code class="docutils literal"><span class="pre">ProcessingInstructions</span></code>. If no spectrum ranges are given the whole input workspace is used.</p>
<p>The background can be calculated using three methods. <strong>PerDetectorAverage</strong> which groups the background spectrum together and divides it by the total number of spectra.
This is done using <a class="reference internal" href="GroupDetectors-v2.html#algm-groupdetectors"><span class="std std-ref">GroupDetectors v2</span></a>. This is then subtracted from the input workspace. <strong>Polynomial</strong> uses <a class="reference internal" href="Transpose-v1.html#algm-transpose"><span class="std std-ref">Transpose v1</span></a> so the spectrum numbers
are in the X (horizontal) axis and TOF channels are the vertical axis. Then the background is calculated by fitting a polynomial of the given degree to each TOF using the background spectra given
in <code class="docutils literal"><span class="pre">InputWorkspaceIndexSet</span></code>. This is done using <a class="reference internal" href="CalculatePolynomialBackground-v1.html#algm-calculatepolynomialbackground"><span class="std std-ref">CalculatePolynomialBackground v1</span></a>. The minimizer used is ‘Levenberg-Marquardt’ and the value of CostFunction is passed to <a class="reference internal" href="CalculatePolynomialBackground-v1.html#algm-calculatepolynomialbackground"><span class="std std-ref">CalculatePolynomialBackground v1</span></a> as-is.
The default option for the CostFunction is ‘Least squares’ which uses the histogram errors as weights. This might not be desirable, e.g. when there are bins with zero counts and zero errors.
An ‘Unweighted least squares’ option is available to deal with such cases. Once this has been done the workspace is then transposed again and subtracted from the input workspace.
<strong>AveragePixelFit</strong> uses <a class="reference internal" href="RefRoi-v1.html#algm-refroi"><span class="std std-ref">RefRoi v1</span></a> to sum the background region on either side of the peak and finding average of these regions. Then the average is subtracted from
the sum of the whole region of interest of the detector. It takes the background range from the <code class="docutils literal"><span class="pre">ProcessingInstructions</span></code> and the <code class="docutils literal"><span class="pre">PeakRange</span></code> which is the range of pixels containing the peak.
Note when using the average pixel fit method the background must only be one region either side of the peak. If any more regions are given the background will be taken as all the spectra between the highest and lowest spectra entered excluding the peak.
This is done using <a class="reference internal" href="LRSubtractAverageBackground-v1.html#algm-lrsubtractaveragebackground"><span class="std std-ref">LRSubtractAverageBackground v1</span></a>.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id5">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Subtracting background using Per detector average:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">dataX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">background</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">peak</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">dataY</span> <span class="o">=</span> <span class="n">background</span> <span class="o">+</span> <span class="n">peak</span> <span class="o">+</span> <span class="n">background</span>
<span class="c1">#workspace has a background of 2 and a peak of 5 in the 2nd index</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span><span class="p">,</span> <span class="n">NSpec</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">ws_bkg_subtr</span> <span class="o">=</span> <span class="n">ReflectometryBackgroundSubtraction</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ProcessingInstructions</span> <span class="o">=</span> <span class="s2">&quot;0,1,3,4&quot;</span><span class="p">,</span> <span class="n">BackgroundCalculationMethod</span> <span class="o">=</span> <span class="s2">&quot;PerDetectorAverage&quot;</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peak height with background: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">ws_bkg_subtr</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background subtracted peak height: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Peak height with background: 5.0
Background subtracted peak height: 3.0
</pre></div>
</div>
<p><strong>Example - Subtracting background using Polynomial:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>

<span class="c1">#create a workspace with a polynomial background of degree 2 and a peak of 5 in the 5th spectra</span>
<span class="n">dataX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">polynomial</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">peak</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">dataY</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">polynomial</span><span class="p">,</span> <span class="n">peak</span><span class="p">)]</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span><span class="n">dataX</span><span class="p">,</span> <span class="n">dataY</span><span class="p">,</span> <span class="n">NSpec</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span>

<span class="n">ws_bkg_subtr</span> <span class="o">=</span> <span class="n">ReflectometryBackgroundSubtraction</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">InputWorkspaceIndexType</span><span class="o">=</span><span class="s1">&#39;SpectrumNumber&#39;</span><span class="p">,</span> <span class="n">ProcessingInstructions</span> <span class="o">=</span> <span class="s2">&quot;1-4,6-9&quot;</span><span class="p">,</span> <span class="n">BackgroundCalculationMethod</span> <span class="o">=</span> <span class="s2">&quot;Polynomial&quot;</span><span class="p">,</span> <span class="n">DegreeOfPolynomial</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Peak height with background: </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">ws_bkg_subtr</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background subtracted peak height: </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Peak height with background: 22.0
Background subtracted peak height: 5.0
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/AlgorithmIndex.html">AlgorithmIndex</a> | <a class="reference external" href="categories/Reflectometry.html">Reflectometry</a> | <a class="reference external" href="categories/Reflectometry/ISIS.html">Reflectometry\ISIS</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id6">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5498c57ddbfd1fd2cfdfe331c04b104ba5040e83/Framework/Reflectometry/inc/MantidReflectometry/ReflectometryBackgroundSubtraction.h">ReflectometryBackgroundSubtraction.h</a> <em>(last modified: 2021-03-31)</em></p>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/5498c57ddbfd1fd2cfdfe331c04b104ba5040e83/Framework/Reflectometry/src/ReflectometryBackgroundSubtraction.cpp">ReflectometryBackgroundSubtraction.cpp</a> <em>(last modified: 2021-03-31)</em></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="RefinePowderInstrumentParameters-v3.html" title="Previous Chapter: RefinePowderInstrumentParameters v3"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; RefinePowderI...</span>
    </a>
  </li>
  <li>
    <a href="ReflectometryBeamStatistics-v1.html" title="Next Chapter: ReflectometryBeamStatistics v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Reflectometry... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-06-03.<br/>
    </p>
  </div>
</footer>
  </body>
</html>