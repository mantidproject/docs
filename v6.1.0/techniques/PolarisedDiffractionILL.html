<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Data reduction for D7 instrument at the ILL</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '6.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SANS TOML Files" href="SANS-Toml-v1.html" />
    <link rel="prev" title="ISIS Reflectometry" href="ISIS_Reflectometry.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>6.1</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://docs.mantidproject.org/nightly/">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <p><span class="math">\(\renewcommand\AA{\unicode{x212B}}\)</span></p>
<div class="section" id="data-reduction-for-d7-instrument-at-the-ill">
<span id="polariseddiffractionill"></span><h1>Data reduction for D7 instrument at the ILL<a class="headerlink" href="#data-reduction-for-d7-instrument-at-the-ill" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="simple">
<li><a class="reference internal" href="#reduction-workflow-and-recommendations" id="id17">Reduction workflow and recommendations</a><ul>
<li><a class="reference internal" href="#reduction-basics" id="id18">Reduction basics</a></li>
<li><a class="reference internal" href="#wavelength-and-position-calibration" id="id19">Wavelength and position calibration</a></li>
<li><a class="reference internal" href="#transmission-calculation" id="id20">Transmission calculation</a><ul>
<li><a class="reference internal" href="#workflow-diagrams-and-working-example" id="id21">Workflow diagrams and working example</a></li>
<li><a class="reference internal" href="#absorber" id="id22">Absorber</a></li>
<li><a class="reference internal" href="#empty-container" id="id23">Empty container</a></li>
<li><a class="reference internal" href="#transmission" id="id24">Transmission</a></li>
</ul>
</li>
<li><a class="reference internal" href="#polarisation-correction" id="id25">Polarisation correction</a><ul>
<li><a class="reference internal" href="#workflow-diagram-and-working-example" id="id26">Workflow diagram and working example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vanadium-data-reduction" id="id27">Vanadium data reduction</a><ul>
<li><a class="reference internal" href="#reduction-workflow" id="id28">Reduction workflow</a></li>
<li><a class="reference internal" href="#self-attenuation-correction" id="id29">Self-attenuation correction</a></li>
<li><a class="reference internal" href="#output" id="id30">Output</a></li>
<li><a class="reference internal" href="#id7" id="id31">Workflow diagrams and working example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sample-data-reduction" id="id32">Sample data reduction</a><ul>
<li><a class="reference internal" href="#cross-section-separation" id="id33">Cross-section separation</a></li>
<li><a class="reference internal" href="#sample-data-normalisation" id="id34">Sample data normalisation</a></li>
<li><a class="reference internal" href="#id13" id="id35">Output</a></li>
<li><a class="reference internal" href="#id14" id="id36">Workflow diagrams and working example</a></li>
<li><a class="reference internal" href="#sample-reduction" id="id37">Sample reduction</a></li>
<li><a class="reference internal" href="#sample-normalisation" id="id38">Sample normalisation</a></li>
<li><a class="reference internal" href="#references" id="id39">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>There are three workflow algorithms supporting data reduction at ILL’s D7 polarised diffraction and spectroscopy instrument. These algorithms are:</p>
<dl class="docutils">
<dt><a class="reference internal" href="../algorithms/D7YIGPositionCalibration-v1.html#algm-d7yigpositioncalibration"><span class="std std-ref">D7YIGPositionCalibration v1</span></a></dt>
<dd>Performs wavelength and position calibraiton for D7 instrument banks and individual detectors in banks.</dd>
<dt><a class="reference internal" href="../algorithms/PolDiffILLReduction-v1.html#algm-poldiffillreduction"><span class="std std-ref">PolDiffILLReduction v1</span></a></dt>
<dd>Performs data reduction and produces the unnormalised sample cross-sections in one of the available units.</dd>
<dt><a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections v1</span></a></dt>
<dd>Performs cross-section separation into nuclear coherent, spin-incoherent and magnetic components, and does the data normalisation.</dd>
</dl>
<p>Together with the other algorithms and services provided by the Mantid framework, the reduction algorithms can handle a number of reduction scenarios. If this proves insufficient, however, the algorithms can be accessed using Python. Before making modifications it is recommended to copy the source files and rename the algorithms as not to break the original behavior.</p>
<p>This document tries to give an overview on how the algorithms work together via Python examples. Please refer to the algorithm documentation for details of each individual algorithm.</p>
<div class="section" id="reduction-workflow-and-recommendations">
<h2><a class="toc-backref" href="#id17">Reduction workflow and recommendations</a><a class="headerlink" href="#reduction-workflow-and-recommendations" title="Permalink to this headline">¶</a></h2>
<p>A description of the usage of the algorithms for the D7 data reduction is presented along with several possible workflows, depending on the number of desired corrections and the type of normalisation.</p>
<div class="section" id="reduction-basics">
<h3><a class="toc-backref" href="#id18">Reduction basics</a><a class="headerlink" href="#reduction-basics" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p>A very basic reduction would include a vanadium reference and a sample, without any corrections or position and wavelength calibration, and follow the steps:</p>
<ol class="arabic simple">
<li>Reduce vanadium data.</li>
<li>Reduce sample data.</li>
<li>Run normalisation with vanadium reduction output as input.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Define vanadium properties:</span>
<span class="n">vanadiumProperties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FormulaUnits&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;SampleMass&#39;</span><span class="p">:</span> <span class="mf">8.54</span><span class="p">,</span> <span class="s1">&#39;FormulaUnitMass&#39;</span><span class="p">:</span> <span class="mf">50.94</span><span class="p">}</span>

<span class="c1"># Vanadium reduction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span><span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396993&#39;</span><span class="p">,</span> <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span><span class="p">,</span> <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Sum&#39;</span><span class="p">,</span>
                    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;reduced_vanadium&#39;</span><span class="p">,</span>
                    <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">vanadiumProperties</span><span class="p">)</span>

<span class="c1"># Define the number of formula units for the sample</span>
<span class="n">sampleProperties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FormulaUnits&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;SampleMass&#39;</span><span class="p">:</span> <span class="mf">2.932</span><span class="p">,</span> <span class="s1">&#39;FormulaUnitMass&#39;</span><span class="p">:</span> <span class="mf">182.54</span><span class="p">}</span>
<span class="c1"># Sample reduction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span><span class="n">Run</span><span class="o">=</span><span class="s1">&#39;397004&#39;</span><span class="p">,</span> <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Sample&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;reduced_sample&#39;</span><span class="p">,</span>
                        <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">sampleProperties</span><span class="p">)</span>

<span class="c1"># normalise sample and set the output to absolute units with vanadium</span>
<span class="n">D7AbsoluteCrossSections</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;reduced_sample&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;normalised_sample&#39;</span><span class="p">,</span>
                        <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">sampleProperties</span><span class="p">,</span>
                        <span class="n">NormalisationMethod</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span><span class="p">,</span> <span class="n">VanadiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;reduced_vanadium&#39;</span><span class="p">)</span>

<span class="n">SofQ</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;normalised_sample&#39;</span><span class="p">]</span>
<span class="n">xAxis</span> <span class="o">=</span> <span class="n">SofQ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># TwoTheta axis</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dS/dOmega (TwoTheta) detector position range: </span><span class="si">{:.2f}</span><span class="s1">...</span><span class="si">{:.2f}</span><span class="s1"> (degrees)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xAxis</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xAxis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>dS/dOmega (TwoTheta) detector position range: 13.14...144.06 (degrees)
</pre></div>
</div>
</div>
<div class="section" id="wavelength-and-position-calibration">
<h3><a class="toc-backref" href="#id19">Wavelength and position calibration</a><a class="headerlink" href="#wavelength-and-position-calibration" title="Permalink to this headline">¶</a></h3>
<p>The first step of working with D7 data is to ensure that there exist a proper calibration of the wavelength, bank positions, and detector positions relative to their bank. This calibration can be either taken from a previous experiment performed in comparable conditions or obtained from the <span class="math">\(\text{Y}_{3}\text{Fe}_{5}\text{O}_{12}\)</span> (YIG) scan data using a dedicated algorithm <a class="reference internal" href="../algorithms/D7YIGPositionCalibration-v1.html#algm-d7yigpositioncalibration"><span class="std std-ref">D7YIGPositionCalibration</span></a>. The method follows the description presented in Ref. <a class="footnote-reference" href="#fennell" id="id1">[1]</a>.</p>
<p>This algorithm performs wavelength and position calibration for both individual detectors and detector banks using measurement of a sample of powdered YIG. This data is fitted with Gaussian distributions at the expected peak positions. The output is an <a class="reference internal" href="../concepts/InstrumentParameterFile.html#instrumentparameterfile"><span class="std std-ref">Instrument Parameter File</span></a> readable by the <a class="reference internal" href="../algorithms/LoadILLPolarizedDiffraction-v1.html#algm-loadillpolarizeddiffraction"><span class="std std-ref">LoadILLPolarizedDiffraction</span></a> algorithm that will place the detector banks and detectors using the output of this algorithm.</p>
<p>The provided YIG d-spacing values are loaded from an XML list. The default d-spacing distribution for YIG available in Mantid in <cite>D7_YIG_peaks.xml</cite> file is coming from Ref. <a class="footnote-reference" href="#nakatsuka" id="id2">[2]</a>.
As long as this d-spacing list is sufficient and does not require changes, the <cite>YIGPeaksFile</cite> property does not need to be specified. The peak positions are converted into <span class="math">\(2\theta\)</span> positions using the initial assumption of the neutron wavelength. YIG peaks in the detector’s scan are fitted separately using a Gaussian distribution.</p>
<p>The workspace containing the peak fitting results is then fitted using a <cite>Multidomain</cite> function of the form:</p>
<div class="math">
\[2\theta_{\text{fit}} = m \cdot (2.0 \cdot \text{asin} ( \lambda / 2d ) + offset_{\text{pixel}} + offset_{\text{bank}}),\]</div>
<p>where <cite>m</cite> is the bank slope, <span class="math">\(offset_{\text{pixel}}\)</span> is the relative offset to the initial assumption of the position inside the detector bank, and <span class="math">\(offset_{\text{bank}}\)</span> is the offset of the entire bank. This function allows to extract the information about the wavelength, detector bank slopes and offsets, and the distribution of detector offsets.</p>
<p>It is strongly advised to first run the <a class="reference internal" href="../algorithms/D7YIGPositionCalibration-v1.html#algm-d7yigpositioncalibration"><span class="std std-ref">D7YIGPositionCalibration</span></a> algorithm with the <cite>FittingMethod</cite> set to <cite>None</cite>, so that the initial guesses for the positions of the YIG Bragg peaks can be inspected and corrected if needed. Assuming the first python code-block below is used for this purpose, the workspace name to use for inspection of the initial guesses is named <cite>peak_fits_fitting_test</cite>. There, the initial guesses for individual detectors can be checked against the measured YIG Bragg peaks distribution. The correction can be done by changing the bank offsets, changing the desired peaks width and the minimal distance between them.</p>
<p>To save time in this iterative process, <cite>InputWorkspace</cite> property can be specified instead of <cite>Filenames</cite>. This way, the 2D distribution of measured intensities does not have to be created each time from loaded data but can be cached and reused for time saving. To profit from this feature, comment the <cite>Filenames</cite> property and uncomment the <cite>InputWorkspace</cite> in the first example below.</p>
<p><strong>Example - D7YIGPositionCalibration - initial guess check before fitting at the shortest wavelength</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">approximate_wavelength</span> <span class="o">=</span> <span class="s1">&#39;3.1&#39;</span> <span class="c1"># Angstrom</span>
<span class="n">D7YIGPositionCalibration</span><span class="p">(</span>
             <span class="n">Filenames</span><span class="o">=</span><span class="s1">&#39;402652:403041&#39;</span><span class="p">,</span>
<span class="c1">#            InputWorkspace=&#39;conjoined_input_fitting_test&#39;,</span>
             <span class="n">ApproximateWavelength</span><span class="o">=</span><span class="n">approximate_wavelength</span><span class="p">,</span>
             <span class="n">YIGPeaksFile</span><span class="o">=</span><span class="s1">&#39;D7_YIG_peaks.xml&#39;</span><span class="p">,</span>
             <span class="n">MinimalDistanceBetweenPeaks</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
             <span class="n">BraggPeakWidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
             <span class="n">BankOffsets</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
             <span class="n">MaskedBinsRange</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
             <span class="n">FittingMethod</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
             <span class="n">ClearCache</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">FitOutputWorkspace</span><span class="o">=</span><span class="s1">&#39;fitting_test&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Example - D7YIGPositionCalibration - calibration at the shortest wavelength</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">approximate_wavelength</span> <span class="o">=</span> <span class="s1">&#39;3.1&#39;</span> <span class="c1"># Angstrom</span>
<span class="n">D7YIGPositionCalibration</span><span class="p">(</span><span class="n">Filenames</span><span class="o">=</span><span class="s1">&#39;402652:403041&#39;</span><span class="p">,</span> <span class="n">ApproximateWavelength</span><span class="o">=</span><span class="n">approximate_wavelength</span><span class="p">,</span>
                            <span class="n">YIGPeaksFile</span><span class="o">=</span><span class="s1">&#39;D7_YIG_peaks.xml&#39;</span><span class="p">,</span> <span class="n">CalibrationOutputFile</span><span class="o">=</span><span class="s1">&#39;test_shortWavelength.xml&#39;</span><span class="p">,</span>
                            <span class="n">MinimalDistanceBetweenPeaks</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">BankOffsets</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">MaskedBinsRange</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span> <span class="n">FittingMethod</span><span class="o">=</span><span class="s1">&#39;Global&#39;</span><span class="p">,</span> <span class="n">ClearCache</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">FitOutputWorkspace</span><span class="o">=</span><span class="s1">&#39;shortWavelength&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;The calibrated wavelength is: {0:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">approximate_wavelength</span><span class="p">)</span><span class="o">*</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;shortWavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;The bank2 gradient is: {0:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;shortWavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;The bank3 gradient is: {0:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;shortWavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">176</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;The bank4 gradient is: {0:.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;shortWavelength&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">352</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="transmission-calculation">
<h3><a class="toc-backref" href="#id20">Transmission calculation</a><a class="headerlink" href="#transmission-calculation" title="Permalink to this headline">¶</a></h3>
<p>The transmission (T) is calculated using counts measured by monitor 2 (M2), and according to the following formula:</p>
<div class="math">
\[T = \frac{S - E_{Cd}}{E - E_{Cd}},\]</div>
<p>where <span class="math">\(S\)</span> is M2 counts measured with the current sample, <span class="math">\(E_{Cd}\)</span> is counts when cadmium absorber is measured, and <span class="math">\(E\)</span> is counts from the direct beam.</p>
<p>The measurement of the cadmium absorber is optional and does not have to be provided as input for the transmission to be calculated. However, it allows
to take into account dark currents in the readout system electronics and thus this measurement is advised to be included in transmission calculations.</p>
<p>It is possible to provide more than one numor as input for the transmission calculation. In such a case, the input workspaces are averaged.</p>
<p>The output of the transmission calculation is given as a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> with a single workspace containing a single value of the calculated polarisation.</p>
<div class="section" id="workflow-diagrams-and-working-example">
<h4><a class="toc-backref" href="#id21">Workflow diagrams and working example</a><a class="headerlink" href="#workflow-diagrams-and-working-example" title="Permalink to this headline">¶</a></h4>
<p>Below are the relevant workflow diagrams describing reduction steps of the transmission calculation.</p>
</div>
<div class="section" id="absorber">
<h4><a class="toc-backref" href="#id22">Absorber</a><a class="headerlink" href="#absorber" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/PolDiffILLReduction-v1_absorber_wkflw.png" src="../_images/PolDiffILLReduction-v1_absorber_wkflw.png" />
</div>
<div class="section" id="empty-container">
<h4><a class="toc-backref" href="#id23">Empty container</a><a class="headerlink" href="#empty-container" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/PolDiffILLReduction-v1_beam_wkflw.png" src="../_images/PolDiffILLReduction-v1_beam_wkflw.png" />
</div>
<div class="section" id="transmission">
<h4><a class="toc-backref" href="#id24">Transmission</a><a class="headerlink" href="#transmission" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/PolDiffILLReduction-v1_transmission_wkflw.png" src="../_images/PolDiffILLReduction-v1_transmission_wkflw.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - transmission calculation for quartz sample</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Beam with cadmium absorber, used for transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396991&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;BeamWithCadmium&#39;</span>
<span class="p">)</span>
<span class="c1"># Beam measurement for transmisison</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396983&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;EmptyBeam&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cadmium absorber transmission is </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

<span class="c1"># Quartz transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396985&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Quartz transmission is </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;quartz_transmission_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Cadmium absorber transmission is 0.011
Quartz transmission is 0.700
</pre></div>
</div>
</div>
</div>
<div class="section" id="polarisation-correction">
<h3><a class="toc-backref" href="#id25">Polarisation correction</a><a class="headerlink" href="#polarisation-correction" title="Permalink to this headline">¶</a></h3>
<p>The polarisation correction is estimated using quartz sample. The scattering is purely diffuse and, to a good approximation, non-spin flip.
Ideally, the quartz should have the same geometry and attenuation as the sample as then the same gauge volume of the beam is measured
and the reduction will give an accurate estimation of the polarizing efficiency. However, the correction is usually fairly insensitive to small
differences in the polarizing efficiency and choosing the quartz to have the same outer dimensions is normally satisfactory. Multiple scattering
is not a problem, as the correction is given by a ratio and there is no spin-flip scattering to depolarize the beam. The polarization efficiencies
are calculated from ratios of non-spin-flip to spin-flip scattering, hence absolute numbers are not necessary.</p>
<p>First, the data is normalised to monitor 1 (M1). Then, if the necessary inputs of empty container and absorber (please note this is a different measurement
than mentioned in the <cite>Transmission</cite> section) measurements are provided, the background can be subtracted from the data:</p>
<div class="math">
\[\dot{I_{B}} = \dot{I} - T\dot{E} - (1-T) \dot{C},\]</div>
<p>where <span class="math">\(\dot{I}\)</span> denotes monitor-normalised quartz data, <span class="math">\(T\)</span> is transmission, and <span class="math">\(\dot{E}\)</span> and <span class="math">\(\dot{C}\)</span> are the normalised counts
measured with empty container and cadmium absorber, respectively.</p>
<p>In the case where either absorber or empty container inputs are not provided, this correction is not performed.</p>
<p>Finally, the polariser-analyser efficiency can be calculated, using the following formula:</p>
<div class="math">
\[\phi = \frac{\dot{I_{B}}(00) - \dot{I_{B}}(01)}{(2f_{p}-1) \dot{I_{B}}(00) + \dot{I_{B}}(01)},\]</div>
<p>where <span class="math">\(f_{p}\)</span> is the flipper efficiency, currently assumed to be 1.0, and <span class="math">\(\dot{I_{B}}(00)\)</span> and <span class="math">\(\dot{I_{B}}(01)\)</span> denote normalised
and background-subtracted data with flipper states off and on respectively.</p>
<p>The output is given in as a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> with the number of entries consistent with the number of measured polarisation directions.
Each workspace in the group contains a single value of the polariser-analyser efficiency per detector. The flipping ratios are also available for inspection
in a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> named <cite>flipping_ratios</cite>.</p>
<div class="section" id="workflow-diagram-and-working-example">
<h4><a class="toc-backref" href="#id26">Workflow diagram and working example</a><a class="headerlink" href="#workflow-diagram-and-working-example" title="Permalink to this headline">¶</a></h4>
<p>Below is the relevant workflow diagram describing reduction steps of the quartz reduction.</p>
<img alt="../_images/PolDiffILLReduction-v1_quartz_wkflw.png" src="../_images/PolDiffILLReduction-v1_quartz_wkflw.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - full treatment of a sample</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Beam with cadmium absorber, used for transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396991&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;BeamWithCadmium&#39;</span>
<span class="p">)</span>

<span class="c1"># Beam measurement for transmisison</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396983&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;EmptyBeam&#39;</span>
<span class="p">)</span>

<span class="c1"># Quartz transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396985&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>

<span class="c1"># Empty container</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396917&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Empty&#39;</span>
<span class="p">)</span>

<span class="c1"># Absorber</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396928&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Cadmium&#39;</span>
<span class="p">)</span>

<span class="c1"># Polarisation correction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396939&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections&#39;</span><span class="p">,</span>
    <span class="n">CadmiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">EmptyInputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">TransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission_1&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Average&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Quartz&#39;</span>
<span class="p">)</span>

<span class="n">SumSpectra</span><span class="p">(</span><span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections_ZPO_0&#39;</span><span class="p">,</span> <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span>
           <span class="n">StartWorkspaceIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">EndWorkspaceIndex</span><span class="o">=</span><span class="mi">131</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The average polarisation efficiency in the Z direction is </span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">132.0</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>The average polarisation efficiency in the Z direction is 0.90
</pre></div>
</div>
</div>
</div>
<div class="section" id="vanadium-data-reduction">
<h3><a class="toc-backref" href="#id27">Vanadium data reduction</a><a class="headerlink" href="#vanadium-data-reduction" title="Permalink to this headline">¶</a></h3>
<p>Vanadium provides a measure of the relative detector efficiencies and its count rate can be used for the calibration
of sample data to absolute units. Multiple scattering and sample self-attenuation are issues here and the correction
works best if the vanadium has, as close as possible, the same attenuation and shape as the sample.</p>
<p>The scattering from the vanadium is considered to be purely elastic scattering and the cross-section considered to be purely
due to the nuclear spin-incoherent contribution. The reduced vanadium data can be used to normalise the results of the sample
data reduction in <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a>. The vanadium data can also be used as a consistency
check for polarization and multiple scattering corrections.</p>
<p>If the sample has a large nuclear-spin-incoherent cross-section, this separated cross-section can be used as a self-correction for detector
efficiency and even for shape effects from the sample. If the sample stoichiometry is well-known and an accurate estimate for the
nuclear-spin-incoherent cross-section can be derived, this cross-section can be used to express the sample data in absolute units.
In this case, the vanadium cross-section is unnecessary.</p>
<p>For the best results of using the reduced vanadium data as input for sample data normalisation, the <cite>OutputTreatment</cite> property of the
<a class="reference internal" href="../algorithms/PolDiffILLReduction-v1.html#algm-poldiffillreduction"><span class="std std-ref">PolDiffILLReduction</span></a> algorithm needs to be set to <cite>Sum</cite>.</p>
<div class="section" id="reduction-workflow">
<h4><a class="toc-backref" href="#id28">Reduction workflow</a><a class="headerlink" href="#reduction-workflow" title="Permalink to this headline">¶</a></h4>
<p>The first two steps of the reduction of vanadium data are the same as for quartz, with normalisation to the monitor and background
subtraction (provided the necessary inputs). The polarisation efficiency of the instrument can be corrected using the previously reduced
quartz data. The correction is applied according to the following formula:</p>
<div class="math">
\[\begin{split}\begin{bmatrix}
    \dot{I_{B}}(+) \\
    \dot{I_{B}}(-) \\
\end{bmatrix} = \frac{1}{2 f_{p} \phi}  \begin{bmatrix}
                                        (1-\phi)(1-f_{p}) + f_{p}(1+\phi) &amp; -(1-\phi) \\
                                        -(1+\phi)(1-f_{p}) - f_{p}(1-\phi) &amp; (1+\phi) \\
                                        \end{bmatrix}  \begin{bmatrix}
                                                           \dot{I_{B}}(0) \\
                                                           \dot{I_{B}}(1) \\
                                                       \end{bmatrix},\end{split}\]</div>
<p>where <span class="math">\(\dot{I_{B}}(+)\)</span> and <span class="math">\(\dot{I_{B}}(-)\)</span> denote the spin-flip and the non-spin-flip scattering events, respectively,
and <span class="math">\(\dot{I_{B}}(0)\)</span> and <span class="math">\(\dot{I_{B}}(1)\)</span> are the events with the flipper state on and off, respectively.</p>
</div>
<div class="section" id="self-attenuation-correction">
<h4><a class="toc-backref" href="#id29">Self-attenuation correction</a><a class="headerlink" href="#self-attenuation-correction" title="Permalink to this headline">¶</a></h4>
<p>There are three ways the self-attenuation of a sample can be taken into account in the implemented D7 reduction: <cite>Numerical</cite>, <cite>MonteCarlo</cite>, and <cite>User</cite>.
In all three cases, the correction is applied to data with <a class="reference internal" href="../algorithms/ApplyPaalmanPingsCorrection-v1.html#algm-applypaalmanpingscorrection"><span class="std std-ref">ApplyPaalmanPingsCorrection</span></a> algorithm.</p>
<p>The <cite>User</cite> option depends on the self-attenuation parameters provided by the user through <cite>SampleSelfAttenuationFactors</cite> property of the <a class="reference internal" href="../algorithms/PolDiffILLReduction-v1.html#algm-poldiffillreduction"><span class="std std-ref">PolDiffILLReduction</span></a>
algorithm. This option allows to study the self-attenuation of a sample that can have arbitrary shape separately from running the reduction algorithm,
and in more detail if necessary.</p>
<p>On the contrary, The <cite>Numerical</cite> and <cite>MonteCarlo</cite> options calculate the self-attenuation parameters for both the sample and its container during the execution of
the reduction algorithm. These two options depend on Mantid algorithms <a class="reference internal" href="../algorithms/PaalmanPingsAbsorptionCorrection-v1.html#algm-paalmanpingsabsorptioncorrection"><span class="std std-ref">PaalmanPingsAbsorptionCorrection</span></a>
and <a class="reference internal" href="../algorithms/PaalmanPingsMonteCarloAbsorption-v1.html#algm-paalmanpingsmontecarloabsorption"><span class="std std-ref">PaalmanPingsMonteCarloAbsorption</span></a>, respectively. These two algorithms require multiple parameters describing
the sample and its environment, such as the geometry, density, and chemical composition to be defined. The communication of these parameters is done
via <cite>SampleAndEnvironmentProperties</cite> property of the <a class="reference internal" href="../algorithms/PolDiffILLReduction-v1.html#algm-poldiffillreduction"><span class="std std-ref">PolDiffILLReduction</span></a> algorithm. All the necessary and accepted keys that
need to be defined for the sample self-attenuation to be properly corrected are described below.</p>
<p>The <cite>SampleAndEnvironmentProperties</cite> property of the <a class="reference internal" href="../algorithms/PolDiffILLReduction-v1.html#algm-poldiffillreduction"><span class="std std-ref">PolDiffILLReduction</span></a> algorithm is a dictionary containing
all of the information about the sample and its environment. This information is used in self-attenuation calculations and also can be reused
in data normalisation in the <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a> algorithm.</p>
<p>The complete list of keys can is summarised below:</p>
<p>Sample-only keys:</p>
<ul class="simple">
<li><em>SampleMass</em></li>
<li><em>FormulaUnits</em></li>
<li><em>FormulaUnitMass</em></li>
<li><em>SampleChemicalFormula</em></li>
<li><em>SampleDensity</em></li>
<li><em>Height</em></li>
</ul>
<p>The first three keys need to be always defined, so that the number of moles of the sample can be calculated, to ensure proper data normalisation.
All of the density parameters are <strong>number density in formula units</strong>.</p>
<p>Container-only keys:</p>
<ul class="simple">
<li><em>ContainerChemicalFormula</em></li>
<li><em>ContainerDensity</em></li>
</ul>
<p>Optional beam-only keys, if not user-defined will be automatically defined to be larger than the sample dimensions:</p>
<ul class="simple">
<li><em>BeamHeight</em></li>
<li><em>BeamWidth</em></li>
</ul>
<p>Then, depending on the chosen sample geometry, additional parameters need to be defined:</p>
<ul class="simple">
<li>For FlatPlate:<ul>
<li><em>SampleThickness</em></li>
<li><em>SampleWidth</em></li>
<li><em>SampleCenter</em></li>
<li><em>SampleAngle</em></li>
<li><em>ContainerFrontThickness</em></li>
<li><em>ContainerBackThickness</em></li>
</ul>
</li>
<li>For Cylinder:<ul>
<li><em>SampleRadius</em></li>
<li><em>ContainerRadius</em></li>
</ul>
</li>
<li>For Annulus:<ul>
<li><em>SampleInnerRadius</em></li>
<li><em>SampleOuterRadius</em></li>
<li><em>ContainerInnerRadius</em></li>
<li><em>ContainerOuterRadius</em></li>
</ul>
</li>
</ul>
<p>Depending on the choice of the self-attenuation method, either <cite>ElementSize</cite> in case of numerical calculations or <cite>EventsPerPoint</cite> for Monte-Carlo method
need to be defined.</p>
<p>Optional keys:</p>
<ul class="simple">
<li><em>InitialEnergy</em> - if not provided, the value will be calculated from the wavelength in the SampleLogs</li>
<li><em>NMoles</em> - if not provided, the value will be calculated based on the <em>SampleMass</em> and <em>FormulaUnitMass</em></li>
</ul>
</div>
<div class="section" id="output">
<h4><a class="toc-backref" href="#id30">Output</a><a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h4>
<p>The corrected counts in each each detector are normalised to the expected total cross-section for vanadium
of <span class="math">\(0.404 \frac{\text{barn}}{\text{steradian} \cdot \text{atom}}\)</span>. The output of vanadium reduction
is a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> with one entry if the <cite>OutputTreatment</cite> is set to <cite>Sum</cite>, or
the same number of entries as input data if <cite>Individual</cite> was selected.</p>
<p>In case it is desireable to separate cross-sections, for example for diagnostic purposes, it can be done
using the reduced data described as above using <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a>
algorithm. More details on working with this algorithm are given in the sample normalisation section.</p>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id31">Workflow diagrams and working example</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>Below is the relevant workflow diagram describing reduction steps of the vanadium reduction.</p>
<img alt="../_images/PolDiffILLReduction-v1_vanadium_wkflw.png" src="../_images/PolDiffILLReduction-v1_vanadium_wkflw.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Vanadium reduction with annulus geometry</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vanadium_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SampleMass&#39;</span><span class="p">:</span><span class="mf">8.54</span><span class="p">,</span><span class="s1">&#39;FormulaUnits&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;FormulaUnitMass&#39;</span><span class="p">:</span><span class="mf">50.94</span><span class="p">,</span><span class="s1">&#39;SampleChemicalFormula&#39;</span><span class="p">:</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;Height&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;SampleDensity&#39;</span><span class="p">:</span><span class="mf">0.118</span><span class="p">,</span><span class="s1">&#39;SampleInnerRadius&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;SampleOuterRadius&#39;</span><span class="p">:</span><span class="mf">2.49</span><span class="p">,</span>
                       <span class="s1">&#39;BeamWidth&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span><span class="s1">&#39;BeamHeight&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span>
                       <span class="s1">&#39;ContainerChemicalFormula&#39;</span><span class="p">:</span><span class="s1">&#39;Al&#39;</span><span class="p">,</span><span class="s1">&#39;ContainerDensity&#39;</span><span class="p">:</span><span class="mf">0.0027</span><span class="p">,</span><span class="s1">&#39;ContainerOuterRadius&#39;</span><span class="p">:</span><span class="mf">2.52</span><span class="p">,</span>
                       <span class="s1">&#39;ContainerInnerRadius&#39;</span><span class="p">:</span><span class="mf">1.99</span><span class="p">,</span> <span class="s1">&#39;EventsPerPoint&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">}</span>

<span class="n">calibration_file</span><span class="o">=</span><span class="s1">&#39;D7_YIG_calibration.xml&#39;</span> <span class="c1"># example calibration file</span>

<span class="c1"># Beam with cadmium absorber, used for transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396991&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;BeamWithCadmium&#39;</span>
<span class="p">)</span>
<span class="c1"># Beam measurement for transmisison</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396983&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;EmptyBeam&#39;</span>
<span class="p">)</span>

<span class="c1"># Quartz transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396985&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>

<span class="c1"># Empty container</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396917&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Empty&#39;</span>
<span class="p">)</span>

<span class="c1"># Absorber</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396928&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Cadmium&#39;</span>
<span class="p">)</span>

<span class="c1"># Polarisation correction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396939&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections&#39;</span><span class="p">,</span>
    <span class="n">CadmiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">EmptyInputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">TransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission_1&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Average&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Quartz&#39;</span>
<span class="p">)</span>

<span class="c1"># Vanadium transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396990&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_transmission&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Vanadium transmission is </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;vanadium_transmission_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

<span class="c1"># Vanadium reduction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396993&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">EmptyInputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">TransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_transmission_1&#39;</span><span class="p">,</span>
    <span class="n">QuartzInputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Sum&#39;</span><span class="p">,</span>
    <span class="n">SelfAttenuationMethod</span><span class="o">=</span><span class="s1">&#39;MonteCarlo&#39;</span><span class="p">,</span>
    <span class="n">SampleGeometry</span><span class="o">=</span><span class="s1">&#39;Annulus&#39;</span><span class="p">,</span>
    <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">vanadium_dictionary</span><span class="p">,</span>
    <span class="n">InstrumentCalibration</span><span class="o">=</span><span class="n">calibration_file</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The vanadium reduction output contains </span><span class="si">{}</span><span class="s2"> entry with </span><span class="si">{}</span><span class="s2"> spectra and </span><span class="si">{}</span><span class="s2"> bin.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;vanadium_ws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">(),</span>
          <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;vanadium_ws&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">(),</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;vanadium_ws&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Vanadium transmission is 0.886
The vanadium reduction output contains 1 entry with 132 spectra and 1 bin.
</pre></div>
</div>
</div>
</div>
<div class="section" id="sample-data-reduction">
<h3><a class="toc-backref" href="#id32">Sample data reduction</a><a class="headerlink" href="#sample-data-reduction" title="Permalink to this headline">¶</a></h3>
<p>The sample data reduction follows the same steps of monitor normalisation, background subtraction, polarisation correction, and
self-attenuation correction as vanadium data reduction. Should the self-attenuation correction be taken into account, the relevant
sample and environment parameters need to be defined in a dictionary that is provided to <cite>SampleAndEnvironmentProperty</cite> with
keys described in the vanadium reduction section.</p>
<p>The output of the  is a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> with the number of entries equal to number of measured polarisations
times number of steps in a <span class="math">\(2\theta\)</span> scan. This output can be provided to <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a>
for cross-section separation, e.g. for diagnostic purposes, or for the final normalisation.</p>
<div class="section" id="cross-section-separation">
<h4><a class="toc-backref" href="#id33">Cross-section separation</a><a class="headerlink" href="#cross-section-separation" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a> algorithm allows for either cross-section separation or sample data
normalisation. It is possible to use only one of the possibilities, for example, to separate cross-sections of the reduced vanadium
data without the normalisation subroutines to be invoked. This is especially useful for diagnostic purposes.</p>
<p>The cross-section separation is done according to formulae presented in Ref. <a class="footnote-reference" href="#sharpf" id="id10">[3]</a> <a class="footnote-reference" href="#steward" id="id11">[4]</a> <a class="footnote-reference" href="#ehlers" id="id12">[5]</a>. More details on the exact calculations is given in
documentation of the <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a> algorithm. It is possible to perform uniaxial,
6-point (or XYZ), and 10-point measurement separation of magnetic, nuclear coherent, and nuclear-spin-incoherent components of the total
measured scattering cross-section. The specifics of the 10-point measurement as a set of two separate 6-point measurements are taken into account.
In that case, the second set of 6-point data needs to be provided to <cite>RotatedXYZWorkspace</cite> property of the <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a>
algorithm, and the ‘10-p’ needs to be chosen as the <cite>CrossSectionSeparationMethod</cite>.</p>
</div>
<div class="section" id="sample-data-normalisation">
<h4><a class="toc-backref" href="#id34">Sample data normalisation</a><a class="headerlink" href="#sample-data-normalisation" title="Permalink to this headline">¶</a></h4>
<p>The output from sample data reduction still needs to be normalised to the relevant standard to set the units to absolute scale.
The normalisation is handled by <a class="reference internal" href="../algorithms/D7AbsoluteCrossSections-v1.html#algm-d7absolutecrosssections"><span class="std std-ref">D7AbsoluteCrossSections</span></a> algorithm, and there are three
options available to normalise the sample data:</p>
<ol class="arabic">
<li><p class="first">Vanadium normalisation</p>
<p>Uses output from the vanadium data reduction. The units chosen for both the sample and vanadium data during reduction should agree.</p>
</li>
<li><p class="first">Paramagnetic normalisation</p>
<p>This normalisation approach uses the output from the cross-section separation to set the sample output to absolute units. An additional parameter
needs to be defined in the sample properties dictionary, named <cite>SampleSpin</cite>, to define the spin of the sample.</p>
</li>
<li><p class="first">Spin-incoherent normalisation</p>
<p>This normalisation approach also uses the output from the cross-section separation. If the goal is to set the output data to absolute scale,
an additional parameter needs to be defined in the sample properties dictionary, named <cite>IncoherentCrossSection</cite>, to provide the total
nuclear-spin-incoherent cross-section of the sample.</p>
</li>
</ol>
<p>In all cases, a relative normalisation to the detector with highest number of counts is always performed.</p>
</div>
<div class="section" id="id13">
<h4><a class="toc-backref" href="#id35">Output</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>The output of the reduction and normalisation is a <a class="reference internal" href="../concepts/WorkspaceGroup.html#workspacegroup"><span class="std std-ref">WorkspaceGroup</span></a> with the number of entries consistent with the input
if the <cite>OutputTreatment</cite> property was selected to be <cite>Individual</cite>, or the number of entries will be consistent with either the number of polarisation
orientations present in the data (e.g. six for a XYZ method) or the number of separated cross-section.
Each entry of the output group is a workspace with X-axis unit being either momentum exchange <span class="math">\(Q\)</span> or the scattering angle <span class="math">\(2\theta\)</span>.</p>
</div>
<div class="section" id="id14">
<h4><a class="toc-backref" href="#id36">Workflow diagrams and working example</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>Below is the relevant workflow diagram describing reduction steps of the sample reduction and normalisation.</p>
</div>
<div class="section" id="sample-reduction">
<h4><a class="toc-backref" href="#id37">Sample reduction</a><a class="headerlink" href="#sample-reduction" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/PolDiffILLReduction-v1_sample_wkflw.png" src="../_images/PolDiffILLReduction-v1_sample_wkflw.png" />
</div>
<div class="section" id="sample-normalisation">
<h4><a class="toc-backref" href="#id38">Sample normalisation</a><a class="headerlink" href="#sample-normalisation" title="Permalink to this headline">¶</a></h4>
<img alt="../_images/D7AbsoluteCrossSections-v1_wkflw.png" src="../_images/D7AbsoluteCrossSections-v1_wkflw.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To run these usage examples please first download the
<a class="reference external" href="https://sourceforge.net/projects/mantid/files/Sample%20Data/UsageData.zip/download">usage data</a>,
and add these to your path. In Mantid this is done using <a class="reference external" href="http://www.mantidproject.org/ManageUserDirectories">Manage User Directories</a>.</p>
</div>
<p><strong>Example - Complete sample reduction with normalisation</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vanadium_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SampleMass&#39;</span><span class="p">:</span><span class="mf">8.54</span><span class="p">,</span><span class="s1">&#39;FormulaUnits&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;FormulaUnitMass&#39;</span><span class="p">:</span><span class="mf">50.94</span><span class="p">}</span>

<span class="n">sample_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SampleMass&#39;</span><span class="p">:</span><span class="mf">2.932</span><span class="p">,</span><span class="s1">&#39;SampleDensity&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;FormulaUnits&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;FormulaUnitMass&#39;</span><span class="p">:</span><span class="mf">182.56</span><span class="p">,</span>
                     <span class="s1">&#39;SampleChemicalFormula&#39;</span><span class="p">:</span><span class="s1">&#39;Mn0.5-Fe0.5-P-S3&#39;</span><span class="p">,</span><span class="s1">&#39;Height&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span><span class="s1">&#39;SampleDensity&#39;</span><span class="p">:</span><span class="mf">0.118</span><span class="p">,</span>
                     <span class="s1">&#39;SampleInnerRadius&#39;</span><span class="p">:</span><span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;SampleOuterRadius&#39;</span><span class="p">:</span><span class="mf">2.49</span><span class="p">,</span><span class="s1">&#39;BeamWidth&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span><span class="s1">&#39;BeamHeight&#39;</span><span class="p">:</span><span class="mf">2.5</span><span class="p">,</span>
                     <span class="s1">&#39;ContainerChemicalFormula&#39;</span><span class="p">:</span><span class="s1">&#39;Al&#39;</span><span class="p">,</span><span class="s1">&#39;ContainerDensity&#39;</span><span class="p">:</span><span class="mf">0.027</span><span class="p">,</span><span class="s1">&#39;ContainerOuterRadius&#39;</span><span class="p">:</span><span class="mf">2.52</span><span class="p">,</span>
                     <span class="s1">&#39;ContainerInnerRadius&#39;</span><span class="p">:</span><span class="mf">1.99</span><span class="p">,</span> <span class="s1">&#39;ElementSize&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">}</span>

<span class="n">calibration_file</span> <span class="o">=</span> <span class="s1">&#39;D7_YIG_calibration.xml&#39;</span>

<span class="c1"># Beam with cadmium absorber, used for transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396991&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;BeamWithCadmium&#39;</span>
<span class="p">)</span>
<span class="c1"># Beam measurement for transmisison</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396983&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;EmptyBeam&#39;</span>
<span class="p">)</span>

<span class="c1"># Quartz transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396985, 396986&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>

<span class="c1"># Empty container</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396917, 396918&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Empty&#39;</span>
<span class="p">)</span>

<span class="c1"># Cadmium absorber</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396928, 396929&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Cadmium&#39;</span>
<span class="p">)</span>

<span class="c1"># Polarisation correction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396939, 396940&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections&#39;</span><span class="p">,</span>
    <span class="n">CadmiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">EmptyInputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">TransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;quartz_transmission_1&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Average&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Quartz&#39;</span>
<span class="p">)</span>

<span class="c1"># Vanadium transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396990&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_transmission&#39;</span><span class="p">,</span>
    <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
    <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>

<span class="c1"># Vanadium reduction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396993, 396994&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">EmptyInputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">TransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_transmission_1&#39;</span><span class="p">,</span>
    <span class="n">QuartzInputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Sum&#39;</span><span class="p">,</span>
    <span class="n">SampleGeometry</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
    <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">vanadium_dictionary</span><span class="p">,</span>
    <span class="n">AbsoluteNormalisation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">InstrumentCalibration</span><span class="o">=</span><span class="n">calibration_file</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span>
<span class="p">)</span>
<span class="c1"># Sample transmission</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
   <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;396986, 396987&#39;</span><span class="p">,</span>
   <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_transmission&#39;</span><span class="p">,</span>
   <span class="n">CadmiumTransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_transmission_ws_1&#39;</span><span class="p">,</span>
   <span class="n">BeamInputWorkspace</span><span class="o">=</span><span class="s1">&#39;beam_ws_1&#39;</span><span class="p">,</span>
   <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Transmission&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sample transmission is </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_transmission_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">readY</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>

<span class="c1"># Sample reduction</span>
<span class="n">PolDiffILLReduction</span><span class="p">(</span>
    <span class="n">Run</span><span class="o">=</span><span class="s1">&#39;397004, 397005&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_ws&#39;</span><span class="p">,</span>
    <span class="n">CadmiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;cadmium_ws&#39;</span><span class="p">,</span>
    <span class="n">EmptyInputWorkspace</span><span class="o">=</span><span class="s1">&#39;empty_ws&#39;</span><span class="p">,</span>
    <span class="n">TransmissionInputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_transmission_1&#39;</span><span class="p">,</span>
    <span class="n">QuartzInputWorkspace</span><span class="o">=</span><span class="s1">&#39;pol_corrections&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Individual&#39;</span><span class="p">,</span>
    <span class="n">InstrumentCalibration</span><span class="o">=</span><span class="n">calibration_file</span><span class="p">,</span>
    <span class="n">SelfAttenuationMethod</span><span class="o">=</span><span class="s1">&#39;Numerical&#39;</span><span class="p">,</span>
    <span class="n">SampleGeometry</span><span class="o">=</span><span class="s1">&#39;Annulus&#39;</span><span class="p">,</span>
    <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">sample_dictionary</span><span class="p">,</span>
    <span class="n">ProcessAs</span><span class="o">=</span><span class="s1">&#39;Sample&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The reduced sample data contains </span><span class="si">{}</span><span class="s2"> entries with </span><span class="si">{}</span><span class="s2"> spectra and </span><span class="si">{}</span><span class="s2"> bins.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_ws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">(),</span>
          <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_ws&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">(),</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_ws&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>

<span class="c1"># Normalise sample data</span>
<span class="n">D7AbsoluteCrossSections</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_ws&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s1">&#39;sample_norm&#39;</span><span class="p">,</span>
    <span class="n">CrossSectionSeparationMethod</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
    <span class="n">NormalisationMethod</span><span class="o">=</span><span class="s1">&#39;Vanadium&#39;</span><span class="p">,</span>
    <span class="n">VanadiumInputWorkspace</span><span class="o">=</span><span class="s1">&#39;vanadium_ws&#39;</span><span class="p">,</span>
    <span class="n">OutputTreatment</span><span class="o">=</span><span class="s1">&#39;Merge&#39;</span><span class="p">,</span>
    <span class="n">OutputUnits</span><span class="o">=</span><span class="s1">&#39;TwoTheta&#39;</span><span class="p">,</span>
    <span class="n">ScatteringAngleBinSize</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="c1"># degrees</span>
    <span class="n">SampleAndEnvironmentProperties</span><span class="o">=</span><span class="n">sample_dictionary</span><span class="p">,</span>
    <span class="n">AbsoluteUnitsNormalisation</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The normalised sample data contains </span><span class="si">{}</span><span class="s2"> entries with </span><span class="si">{}</span><span class="s2"> spectrum and </span><span class="si">{}</span><span class="s2"> bins.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberOfEntries</span><span class="p">(),</span>
          <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_norm&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">(),</span> <span class="n">mtd</span><span class="p">[</span><span class="s1">&#39;sample_norm&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">blocksize</span><span class="p">()))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Sample transmission is 0.962
The reduced sample data contains 12 entries with 132 spectra and 1 bins.
The normalised sample data contains 6 entries with 1 spectrum and 134 bins.
</pre></div>
</div>
</div>
<div class="section" id="references">
<h4><a class="toc-backref" href="#id39">References</a><a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h4>
<table class="docutils footnote" frame="void" id="fennell" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>T. Fennell, L. Mangin-Thro, H.Mutka, G.J. Nilsen, A.R. Wildes.
<em>Wavevector and energy resolution of the polarized diffuse scattering spectrometer D7</em>,
Nuclear Instruments and Methods in Physics Research A <strong>857</strong> (2017) 24–30
<a class="reference external" href="https://doi.org/10.1016/j.nima.2017.03.024">doi: 10.1016/j.nima.2017.03.024</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="nakatsuka" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>A. Nakatsuka, A. Yoshiasa, and S. Takeno.
<em>Site preference of cations and structural variation in Y3Fe5O12 solid solutions with garnet structure</em>,
Acta Crystallographica Section B <strong>51</strong> (1995) 737–745
<a class="reference external" href="https://doi.org/10.1107/S0108768194014813">doi: 10.1107/S0108768194014813</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="sharpf" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[3]</a></td><td>Scharpf, O. and Capellmann, H.
<em>The XYZ‐Difference Method with Polarized Neutrons and the Separation of Coherent, Spin Incoherent, and Magnetic Scattering Cross Sections in a Multidetector</em>
Physica Status Solidi (A) <strong>135</strong> (1993) 359-379
<a class="reference external" href="https://doi.org/10.1002/pssa.2211350204">doi: 10.1002/pssa.2211350204</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="steward" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[4]</a></td><td>Stewart, J. R. and Deen, P. P. and Andersen, K. H. and Schober, H. and Barthelemy, J.-F. and Hillier, J. M. and Murani, A. P. and Hayes, T. and Lindenau, B.
<em>Disordered materials studied using neutron polarization analysis on the multi-detector spectrometer, D7</em>
Journal of Applied Crystallography <strong>42</strong> (2009) 69-84
<a class="reference external" href="https://doi.org/10.1107/S0021889808039162">doi: 10.1107/S0021889808039162</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="ehlers" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[5]</a></td><td>G. Ehlers, J. R. Stewart, A. R. Wildes, P. P. Deen, and K. H. Andersen
<em>Generalization of the classical xyz-polarization analysis technique to out-of-plane and inelastic scattering</em>
Review of Scientific Instruments <strong>84</strong> (2013), 093901
<a class="reference external" href="https://doi.org/10.1063/1.4819739">doi: 10.1063/1.4819739</a></td></tr>
</tbody>
</table>
<p><strong>Category</strong>: <a class="reference external" href="categories/Techniques.html">Techniques</a></p>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="ISIS_Reflectometry.html" title="Previous Chapter: ISIS Reflectometry"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; ISIS Reflectometry</span>
    </a>
  </li>
  <li>
    <a href="SANS-Toml-v1.html" title="Next Chapter: SANS TOML Files"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">SANS TOML Files &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
      Last updated on 2021-06-03.<br/>
    </p>
  </div>
</footer>
  </body>
</html>