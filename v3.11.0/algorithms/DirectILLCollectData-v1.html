<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DirectILLCollectData v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DirectILLDiagnostics v1" href="DirectILLDiagnostics-v1.html" />
    <link rel="prev" title="DirectILLApplySelfShielding v1" href="DirectILLApplySelfShielding-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.11</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="directillcollectdata-v1">
<span id="algm-directillcollectdata"></span><span id="algm-directillcollectdata-v1"></span><h1>DirectILLCollectData v1<a class="headerlink" href="#directillcollectdata-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DirectILLCollectData-v1_dlg.png"><img alt="../_images/DirectILLCollectData-v1_dlg.png" class="screenshot" src="../_images/DirectILLCollectData-v1_dlg.png" style="width: 262px;" /></a>
<p class="caption"><strong>DirectILLCollectData</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#input-data" id="id4">Input data</a></li>
<li><a class="reference internal" href="#basic-reduction-steps" id="id5">Basic reduction steps</a><ul>
<li><a class="reference internal" href="#normalisation-to-monitor" id="id6">Normalisation to monitor</a></li>
<li><a class="reference internal" href="#flat-background-subtraction" id="id7">Flat background subtraction</a></li>
<li><a class="reference internal" href="#elastic-peak-positions-epp" id="id8">Elastic peak positions (EPP)</a></li>
<li><a class="reference internal" href="#incident-energy-calibration" id="id9">Incident energy calibration</a></li>
<li><a class="reference internal" href="#tof-axis-adjustment" id="id10">TOF axis adjustment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#optional-inputs-and-outputs" id="id11">Optional inputs and outputs</a><ul>
<li><a class="reference internal" href="#raw-output-workspace" id="id12">Raw output workspace</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id13">Usage</a></li>
<li><a class="reference internal" href="#source" id="id14">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>An initial step of the reduction workflow for the direct geometry TOF spectrometers at ILL.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="3%" />
<col width="15%" />
<col width="9%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Run</td>
<td>Input</td>
<td>list of str lists</td>
<td>&nbsp;</td>
<td>An input run number (or a list thereof) or a filename. Allowed values: [&#8216;nxs&#8217;]</td>
</tr>
<tr class="row-odd"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Input workspace if no run is given.</td>
</tr>
<tr class="row-even"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td><em>Mandatory</em></td>
<td>The output of the algorithm.</td>
</tr>
<tr class="row-odd"><td>Cleanup</td>
<td>Input</td>
<td>string</td>
<td>Cleanup ON</td>
<td>What to do with intermediate workspaces. Allowed values: [&#8216;Cleanup ON&#8217;, &#8216;Cleanup OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>SubalgorithmLogging</td>
<td>Input</td>
<td>string</td>
<td>Logging OFF</td>
<td>Enable or disable subalgorithms to print in the logs. Allowed values: [&#8216;Logging OFF&#8217;, &#8216;Logging ON&#8217;]</td>
</tr>
<tr class="row-odd"><td>EPPWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Table workspace containing results from the FindEPP algorithm.</td>
</tr>
<tr class="row-even"><td>EPPCreationMethod</td>
<td>Input</td>
<td>string</td>
<td>EPP Method AUTO</td>
<td>Method to create the EPP table for detectors (monitor is awlays fitted) if EPPWorkspace is not given. Allowed values: [&#8216;EPP Method AUTO&#8217;, &#8216;Fit EPP&#8217;, &#8216;Calculate EPP&#8217;]</td>
</tr>
<tr class="row-odd"><td>SigmaForCalculatedEPP</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Nominal sigma for the EPP table when EPPCreationMethod is set to Calculate EPP (default: 10 times the first bin width).</td>
</tr>
<tr class="row-even"><td>ElasticChannel</td>
<td>Input</td>
<td>string</td>
<td>Elastic Channel AUTO</td>
<td>How to acquire the elastic channel. Allowed values: [&#8216;Elastic Channel AUTO&#8217;, &#8216;Default Elastic Channel&#8217;, &#8216;Fit Elastic Channel&#8217;]</td>
</tr>
<tr class="row-odd"><td>ElasticChannelWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A single value workspace containing the elatic channel index. Overrides ElasticChannel.</td>
</tr>
<tr class="row-even"><td>Monitor</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Index of the incident monitor, if not specified in instrument parameters.</td>
</tr>
<tr class="row-odd"><td>IncidentEnergyCalibration</td>
<td>Input</td>
<td>string</td>
<td>Energy Calibration AUTO</td>
<td>Control the incident energy calibration. Allowed values: [&#8216;Energy Calibration AUTO&#8217;, &#8216;Energy Calibration ON&#8217;, &#8216;Energy Calibration OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>IncidentEnergyWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>A single-valued workspace holding the calibrated incident energy.</td>
</tr>
<tr class="row-odd"><td>FlatBkg</td>
<td>Input</td>
<td>string</td>
<td>Flat Bkg AUTO</td>
<td>Control flat background subtraction. Allowed values: [&#8216;Flat Bkg AUTO&#8217;, &#8216;Flat Bkg ON&#8217;, &#8216;Flat Bkg OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>FlatBkgScaling</td>
<td>Input</td>
<td>number</td>
<td>1</td>
<td>Flat background scaling constant</td>
</tr>
<tr class="row-odd"><td>FlatBkgAveragingWindow</td>
<td>Input</td>
<td>number</td>
<td>30</td>
<td>Running average window width (in bins) for flat background.</td>
</tr>
<tr class="row-even"><td>FlatBkgWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Workspace from which to get flat background data.</td>
</tr>
<tr class="row-odd"><td>Normalisation</td>
<td>Input</td>
<td>string</td>
<td>Normalisation Monitor</td>
<td>Normalisation method. Allowed values: [&#8216;Normalisation Monitor&#8217;, &#8216;Normalisation Time&#8217;, &#8216;Normalisation OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>MonitorPeakWidthInSigmas</td>
<td>Input</td>
<td>number</td>
<td>3</td>
<td>Width of the monitor peak in multiples  of &#8216;Sigma&#8217; in monitor&#8217;s EPP table.</td>
</tr>
<tr class="row-odd"><td>OutputRawWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td>&nbsp;</td>
<td>Output the merged runs or InputWorkspace as is.</td>
</tr>
<tr class="row-even"><td>OutputElasticChannelWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td>&nbsp;</td>
<td>Output workspace for elastic channel index.</td>
</tr>
<tr class="row-odd"><td>OutputEPPWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Output workspace for elastic peak positions.</td>
</tr>
<tr class="row-even"><td>OutputIncidentEnergyWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td>&nbsp;</td>
<td>Output workspace for calibrated inciden energy.</td>
</tr>
<tr class="row-odd"><td>OutputFlatBkgWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td>&nbsp;</td>
<td>Output workspace for flat background.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm preprocesses data for the other algorithms in <a class="reference internal" href="../techniques/DirectILL.html#directill"><em>ILL&#8217;s time-of-flight data reduction suite</em></a>. Thus, it is usually the first algorithm to call in the reduction process. The algorithm (optionally) loads data from disk, performs some common basic data reduction steps to the raw data, and provides other workspaces, such as flat background information, which can be used in subsequent reduction steps. The workflow of the algorithm is shown in the diagram below:</p>
<img alt="../_images/DirectILLCollectData-v1_wkflw.png" src="../_images/DirectILLCollectData-v1_wkflw.png" />
<div class="section" id="input-data">
<h3><a class="toc-backref" href="#id4">Input data</a><a class="headerlink" href="#input-data" title="Permalink to this headline">¶</a></h3>
<p>Either <em>Run</em> or <em>InputWorkspace</em> has to be specified. <em>Run</em> can take multiple run numbers. In this case the files will be merged using the <a class="reference internal" href="MergeRuns-v1.html#algm-mergeruns"><em>MergeRuns</em></a> algorihtm. For example, <cite>&#8216;/data/0100:0103,0200:0202&#8217;</cite> would merge runs 100, 101, 102, 103, 200, 201 and 202 from directory <cite>/data/</cite>.</p>
</div>
<div class="section" id="basic-reduction-steps">
<h3><a class="toc-backref" href="#id5">Basic reduction steps</a><a class="headerlink" href="#basic-reduction-steps" title="Permalink to this headline">¶</a></h3>
<p>Some basic reduction steps are done to the input data.</p>
<ol class="arabic simple">
<li>Separate monitor and detector spectra to different workspaces.</li>
<li>Optionally normalise the detector specta to monitor counts or acquisition time.</li>
<li>Subtract time-independent background from the detector spectra.</li>
<li>Optionally find the elastic peak positions.</li>
<li>Optionally calibrate the incident energy.</li>
<li>Adjust the TOF axis so that the elastic time-of-flight corresponds to the L1+L2 distances.</li>
<li>Find elastic peak positions again, if <em>OutputEPPWorkspace</em> is requested.</li>
</ol>
<p>More detailed description of some of these steps is given below.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The initial time-of-flight axis of ILL&#8217;s spectrometers has an arbitrary starting point. Therefore, the TOF values in the intermediate workspaces do not correspond to any physical flight distances until they are corrected at step 6.</p>
</div>
<div class="section" id="normalisation-to-monitor">
<h4><a class="toc-backref" href="#id6">Normalisation to monitor</a><a class="headerlink" href="#normalisation-to-monitor" title="Permalink to this headline">¶</a></h4>
<p>If <em>Normalisation</em> is set to &#8216;Normalisation Monitor&#8217;, the monitor spectrum specified by the &#8216;default-incident-monitor-spectrum&#8217; instrument parameter is used for normalisation. If the parameter is not present, the <em>Monitor</em> property is used. A flat background is subtracted from the spectrum (no scaling applied), and it is integrated over the range specified by <em>ElasticPeakWidthInSigmas</em>. The monitor peak is found using <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><em>FindEPP</em></a>. If <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><em>FindEPP</em></a> fails to find a peak in the monitor spectrum, the entire monitor range is integrated.</p>
<p>Afterwards, the counts are scaled by a factor defined by the &#8216;scaling_after_monitor_normalisation&#8217; entry in instrument parameters, if present.</p>
</div>
<div class="section" id="flat-background-subtraction">
<h4><a class="toc-backref" href="#id7">Flat background subtraction</a><a class="headerlink" href="#flat-background-subtraction" title="Permalink to this headline">¶</a></h4>
<p>A flat time-independent background for subtraction can be given by <em>FlatBkgWorkspace</em>. If this input property is not specified, flat background will be calculated from the detector spectra by (<a class="reference internal" href="CalculateFlatBackground-v1.html#algm-calculateflatbackground"><em>CalculateFlatBackground</em></a>) using the &#8216;Moving Average&#8217; mode. The <em>FlatBkgAveragingWindow</em> property is passed directly to (<a class="reference internal" href="CalculateFlatBackground-v1.html#algm-calculateflatbackground"><em>CalculateFlatBackground</em></a>) as <em>AveragingWindowWidth</em>.</p>
<p>Before subtraction, the background workspace is multiplied by <em>FlatBkgScaling</em>.</p>
<p>The background used for the subtraction can be retrieved using the <em>OutputFlatBkgWorkspace</em> property. This property holds either the same workspace as <em>FlatBkgWorkspace</em>, or a workspace created by <a class="reference internal" href="CalculateFlatBackground-v1.html#algm-calculateflatbackground"><em>CalculateFlatBackground</em></a>. Note that no <em>FlatBkgScaling</em> is applied to this workspace.</p>
</div>
<div class="section" id="elastic-peak-positions-epp">
<h4><a class="toc-backref" href="#id8">Elastic peak positions (EPP)</a><a class="headerlink" href="#elastic-peak-positions-epp" title="Permalink to this headline">¶</a></h4>
<p>Information on the elastic peaks (position, peak width) is needed for incident energy calibration, as well as for the <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><em>DirectILLDiagnostics</em></a> and <a class="reference internal" href="DirectILLIntegrateVanadium-v1.html#algm-directillintegratevanadium"><em>DirectILLIntegrateVanadium</em></a> algorithms. This data comes in the form of a EPP workspace which is a TableWorkspace containing columns specified by the <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><em>FindEPP</em></a> algorithm.</p>
<p>If no external EPP table is given by the <em>EPPWorkspace</em> property, the algorithm either fits the elastic peaks using <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><em>FindEPP</em></a>, or calculates their nominal positions using <a class="reference internal" href="CreateEPP-v1.html#algm-createepp"><em>CreateEPP</em></a>. This behavior can be controlled by the <em>EPPCreationMode</em> property. The default (&#8216;EPP Method AUTO&#8217;) is to calculate the positions for the IN5 instrument, and to fit for any other instrument.</p>
<p>In the calculation case, a nominal peak width can be given using the <em>Sigma</em> property.  The peak width is needed for some integration operations. If <em>Sigma</em> is not specified, ten times the first bin width in the workspace will be used.</p>
</div>
<div class="section" id="incident-energy-calibration">
<h4><a class="toc-backref" href="#id9">Incident energy calibration</a><a class="headerlink" href="#incident-energy-calibration" title="Permalink to this headline">¶</a></h4>
<p>This step applies to IN4 and IN6 only. Incident energy calibration is disabled for IN5 by default.</p>
<p>Incident energy is calibrated either by giving a new energy as a single-value workspace in <em>IncidentEnergyWorkspace</em> or calculating it from the elastic peak positions. The elastic peak position can be given by <em>EPPWorkspace</em>. If this parameter not specified, <a class="reference internal" href="FindEPP-v2.html#algm-findepp"><em>FindEPP</em></a> is used.</p>
<p>The calibrated energy can be retrieved as a single-value workspace using the <em>OutputIncidentEnergyWorkspace</em> property.</p>
</div>
<div class="section" id="tof-axis-adjustment">
<h4><a class="toc-backref" href="#id10">TOF axis adjustment</a><a class="headerlink" href="#tof-axis-adjustment" title="Permalink to this headline">¶</a></h4>
<p>The TOF axis is adjusted according to the elastic channel number found in the &#8216;Detector.elasticpeak&#8217; sample log.</p>
</div>
</div>
<div class="section" id="optional-inputs-and-outputs">
<h3><a class="toc-backref" href="#id11">Optional inputs and outputs</a><a class="headerlink" href="#optional-inputs-and-outputs" title="Permalink to this headline">¶</a></h3>
<p>The algorithm has some optional input and output workspaces. Their purpose is to extract some common information from a single data set and use it as input for other algorithms or data sets. An example would be backgrounds extracted from a low temperature measurement which can be used when reducing data taken at higher temperatures.</p>
<p>The optional input and output workspaces come in pairs. If the input workspace is specified, it will be used in the reduction and returned as the corresponding output workspace. If the input workspace is not specified, the needed information is calculated from the current spectra, and returned in the output workspace.</p>
<ul class="simple">
<li><em>EPPWorkspace</em> &#8212; <em>OutputEPPWorkspace</em>: elastic peak position table, used for incident energy calibration, but also in <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><em>DirectILLDiagnostics</em></a> and <a class="reference internal" href="DirectILLIntegrateVanadium-v1.html#algm-directillintegratevanadium"><em>DirectILLIntegrateVanadium</em></a>.</li>
<li><em>IncidentEnergyWorkspace</em> &#8212; <em>OutputIncidentEnergyWorkspace</em>: single-valued workspace containing calibrated incident energy, used for incident energy calibration.</li>
<li><em>FlatBkgWorkspace</em> &#8212; <em>OutputFlatBkgWorkspace</em>: a MatrixWorkspace containing the flat backgrounds. Used for flat background subtraction. Note that <em>FlatBkgScaling</em> is not applied to <em>OutputFlatBkgWorkspace</em>.</li>
</ul>
<div class="section" id="raw-output-workspace">
<h4><a class="toc-backref" href="#id12">Raw output workspace</a><a class="headerlink" href="#raw-output-workspace" title="Permalink to this headline">¶</a></h4>
<p>The <em>OutputRawWorkspace</em> property provides an access to a &#8216;raw&#8217; data workspace in the sense that no normalisation or background subtraction is applied to this workspace. The raw workspace is useful as an input workspace for the <a class="reference internal" href="DirectILLDiagnostics-v1.html#algm-directilldiagnostics"><em>DirectILLDiagnostics</em></a> algorithm.</p>
</div>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id13">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Fake IN4 workspace as input</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="c"># Create a fake IN4 workspace.</span>
<span class="c"># We need an instrument and a template first.</span>
<span class="n">empty_IN4</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;IN4&#39;</span><span class="p">)</span>
<span class="n">nHist</span> <span class="o">=</span> <span class="n">empty_IN4</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>
<span class="c"># Make TOF bin edges.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">530.0</span><span class="p">,</span> <span class="mf">2420.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="c"># Make some Gaussian spectra.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">970</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="c"># Repeat data for each histogram.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span>
    <span class="n">DataX</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span>
    <span class="n">DataY</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span>
    <span class="n">NSpec</span><span class="o">=</span><span class="n">nHist</span><span class="p">,</span>
    <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;TOF&#39;</span><span class="p">,</span>
    <span class="n">ParentWorkspace</span><span class="o">=</span><span class="n">empty_IN4</span>
<span class="p">)</span>
<span class="c"># Manually correct monitor spectrum number as LoadEmptyInstrument does</span>
<span class="c"># not know about such details.</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">ParameterName</span><span class="o">=</span><span class="s">&#39;default-incident-monitor-spectrum&#39;</span><span class="p">,</span>
    <span class="n">ParameterType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="c"># Add incident energy information to sample logs.</span>
<span class="n">AddSampleLog</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">LogName</span><span class="o">=</span><span class="s">&#39;Ei&#39;</span><span class="p">,</span>
    <span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">57</span><span class="p">),</span>
    <span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">LogUnit</span><span class="o">=</span><span class="s">&#39;meV&#39;</span><span class="p">,</span>
    <span class="n">NumberType</span><span class="o">=</span><span class="s">&#39;Double&#39;</span>
<span class="p">)</span>
<span class="c"># Elastic channel information is missing in the sample logs.</span>
<span class="c"># It can be given as single valued workspace, as well.</span>
<span class="n">elasticChannelWS</span> <span class="o">=</span> <span class="n">CreateSingleValuedWorkspace</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span>

<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">ElasticChannelWorkspace</span><span class="o">=</span><span class="n">elasticChannelWS</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s">&#39;Energy Calibration OFF&#39;</span><span class="p">,</span> <span class="c"># Normally we would enable this for IN4.</span>
<span class="p">)</span>

<span class="c"># Notably, the TOF axis got adjusted in DirectILLCollectData</span>
<span class="n">preprocessedWS</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;preprocessed&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;TOF offset without corrections: {:.4} microseconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Corrected TOF offset: {:.4} microseconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preprocessedWS</span><span class="o">.</span><span class="n">readX</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>TOF offset without corrections: 530.0 microseconds
Corrected TOF offset: 380.1 microseconds
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id14">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/2f15ec50de5065d8b6a032a915ac44d99f4a8835/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/DirectILLCollectData.py">DirectILLCollectData.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DirectILLApplySelfShielding-v1.html" title="Previous Chapter: DirectILLApplySelfShielding v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DirectILLApplySe...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLDiagnostics-v1.html" title="Next Chapter: DirectILLDiagnostics v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLDiagnos... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>