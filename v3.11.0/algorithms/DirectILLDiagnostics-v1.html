<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DirectILLDiagnostics v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.11.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="DirectILLIntegrateVanadium v1" href="DirectILLIntegrateVanadium-v1.html" />
    <link rel="prev" title="DirectILLCollectData v1" href="DirectILLCollectData-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.11</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="directilldiagnostics-v1">
<span id="algm-directilldiagnostics"></span><span id="algm-directilldiagnostics-v1"></span><h1>DirectILLDiagnostics v1<a class="headerlink" href="#directilldiagnostics-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/DirectILLDiagnostics-v1_dlg.png"><img alt="../_images/DirectILLDiagnostics-v1_dlg.png" class="screenshot" src="../_images/DirectILLDiagnostics-v1_dlg.png" style="width: 242px;" /></a>
<p class="caption"><strong>DirectILLDiagnostics</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a><ul>
<li><a class="reference internal" href="#diagnostics-performed" id="id4">Diagnostics performed</a><ul>
<li><a class="reference internal" href="#elastic-peak-diagnostics" id="id5">Elastic peak diagnostics</a></li>
<li><a class="reference internal" href="#flat-background-diagnostics" id="id6">Flat background diagnostics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#beam-stop" id="id7">Beam stop</a></li>
<li><a class="reference internal" href="#defaul-mask" id="id8">Defaul mask</a></li>
<li><a class="reference internal" href="#diagnostics-reporting" id="id9">Diagnostics reporting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage" id="id10">Usage</a></li>
<li><a class="reference internal" href="#source" id="id11">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Perform detector diagnostics and masking for the direct geometry TOF spectrometers at ILL.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="3%" />
<col width="17%" />
<col width="11%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>InputWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Raw input workspace.</td>
</tr>
<tr class="row-odd"><td>OutputWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/Workspace.html#workspace"><em>Workspace</em></a></td>
<td><em>Mandatory</em></td>
<td>A diagnostics mask workspace.</td>
</tr>
<tr class="row-even"><td>Cleanup</td>
<td>Input</td>
<td>string</td>
<td>Cleanup ON</td>
<td>What to do with intermediate workspaces. Allowed values: [&#8216;Cleanup ON&#8217;, &#8216;Cleanup OFF&#8217;]</td>
</tr>
<tr class="row-odd"><td>SubalgorithmLogging</td>
<td>Input</td>
<td>string</td>
<td>Logging OFF</td>
<td>Enable or disable subalgorithms to print in the logs. Allowed values: [&#8216;Logging OFF&#8217;, &#8216;Logging ON&#8217;]</td>
</tr>
<tr class="row-even"><td>EPPWorkspace</td>
<td>Input</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Table workspace containing results from the FindEPP algorithm.</td>
</tr>
<tr class="row-odd"><td>ElasticPeakDiagnostics</td>
<td>Input</td>
<td>string</td>
<td>Peak Diagnostics AUTO</td>
<td>Enable or disable elastic peak diagnostics. Allowed values: [&#8216;Peak Diagnostics AUTO&#8217;, &#8216;Peak Diagnostics ON&#8217;, &#8216;Peak Diagnostics OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>ElasticPeakWidthInSigmas</td>
<td>Input</td>
<td>number</td>
<td>3</td>
<td>Integration width of the elastic peak in multiples  of &#8216;Sigma&#8217; in the EPP table.</td>
</tr>
<tr class="row-odd"><td>ElasticPeakLowThreshold</td>
<td>Input</td>
<td>number</td>
<td>0.1</td>
<td>Multiplier for lower acceptance limit used in elastic peak diagnostics.</td>
</tr>
<tr class="row-even"><td>ElasticPeakHighThreshold</td>
<td>Input</td>
<td>number</td>
<td>3</td>
<td>Multiplier for higher acceptance limit used in elastic peak diagnostics.</td>
</tr>
<tr class="row-odd"><td>ElasticPeakErrorThreshold</td>
<td>Input</td>
<td>number</td>
<td>3.3</td>
<td>Error bar multiplier for significance test in the elastic peak diagnostics.</td>
</tr>
<tr class="row-even"><td>BkgDiagnostics</td>
<td>Input</td>
<td>string</td>
<td>Bkg Diagnostics AUTO</td>
<td>Control the background diagnostics. Allowed values: [&#8216;Bkg Diagnostics AUTO&#8217;, &#8216;Bkg Diagnostics ON&#8217;, &#8216;Bkg Diagnostics OFF&#8217;]</td>
</tr>
<tr class="row-odd"><td>NonBkgRegionInSigmas</td>
<td>Input</td>
<td>number</td>
<td>10</td>
<td>Width of the range excluded from background integration around the elastic peaks in multiplies of &#8216;Sigma&#8217; in the EPP table</td>
</tr>
<tr class="row-even"><td>NoisyBkgLowThreshold</td>
<td>Input</td>
<td>number</td>
<td>0.1</td>
<td>Multiplier for lower acceptance limit used in noisy background diagnostics.</td>
</tr>
<tr class="row-odd"><td>NoisyBkgHighThreshold</td>
<td>Input</td>
<td>number</td>
<td>3.3</td>
<td>Multiplier for higher acceptance limit used in noisy background diagnostics.</td>
</tr>
<tr class="row-even"><td>NoisyBkgErrorThreshold</td>
<td>Input</td>
<td>number</td>
<td>3.3</td>
<td>Error bar multiplier for significance test in the noisy background diagnostics.</td>
</tr>
<tr class="row-odd"><td>BeamStopDiagnostics</td>
<td>Input</td>
<td>string</td>
<td>Beam Stop Diagnostics AUTO</td>
<td>Control the beam stop diagnostics. Allowed values: [&#8216;Beam Stop Diagnostics AUTO&#8217;, &#8216;Beam Stop Diagnostics ON&#8217;, &#8216;Beam Stop Diagnostics OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>BeamStopThreshold</td>
<td>Input</td>
<td>number</td>
<td>0.67</td>
<td>Multiplier for the lower acceptance limit for beam stop diagnostics.</td>
</tr>
<tr class="row-odd"><td>DefaultMask</td>
<td>Input</td>
<td>string</td>
<td>Default Mask ON</td>
<td>Enable or disable instrument specific default mask. Allowed values: [&#8216;Default Mask ON&#8217;, &#8216;Default Mask OFF&#8217;]</td>
</tr>
<tr class="row-even"><td>MaskedDetectors</td>
<td>Input</td>
<td>int list</td>
<td>&nbsp;</td>
<td>List of spectra to mask.</td>
</tr>
<tr class="row-odd"><td>MaskedComponents</td>
<td>Input</td>
<td>str list</td>
<td>&nbsp;</td>
<td>List of instrument components to mask.</td>
</tr>
<tr class="row-even"><td>OutputReportWorkspace</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/TableWorkspaces.html#table-workspaces"><em>TableWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Output table workspace for detector diagnostics reporting.</td>
</tr>
<tr class="row-odd"><td>OutputReport</td>
<td>Output</td>
<td>string</td>
<td>&nbsp;</td>
<td>Diagnostics report as a string.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This algorithm performs detector diagnostics and masking. It is part of <a class="reference internal" href="../techniques/DirectILL.html#directill"><em>ILL&#8217;s direct geometry data reduction suite</em></a>. The diagnostics are calculated using the counts from <em>InputWorkspace</em> which is preferably the raw workspace provided by the <em>OutputRawWorkspace</em> property of <a class="reference internal" href="DirectILLCollectData-v1.html#algm-directillcollectdata"><em>DirectILLCollectData</em></a>. The output is a special mask workspace which can be further fed to <a class="reference internal" href="DirectILLReduction-v1.html#algm-directillreduction"><em>DirectILLReduction</em></a> to mask the detectors diagnosed as bad. Optionally, an instrument specific default mask, a beam stop mask and/or a user specified hard mask given by <em>MaskedDetectors</em> or <em>MaskedComponents</em> can be added to the diagnostics mask.</p>
<p>A workflow diagram for the diagnostics is shown below:</p>
<img alt="../_images/DirectILLDiagnostics-v1_wkflw.png" src="../_images/DirectILLDiagnostics-v1_wkflw.png" />
<div class="section" id="diagnostics-performed">
<h3><a class="toc-backref" href="#id4">Diagnostics performed</a><a class="headerlink" href="#diagnostics-performed" title="Permalink to this headline">¶</a></h3>
<p>The algorithm performs two tests for each spectrum in <em>InputWorkspace</em>: elastic peak diagnostics and flat background diagnostics. Basically both tests calculate the median of the test values over all spectra, then compare the individual values to the median. For more detailed information, see <a class="reference internal" href="MedianDetectorTest-v1.html#algm-mediandetectortest"><em>MedianDetectorTest</em></a>.</p>
<div class="section" id="elastic-peak-diagnostics">
<h4><a class="toc-backref" href="#id5">Elastic peak diagnostics</a><a class="headerlink" href="#elastic-peak-diagnostics" title="Permalink to this headline">¶</a></h4>
<p>The EPP table given in <em>EPPWorkspace</em> and the value of <em>ElasticPeakWidthInSigmas</em> are used to integrate the spectra around the elastic peaks, giving the elastic intensities. The intensities are further normalised by the opening solid angles of the detectors, given by <a class="reference internal" href="SolidAngle-v1.html#algm-solidangle"><em>SolidAngle</em></a> before the actual diagnostics.</p>
</div>
<div class="section" id="flat-background-diagnostics">
<h4><a class="toc-backref" href="#id6">Flat background diagnostics</a><a class="headerlink" href="#flat-background-diagnostics" title="Permalink to this headline">¶</a></h4>
<p>Similarly to elastic peak diagnostics, <em>EPPWorkspace</em> and <em>NonBgkRegionInSigmas</em> are used to integrate the time-independent background regions of <em>InputWorkspace</em>. <em>NonBkgRegionInSigmas</em> is a factor applied to the &#8216;Sigma&#8217; column in <em>EPPWorkspace</em> and this interval around the elastic peak positions is excluded from the integration. No opening angle corrections are applied to the background diagnostics.</p>
</div>
</div>
<div class="section" id="beam-stop">
<h3><a class="toc-backref" href="#id7">Beam stop</a><a class="headerlink" href="#beam-stop" title="Permalink to this headline">¶</a></h3>
<p>The shadow cast on the detectors by a beam stop can be masked by the diagnostics, as well. This functionality is automatically enabled when &#8216;beam_stop_diagnostics_spectra&#8217; instrument parameter is defined and can be disabled by <em>BeamStopDiagnostics</em>. The algorithm tries to mask a continuous region within the spectra listed in &#8216;beam_stop_diagnostics_spectra&#8217;. The <em>BeamStopThreshold</em> property can be used to fine-tune the operation.</p>
<p>The &#8216;beam_stop_diagnostics_spectra&#8217; instrument parameter lists ranges of spectrum numbers. Each range should cover a region of a physical detector tube, part of which is behind the beam stop.</p>
<p>The masking procedure proceeds as follows:</p>
<ol class="arabic simple">
<li>Pick a range from &#8216;beam_stop_diagnostics_spectra&#8217;.</li>
<li>Integrate the spectra within the range.</li>
<li>Divide the range into two halves from the middle.</li>
<li>Pick one of the halves, take the maximum integrated value.</li>
<li>Starting from the spectrum containing the maximum value, and stepping towards the center of the range, find the first spectrum where the integrated intensity is less than the maximum intensity multiplied by <em>BeamStopThreshold</em>. Lets call this the threshold spectrum.</li>
<li>Mark all spectra from the middle of the range to the threshold spectrum as masked.</li>
<li>Repeat for the other half.</li>
</ol>
</div>
<div class="section" id="defaul-mask">
<h3><a class="toc-backref" href="#id8">Defaul mask</a><a class="headerlink" href="#defaul-mask" title="Permalink to this headline">¶</a></h3>
<p>The default mask file is defined by the &#8216;Workflow.MaskFile&#8217; instrument parameter.</p>
</div>
<div class="section" id="diagnostics-reporting">
<h3><a class="toc-backref" href="#id9">Diagnostics reporting</a><a class="headerlink" href="#diagnostics-reporting" title="Permalink to this headline">¶</a></h3>
<p>The optional <em>OutputReportWorkspace</em> property returns a table workspace summarizing the diagnostics. The table has six columns:</p>
<ol class="arabic simple">
<li>&#8216;WorkspaceIndex&#8217;</li>
<li>&#8216;UserMask&#8217;: Holds non-zero values for spectra masked by the default mask, <em>MaskedDetectors</em> and <em>MaskedComponents</em>.</li>
<li>&#8216;ElasticIntensity&#8217;: Holds the value of integrated elastic peaks used for the diagnostics.</li>
<li>&#8216;IntensityDiagnosed&#8217;: Holds non-zero values for spectra diagnosed as &#8216;bad&#8217; in elastic peak diagnostics.</li>
<li>&#8216;FlagBkg&#8217;: Holds the value of the flat backgrounds used for the diagnostics.</li>
<li>&#8216;FlatBkgDiagnosed&#8217;: Non-zero values in this column indicate that the spectrum did not pass the background diagnostics.</li>
</ol>
<p>The columns can be plotted to get an overview of the diagnostics.</p>
<p>Additionally, a string listing the masked and diagnosed detectors can be accessed via the <em>OutputReport</em> property.</p>
</div>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id10">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Diagnostics on fake IN4 workspace</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>

<span class="c"># Create a fake IN4 workspace.</span>
<span class="c"># We need an instrument and a template first.</span>
<span class="n">empty_IN4</span> <span class="o">=</span> <span class="n">LoadEmptyInstrument</span><span class="p">(</span><span class="n">InstrumentName</span><span class="o">=</span><span class="s">&#39;IN4&#39;</span><span class="p">)</span>
<span class="n">nHist</span> <span class="o">=</span> <span class="n">empty_IN4</span><span class="o">.</span><span class="n">getNumberHistograms</span><span class="p">()</span>
<span class="c"># Make TOF bin edges.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">530.0</span><span class="p">,</span> <span class="mf">2420.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>
<span class="c"># Make some Gaussian spectra.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">970</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="c"># Repeat data for each histogram.</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">nHist</span><span class="p">)</span>
<span class="n">ws</span> <span class="o">=</span> <span class="n">CreateWorkspace</span><span class="p">(</span>
    <span class="n">DataX</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span>
    <span class="n">DataY</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span>
    <span class="n">NSpec</span><span class="o">=</span><span class="n">nHist</span><span class="p">,</span>
    <span class="n">UnitX</span><span class="o">=</span><span class="s">&#39;TOF&#39;</span><span class="p">,</span>
    <span class="n">ParentWorkspace</span><span class="o">=</span><span class="n">empty_IN4</span>
<span class="p">)</span>
<span class="c"># Set some histograms to zero to see if the diagnostics can catch them.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">*=</span> <span class="mf">0.0</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">ws</span><span class="o">.</span><span class="n">dataY</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">*=</span> <span class="mf">0.0</span>

<span class="c"># Manually correct monitor spectrum number as LoadEmptyInstrument does</span>
<span class="c"># not know about such details.</span>
<span class="n">SetInstrumentParameter</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">ParameterName</span><span class="o">=</span><span class="s">&#39;default-incident-monitor-spectrum&#39;</span><span class="p">,</span>
    <span class="n">ParameterType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">Value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="c"># Add incident energy information to sample logs.</span>
<span class="n">AddSampleLog</span><span class="p">(</span>
    <span class="n">Workspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">LogName</span><span class="o">=</span><span class="s">&#39;Ei&#39;</span><span class="p">,</span>
    <span class="n">LogText</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="mi">57</span><span class="p">),</span>
    <span class="n">LogType</span><span class="o">=</span><span class="s">&#39;Number&#39;</span><span class="p">,</span>
    <span class="n">LogUnit</span><span class="o">=</span><span class="s">&#39;meV&#39;</span><span class="p">,</span>
    <span class="n">NumberType</span><span class="o">=</span><span class="s">&#39;Double&#39;</span>
<span class="p">)</span>
<span class="c"># Elastic channel information is missing in the sample logs.</span>
<span class="c"># It can be given as single valued workspace, as well.</span>
<span class="n">elasticChannelWS</span> <span class="o">=</span> <span class="n">CreateSingleValuedWorkspace</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span>

<span class="n">DirectILLCollectData</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="n">ws</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">ElasticChannelWorkspace</span><span class="o">=</span><span class="n">elasticChannelWS</span><span class="p">,</span>
    <span class="n">IncidentEnergyCalibration</span><span class="o">=</span><span class="s">&#39;Energy Calibration OFF&#39;</span><span class="p">,</span> <span class="c"># Normally we would do this for IN4.</span>
    <span class="n">OutputEPPWorkspace</span><span class="o">=</span><span class="s">&#39;epps&#39;</span> <span class="c"># Needed for the diagnostics.</span>
<span class="p">)</span>

<span class="n">diagnostics</span> <span class="o">=</span> <span class="n">DirectILLDiagnostics</span><span class="p">(</span>
    <span class="n">InputWorkspace</span><span class="o">=</span><span class="s">&#39;preprocessed&#39;</span><span class="p">,</span>
    <span class="n">OutputWorkspace</span><span class="o">=</span><span class="s">&#39;diagnosed&#39;</span><span class="p">,</span>
    <span class="n">EPPWorkspace</span><span class="o">=</span><span class="s">&#39;epps&#39;</span><span class="p">,</span>
    <span class="n">NoisyBkgLowThreshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">OutputReportWorkspace</span><span class="o">=</span><span class="s">&#39;diagnostics_report&#39;</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">OutputReport</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Some small-angle detectors got diagnosed as bad due to detector solid angle corrections.&#39;</span><span class="p">)</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">mtd</span><span class="p">[</span><span class="s">&#39;diagnostics_report&#39;</span><span class="p">]</span>
<span class="n">I0</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s">&#39;ElasticIntensity&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">I304</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">cell</span><span class="p">(</span><span class="s">&#39;ElasticIntensity&#39;</span><span class="p">,</span> <span class="mi">303</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Solid-angle corrected elastic intensity of spectrum 1: {:.8}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I0</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;vs. corrected intensity of spectrum 304: {:.8}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I304</span><span class="p">))</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-none"><div class="highlight"><pre>Spectra masked by default mask file:
None
Spectra masked by user:
None
Spectra masked by beam stop diagnostics:
None
Spectra marked as bad by elastic peak diagnostics:
14, 102, 302-305, 314-317, 326-329, 338-341, 350-353, 362-365, 374-377, 386-389
Spectra marked as bad by flat background diagnostics:
14, 102
Some small-angle detectors got diagnosed as bad due to detector solid angle corrections.
Solid-angle corrected elastic intensity of spectrum 1: 555524.7
vs. corrected intensity of spectrum 304: 1795774.9
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Workflow/Inelastic.html">Workflow\Inelastic</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id11">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>Python: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/2f15ec50de5065d8b6a032a915ac44d99f4a8835/Framework/PythonInterface/plugins/algorithms/WorkflowAlgorithms/DirectILLDiagnostics.py">DirectILLDiagnostics.py</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="DirectILLCollectData-v1.html" title="Previous Chapter: DirectILLCollectData v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; DirectILLCollect...</span>
    </a>
  </li>
  <li>
    <a href="DirectILLIntegrateVanadium-v1.html" title="Next Chapter: DirectILLIntegrateVanadium v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">DirectILLIntegra... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>