<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>CalculateCountRate v1</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="next" title="CalculateCoverageDGS v1" href="CalculateCoverageDGS-v1.html" />
    <link rel="prev" title="CalculateCostFunction v1" href="CalculateCostFunction-v1.html" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59110517-1', 'auto');
  ga('send', 'pageview');

</script>


  </head>
  <body>





  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://www.mantidproject.org"><img src="../_static/Mantid_Logo_Transparent.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b>3.9</b></span>
      </div>

      
        <div class="collapse navbar-collapse nav-collapse">
      
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://www.mantidproject.org">Home</a></li>
                <li><a href="http://download.mantidproject.org">Download</a></li>
                <li><a href="http://www.mantidproject.org/Documentation">Documentation</a></li>
                <li><a href="http://www.mantidproject.org/Contact">Contact Us</a></li>
            
            
              
              
            
            
            
            
          </ul>
              
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
            </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="calculatecountrate-v1">
<span id="algm-calculatecountrate"></span><span id="algm-calculatecountrate-v1"></span><h1>CalculateCountRate v1<a class="headerlink" href="#calculatecountrate-v1" title="Permalink to this headline">¶</a></h1>
<div class="figure align-right" id="index-0">
<a class="screenshot reference internal image-reference" href="../_images/CalculateCountRate-v1_dlg.png"><img alt="../_images/CalculateCountRate-v1_dlg.png" class="screenshot" src="../_images/CalculateCountRate-v1_dlg.png" style="width: 192px;" /></a>
<p class="caption"><strong>CalculateCountRate</strong> dialog.</p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id1">Summary</a></li>
<li><a class="reference internal" href="#properties" id="id2">Properties</a></li>
<li><a class="reference internal" href="#description" id="id3">Description</a></li>
<li><a class="reference internal" href="#usage" id="id4">Usage</a></li>
<li><a class="reference internal" href="#source" id="id5">Source</a></li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id1">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Calculates instrument count rate as the function of the experiment time and adds CountRate log to the source workspace.</p>
</div>
<div class="section" id="properties">
<h2><a class="toc-backref" href="#id2">Properties</a><a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="3%" />
<col width="1%" />
<col width="5%" />
<col width="2%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Direction</th>
<th class="head">Type</th>
<th class="head">Default</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Workspace</td>
<td>InOut</td>
<td><a class="reference internal" href="../concepts/EventWorkspace.html#eventworkspace"><em>EventWorkspace</em></a></td>
<td><em>Mandatory</em></td>
<td>Name of the event workspace to calculate counting rate for.</td>
</tr>
<tr class="row-odd"><td>XMin</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Minimal value of X-range for the rate calculations. If left to default, Workspace X-axis minimal value is used.</td>
</tr>
<tr class="row-even"><td>XMax</td>
<td>Input</td>
<td>number</td>
<td><em>Optional</em></td>
<td>Maximal value of X-range for the rate calculations. If left to default, Workspace X-axis maximal value is used.</td>
</tr>
<tr class="row-odd"><td>RangeUnits</td>
<td>Input</td>
<td>string</td>
<td>Energy</td>
<td>The units from Mantid Unit factory for calculating the counting rate and XMin-XMax ranges are in. If the X-axis of the input workspace is not expressedin these units, unit conversion will be performed, so the workspace should contain all necessary information for this conversion. E.g. if <em>RangeUnits</em> is <em>EnergyTransfer</em>, Ei log containing incident energy value should be attached to the input workspace. See ConvertUnits algorithm for the details. Allowed values: [&#8216;Degrees&#8217;, &#8216;DeltaE&#8217;, &#8216;DeltaE_inWavenumber&#8217;, &#8216;dSpacing&#8217;, &#8216;Empty&#8217;, &#8216;Energy&#8217;, &#8216;Energy_inWavenumber&#8217;, &#8216;Label&#8217;, &#8216;Momentum&#8217;, &#8216;MomentumTransfer&#8217;, &#8216;QSquared&#8217;, &#8216;SpinEchoLength&#8217;, &#8216;SpinEchoTime&#8217;, &#8216;Time&#8217;, &#8216;TOF&#8217;, &#8216;Wavelength&#8217;]</td>
</tr>
<tr class="row-even"><td>EMode</td>
<td>Input</td>
<td>string</td>
<td>Elastic</td>
<td>The energy mode for &#8216;RangeUnits&#8217; conversion mode (default: elastic). Allowed values: [&#8216;Elastic&#8217;, &#8216;Direct&#8217;, &#8216;Indirect&#8217;]</td>
</tr>
<tr class="row-odd"><td>NormalizeTheRate</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>Usually you want to normalize counting rate to some rate related to the source beam intensity. Change this to &#8216;false&#8217; if appropriate time series log is broken || not attached to the input workspace.</td>
</tr>
<tr class="row-even"><td>UseLogDerivative</td>
<td>Input</td>
<td>boolean</td>
<td>False</td>
<td>If the normalization log contains cumulative counting, derivative of this log is necessary to get correct normalization values.</td>
</tr>
<tr class="row-odd"><td>NormalizationLogName</td>
<td>Input</td>
<td>string</td>
<td>proton_charge</td>
<td>The name of the log, used in the counting rate normalization.</td>
</tr>
<tr class="row-even"><td>CountRateLogName</td>
<td>Input</td>
<td>string</td>
<td>block_count_rate</td>
<td>The name of the processed time series log with instrument count rate to be added to the source workspace</td>
</tr>
<tr class="row-odd"><td>UseNormLogGranularity</td>
<td>Input</td>
<td>boolean</td>
<td>True</td>
<td>If true, the count rate log will have the normalization log accuracy; If false, the &#8216;NumTimeSteps&#8217; in the visualization workspace below will be used for the target log granularity too.</td>
</tr>
<tr class="row-even"><td>VisualizationWs</td>
<td>Output</td>
<td><a class="reference internal" href="../concepts/MatrixWorkspace.html#matrixworkspace"><em>MatrixWorkspace</em></a></td>
<td>&nbsp;</td>
<td>Optional name to build 2D matrix workspace for spurion visualization. If name is provided, a 2D workspace with this name will be created containing data to visualize counting rate as function of time in the ranges XMin-XMax</td>
</tr>
<tr class="row-odd"><td>NumTimeSteps</td>
<td>Input</td>
<td>number</td>
<td>200</td>
<td>Number of time steps (time accuracy) the visualization workspace has. Also number of steps in &#8216;CountRateLogName&#8217; log if &#8216;UseNormLogGranularity&#8217; is set to false. Should be bigger than 3</td>
</tr>
<tr class="row-even"><td>XResolution</td>
<td>Input</td>
<td>number</td>
<td>100</td>
<td>Number of steps (accuracy) of the visualization workspace has along X-axis.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="description">
<h2><a class="toc-backref" href="#id3">Description</a><a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The algorithm works with event workspaces produced by instruments operating in event mode and calculates the rate at which an instrument counts
neutrons as function of the experiment time.
Then it adds the time series log containing this rate, with the name, defined by
<strong>CountRateLogName</strong> property to the source workspace.</p>
<p>Additionally it can also calculate 2D matrix workspace, which contains count rate as function of
experiment time and neutrons time of flight or energy or other neutron property related to the time of flight in the range <strong>XMin-XMax</strong>
in the units defined by <strong>RangeUnits</strong> property.</p>
<p>In normal circumstances the instrument count rate does not change. Unfortunately, Data Acquisition Electronics sometimes randomly generates spurious signals,
appearing randomly at some moments of the experiment time. Such signals distort real physical image, obtained in experiment and should be removed.</p>
<p>The picture below gives example of counting rate log, calculated by the algorithm together with image of the visualization workspace,
which shows the spurious signal as function of experiment time and neutron energy.</p>
<img alt="../_images/SpurionReal.png" src="../_images/SpurionReal.png" />
<p>The calculated log above can be used as input for <a class="reference internal" href="FilterByLogValue-v1.html#algm-filterbylogvalue"><em>FilterByLogValue v1</em></a> algorithm to filter events recorded around 200sec of experiment time to
remove spurious signal at 2.9mEv.</p>
<p>The algorithm can also be used to evaluate changes of sample reflectivity as function of some slow changing experiment&#8217;s
parameter e.g. temperature, magnetic field or pressure.</p>
<p><strong>NOTE:</strong> Normally one wants to divide the count rate by a value, proportional to incident neutron flux to avoid count rate dependency from changing incident beam intensity.
Usually algorithm just divides the neutron counts by <em>proton_charge</em> log values, normally recorded per frame basis.
If this log is not available, other logs can be used to estimate incident beam intensity.
Visualization workspace is usually calculated with much more coarse time step than the count_rate log, so the normalization used in visualization workspace
is just the sum of all values of the log used for normalization falling within the visualization time step.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id4">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p><strong>Example - Calculate Count Rate</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="s">&quot;LogTest&quot;</span> <span class="ow">in</span> <span class="n">mtd</span><span class="p">:</span>
    <span class="n">DeleteWorkspace</span><span class="p">(</span><span class="s">&quot;LogTest&quot;</span><span class="p">)</span>
<span class="c"># Create sample workspace with events</span>
<span class="n">LogTest</span><span class="o">=</span><span class="n">CreateSampleWorkspace</span><span class="p">(</span><span class="n">WorkspaceType</span><span class="o">=</span><span class="s">&#39;Event&#39;</span><span class="p">,</span> <span class="n">Function</span><span class="o">=</span><span class="s">&#39;Flat background&#39;</span><span class="p">)</span>
<span class="n">log_name</span> <span class="o">=</span> <span class="s">&#39;block_count_rate&#39;</span><span class="p">;</span>

<span class="c"># no rate log found:</span>
<span class="n">rez</span> <span class="o">=</span> <span class="n">CheckForSampleLogs</span><span class="p">(</span><span class="n">LogTest</span><span class="p">,</span><span class="n">log_name</span><span class="p">)</span>
<span class="k">print</span> <span class="p">(</span><span class="s">&quot;Initially, {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">))</span>

<span class="c"># calculate number of events in the workspace</span>
<span class="n">CalculateCountRate</span><span class="p">(</span><span class="n">LogTest</span><span class="p">,</span><span class="n">CountRateLogName</span><span class="o">=</span> <span class="n">log_name</span><span class="p">)</span>

<span class="n">rez</span> <span class="o">=</span> <span class="n">CheckForSampleLogs</span><span class="p">(</span><span class="n">LogTest</span><span class="p">,</span><span class="n">log_name</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rez</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
     <span class="k">print</span> <span class="p">(</span><span class="s">&quot;The Algorithm produced log: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_name</span><span class="p">))</span>
     <span class="n">log</span> <span class="o">=</span> <span class="n">LogTest</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">getLogData</span><span class="p">(</span><span class="n">log_name</span><span class="p">)</span>
     <span class="k">print</span> <span class="p">(</span><span class="s">&quot;log {0} contains {1} entries&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_name</span><span class="p">,</span><span class="n">log</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
     <span class="k">print</span> <span class="p">(</span><span class="s">&quot;log starts at {0} and records value: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">firstTime</span><span class="p">(),</span><span class="n">log</span><span class="o">.</span><span class="n">firstValue</span><span class="p">()))</span>
     <span class="k">print</span> <span class="p">(</span><span class="s">&quot;log ends   at {0} and records value: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">lastTime</span><span class="p">(),</span><span class="n">log</span><span class="o">.</span><span class="n">lastValue</span><span class="p">()))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rez</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>Initially, Property block_count_rate not found
The Algorithm produced log: block_count_rate
log block_count_rate contains 200 entries
log starts at 2010-01-01T00:00:09.011891145  and records value: 991.0
log ends   at 2010-01-01T00:59:50.996493194  and records value: 1010.0
</pre></div>
</div>
<p><strong>Categories</strong>: <a class="reference external" href="categories/Algorithms.html">Algorithms</a> | <a class="reference external" href="categories/Inelastic/Utility.html">Inelastic\Utility</a> | <a class="reference external" href="categories/Diagnostics.html">Diagnostics</a> | <a class="reference external" href="categories/Events/EventFiltering.html">Events\EventFiltering</a></p>
</div>
<div class="section" id="source">
<h2><a class="toc-backref" href="#id5">Source</a><a class="headerlink" href="#source" title="Permalink to this headline">¶</a></h2>
<p>C++ source: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/3343e70222874fbd364099f979bd048987dd346c/Framework/Algorithms/src/CalculateCountRate.cpp">CalculateCountRate.cpp</a></p>
<p>C++ header: <a class="reference external" href="https://github.com/mantidproject/mantid/blob/3343e70222874fbd364099f979bd048987dd346c/Framework/Algorithms/inc/MantidAlgorithms/CalculateCountRate.h">CalculateCountRate.h</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
      <ul class="nav navbar-nav" style=" float: right;">
      
      
          
            
  <li>
    <a href="CalculateCostFunction-v1.html" title="Previous Chapter: CalculateCostFunction v1"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; CalculateCostFun...</span>
    </a>
  </li>
  <li>
    <a href="CalculateCoverageDGS-v1.html" title="Next Chapter: CalculateCoverageDGS v1"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">CalculateCoverag... &raquo;</span>
    </a>
  </li>
          
       
          <li><a href="#">Back to top</a></li>
       </ul>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>